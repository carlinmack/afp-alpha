<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Session Verified_SAT_Based_AI_Planning - Archive of Formal Proofs</title><meta name=description content="A collection of proof libraries, examples, and larger scientific developments, mechanically checked in the theorem prover Isabelle."><meta property="og:title" content="Session Verified_SAT_Based_AI_Planning"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="/entries/verified_sat_based_ai_planning/theories/"><meta property="og:image" content="/images/afp.png"><meta property="article:section" content="theories"><meta property="og:site_name" content="Archive of Formal Proofs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/afp.png"><meta name=twitter:title content="Session Verified_SAT_Based_AI_Planning"><meta name=twitter:description content><link rel=stylesheet type=text/css href=/css/front.min.css><link rel=stylesheet type=text/css href=/css/isabelle.css><link rel=icon href=/images/favicon.ico type=image/icon><script src=/js/flexsearch.min.js></script><script src=/js/header-search.js></script></head><body class=mathjax_ignore><aside><div><div><a href=/><img src=/images/afp.png alt="Logo of the Archive of Formal Proofs" class=logo></a><ul><li><a href=/entries/verified_sat_based_ai_planning>Return to entry</a></li></ul><hr><ul><li><a href=#List_Supplement>List_Supplement</a><ul><li><a href=#List_Supplement-list_foot>list_foot</a></li><li><a href=#List_Supplement-list_ex_intersection>list_ex_intersection</a></li><li><a href=#List_Supplement-length_map_upt>length_map_upt</a></li><li><a href=#List_Supplement-not_list_ex_equals_list_all_not>not_list_ex_equals_list_all_not</a></li><li><a href=#List_Supplement-element_of_subseqs_then_subset>element_of_subseqs_then_subset</a></li><li><a href=#List_Supplement-set_of_embed_is>set_of_embed_is</a></li><li><a href=#List_Supplement-concat_is_inverse_of_embed>concat_is_inverse_of_embed</a></li><li><a href=#List_Supplement-embed_append>embed_append</a></li></ul></li><li><a href=#Map_Supplement>Map_Supplement</a><ul><li><a href=#Map_Supplement-map_of_defined_if_constructed_from_list_of_constant_assignments>map_of_defined_if_constructed_from_list_of_constant_assignments</a></li><li><a href=#Map_Supplement-map_of_from_function_graph_is_some_if>map_of_from_function_graph_is_some_if</a></li><li><a href=#Map_Supplement-foldl_map_append_is_some_if>foldl_map_append_is_some_if</a></li><li><a href=#Map_Supplement-map_of_constant_assignments_defined_if>map_of_constant_assignments_defined_if</a></li></ul></li><li><a href=#CNF_Supplement>CNF_Supplement</a><ul><li><a href=#CNF_Supplement-is_literal_formula_then_cnf_is_singleton_clause>is_literal_formula_then_cnf_is_singleton_clause</a></li><li><a href=#CNF_Supplement-literal_formula_to_literal_is_inverse_of_form_of_lit>literal_formula_to_literal_is_inverse_of_form_of_lit</a></li><li><a href=#CNF_Supplement-is_nnf_cnf>is_nnf_cnf</a></li><li><a href=#CNF_Supplement-cnf_of_literal_formula>cnf_of_literal_formula</a></li><li><a href=#CNF_Supplement-is_cnf_foldr_and_if>is_cnf_foldr_and_if</a></li></ul></li><li><a href=#CNF_Semantics_Supplement>CNF_Semantics_Supplement</a><ul><li><a href=#CNF_Semantics_Supplement-not_model_if_exists_unmodeled_singleton_clause>not_model_if_exists_unmodeled_singleton_clause</a></li><li><a href=#CNF_Semantics_Supplement-model_for_cnf_is_model_of_all_subsets>model_for_cnf_is_model_of_all_subsets</a></li><li><a href=#CNF_Semantics_Supplement-cnf_semantics_monotonous_in_cnf_subsets_if>cnf_semantics_monotonous_in_cnf_subsets_if</a></li><li><a href=#CNF_Semantics_Supplement-lit_semantics_reducible_to_subset_if>lit_semantics_reducible_to_subset_if</a></li></ul></li><li><a href=#State_Variable_Representation>State_Variable_Representation</a></li><li><a href=#STRIPS_Representation>STRIPS_Representation</a></li><li><a href=#STRIPS_Semantics>STRIPS_Semantics</a><ul><li><a href=#STRIPS_Semantics-is_valid_problem_strips_initial_of_dom>is_valid_problem_strips_initial_of_dom</a></li><li><a href=#STRIPS_Semantics-is_valid_problem_dom_of_goal_state_is>is_valid_problem_dom_of_goal_state_is</a></li><li><a href=#STRIPS_Semantics-is_valid_problem_strips_operator_variable_sets>is_valid_problem_strips_operator_variable_sets</a></li><li><a href=#STRIPS_Semantics-effect_to_assignments_i>effect_to_assignments_i</a></li><li><a href=#STRIPS_Semantics-effect_to_assignments_ii>effect_to_assignments_ii</a></li><li><a href=#STRIPS_Semantics-effect_to_assignments_iii_a>effect_to_assignments_iii_a</a></li><li><a href=#STRIPS_Semantics-effect_to_assignments_iii_b>effect_to_assignments_iii_b</a></li><li><a href=#STRIPS_Semantics-effect__strips_i>effect__strips_i</a></li><li><a href=#STRIPS_Semantics-effect__strips_ii>effect__strips_ii</a></li><li><a href=#STRIPS_Semantics-map_of_constant_assignments_dom>map_of_constant_assignments_dom</a></li><li><a href=#STRIPS_Semantics-effect__strips_iii_a>effect__strips_iii_a</a></li><li><a href=#STRIPS_Semantics-effect__strips_iii_b>effect__strips_iii_b</a></li><li><a href=#STRIPS_Semantics-effect__strips_iii_c>effect__strips_iii_c</a></li><li><a href=#STRIPS_Semantics-are_all_operators_applicable_set>are_all_operators_applicable_set</a></li><li><a href=#STRIPS_Semantics-are_all_operators_applicable_cons>are_all_operators_applicable_cons</a></li><li><a href=#STRIPS_Semantics-are_operator_effects_consistent_set>are_operator_effects_consistent_set</a></li><li><a href=#STRIPS_Semantics-are_all_operator_effects_consistent_set>are_all_operator_effects_consistent_set</a></li><li><a href=#STRIPS_Semantics-are_all_effects_consistent_tail>are_all_effects_consistent_tail</a></li><li><a href=#STRIPS_Semantics-are_all_operators_non_interfering_tail>are_all_operators_non_interfering_tail</a></li><li><a href=#STRIPS_Semantics-are_operators_interfering_symmetric>are_operators_interfering_symmetric</a></li><li><a href=#STRIPS_Semantics-are_all_operators_non_interfering_set_contains_no_distinct_interfering_operator_pairs>are_all_operators_non_interfering_set_contains_no_distinct_interfering_operator_pairs</a></li><li><a href=#STRIPS_Semantics-execute_parallel_plan_precondition_cons_i>execute_parallel_plan_precondition_cons_i</a></li><li><a href=#STRIPS_Semantics-execute_parallel_plan_precondition_cons>execute_parallel_plan_precondition_cons</a></li><li><a href=#STRIPS_Semantics-execute_parallel_operator_cons>execute_parallel_operator_cons</a></li><li><a href=#STRIPS_Semantics-execute_parallel_operator_cons_equals>execute_parallel_operator_cons_equals</a></li><li><a href=#STRIPS_Semantics-effect_to_assignments_simp>effect_to_assignments_simp</a></li><li><a href=#STRIPS_Semantics-effect_to_assignments_set_is>effect_to_assignments_set_is</a></li><li><a href=#STRIPS_Semantics-execute_parallel_operator_positive_effect_if_i>execute_parallel_operator_positive_effect_if_i</a></li><li><a href=#STRIPS_Semantics-execute_parallel_operator_positive_effect_if>execute_parallel_operator_positive_effect_if</a></li><li><a href=#STRIPS_Semantics-execute_parallel_operator_negative_effect_if_i>execute_parallel_operator_negative_effect_if_i</a></li><li><a href=#STRIPS_Semantics-execute_parallel_operator_negative_effect_if>execute_parallel_operator_negative_effect_if</a></li><li><a href=#STRIPS_Semantics-execute_parallel_operator_no_effect_if>execute_parallel_operator_no_effect_if</a></li><li><a href=#STRIPS_Semantics-is_parallel_solution_for_problem_operator_set>is_parallel_solution_for_problem_operator_set</a></li><li><a href=#STRIPS_Semantics-trace_parallel_plan_strips_not_nil>trace_parallel_plan_strips_not_nil</a></li><li><a href=#STRIPS_Semantics-trace_parallel_plan_strips_head_is_initial_state>trace_parallel_plan_strips_head_is_initial_state</a></li><li><a href=#STRIPS_Semantics-trace_parallel_plan_strips_length_gt_one_if>trace_parallel_plan_strips_length_gt_one_if</a></li><li><a href=#STRIPS_Semantics-trace_parallel_plan_strips_last_cons_then>trace_parallel_plan_strips_last_cons_then</a></li><li><a href=#STRIPS_Semantics-trace_parallel_plan_strips_operator_preconditions>trace_parallel_plan_strips_operator_preconditions</a></li><li><a href=#STRIPS_Semantics-trace_parallel_plan_plan_prefix>trace_parallel_plan_plan_prefix</a></li><li><a href=#STRIPS_Semantics-length_trace_parallel_plan_strips_lte_length_plan_plus_one>length_trace_parallel_plan_strips_lte_length_plan_plus_one</a></li><li><a href=#STRIPS_Semantics-plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements>plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements</a></li><li><a href=#STRIPS_Semantics-trace_parallel_plan_step_effect_is>trace_parallel_plan_step_effect_is</a></li><li><a href=#STRIPS_Semantics-trace_parallel_plan_strips_none_if>trace_parallel_plan_strips_none_if</a></li><li><a href=#STRIPS_Semantics-execute_parallel_plan_reaches_goal_iff_goal_is_last_element_of_trace>execute_parallel_plan_reaches_goal_iff_goal_is_last_element_of_trace</a></li><li><a href=#STRIPS_Semantics-execute_parallel_operator_equals_execute_sequential_strips_if>execute_parallel_operator_equals_execute_sequential_strips_if</a></li><li><a href=#STRIPS_Semantics-execute_serial_plan_split_i>execute_serial_plan_split_i</a></li><li><a href=#STRIPS_Semantics-execute_serial_plan_split>execute_serial_plan_split</a></li><li><a href=#STRIPS_Semantics-embedding_lemma_i>embedding_lemma_i</a></li><li><a href=#STRIPS_Semantics-execute_serial_plan_is_execute_parallel_plan_ii>execute_serial_plan_is_execute_parallel_plan_ii</a></li><li><a href=#STRIPS_Semantics-embedding_lemma_iii>embedding_lemma_iii</a></li><li><a href=#STRIPS_Semantics-flattening_lemma_i>flattening_lemma_i</a></li><li><a href=#STRIPS_Semantics-flattening_lemma_ii>flattening_lemma_ii</a></li><li><a href=#STRIPS_Semantics-flattening_lemma>flattening_lemma</a></li><li><a href=#STRIPS_Semantics-set_to_precondition_of_op_is>set_to_precondition_of_op_is</a></li></ul></li><li><a href=#SAS_Plus_Representation>SAS_Plus_Representation</a><ul><li><a href=#SAS_Plus_Representation-range_of_not_empty>range_of_not_empty</a></li><li><a href=#SAS_Plus_Representation-is_valid_operator_sas_plus_then>is_valid_operator_sas_plus_then</a></li><li><a href=#SAS_Plus_Representation-is_valid_problem_sas_plus_then>is_valid_problem_sas_plus_then</a></li></ul></li><li><a href=#SAS_Plus_Semantics>SAS_Plus_Semantics</a><ul><li><a href=#SAS_Plus_Semantics-execute_operator_sas_plus_effect_i>execute_operator_sas_plus_effect_i</a></li><li><a href=#SAS_Plus_Semantics-execute_operator_sas_plus_effect_ii>execute_operator_sas_plus_effect_ii</a></li><li><a href=#SAS_Plus_Semantics-execute_parallel_operator_sas_plus_cons>execute_parallel_operator_sas_plus_cons</a></li><li><a href=#SAS_Plus_Semantics-trace_parallel_plan_sas_plus_head_is_initial_state>trace_parallel_plan_sas_plus_head_is_initial_state</a></li><li><a href=#SAS_Plus_Semantics-trace_parallel_plan_sas_plus_length_gt_one_if>trace_parallel_plan_sas_plus_length_gt_one_if</a></li><li><a href=#SAS_Plus_Semantics-length_trace_parallel_plan_sas_plus_lte_length_plan_plus_one>length_trace_parallel_plan_sas_plus_lte_length_plan_plus_one</a></li><li><a href=#SAS_Plus_Semantics-plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements>plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements</a></li><li><a href=#SAS_Plus_Semantics-trace_parallel_plan_sas_plus_step_implies_operator_execution_condition_holds>trace_parallel_plan_sas_plus_step_implies_operator_execution_condition_holds</a></li><li><a href=#SAS_Plus_Semantics-trace_parallel_plan_sas_plus_prefix>trace_parallel_plan_sas_plus_prefix</a></li><li><a href=#SAS_Plus_Semantics-trace_parallel_plan_sas_plus_step_effect_is>trace_parallel_plan_sas_plus_step_effect_is</a></li><li><a href=#SAS_Plus_Semantics-execute_parallel_plan_sas_plus_reaches_goal_iff_goal_is_last_element_of_trace>execute_parallel_plan_sas_plus_reaches_goal_iff_goal_is_last_element_of_trace</a></li><li><a href=#SAS_Plus_Semantics-is_parallel_solution_for_problem_plan_operator_set>is_parallel_solution_for_problem_plan_operator_set</a></li><li><a href=#SAS_Plus_Semantics-execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_i>execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_i</a></li><li><a href=#SAS_Plus_Semantics-execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_ii>execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_ii</a></li><li><a href=#SAS_Plus_Semantics-execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iii>execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iii</a></li><li><a href=#SAS_Plus_Semantics-execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iv>execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iv</a></li><li><a href=#SAS_Plus_Semantics-flattening_lemma_i>flattening_lemma_i</a></li><li><a href=#SAS_Plus_Semantics-flattening_lemma_ii>flattening_lemma_ii</a></li><li><a href=#SAS_Plus_Semantics-flattening_lemma>flattening_lemma</a></li><li><a href=#SAS_Plus_Semantics-is_valid_operator_sas_plus_then_range_of_sas_plus_op_is_set_range_of_op>is_valid_operator_sas_plus_then_range_of_sas_plus_op_is_set_range_of_op</a></li><li><a href=#SAS_Plus_Semantics-set_the_range_of_is_range_of_sas_plus_if>set_the_range_of_is_range_of_sas_plus_if</a></li><li><a href=#SAS_Plus_Semantics-sublocale_sas_plus_finite_domain_representation_ii>sublocale_sas_plus_finite_domain_representation_ii</a></li></ul></li><li><a href=#SAS_Plus_STRIPS>SAS_Plus_STRIPS</a><ul><li><a href=#SAS_Plus_STRIPS-is_valid_problem_sas_plus_dom_sas_plus_problem_range_of>is_valid_problem_sas_plus_dom_sas_plus_problem_range_of</a></li><li><a href=#SAS_Plus_STRIPS-possible_assignments_for_set_is>possible_assignments_for_set_is</a></li><li><a href=#SAS_Plus_STRIPS-all_possible_assignments_for_set_is>all_possible_assignments_for_set_is</a></li><li><a href=#SAS_Plus_STRIPS-state_to_strips_state_dom_is_i>state_to_strips_state_dom_is_i</a></li><li><a href=#SAS_Plus_STRIPS-state_to_strips_state_dom_is>state_to_strips_state_dom_is</a></li><li><a href=#SAS_Plus_STRIPS-state_to_strips_state_range_is>state_to_strips_state_range_is</a></li><li><a href=#SAS_Plus_STRIPS-state_to_strips_state_effect_consistent>state_to_strips_state_effect_consistent</a></li><li><a href=#SAS_Plus_STRIPS-sasp_op_to_strips_set_delete_effects_is>sasp_op_to_strips_set_delete_effects_is</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_problem_to_strips_problem_variable_set_is>sas_plus_problem_to_strips_problem_variable_set_is</a></li><li><a href=#SAS_Plus_STRIPS-sasp_op_to_strips_effect_consistent>sasp_op_to_strips_effect_consistent</a></li><li><a href=#SAS_Plus_STRIPS-is_valid_problem_sas_plus_then_strips_transformation_too_iii>is_valid_problem_sas_plus_then_strips_transformation_too_iii</a></li><li><a href=#SAS_Plus_STRIPS-is_valid_problem_sas_plus_then_strips_transformation_too_iv>is_valid_problem_sas_plus_then_strips_transformation_too_iv</a></li><li><a href=#SAS_Plus_STRIPS-is_valid_problem_sas_plus_then_strips_transformation_too_v>is_valid_problem_sas_plus_then_strips_transformation_too_v</a></li><li><a href=#SAS_Plus_STRIPS-set_filter_all_possible_assignments_true_is>set_filter_all_possible_assignments_true_is</a></li><li><a href=#SAS_Plus_STRIPS-strips_state_to_state_dom_is>strips_state_to_state_dom_is</a></li><li><a href=#SAS_Plus_STRIPS-strips_state_to_state_range_is>strips_state_to_state_range_is</a></li><li><a href=#SAS_Plus_STRIPS-strips_state_to_state_inverse_is_i>strips_state_to_state_inverse_is_i</a></li><li><a href=#SAS_Plus_STRIPS-strips_state_to_state_inverse_is_iv>strips_state_to_state_inverse_is_iv</a></li><li><a href=#SAS_Plus_STRIPS-strips_state_to_state_inverse_is>strips_state_to_state_inverse_is</a></li><li><a href=#SAS_Plus_STRIPS-state_to_strips_state_map_le_iff>state_to_strips_state_map_le_iff</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_operator_inverse_is>sas_plus_operator_inverse_is</a></li><li><a href=#SAS_Plus_STRIPS-strips_operator_inverse_is>strips_operator_inverse_is</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_I>sas_plus_equivalent_to_strips_i_a_I</a></li><li><a href=#SAS_Plus_STRIPS-to_sas_plus_list_of_transformed_sas_plus_problem_operators_structure>to_sas_plus_list_of_transformed_sas_plus_problem_operators_structure</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_II>sas_plus_equivalent_to_strips_i_a_II</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_IV>sas_plus_equivalent_to_strips_i_a_IV</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_VI>sas_plus_equivalent_to_strips_i_a_VI</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_VII>sas_plus_equivalent_to_strips_i_a_VII</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_VIII>sas_plus_equivalent_to_strips_i_a_VIII</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_IX>sas_plus_equivalent_to_strips_i_a_IX</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_X>sas_plus_equivalent_to_strips_i_a_X</a></li><li><a href=#SAS_Plus_STRIPS-transfom_sas_plus_problem_to_strips_problem_operators_valid>transfom_sas_plus_problem_to_strips_problem_operators_valid</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_XI>sas_plus_equivalent_to_strips_i_a_XI</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_XII>sas_plus_equivalent_to_strips_i_a_XII</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_XIII>sas_plus_equivalent_to_strips_i_a_XIII</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a>sas_plus_equivalent_to_strips_i_a</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i>sas_plus_equivalent_to_strips_i</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_ii>sas_plus_equivalent_to_strips_ii</a></li><li><a href=#SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a_I>strips_equivalent_to_sas_plus_i_a_I</a></li><li><a href=#SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a_III>strips_equivalent_to_sas_plus_i_a_III</a></li><li><a href=#SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a_IV>strips_equivalent_to_sas_plus_i_a_IV</a></li><li><a href=#SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a_V>strips_equivalent_to_sas_plus_i_a_V</a></li><li><a href=#SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a>strips_equivalent_to_sas_plus_i_a</a></li><li><a href=#SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i>strips_equivalent_to_sas_plus_i</a></li><li><a href=#SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_ii>strips_equivalent_to_sas_plus_ii</a></li><li><a href=#SAS_Plus_STRIPS-embedded_serial_sas_plus_plan_operator_structure>embedded_serial_sas_plus_plan_operator_structure</a></li><li><a href=#SAS_Plus_STRIPS-serial_sas_plus_equivalent_to_serial_strips_i>serial_sas_plus_equivalent_to_serial_strips_i</a></li><li><a href=#SAS_Plus_STRIPS-serial_sas_plus_equivalent_to_serial_strips_ii>serial_sas_plus_equivalent_to_serial_strips_ii</a></li><li><a href=#SAS_Plus_STRIPS-embedded_serial_strips_plan_operator_structure>embedded_serial_strips_plan_operator_structure</a></li><li><a href=#SAS_Plus_STRIPS-serial_strips_equivalent_to_serial_sas_plus_i>serial_strips_equivalent_to_serial_sas_plus_i</a></li><li><a href=#SAS_Plus_STRIPS-serial_strips_equivalent_to_serial_sas_plus_ii>serial_strips_equivalent_to_serial_sas_plus_ii</a></li><li><a href=#SAS_Plus_STRIPS-sasp_op_to_strips_injective>sasp_op_to_strips_injective</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_a>sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_a</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_c>sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_c</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_d>sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_d</a></li><li><a href=#SAS_Plus_STRIPS-bounded_plan_set_finite>bounded_plan_set_finite</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_a>sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_a</a></li><li><a href=#SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_b>sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_b</a></li></ul></li><li><a href=#SAT_Plan_Base>SAT_Plan_Base</a><ul><li><a href=#SAT_Plan_Base-encode_state_variable_is_lit_plus_if>encode_state_variable_is_lit_plus_if</a></li><li><a href=#SAT_Plan_Base-is_cnf_encode_initial_state>is_cnf_encode_initial_state</a></li><li><a href=#SAT_Plan_Base-encode_goal_state_is_cnf>encode_goal_state_is_cnf</a></li><li><a href=#SAT_Plan_Base-encode_operator_precondition_is_cnf>encode_operator_precondition_is_cnf</a></li><li><a href=#SAT_Plan_Base-set_map_operator_precondition>set_map_operator_precondition</a></li><li><a href=#SAT_Plan_Base-is_cnf_encode_all_operator_preconditions>is_cnf_encode_all_operator_preconditions</a></li><li><a href=#SAT_Plan_Base-set_map_or>set_map_or</a></li><li><a href=#SAT_Plan_Base-encode_operator_effects_is_cnf_i>encode_operator_effects_is_cnf_i</a></li><li><a href=#SAT_Plan_Base-encode_operator_effects_is_cnf_ii>encode_operator_effects_is_cnf_ii</a></li><li><a href=#SAT_Plan_Base-encode_operator_effect_is_cnf>encode_operator_effect_is_cnf</a></li><li><a href=#SAT_Plan_Base-set_map_encode_operator_effect>set_map_encode_operator_effect</a></li><li><a href=#SAT_Plan_Base-encode_all_operator_effects_is_cnf>encode_all_operator_effects_is_cnf</a></li><li><a href=#SAT_Plan_Base-encode_operators_is_cnf>encode_operators_is_cnf</a></li><li><a href=#SAT_Plan_Base-set_map_to_operator_atom>set_map_to_operator_atom</a></li><li><a href=#SAT_Plan_Base-is_disj_big_or_if>is_disj_big_or_if</a></li><li><a href=#SAT_Plan_Base-is_cnf_encode_negative_transition_frame_axiom>is_cnf_encode_negative_transition_frame_axiom</a></li><li><a href=#SAT_Plan_Base-is_cnf_encode_positive_transition_frame_axiom>is_cnf_encode_positive_transition_frame_axiom</a></li><li><a href=#SAT_Plan_Base-encode_all_frame_axioms_set>encode_all_frame_axioms_set</a></li><li><a href=#SAT_Plan_Base-encode_frame_axioms_is_cnf>encode_frame_axioms_is_cnf</a></li><li><a href=#SAT_Plan_Base-is_cnf_encode_problem>is_cnf_encode_problem</a></li><li><a href=#SAT_Plan_Base-encode_problem_has_model_then_also_partial_encodings>encode_problem_has_model_then_also_partial_encodings</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_problem_structure>cnf_of_encode_problem_structure</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_initial_state_set_i>cnf_of_encode_initial_state_set_i</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_initial_state_set>cnf_of_encode_initial_state_set</a></li><li><a href=#SAT_Plan_Base-cnf_of_operator_encoding_structure>cnf_of_operator_encoding_structure</a></li><li><a href=#SAT_Plan_Base-cnf_foldr_and>cnf_foldr_and</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_operator_precondition>cnf_of_encode_operator_precondition</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_all_operator_preconditions_structure>cnf_of_encode_all_operator_preconditions_structure</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_operator_effect_structure>cnf_of_encode_operator_effect_structure</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_all_operator_effects_structure>cnf_of_encode_all_operator_effects_structure</a></li><li><a href=#SAT_Plan_Base-cnf_of_big_or_of_literal_formulas_is>cnf_of_big_or_of_literal_formulas_is</a></li><li><a href=#SAT_Plan_Base-set_filter_op_list_mem_vs>set_filter_op_list_mem_vs</a></li><li><a href=#SAT_Plan_Base-cnf_of_positive_transition_frame_axiom>cnf_of_positive_transition_frame_axiom</a></li><li><a href=#SAT_Plan_Base-cnf_of_negative_transition_frame_axiom>cnf_of_negative_transition_frame_axiom</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_all_frame_axioms_structure>cnf_of_encode_all_frame_axioms_structure</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_goal_state_set_i>cnf_of_encode_goal_state_set_i</a></li><li><a href=#SAT_Plan_Base-cnf_of_encode_goal_state_set>cnf_of_encode_goal_state_set</a></li><li><a href=#SAT_Plan_Base-valuation_models_encoding_cnf_formula_equals>valuation_models_encoding_cnf_formula_equals</a></li><li><a href=#SAT_Plan_Base-decode_plan_length>decode_plan_length</a></li><li><a href=#SAT_Plan_Base-decode_plan%27_set_is>decode_plan'_set_is</a></li><li><a href=#SAT_Plan_Base-decode_plan_set_is>decode_plan_set_is</a></li><li><a href=#SAT_Plan_Base-decode_plan_step_element_then_i>decode_plan_step_element_then_i</a></li><li><a href=#SAT_Plan_Base-decode_plan_step_element_then>decode_plan_step_element_then</a></li><li><a href=#SAT_Plan_Base-decode_plan_step_distinct>decode_plan_step_distinct</a></li><li><a href=#SAT_Plan_Base-decode_state_at_valid_variable>decode_state_at_valid_variable</a></li><li><a href=#SAT_Plan_Base-decode_state_at_encoding_variables_equals_some_of_valuation_if>decode_state_at_encoding_variables_equals_some_of_valuation_if</a></li><li><a href=#SAT_Plan_Base-decode_state_at_dom>decode_state_at_dom</a></li><li><a href=#SAT_Plan_Base-decode_state_at_initial_state>decode_state_at_initial_state</a></li><li><a href=#SAT_Plan_Base-decode_state_at_goal_state>decode_state_at_goal_state</a></li><li><a href=#SAT_Plan_Base-decode_state_at_preconditions>decode_state_at_preconditions</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_i>encode_problem_parallel_correct_i</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_ii>encode_problem_parallel_correct_ii</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_iii>encode_problem_parallel_correct_iii</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_iv>encode_problem_parallel_correct_iv</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_v>encode_problem_parallel_correct_v</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_vi>encode_problem_parallel_correct_vi</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_vii>encode_problem_parallel_correct_vii</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_x>encode_problem_parallel_correct_x</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_correct_xi>encode_problem_parallel_correct_xi</a></li><li><a href=#SAT_Plan_Base-model_of_encode_problem_makespan_zero_iff>model_of_encode_problem_makespan_zero_iff</a></li><li><a href=#SAT_Plan_Base-empty_valution_is_False>empty_valution_is_False</a></li><li><a href=#SAT_Plan_Base-model_initial_state_set_valuations>model_initial_state_set_valuations</a></li><li><a href=#SAT_Plan_Base-valuation_of_state_variable_implies_lit_semantics_if>valuation_of_state_variable_implies_lit_semantics_if</a></li><li><a href=#SAT_Plan_Base-foldr_fun_upd>foldr_fun_upd</a></li><li><a href=#SAT_Plan_Base-foldr_fun_no_upd>foldr_fun_no_upd</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_i>encode_problem_parallel_complete_i</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_ii>encode_problem_parallel_complete_ii</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_iii_a>encode_problem_parallel_complete_iii_a</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_iii_b>encode_problem_parallel_complete_iii_b</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_iii>encode_problem_parallel_complete_iii</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_iv_a>encode_problem_parallel_complete_iv_a</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_iv_b>encode_problem_parallel_complete_iv_b</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_iv>encode_problem_parallel_complete_iv</a></li><li><a href=#SAT_Plan_Base-valuation_for_operator_variables_is>valuation_for_operator_variables_is</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_vi_a>encode_problem_parallel_complete_vi_a</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_vi_b>encode_problem_parallel_complete_vi_b</a></li><li><a href=#SAT_Plan_Base-list_product_is_nil_iff>list_product_is_nil_iff</a></li><li><a href=#SAT_Plan_Base-valuation_for_state_variables_is>valuation_for_state_variables_is</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_vi_c>encode_problem_parallel_complete_vi_c</a></li><li><a href=#SAT_Plan_Base-encode_problem_parallel_complete_vi_f>encode_problem_parallel_complete_vi_f</a></li></ul></li><li><a href=#SAT_Plan_Extensions>SAT_Plan_Extensions</a><ul><li><a href=#SAT_Plan_Extensions-cnf_of_encode_interfering_operator_pair_exclusion_is_i>cnf_of_encode_interfering_operator_pair_exclusion_is_i</a></li><li><a href=#SAT_Plan_Extensions-cnf_of_encode_interfering_operator_exclusion_is_ii>cnf_of_encode_interfering_operator_exclusion_is_ii</a></li><li><a href=#SAT_Plan_Extensions-cnf_of_encode_interfering_operator_exclusion_is_iii>cnf_of_encode_interfering_operator_exclusion_is_iii</a></li><li><a href=#SAT_Plan_Extensions-cnf_of_encode_interfering_operator_exclusion_is>cnf_of_encode_interfering_operator_exclusion_is</a></li><li><a href=#SAT_Plan_Extensions-cnf_of_encode_interfering_operator_exclusion_contains_clause_if>cnf_of_encode_interfering_operator_exclusion_contains_clause_if</a></li><li><a href=#SAT_Plan_Extensions-is_cnf_encode_interfering_operator_exclusion>is_cnf_encode_interfering_operator_exclusion</a></li><li><a href=#SAT_Plan_Extensions-is_cnf_encode_problem_with_operator_interference_exclusion>is_cnf_encode_problem_with_operator_interference_exclusion</a></li><li><a href=#SAT_Plan_Extensions-cnf_of_encode_problem_with_operator_interference_exclusion_structure>cnf_of_encode_problem_with_operator_interference_exclusion_structure</a></li><li><a href=#SAT_Plan_Extensions-encode_problem_with_operator_interference_exclusion_has_model_then_also_partial_encodings>encode_problem_with_operator_interference_exclusion_has_model_then_also_partial_encodings</a></li><li><a href=#SAT_Plan_Extensions-encode_problem_serializable_sound_i>encode_problem_serializable_sound_i</a></li><li><a href=#SAT_Plan_Extensions-encode_problem_with_operator_interference_exclusion_complete_i>encode_problem_with_operator_interference_exclusion_complete_i</a></li><li><a href=#SAT_Plan_Extensions-encode_problem_forall_step_decoded_plan_is_serializable_i>encode_problem_forall_step_decoded_plan_is_serializable_i</a></li><li><a href=#SAT_Plan_Extensions-encode_problem_forall_step_decoded_plan_is_serializable_ii>encode_problem_forall_step_decoded_plan_is_serializable_ii</a></li></ul></li><li><a href=#SAT_Solve_SAS_Plus>SAT_Solve_SAS_Plus</a><ul><li><a href=#SAT_Solve_SAS_Plus-sas_plus_problem_has_serial_solution_iff_i>sas_plus_problem_has_serial_solution_iff_i</a></li><li><a href=#SAT_Solve_SAS_Plus-sas_plus_problem_has_serial_solution_iff_ii>sas_plus_problem_has_serial_solution_iff_ii</a></li><li><a href=#SAT_Solve_SAS_Plus-sasp_exec_noops>sasp_exec_noops</a></li><li><a href=#SAT_Solve_SAS_Plus-sasp_noops_in_noop_problem>sasp_noops_in_noop_problem</a></li><li><a href=#SAT_Solve_SAS_Plus-noops_complete>noops_complete</a></li><li><a href=#SAT_Solve_SAS_Plus-sasp_filter_empty_action>sasp_filter_empty_action</a></li><li><a href=#SAT_Solve_SAS_Plus-noops_sound>noops_sound</a></li><li><a href=#SAT_Solve_SAS_Plus-noops_valid>noops_valid</a></li><li><a href=#SAT_Solve_SAS_Plus-sas_plus_problem_has_serial_solution_iff_i%27>sas_plus_problem_has_serial_solution_iff_i'</a></li><li><a href=#SAT_Solve_SAS_Plus-sas_plus_problem_has_serial_solution_iff_ii%27>sas_plus_problem_has_serial_solution_iff_ii'</a></li></ul></li><li><a href=#AST_SAS_Plus_Equivalence>AST_SAS_Plus_Equivalence</a><ul><li><a href=#AST_SAS_Plus_Equivalence-map_add_comm>map_add_comm</a></li><li><a href=#AST_SAS_Plus_Equivalence-first_map_add_submap>first_map_add_submap</a></li><li><a href=#AST_SAS_Plus_Equivalence-subsuming_states_map_add>subsuming_states_map_add</a></li><li><a href=#AST_SAS_Plus_Equivalence-consistent_map_lists>consistent_map_lists</a></li><li><a href=#AST_SAS_Plus_Equivalence-subsuming_states_append>subsuming_states_append</a></li><li><a href=#AST_SAS_Plus_Equivalence-consistent_pres_op_then%27>consistent_pres_op_then'</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_valid_states>rem_implicit_pres_ops_valid_states</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_None>rem_implicit_pres_ops_lookup_op_None</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_Some_1>rem_implicit_pres_ops_lookup_op_Some_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_Some_1%27>rem_implicit_pres_ops_lookup_op_Some_1'</a></li><li><a href=#AST_SAS_Plus_Equivalence-implicit_pres_empty>implicit_pres_empty</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_Some_2>rem_implicit_pres_ops_lookup_op_Some_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_Some_2%27>rem_implicit_pres_ops_lookup_op_Some_2'</a></li><li><a href=#AST_SAS_Plus_Equivalence-subsuming_states_def%27>subsuming_states_def'</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_enabled_1>rem_implicit_pres_ops_enabled_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-lookup_Some_in%ce%b4>lookup_Some_inδ</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_enabled_2>rem_implicit_pres_ops_enabled_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_enabled>rem_implicit_pres_ops_enabled</a></li><li><a href=#AST_SAS_Plus_Equivalence-std_eff_enabled>std_eff_enabled</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_standard_operator_rem_implicit>is_standard_operator_rem_implicit</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_standard_operator_rem_implicit_pres_ops>is_standard_operator_rem_implicit_pres_ops</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_standard_operator_rem_implicit_pres_ops%27>is_standard_operator_rem_implicit_pres_ops'</a></li><li><a href=#AST_SAS_Plus_Equivalence-in_rem_implicit_pres_%ce%b4>in_rem_implicit_pres_δ</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_execute>rem_implicit_pres_ops_execute</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_path_to>rem_implicit_pres_ops_path_to</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_astG>rem_implicit_pres_ops_astG</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_goal>rem_implicit_pres_ops_goal</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_astI>rem_implicit_pres_ops_astI</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_init>rem_implicit_pres_ops_init</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_valid_plan>rem_implicit_pres_ops_valid_plan</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_numVars>rem_implicit_pres_ops_numVars</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_numVals>rem_implicit_pres_ops_numVals</a></li><li><a href=#AST_SAS_Plus_Equivalence-in_implicit_pres>in_implicit_pres</a></li><li><a href=#AST_SAS_Plus_Equivalence-pair4_eqD>pair4_eqD</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_wf_partial_state>rem_implicit_pres_ops_wf_partial_state</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_wf_operator>rem_implicit_pres_wf_operator</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_in%ce%b4D>rem_implicit_pres_ops_inδD</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_well_formed>rem_implicit_pres_ops_well_formed</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_is_standard_operator%27>rem_implicit_pres_is_standard_operator'</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_is_standard_operator%27>rem_implicit_pres_ops_is_standard_operator'</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_valid_vars_1>is_valid_vars_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-upt_eq_Nil_conv%27>upt_eq_Nil_conv'</a></li><li><a href=#AST_SAS_Plus_Equivalence-map_of_zip_map_Some>map_of_zip_map_Some</a></li><li><a href=#AST_SAS_Plus_Equivalence-map_of_zip_Some>map_of_zip_Some</a></li><li><a href=#AST_SAS_Plus_Equivalence-in_set_zip_lengthE>in_set_zip_lengthE</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_valid_vars_2>is_valid_vars_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-valid_abs_init_1>valid_abs_init_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_range_map_Some>abs_range_map_Some</a></li><li><a href=#AST_SAS_Plus_Equivalence-in_abs_v_sec_length>in_abs_v_sec_length</a></li><li><a href=#AST_SAS_Plus_Equivalence-valid_abs_init_2>valid_abs_init_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-valid_abs_goal_1>valid_abs_goal_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-in_abs_rangeI>in_abs_rangeI</a></li><li><a href=#AST_SAS_Plus_Equivalence-valid_abs_goal_2>valid_abs_goal_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_rangeI>abs_rangeI</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_1>abs_valid_operator_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-wf_operator_preD>wf_operator_preD</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_2>abs_valid_operator_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-wf_operator_effE>wf_operator_effE</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_3%27>abs_valid_operator_3'</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_3>abs_valid_operator_3</a></li><li><a href=#AST_SAS_Plus_Equivalence-wf_abs_eff>wf_abs_eff</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_4%27>abs_valid_operator_4'</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_4>abs_valid_operator_4</a></li><li><a href=#AST_SAS_Plus_Equivalence-consistent_list_set>consistent_list_set</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_5%27>abs_valid_operator_5'</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_5>abs_valid_operator_5</a></li><li><a href=#AST_SAS_Plus_Equivalence-consistent_list_set_2>consistent_list_set_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_6%27>abs_valid_operator_6'</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_valid_operator_6>abs_valid_operator_6</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_ast_operator_section_valid>abs_ast_operator_section_valid</a></li><li><a href=#AST_SAS_Plus_Equivalence-abs_prob_valid>abs_prob_valid</a></li><li><a href=#AST_SAS_Plus_Equivalence-std_then_implici_effs>std_then_implici_effs</a></li><li><a href=#AST_SAS_Plus_Equivalence-effs_eq_abs_effs>effs_eq_abs_effs</a></li><li><a href=#AST_SAS_Plus_Equivalence-exect_eq_abs_execute>exect_eq_abs_execute</a></li><li><a href=#AST_SAS_Plus_Equivalence-enabled_then_sas_applicable>enabled_then_sas_applicable</a></li><li><a href=#AST_SAS_Plus_Equivalence-path_to_then_exec_serial>path_to_then_exec_serial</a></li><li><a href=#AST_SAS_Plus_Equivalence-map_of_eq_None_iff>map_of_eq_None_iff</a></li><li><a href=#AST_SAS_Plus_Equivalence-path_to_then_lookup_Some>path_to_then_lookup_Some</a></li><li><a href=#AST_SAS_Plus_Equivalence-valid_plan_then_lookup_Some>valid_plan_then_lookup_Some</a></li><li><a href=#AST_SAS_Plus_Equivalence-find_Some>find_Some</a></li><li><a href=#AST_SAS_Plus_Equivalence-distinct_find>distinct_find</a></li><li><a href=#AST_SAS_Plus_Equivalence-lookup_operator_find>lookup_operator_find</a></li><li><a href=#AST_SAS_Plus_Equivalence-lookup_operator_works_1>lookup_operator_works_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-lookup_operator_works_2>lookup_operator_works_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-lookup_operator_works_3>lookup_operator_works_3</a></li><li><a href=#AST_SAS_Plus_Equivalence-mem_find_Some>mem_find_Some</a></li><li><a href=#AST_SAS_Plus_Equivalence-std_lookup_action>std_lookup_action</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_applicable_then_enabled_1>is_applicable_then_enabled_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-lookup_action_Some_in_%ce%b4>lookup_action_Some_in_δ</a></li><li><a href=#AST_SAS_Plus_Equivalence-lookup_operator_eq_name>lookup_operator_eq_name</a></li><li><a href=#AST_SAS_Plus_Equivalence-eq_name_eq_pres>eq_name_eq_pres</a></li><li><a href=#AST_SAS_Plus_Equivalence-eq_name_eq_effs>eq_name_eq_effs</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_applicable_then_subsumes>is_applicable_then_subsumes</a></li><li><a href=#AST_SAS_Plus_Equivalence-eq_name_eq_pres%27>eq_name_eq_pres'</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_applicable_then_enabled_2>is_applicable_then_enabled_2</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_applicable_then_enabled_3>is_applicable_then_enabled_3</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_applicable_then_enabled>is_applicable_then_enabled</a></li><li><a href=#AST_SAS_Plus_Equivalence-eq_name_eq_effs%27>eq_name_eq_effs'</a></li><li><a href=#AST_SAS_Plus_Equivalence-std_eff_enabled%27>std_eff_enabled'</a></li><li><a href=#AST_SAS_Plus_Equivalence-execute_abs>execute_abs</a></li><li><a href=#AST_SAS_Plus_Equivalence-exec_serial_then_path_to%27>exec_serial_then_path_to'</a></li><li><a href=#AST_SAS_Plus_Equivalence-exec_rem_consdless>exec_rem_consdless</a></li><li><a href=#AST_SAS_Plus_Equivalence-rem_conless_sat>rem_conless_sat</a></li><li><a href=#AST_SAS_Plus_Equivalence-set_rem_condlessD>set_rem_condlessD</a></li><li><a href=#AST_SAS_Plus_Equivalence-exec_serial_then_path_to>exec_serial_then_path_to</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_serial_solution_then_abstracted>is_serial_solution_then_abstracted</a></li><li><a href=#AST_SAS_Plus_Equivalence-lookup_operator_works_1%27>lookup_operator_works_1'</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_serial_sol_then_valid_plan_1>is_serial_sol_then_valid_plan_1</a></li><li><a href=#AST_SAS_Plus_Equivalence-is_serial_sol_then_valid_plan_2>is_serial_sol_then_valid_plan_2</a></li></ul></li><li><a href=#Set2_Join_RBT>Set2_Join_RBT</a><ul><li><a href=#Set2_Join_RBT-invc2_joinL>invc2_joinL</a></li><li><a href=#Set2_Join_RBT-invc2_joinR>invc2_joinR</a></li><li><a href=#Set2_Join_RBT-bheight_joinL>bheight_joinL</a></li><li><a href=#Set2_Join_RBT-invh_joinL>invh_joinL</a></li><li><a href=#Set2_Join_RBT-bheight_baliR>bheight_baliR</a></li><li><a href=#Set2_Join_RBT-bheight_joinR>bheight_joinR</a></li><li><a href=#Set2_Join_RBT-invh_joinR>invh_joinR</a></li><li><a href=#Set2_Join_RBT-rbt_join>rbt_join</a></li><li><a href=#Set2_Join_RBT-bheight_paint_Black>bheight_paint_Black</a></li><li><a href=#Set2_Join_RBT-inorder_joinL>inorder_joinL</a></li><li><a href=#Set2_Join_RBT-inorder_joinR>inorder_joinR</a></li><li><a href=#Set2_Join_RBT-set_baliL>set_baliL</a></li><li><a href=#Set2_Join_RBT-set_joinL>set_joinL</a></li><li><a href=#Set2_Join_RBT-set_baliR>set_baliR</a></li><li><a href=#Set2_Join_RBT-set_joinR>set_joinR</a></li><li><a href=#Set2_Join_RBT-set_paint>set_paint</a></li><li><a href=#Set2_Join_RBT-set_join>set_join</a></li><li><a href=#Set2_Join_RBT-bst_baliL>bst_baliL</a></li><li><a href=#Set2_Join_RBT-bst_baliR>bst_baliR</a></li><li><a href=#Set2_Join_RBT-bst_joinL>bst_joinL</a></li><li><a href=#Set2_Join_RBT-bst_joinR>bst_joinR</a></li><li><a href=#Set2_Join_RBT-bst_paint>bst_paint</a></li><li><a href=#Set2_Join_RBT-bst_join>bst_join</a></li><li><a href=#Set2_Join_RBT-inv_join>inv_join</a></li></ul></li><li><a href=#Solve_SASP>Solve_SASP</a><ul><li><a href=#Solve_SASP-length_abs_ast_plan>length_abs_ast_plan</a></li><li><a href=#Solve_SASP-gtD>gtD</a></li><li><a href=#Solve_SASP-State_works>State_works</a></li><li><a href=#Solve_SASP-Operator_works>Operator_works</a></li><li><a href=#Solve_SASP-sat_plan_to_dimacs_works>sat_plan_to_dimacs_works</a></li><li><a href=#Solve_SASP-changing_atoms_works>changing_atoms_works</a></li><li><a href=#Solve_SASP-changing_atoms_works%27>changing_atoms_works'</a></li><li><a href=#Solve_SASP-sat_plan_to_dimacs>sat_plan_to_dimacs</a></li><li><a href=#Solve_SASP-dimacs_to_sat_plan>dimacs_to_sat_plan</a></li><li><a href=#Solve_SASP-encode_initial_state_valid>encode_initial_state_valid</a></li><li><a href=#Solve_SASP-length_operators>length_operators</a></li><li><a href=#Solve_SASP-encode_operator_effect_valid_1>encode_operator_effect_valid_1</a></li><li><a href=#Solve_SASP-encode_operator_effect_valid_2>encode_operator_effect_valid_2</a></li><li><a href=#Solve_SASP-atoms_And_append>atoms_And_append</a></li><li><a href=#Solve_SASP-encode_operator_effect_valid>encode_operator_effect_valid</a></li><li><a href=#Solve_SASP-foldr_And>foldr_And</a></li><li><a href=#Solve_SASP-encode_all_operator_effects_valid>encode_all_operator_effects_valid</a></li><li><a href=#Solve_SASP-encode_operator_precondition_valid_1>encode_operator_precondition_valid_1</a></li><li><a href=#Solve_SASP-encode_operator_precondition_valid>encode_operator_precondition_valid</a></li><li><a href=#Solve_SASP-encode_all_operator_preconditions_valid>encode_all_operator_preconditions_valid</a></li><li><a href=#Solve_SASP-encode_operators_valid>encode_operators_valid</a></li><li><a href=#Solve_SASP-encode_negative_transition_frame_axiom%27>encode_negative_transition_frame_axiom'</a></li><li><a href=#Solve_SASP-encode_negative_transition_frame_axiom_valid>encode_negative_transition_frame_axiom_valid</a></li><li><a href=#Solve_SASP-encode_positive_transition_frame_axiom_valid>encode_positive_transition_frame_axiom_valid</a></li><li><a href=#Solve_SASP-encode_all_frame_axioms_valid>encode_all_frame_axioms_valid</a></li><li><a href=#Solve_SASP-encode_goal_state_valid>encode_goal_state_valid</a></li><li><a href=#Solve_SASP-encode_problem_valid>encode_problem_valid</a></li><li><a href=#Solve_SASP-encode_interfering_operator_pair_exclusion_valid>encode_interfering_operator_pair_exclusion_valid</a></li><li><a href=#Solve_SASP-encode_interfering_operator_exclusion_valid>encode_interfering_operator_exclusion_valid</a></li><li><a href=#Solve_SASP-encode_problem_with_operator_interference_exclusion_valid>encode_problem_with_operator_interference_exclusion_valid</a></li><li><a href=#Solve_SASP-planning_by_cnf_dimacs_complete>planning_by_cnf_dimacs_complete</a></li><li><a href=#Solve_SASP-planning_by_cnf_dimacs_sound>planning_by_cnf_dimacs_sound</a></li><li><a href=#Solve_SASP-find_max_works>find_max_works</a></li><li><a href=#Solve_SASP-atoms_formula_vars>atoms_formula_vars</a></li><li><a href=#Solve_SASP-max_var>max_var</a></li><li><a href=#Solve_SASP-fold_max_ge>fold_max_ge</a></li><li><a href=#Solve_SASP-find_max_append>find_max_append</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_append>model_to_dimacs_model_append</a></li><li><a href=#Solve_SASP-upt_append_sing>upt_append_sing</a></li><li><a href=#Solve_SASP-upt_eqD>upt_eqD</a></li><li><a href=#Solve_SASP-pos_in_model>pos_in_model</a></li><li><a href=#Solve_SASP-neg_in_model>neg_in_model</a></li><li><a href=#Solve_SASP-in_model>in_model</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_all_vars>model_to_dimacs_model_all_vars</a></li><li><a href=#Solve_SASP-cnf_And>cnf_And</a></li><li><a href=#Solve_SASP-one_always_in>one_always_in</a></li><li><a href=#Solve_SASP-isdisj_disjD>isdisj_disjD</a></li><li><a href=#Solve_SASP-disj_to_dimacs_sound>disj_to_dimacs_sound</a></li><li><a href=#Solve_SASP-is_cnf_disj>is_cnf_disj</a></li><li><a href=#Solve_SASP-cnf_to_dimacs_disj>cnf_to_dimacs_disj</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_all_clauses>model_to_dimacs_model_all_clauses</a></li><li><a href=#Solve_SASP-upt_eq_Cons_conv>upt_eq_Cons_conv</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_append%27>model_to_dimacs_model_append'</a></li><li><a href=#Solve_SASP-model_to_dimacs_neg_nin>model_to_dimacs_neg_nin</a></li><li><a href=#Solve_SASP-model_to_dimacs_pos_nin>model_to_dimacs_pos_nin</a></li><li><a href=#Solve_SASP-int_cases2%27>int_cases2'</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_distinct>model_to_dimacs_model_distinct</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_sound>model_to_dimacs_model_sound</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_sound_exists>model_to_dimacs_model_sound_exists</a></li><li><a href=#Solve_SASP-dimacs_model_to_abs_atom>dimacs_model_to_abs_atom</a></li><li><a href=#Solve_SASP-dimacs_model_to_abs_atom%27>dimacs_model_to_abs_atom'</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_complete_disj>model_to_dimacs_model_complete_disj</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_complete>model_to_dimacs_model_complete</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_complete_max_var>model_to_dimacs_model_complete_max_var</a></li><li><a href=#Solve_SASP-model_to_dimacs_model_sound_max_var>model_to_dimacs_model_sound_max_var</a></li><li><a href=#Solve_SASP-var_to_dimacs_pos>var_to_dimacs_pos</a></li><li><a href=#Solve_SASP-map_is_disj>map_is_disj</a></li><li><a href=#Solve_SASP-map_is_cnf>map_is_cnf</a></li><li><a href=#Solve_SASP-planning_dimacs_complete>planning_dimacs_complete</a></li><li><a href=#Solve_SASP-planning_dimacs_sound>planning_dimacs_sound</a></li><li><a href=#Solve_SASP-planning_dimacs_complete_code>planning_dimacs_complete_code</a></li><li><a href=#Solve_SASP-planning_dimacs_complete_code%27>planning_dimacs_complete_code'</a></li><li><a href=#Solve_SASP-encode_sound>encode_sound</a></li><li><a href=#Solve_SASP-encode_complete>encode_complete</a></li><li><a href=#Solve_SASP-match_pres_distinct>match_pres_distinct</a></li><li><a href=#Solve_SASP-tree_map_of_invar>tree_map_of_invar</a></li><li><a href=#Solve_SASP-tree_map_of_works>tree_map_of_works</a></li><li><a href=#Solve_SASP-tree_map_of_dom>tree_map_of_dom</a></li><li><a href=#Solve_SASP-distinct_if_sorted>distinct_if_sorted</a></li><li><a href=#Solve_SASP-tree_map_of_distinct>tree_map_of_distinct</a></li><li><a href=#Solve_SASP-set_tree_intorder>set_tree_intorder</a></li><li><a href=#Solve_SASP-map_of_eq>map_of_eq</a></li><li><a href=#Solve_SASP-lookup_someD>lookup_someD</a></li><li><a href=#Solve_SASP-map_of_lookup>map_of_lookup</a></li><li><a href=#Solve_SASP-map_le_cong>map_le_cong</a></li><li><a href=#Solve_SASP-match_pres_submap>match_pres_submap</a></li><li><a href=#Solve_SASP-planning_dimacs_sound_code>planning_dimacs_sound_code</a></li><li><a href=#Solve_SASP-planning_dimacs_sound_code%27>planning_dimacs_sound_code'</a></li><li><a href=#Solve_SASP-inv_list_to_rbt>inv_list_to_rbt</a></li><li><a href=#Solve_SASP-Tree2_list_to_rbt>Tree2_list_to_rbt</a></li><li><a href=#Solve_SASP-set_list_to_rbt>set_list_to_rbt</a></li><li><a href=#Solve_SASP-dimacs_model_code>dimacs_model_code</a></li><li><a href=#Solve_SASP-decode_sound>decode_sound</a></li><li><a href=#Solve_SASP-decode_complete>decode_complete</a></li></ul></li></ul></div><ul><li><a href=https://www.isa-afp.org/browser_info/current/AFP/Verified_SAT_Based_AI_Planning/outline.pdf>Proof
outline</a></li><li><a href=https://www.isa-afp.org/browser_info/current/AFP/Verified_SAT_Based_AI_Planning/document.pdf>Proof
document</a></li><li><a href=https://www.isa-afp.org/browser_info/current/AFP/Verified_SAT_Based_AI_Planning/session_graph.pdf>Theory dependencies</a></li></ul></div></aside><div class="content theories"><header><form action=/%20search><div class=form-container><input id=searchInput type=search size=31 maxlength=255 aria-label="Search the AFP" list=autocomplete><button id=searchButton type=button><img src=/images/search.svg alt=Search></button>
<datalist id=autocomplete></datalist></div></form><h1><span class=first>S</span>ession <span class=first>V</span>erified_<span class=first>S</span><span class=first>A</span><span class=first>T</span>_<span class=first>B</span>ased_<span class=first>A</span><span class=first>I</span>_<span class=first>P</span>lanning</h1><div></div></header><div><main><div id=List_Supplement><div class=head><h1>Theory List_Supplement</h1></div><pre class=source><span class=comment1>(*
  Author: Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> List_Supplement
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=List_Supplement-list_foot><span class=command>lemma</span></span> list_foot<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span> 
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>y</span> <span class=free>ys</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=main>[</span><span class=free>y</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>y</span> <span class=bound>ys</span><span class=main>.</span> <span class=free>l</span> <span class=main>=</span> <span class=bound>ys</span> <span class=main>@</span> <span class=main>[</span><span class=bound>y</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> a 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>l</span><span class=main>)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>[]</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>a</span><span class=main>]</span> <span class=main>=</span> <span class=skolem>a</span> <span class=main>#</span> <span class=skolem>l</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> True
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>thm</span></span> Cons
            <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>ys</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>=</span> <span class=skolem>ys</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> Cons.IH
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>#</span> <span class=skolem>l</span> <span class=main>=</span> <span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ys</span> <span class=main>@</span> <span class=main>[</span><span class=skolem>y</span><span class=main>]</span>"</span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> assms that 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=List_Supplement-list_ex_intersection><span class=command>lemma</span></span> list_ex_intersection<span class=main>:</span> <span class=quoted><span class=quoted>"list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span> <span class=free>xs</span> <span class=main>⟷</span> set <span class=free>xs</span> <span class=main>∩</span> set <span class=free>ys</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=free>xs</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=free>ys</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> list_ex_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>v'</span> <span class=main>∈</span> set <span class=free>ys</span><span class=main>.</span> <span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> list_ex_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=free>xs</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>v'</span> <span class=main>∈</span> set <span class=free>ys</span><span class=main>.</span> <span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>v'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=free>xs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>∈</span> set <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=skolem>v'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=free>xs</span> <span class=main>∩</span> set <span class=free>ys</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span>  <span class=quoted><span class=quoted>"set <span class=free>xs</span> <span class=main>∩</span> set <span class=free>ys</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>v'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=free>xs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>∈</span> set <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=skolem>v'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>∃</span><span class=bound>v'</span> <span class=main>∈</span> set <span class=free>ys</span><span class=main>.</span> <span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span> <span class=free>xs</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> list_ex_iff 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>v'</span> <span class=main>∈</span> set <span class=free>ys</span><span class=main>.</span> <span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span> <span class=main>=</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=free>ys</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> list_ex_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span> <span class=free>xs</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=List_Supplement-length_map_upt><span class=command>lemma</span></span> length_map_upt<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>map <span class=free>f</span> <span class=main>[</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>b</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=main>-</span> <span class=free>a</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>[</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>b</span><span class=main>]</span> <span class=main>=</span> <span class=free>b</span> <span class=main>-</span> <span class=free>a</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> length_upt
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>map <span class=free>f</span> <span class=main>[</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>b</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> length <span class=main>[</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>b</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=List_Supplement-not_list_ex_equals_list_all_not><span class=command>lemma</span></span> not_list_ex_equals_list_all_not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>¬</span>list_ex <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬</span><span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=free>xs</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>¬</span>list_ex <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span>Bex <span class=main>(</span>set <span class=free>xs</span><span class=main>)</span> <span class=free>P</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> list_ex_iff 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> Ball <span class=main>(</span>set <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬</span><span class=free>P</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Ball_set_list_all<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=List_Supplement-element_of_subseqs_then_subset><span class=command>lemma</span></span> element_of_subseqs_then_subset<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> set <span class=main>(</span>subseqs <span class=free>l'</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span><span class=quoted><span class=quoted>"set <span class=free>l</span> <span class=main>⊆</span> set <span class=free>l'</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l'</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>l</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>l'</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>subseqs <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>l'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Cons <span class=skolem>x</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>subseqs <span class=skolem>l'</span><span class=main>)</span> <span class=main>∪</span> set <span class=main>(</span>subseqs <span class=skolem>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> subseqs.simps<span class=main>(</span>2<span class=main>)</span> Let_def set_map set_append<span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> <span class=main>(</span>Cons <span class=skolem>x</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>subseqs <span class=skolem>l'</span><span class=main>)</span>"</span></span>
    <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> set <span class=main>(</span>subseqs <span class=skolem>l'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> Cons.prems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> A
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>l''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l''</span> <span class=main>∈</span> set <span class=main>(</span>subseqs <span class=skolem>l'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>=</span> <span class=skolem>x</span> <span class=main>#</span> <span class=skolem>l''</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>l''</span> <span class=main>⊆</span> set <span class=skolem>l'</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>l''</span></span><span class=main>,</span> <span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> B
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.IH
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=comment1>(* TODO rewrite using list comprehension ‹embed xs = [[x]. x ← xs]› *)</span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Embed a list into a list of singleton lists. ›</span></span>
<span class=keyword1><span class=command>primrec</span></span> <span class=entity>embed</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list list"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>embed</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span> 
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>embed</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>]</span> <span class=main>#</span> <span class=free>embed</span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1 id=List_Supplement-set_of_embed_is><span class=command>lemma</span></span> set_of_embed_is<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>embed <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=main>[</span><span class=bound>x</span><span class=main>]</span> <span class=main>|</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>}</span>"</span></span> 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=List_Supplement-concat_is_inverse_of_embed><span class=command>lemma</span></span> concat_is_inverse_of_embed<span class=main>:</span>
  <span class=quoted><span class=quoted>"concat <span class=main>(</span>embed <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=List_Supplement-embed_append><span class=command>lemma</span></span> embed_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"embed <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> embed <span class=free>xs</span> <span class=main>@</span> embed <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"embed <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>x</span><span class=main>]</span> <span class=main>#</span> embed <span class=main>(</span><span class=skolem>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>try0</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>x</span><span class=main>]</span> <span class=main>#</span> <span class=main>(</span>embed <span class=skolem>xs</span> <span class=main>@</span> embed <span class=free>ys</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> Cons.IH 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Map_Supplement><div class=head><h1>Theory Map_Supplement</h1></div><pre class=source><span class=comment1>(*
  Author: Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> Map_Supplement
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Map_Supplement-map_of_defined_if_constructed_from_list_of_constant_assignments><span class=command>lemma</span></span> map_of_defined_if_constructed_from_list_of_constant_assignments<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>x</span> <span class=main>∈</span> set <span class=free>xs</span><span class=main>.</span> <span class=main>(</span>map_of <span class=free>l</span><span class=main>)</span> <span class=bound>x</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>l</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>#</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=skolem>xs</span><span class=main>.</span> <span class=main>(</span>map_of <span class=var>?l'</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> l<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?l'</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=comment1>― ‹ NOTE Function graph is the set of pairs (x, f x) for a (total) function f. ›</span>
<span class=comment1>― ‹ TODO Remove the first premise (follows from the second). ›</span>
<span class=keyword1 id=Map_Supplement-map_of_from_function_graph_is_some_if><span class=command>lemma</span></span> map_of_from_function_graph_is_some_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>f</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'b</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"set <span class=free>xs</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms 
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>f</span></span> <span class=quoted><span class=free>x</span></span><span class=main>)</span>
  <span class=comment1>― ‹ NOTE Base case follows trivially from violation of assumption <span class=antiquoted><span class=raw_text><span class=operator>‹</span>set xs ≠ {}›</span></span>. ›</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>xs</span><span class=main>)</span>
    <span class=keyword1><span class=command>thm</span></span> Cons
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=skolem>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>have</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=skolem>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>xs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?m</span><span class=main>(</span><span class=skolem>a</span> <span class=main>↦</span> <span class=skolem>f</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> map_of_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
      <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"set <span class=skolem>xs</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
            <span class=comment1>― ‹ NOTE Follows from contradiction (<span class=antiquoted><span class=raw_text><span class=operator>‹</span>x ∈ set (Cons a xs) ∧ set xs = {} ∧ x ≠ a ≡ ⊥›</span></span>)›</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> set <span class=skolem>xs</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>≠</span> <span class=skolem>a</span>›</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=skolem>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>xs</span><span class=main>)</span><span class=main>)</span> <span class=skolem>x</span> <span class=main>=</span> <span class=var>?m</span> <span class=skolem>x</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>≠</span> <span class=skolem>a</span>›</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
              <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>OF</span> False<span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
          <span class=keyword1><span class=command>qed</span></span> 
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Map_Supplement-foldl_map_append_is_some_if><span class=command>lemma</span></span> foldl_map_append_is_some_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>m</span> <span class=main>∈</span> set <span class=free>ms</span><span class=main>.</span> <span class=bound>m</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m'</span> <span class=main>∈</span> set <span class=free>ms</span><span class=main>.</span> <span class=bound>m'</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span> <span class=main>∨</span> <span class=bound>m'</span> <span class=free>x</span> <span class=main>=</span> None"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"foldl <span class=main>(++)</span> <span class=free>b</span> <span class=free>ms</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span>"</span></span> 
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ms</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
  <span class=comment1>― ‹ NOTE Induction base case violates first assumption (we have at least one element in ms 
    and hence <span class=antiquoted><span class=raw_text><span class=operator>‹</span>ms ≠ []›</span></span>). ›</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>ms</span><span class=main>)</span>
  <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>b_is_some_y<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span>"</span></span> 
    <span class=main>|</span> <span class=main>(</span>m_is_some_y<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>m</span> <span class=main>∈</span> set <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ms</span><span class=main>)</span><span class=main>.</span> <span class=bound>m</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>b</span> <span class=main>++</span> <span class=skolem>a</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms</span><span class=main>.</span> <span class=bound>m</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> b_is_some_y
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span> <span class=main>∨</span> <span class=skolem>a</span> <span class=free>x</span> <span class=main>=</span> None"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
        <span class=keyword1><span class=command>using</span></span> map_add_Some_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>b</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> m_is_some_y
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> False 
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>∈</span> set <span class=skolem>ms</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> m_is_some_y <span class=keyword1><span class=command>try0</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m'</span> <span class=main>∈</span> set <span class=skolem>ms</span><span class=main>.</span> <span class=bound>m'</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span> <span class=main>∨</span> <span class=bound>m'</span> <span class=free>x</span> <span class=main>=</span> None"</span></span>  
    <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>++</span> <span class=skolem>a</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=comment1>(* TODO "∀(v, a) ∈ set l. ∀(v', a') ∈ set l. v ≠ v' ∨ a = a'" ↝
  "∀(v', a') ∈ set l. v ≠ v' ∨ a = a'" (this is too strong; we only consider (v, a), i.e. fixed v)
*)</span>
<span class=comment1>(* TODO isn't this the same as map_of_is_SomeI? *)</span>
<span class=keyword1 id=Map_Supplement-map_of_constant_assignments_defined_if><span class=command>lemma</span></span> map_of_constant_assignments_defined_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>l</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>l</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>l</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"map_of <span class=free>l</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>l</span><span class=main>)</span>
  <span class=keyword1><span class=command>thm</span></span> Cons
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>have</span></span> v_a_in_l<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=skolem>l</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> False
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=skolem>l</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=skolem>l</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"map_of <span class=skolem>l</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Cons.IH v_a_in_l
          <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> ih <span class=main>=</span> this
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> set <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"fst <span class=skolem>x</span> <span class=main>≠</span> <span class=free>v</span> <span class=main>∨</span> snd <span class=skolem>x</span> <span class=main>=</span> <span class=free>a</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span> v_a_in_l
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
      <span class=comment1>― ‹ NOTE If <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"fst x = v"</span><span class=antiquote>}</span></span> then <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"snd x = a"</span><span class=antiquote>}</span></span> by fact <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"nb"</span><span class=antiquote>}</span></span>; moreover if 
        on the other hand <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"fst x ≠ v"</span><span class=antiquote>}</span></span>, then the proposition follows from the induction 
        hypothesis since <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"map_of (x # l) v = map_of l v"</span><span class=antiquote>}</span></span> in that case. ›</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> ih nb
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"fst <span class=skolem>x</span> <span class=main>=</span> <span class=free>v</span>"</span></span><span class=main>)</span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>fastforce</span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=CNF_Supplement><div class=head><h1>Theory CNF_Supplement</h1></div><pre class=source><span class=comment1>(*
  Author: Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> CNF_Supplement
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../Propositional_Proof_Systems/CNF_Formulas_Sema.html>Propositional_Proof_Systems.CNF_Formulas_Sema</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* TODO fix warnings *)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>is_literal_formula</span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_literal_formula</span> <span class=main>(</span>Atom <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>is_literal_formula</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True"</span></span> 
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>is_literal_formula</span> <span class=main><span class=bound><span class=entity>_</span></span></span> <span class=main>=</span> False"</span></span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>literal_formula_to_literal</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> formula <span class=main>⇒</span> <span class=tfree>'a</span> literal"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>literal_formula_to_literal</span> <span class=main>(</span>Atom <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>literal_formula_to_literal</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>¯</span>"</span></span> 

<span class=keyword1 id=CNF_Supplement-is_literal_formula_then_cnf_is_singleton_clause><span class=command>lemma</span></span> is_literal_formula_then_cnf_is_singleton_clause<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_literal_formula <span class=free>f</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>C</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"cnf <span class=free>f</span> <span class=main>=</span> <span class=main>{</span> <span class=free>C</span> <span class=main>}</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>f_is_positive_literal<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>f</span> <span class=main>=</span> Atom <span class=bound>a</span>"</span></span> 
    <span class=main>|</span> <span class=main>(</span>f_is_negative_literal<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>f</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=bound>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms is_literal_formula.elims<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>f</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span> 
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>C</span><span class=main>.</span> cnf <span class=free>f</span> <span class=main>=</span> <span class=main>{</span> <span class=bound>C</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> f_is_positive_literal
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> Atom <span class=skolem>a</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=free>f</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=skolem>a</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> f_is_negative_literal
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=skolem>a</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=free>f</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=skolem>a</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> that
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span> 
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=CNF_Supplement-literal_formula_to_literal_is_inverse_of_form_of_lit><span class=command>lemma</span></span> literal_formula_to_literal_is_inverse_of_form_of_lit<span class=main>:</span> 
  <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>(</span>form_of_lit <span class=free>L</span><span class=main>)</span> <span class=main>=</span> <span class=free>L</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>L</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=CNF_Supplement-is_nnf_cnf><span class=command>lemma</span></span> is_nnf_cnf<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=free>F</span>"</span></span> 
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_nnf <span class=free>F</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms 
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>F</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Or <span class=skolem>F1</span> <span class=skolem>F2</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main>(</span><span class=skolem>F1</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=skolem>F2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Or.prems is_cnf.simps<span class=main>(</span>5<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> disj_is_nnf 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=CNF_Supplement-cnf_of_literal_formula><span class=command>lemma</span></span> cnf_of_literal_formula<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_literal_formula <span class=free>f</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=free>f</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=free>f</span> <span class=main>}</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>f_is_positive_literal<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>f</span> <span class=main>=</span> Atom <span class=bound>a</span>"</span></span>
    <span class=main>|</span> <span class=main>(</span>f_is_negative_literal<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=bound>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms is_literal_formula.elims<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>f</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>f</span> <span class=main>=</span> Atom <span class=bound>a</span>"</span></span><span class=main>]</span>
       is_literal_formula.elims<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>f</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=bound>a</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=CNF_Supplement-is_cnf_foldr_and_if><span class=command>lemma</span></span> is_cnf_foldr_and_if<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=free>fs</span><span class=main>.</span> is_cnf <span class=bound>f</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=free>fs</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>fs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>f</span> <span class=skolem>fs</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=main>(</span><span class=skolem>f</span> <span class=main>#</span> <span class=skolem>fs</span><span class=main>)</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>f</span> <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=skolem>fs</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=skolem>fs</span><span class=main>.</span> is_cnf <span class=bound>f</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> Cons.prems
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=skolem>fs</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> Cons.IH
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=skolem>f</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> Cons.prems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=CNF_Semantics_Supplement><div class=head><h1>Theory CNF_Semantics_Supplement</h1></div><pre class=source><span class=comment1>(*
  Author: Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> CNF_Semantics_Supplement
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../Propositional_Proof_Systems/CNF_Formulas_Sema.html>Propositional_Proof_Systems.CNF_Formulas_Sema</a>"</span> <span class=quoted>"<a href=CNF_Supplement.html>CNF_Supplement</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=CNF_Semantics_Supplement-not_model_if_exists_unmodeled_singleton_clause><span class=command>lemma</span></span> not_model_if_exists_unmodeled_singleton_clause<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=free>F</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>L</span><span class=main>}</span> <span class=main>∈</span> cnf <span class=free>F</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>lit_semantics <span class=free>ν</span> <span class=free>L</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>ν</span> <span class=main>⊨</span> <span class=free>F</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>¬</span><span class=free>ν</span> <span class=main>⊨</span> <span class=free>F</span>"</span></span>  
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ν</span> <span class=main>⊨</span> <span class=free>F</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_nnf <span class=free>F</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_nnf_cnf<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>L</span><span class=main>}</span>"</span></span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>L'</span><span class=main>.</span> <span class=bound>L'</span> <span class=main>∈</span> <span class=var>?C</span> <span class=main>∧</span> lit_semantics <span class=free>ν</span> <span class=bound>L'</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∀</span><span class=bound>C</span> <span class=main>∈</span> cnf <span class=free>F</span><span class=main>.</span> <span class=main>∃</span><span class=bound>L</span><span class=main>.</span> <span class=bound>L</span> <span class=main>∈</span> <span class=bound>C</span> <span class=main>∧</span> lit_semantics <span class=free>ν</span> <span class=bound>L</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>cnf_semantics <span class=free>ν</span> <span class=main>(</span>cnf <span class=free>F</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def clause_semantics_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>ν</span> <span class=main>⊨</span> <span class=free>F</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> cnf_semantics
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> 
    <span class=keyword1><span class=command>using</span></span> a 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE This follows by contraposition from the previous lemma 
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>not_model_if_exists_unmodeled_singleton_clause›</span></span>. ›</span>
<span class=keyword1><span class=command>corollary</span></span> model_then_all_singleton_clauses_modelled<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=free>F</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>L</span><span class=main>}</span> <span class=main>∈</span> cnf <span class=free>F</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ν</span> <span class=main>⊨</span> <span class=free>F</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>ν</span> <span class=free>L</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> not_model_if_exists_unmodeled_singleton_clause<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>3<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=comment1>― ‹ NOTE This is essentially the <span class=antiquoted><span class=raw_text><span class=operator>‹</span>⇒›</span></span> direction of the compactness theorem when treating CNFs as sets
of formulas (sets of disjunctions in this case). ›</span>
<span class=keyword1 id=CNF_Semantics_Supplement-model_for_cnf_is_model_of_all_subsets><span class=command>lemma</span></span> model_for_cnf_is_model_of_all_subsets<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>ν</span> <span class=free>ℱ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ℱ'</span> <span class=main>⊆</span> <span class=free>ℱ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>ν</span> <span class=free>ℱ'</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> <span class=free>ℱ'</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> <span class=free>ℱ</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>ν</span> <span class=skolem>C</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=CNF_Semantics_Supplement-cnf_semantics_monotonous_in_cnf_subsets_if><span class=command>lemma</span></span> cnf_semantics_monotonous_in_cnf_subsets_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=free>Φ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=free>Φ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=free>Φ'</span> <span class=main>⊆</span> cnf <span class=free>Φ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>(</span>cnf <span class=free>Φ'</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_nnf <span class=free>Φ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_nnf_cnf<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>(</span>cnf <span class=free>Φ</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> cnf_semantics assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> model_for_cnf_is_model_of_all_subsets<span class=main>[</span><span class=operator>OF</span> _ assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> modelling_relation_monotonous_in_cnf_subsets_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=free>Φ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=free>Φ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=free>Φ'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=free>Φ'</span> <span class=main>⊆</span> cnf <span class=free>Φ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=free>Φ'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>(</span>cnf <span class=free>Φ'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> cnf_semantics_monotonous_in_cnf_subsets_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_semantics is_nnf_cnf<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>  
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE Show that any clause <span class=antiquoted><span class=raw_text><span class=operator>‹</span>C›</span></span> containing a subset <span class=antiquoted><span class=raw_text><span class=operator>‹</span>C›</span></span> for which all literals
  <span class=antiquoted><span class=raw_text><span class=operator>‹</span>L›</span></span> evaluate to <span class=antiquoted><span class=raw_text><span class=operator>‹</span>False›</span></span> for the given valuation <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span>, then the clause
  semantics evaluation can be reduced to the set <span class=antiquoted><span class=raw_text><span class=operator>‹</span>C - C'›</span></span> where all literals of 
  <span class=antiquoted><span class=raw_text><span class=operator>‹</span>C'›</span></span> have been removed. ›</span>
<span class=keyword1 id=CNF_Semantics_Supplement-lit_semantics_reducible_to_subset_if><span class=command>lemma</span></span> lit_semantics_reducible_to_subset_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>C'</span> <span class=main>⊆</span> <span class=free>C</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>L</span> <span class=main>∈</span> <span class=free>C'</span><span class=main>.</span> <span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=bound>L</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=free>C</span> <span class=main>=</span> clause_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=free>C</span> <span class=main>-</span> <span class=free>C'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=State_Variable_Representation><div class=head><h1>Theory State_Variable_Representation</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> State_Variable_Representation
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=../Propositional_Proof_Systems/Formulas.html>Propositional_Proof_Systems.Formulas</a>"</span> <span class=quoted>"<a href=../Propositional_Proof_Systems/Sema.html>Propositional_Proof_Systems.Sema</a>"</span> 
    <span class=quoted>"<a href=../Propositional_Proof_Systems/CNF.html>Propositional_Proof_Systems.CNF</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"State-Variable Representation"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Moving on to the Isabelle implementation of state-variable representation, we
first add a more concrete representation of states using Isabelle maps. To this end, we add a 
type synonym \isaname{state} for maps of variables to values. 
Since maps can be conveniently constructed from lists of 
assignments---i.e. pairs <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>(v, a) :: 'variable × 'domain›</span></span></span></span>---we also add a corresponding type 
synonym \isaname{assignment}. ›</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> <span class=main>⇀</span> <span class=tfree>'domain</span>"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> assignment <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Effects and effect condition (see \autoref{sub:state-variable-representation}) are 
implemented in a straight forward manner using a datatype with constructors for each effect type.›</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> Effect <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> list"</span></span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=STRIPS_Representation><div class=head><h1>Theory STRIPS_Representation</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> STRIPS_Representation
  <span class=keyword2><span class=keyword>imports</span></span> <a href=State_Variable_Representation.html>State_Variable_Representation</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"STRIPS Representation"</span></span>

<span class=comment1>(*&lt;*)</span>
<span class=keyword1><span class=command>type_synonym</span></span>  <span class=main>(</span><span class=tfree>'variable</span><span class=main>)</span> strips_state <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> state"</span></span>
<span class=comment1>(*&gt;*)</span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We start by declaring a \isakeyword{record} for STRIPS operators.
This which allows us to define a data type and automatically generated selector operations. 
\footnote{For the full reference on records see \cite[11.6, pp.260-265]{wenzel--2018}} 

The record specification given below closely resembles the canonical representation of
STRIPS operators with fields corresponding to precondition, add effects as well as delete effects.›</span></span>

<span class=keyword1><span class=command>record</span></span>  <span class=main>(</span><span class=tfree>'variable</span><span class=main>)</span> strips_operator <span class=main>=</span> 
  precondition_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> list"</span></span> 
  add_effects_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> list"</span></span> 
  delete_effects_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> list"</span></span> 

<span class=comment1>― ‹ This constructor function is sometimes a more descriptive and replacement for the record 
syntax and can moreover be helpful if the record syntax leads to type ambiguity.›</span>
<span class=keyword1><span class=command>abbreviation</span></span>  <span class=entity>operator_for</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> list <span class=main>⇒</span> <span class=tfree>'variable</span> list <span class=main>⇒</span> <span class=tfree>'variable</span> list <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>operator_for</span> <span class=free><span class=bound><span class=entity>pre</span></span></span> <span class=free><span class=bound><span class=entity>add</span></span></span> <span class=free><span class=bound><span class=entity>delete</span></span></span> <span class=main>≡</span> <span class=main>⦇</span> 
    precondition_of <span class=main>=</span> <span class=free><span class=bound><span class=entity>pre</span></span></span>
    <span class=main>,</span> add_effects_of <span class=main>=</span> <span class=free><span class=bound><span class=entity>add</span></span></span>
    <span class=main>,</span> delete_effects_of <span class=main>=</span> <span class=free><span class=bound><span class=entity>delete</span></span></span> <span class=main>⦈</span>"</span></span> 

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>to_precondition</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_operator <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> assignment list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>to_precondition</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>to_effect</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_operator <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> Effect"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>to_effect</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>=</span>  <span class=main>[</span><span class=main>(</span><span class=bound>v<span class=hidden>⇩</span><sub>a</sub></span><span class=main>,</span> True<span class=main>)</span><span class=main>.</span> v<span class=hidden>⇩</span><sub>a</sub> <span class=main>←</span> add_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span><span class=main>(</span><span class=bound>v<span class=hidden>⇩</span><sub>d</sub></span><span class=main>,</span> False<span class=main>)</span><span class=main>.</span> v<span class=hidden>⇩</span><sub>d</sub> <span class=main>←</span> delete_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Similar to the operator definition, we use a record to represent STRIPS problems and specify
fields for the variables, operators, as well as the initial and goal state. ›</span></span>

<span class=keyword1><span class=command>record</span></span>  <span class=main>(</span><span class=tfree>'variable</span><span class=main>)</span> strips_problem <span class=main>=</span>
  variables_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> list"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>
  operators_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_operator list"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>
  initial_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>
  goal_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>

<span class=keyword1><span class=command>value</span></span>  <span class=quoted><span class=quoted>"<span class=free>stop</span>"</span></span> <span class=comment1>(* Tell document preparation to stop collecting for the last tag *)</span>
<span class=comment1>(*&lt;*)</span>
<span class=comment1>― ‹ This constructor function is sometimes a more descriptive and replacement for the record 
syntax and can moreover be helpful if the record syntax leads to type ambiguity.›</span>
<span class=comment1>(* TODO change identifier gs ~&gt; G *)</span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>problem_for</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> list 
  <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator list 
  <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state 
  <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state
  <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>)</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>problem_for</span> <span class=free><span class=bound><span class=entity>vs</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>gs</span></span></span> <span class=main>≡</span> <span class=main>⦇</span> 
    variables_of <span class=main>=</span> <span class=free><span class=bound><span class=entity>vs</span></span></span>
    <span class=main>,</span> operators_of <span class=main>=</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
    <span class=main>,</span> initial_of <span class=main>=</span> <span class=free><span class=bound><span class=entity>I</span></span></span>
    <span class=main>,</span> goal_of <span class=main>=</span> <span class=free><span class=bound><span class=entity>gs</span></span></span> <span class=main>⦈</span>"</span></span> 

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>)</span> strips_plan <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_operator list"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>)</span> strips_parallel_plan <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_operator list list"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_valid_operator_strips</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_valid_operator_strips</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span> 
      <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span> 
      <span class=main>;</span> <span class=bound>pre</span> <span class=main>=</span> precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span>
      <span class=main>;</span> <span class=bound>add</span> <span class=main>=</span> add_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span>
      <span class=main>;</span> <span class=bound>del</span> <span class=main>=</span> delete_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span>
    <span class=keyword1>in</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=bound>vs</span><span class=main>)</span> <span class=bound>pre</span> 
    <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=bound>vs</span><span class=main>)</span> <span class=bound>add</span>
    <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=bound>vs</span><span class=main>)</span> <span class=bound>del</span>
    <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>¬</span>ListMem <span class=bound>v</span> <span class=bound>del</span><span class=main>)</span> <span class=bound>add</span>
    <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>¬</span>ListMem <span class=bound>v</span> <span class=bound>add</span><span class=main>)</span> <span class=bound>del</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>is_valid_problem_strips</span> <span class=free><span class=bound><span class=entity>Π</span></span></span>
  <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>I</span> <span class=main>=</span> initial_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>G</span> <span class=main>=</span> goal_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
    <span class=keyword1>in</span>  list_all <span class=main>(</span>is_valid_operator_strips <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span> <span class=bound>ops</span> 
    <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟷</span> ListMem <span class=bound>v</span> <span class=bound>vs</span><span class=main>)</span> 
    <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟶</span> ListMem <span class=bound>v</span> <span class=bound>vs</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_operator_applicable_in</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_operator_applicable_in</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>p</span> <span class=main>=</span> precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=keyword1>in</span>
    list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span> <span class=bound>p</span>"</span></span>

<span class=comment1>(* TODO effect_to_strips and effect_to_assignments could just be removed if we prove a lemma 
  showing the equivalence to effcond semantics.*)</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>effect__strips</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_operator <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> Effect"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>effect__strips</span> <span class=free><span class=bound><span class=entity>op</span></span></span> 
    <span class=main>=</span> 
      map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span>
      <span class=main>@</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>effect_to_assignments</span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>effect_to_assignments</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> effect__strips <span class=free><span class=bound><span class=entity>op</span></span></span>"</span></span>
<span class=comment1>(*&gt;*)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ As discussed in \autoref{sub:serial-sas-plus-and-parallel-strips}, the effect of
a STRIPS operator can be normalized to a conjunction of atomic effects. We can therefore construct 
the successor state by simply converting the list of add effects to assignments to <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹True›</span></span></span></span> resp. 
converting the list of delete effect to a list of assignments to <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹False›</span></span></span></span> and then adding the 
map corresponding to the assignments to the given state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>s</span></span>›</span></span></span></span> as shown below in definition 
\ref{isadef:operator-execution-strips}. 
\footnote{Function \path{effect_to_assignments} converts the operator effect to a list of 
assignments. }›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>execute_operator</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state 
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator 
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>⪢</span>"</span> 52<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>execute_operator</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span>
    <span class=main>≡</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=STRIPS_Semantics><div class=head><h1>Theory STRIPS_Semantics</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> STRIPS_Semantics
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=STRIPS_Representation.html>STRIPS_Representation</a>"</span>
    <span class=quoted>"<a href=List_Supplement.html>List_Supplement</a>"</span>
    <span class=quoted>"<a href=Map_Supplement.html>Map_Supplement</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"STRIPS Semantics"</span></span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Having provided a concrete implementation of STRIPS and a corresponding locale <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>strips›</span></span></span></span>, we
can now continue to define the semantics of serial and parallel STRIPS plan execution (see
\autoref{sub:serial-sas-plus-and-parallel-strips} and
\autoref{sub:parallel-sas-plus-and-parallel-strips}). ›</span></span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Serial Plan Execution Semantics"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Serial plan execution is defined by primitive recursion on the plan.
Definition \autoref{isadef:execute_serial_plan} returns the given state if the state argument does
note satisfy the precondition of the next operator in the plan.
Otherwise it executes the rest of the plan on the successor state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹execute_operator <span class=free><span class=free>s</span></span> <span class=free><span class=free>op</span></span>›</span></span></span></span> of
the given state and operator. ›</span></span>

<span class=keyword1><span class=command>primrec</span></span>  <span class=entity>execute_serial_plan</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>execute_serial_plan</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>s</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>execute_serial_plan</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> is_operator_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span>
      <span class=keyword1>then</span> <span class=free>execute_serial_plan</span> <span class=main>(</span>execute_operator <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
      <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>s</span></span></span>
  <span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Analogously, a STRIPS trace either returns the singleton list containing only the given
state in case the precondition of the next operator in the plan is not satisfied. Otherwise, the
given state is prepended to trace of the rest of the plan for the successor state of executing the
next operator on the given state. ›</span></span>

<span class=keyword1><span class=command>fun</span></span>  <span class=entity>trace_serial_plan_strips</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state <span class=main>⇒</span> <span class=tfree>'variable</span> strips_plan <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>trace_serial_plan_strips</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>trace_serial_plan_strips</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>
      <span class=main>=</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>if</span> is_operator_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span>
        <span class=keyword1>then</span> <span class=free>trace_serial_plan_strips</span> <span class=main>(</span>execute_operator <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
        <span class=keyword1>else</span> <span class=main>[]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Finally, a serial solution is a plan which transforms a given problems initial state into
its goal state and for which all operators are elements of the problem's operator list. ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>is_serial_solution_for_problem</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_serial_solution_for_problem</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>π</span></span></span>
    <span class=main>≡</span> <span class=main>(</span>goal_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=main>(</span>initial_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>π</span></span></span>
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=bound>op</span> <span class=main>(</span>operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>π</span></span></span>"</span></span>

<span class=keyword1 id=STRIPS_Semantics-is_valid_problem_strips_initial_of_dom><span class=command>lemma</span></span> is_valid_problem_strips_initial_of_dom<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span>"</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>≠</span> None <span class=main>⟷</span> ListMem <span class=skolem>v</span> <span class=var>?vs</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_problem_strips_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?I</span> <span class=main>⟷</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ListMem_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-is_valid_problem_dom_of_goal_state_is><span class=command>lemma</span></span> is_valid_problem_dom_of_goal_state_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.goal_of <span class=free>Π</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟶</span> ListMem <span class=bound>v</span> <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_problem_strips_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?G</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> nb
        <span class=keyword1><span class=command>unfolding</span></span> ListMem_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-is_valid_problem_strips_operator_variable_sets><span class=command>lemma</span></span> is_valid_problem_strips_operator_variable_sets<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"disjnt <span class=main>(</span>set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>is_valid_operator_strips <span class=free>Π</span><span class=main>)</span> <span class=var>?ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_problem_strips_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> calculation
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_strips_def list_all_iff Let_def ListMem_iff
      <span class=keyword1><span class=command>using</span></span> variables_of_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"disjnt <span class=main>(</span>set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> disjnt_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-effect_to_assignments_i><span class=command>lemma</span></span> effect_to_assignments_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>as</span> <span class=main>=</span> effect_to_assignments <span class=free>op</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>as</span> <span class=main>=</span>  <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
      <span class=main>@</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> effect_to_assignments_def effect__strips_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=STRIPS_Semantics-effect_to_assignments_ii><span class=command>lemma</span></span> effect_to_assignments_ii<span class=main>:</span>
  <span class=comment1>― ‹ NOTE <span class=antiquoted><span class=raw_text><span class=operator>‹</span>effect_to_assignments›</span></span> can be simplified drastically given that only atomic effects
  and the add-effects as well as delete-effects lists only consist of variables.›</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>as</span> <span class=main>=</span> effect_to_assignments <span class=free>op</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>as<span class=hidden>⇩</span><sub>2</sub></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>as</span> <span class=main>=</span> <span class=free>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=free>as<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms effect__strips_def effect_to_assignments_def<span class=main>)</span>

<span class=comment1>― ‹ NOTE Show that for every variable <span class=antiquoted><span class=raw_text><span class=operator>‹</span>v›</span></span> in either the add effect list or the delete effect
list, there exists an assignment in  \isaname{effect_to_assignments op} representing setting <span class=antiquoted><span class=raw_text><span class=operator>‹</span>v›</span></span> to
true respectively setting <span class=antiquoted><span class=raw_text><span class=operator>‹</span>v›</span></span> to false. Note that the first assumption amounts to saying that
the add effect list is not empty. This also requires us to split lemma
\isaname{effect_to_assignments_iii} into two separate lemmas since add and delete effect lists are
not required to both contain at least one variable simultaneously. ›</span>
<span class=keyword1 id=STRIPS_Semantics-effect_to_assignments_iii_a><span class=command>lemma</span></span> effect_to_assignments_iii_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>v</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>as</span> <span class=main>=</span> effect_to_assignments <span class=free>op</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>a</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> set <span class=free>as</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> True<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?add_assignments</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?delete_assignments</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span></span>
      <span class=keyword2><span class=keyword>where</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>as</span> <span class=main>=</span> <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> a2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> a3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> effect_to_assignments_ii
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=free>as</span>
      <span class=main>=</span> <span class=var>?add_assignments</span> <span class=main>∪</span> <span class=var>?delete_assignments</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>― ‹ NOTE The existence of an assignment as proposed can be shown by the following sequence of
      set inclusions. ›</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>from</span></span> b <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?add_assignments</span> <span class=main>⊆</span> set <span class=free>as</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=free>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>}</span> <span class=main>⊆</span> <span class=var>?add_assignments</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> a2
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> set <span class=free>as</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>=</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> True<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> that
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-effect_to_assignments_iii_b><span class=command>lemma</span></span> effect_to_assignments_iii_b<span class=main>:</span>
  <span class=comment1>― ‹ NOTE This proof is symmetrical to the one above. ›</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>v</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>as</span> <span class=main>=</span> effect_to_assignments <span class=free>op</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>a</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> set <span class=free>as</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> False<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?add_assignments</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?delete_assignments</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span></span>
      <span class=keyword2><span class=keyword>where</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>as</span> <span class=main>=</span> <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> a2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> a3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> effect_to_assignments_ii
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=free>as</span>
      <span class=main>=</span> <span class=var>?add_assignments</span> <span class=main>∪</span> <span class=var>?delete_assignments</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>― ‹ NOTE The existence of an assignment as proposed can be shown by the following sequence of
      set inclusions. ›</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>from</span></span> b <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?delete_assignments</span> <span class=main>⊆</span> set <span class=free>as</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=free>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>}</span> <span class=main>⊆</span> <span class=var>?delete_assignments</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> a2
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> set <span class=free>as</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>=</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> False<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> that
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-effect__strips_i><span class=command>lemma</span></span> effect__strips_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>op</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>e</span> <span class=main>=</span> effect__strips <span class=free>op</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>es<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>es<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>e</span> <span class=main>=</span> <span class=main>(</span><span class=free>es<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=free>es<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>es<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>es<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>es<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>es<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>e</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>es<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=skolem>es<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>es<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> c<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>es<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> effect__strips_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> that
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-effect__strips_ii><span class=command>lemma</span></span> effect__strips_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>op</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>e</span> <span class=main>=</span> <span class=free>ConjunctiveEffect</span> <span class=main>(</span><span class=free>es<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=free>es<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>es<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>es<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>e'</span> <span class=main>∈</span> set <span class=free>es<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=bound>e'</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>e'</span> <span class=main>∈</span> set <span class=free>es<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=bound>e'</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
  <span class=comment1>― ‹ NOTE Show that for each variable <span class=antiquoted><span class=raw_text><span class=operator>‹</span>v›</span></span> in the add effect list, we can obtain an atomic effect
  with true value. ›</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>assume</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=free>es<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> List.set_map
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>e'</span></span>
        <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>e'</span> <span class=main>∈</span> set <span class=free>es<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>e'</span> <span class=main>=</span>  <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>e'</span> <span class=main>∈</span> set <span class=free>es<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=bound>e'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> True<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>e'</span> <span class=main>∈</span> set <span class=free>es<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=bound>e'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> True<span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=comment1>― ‹ NOTE the proof is symmetrical to the one above: for each variable v in the delete effect list,
  we can obtain an atomic effect with v being false. ›</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=free>es<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> List.set_map
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>e''</span></span>
        <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>e''</span> <span class=main>∈</span> set <span class=free>es<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>e''</span> <span class=main>=</span>  <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>e''</span> <span class=main>∈</span> set <span class=free>es<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=bound>e''</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> False<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>∃</span><span class=bound>e'</span><span class=main>∈</span>set <span class=free>es<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=bound>e'</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor theory Appendix AND make visible? *)</span>
<span class=keyword1 id=STRIPS_Semantics-map_of_constant_assignments_dom><span class=command>lemma</span></span> map_of_constant_assignments_dom<span class=main>:</span>
  <span class=comment1>― ‹ NOTE ancillary lemma used in the proof below. ›</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>vs</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dom <span class=free>m</span> <span class=main>=</span> set <span class=free>vs</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>vs</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=free>m</span> <span class=main>=</span> fst <span class=main>`</span> set <span class=var>?vs'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> dom_map_of_conv_image_fst
      <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=var>?vs'</span> <span class=main>=</span> set <span class=free>vs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-effect__strips_iii_a><span class=command>lemma</span></span> effect__strips_iii_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> <span class=main>(</span><span class=free>s</span> <span class=main>⪢</span> <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?as</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?as</span> <span class=main>=</span> <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> c<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> effect_to_assignments_ii
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> d<span class=main>:</span> <span class=quoted><span class=quoted>"map_of <span class=var>?as</span> <span class=main>=</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> b Map.map_of_append
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=comment1>― ‹ TODO refactor? ›</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"add_effects_of <span class=free>op</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?vs</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> c map_of_constant_assignments_dom
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=var>?as</span> <span class=skolem>v</span> <span class=main>=</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> d
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> True"</span></span>
      <span class=keyword1><span class=command>from</span></span> c <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=main>(</span>Some <span class=main>∘</span> <span class=var>?f</span><span class=main>)</span> <span class=main>|`</span> <span class=main>(</span>set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> map_of_map_restrict
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>using</span></span> a
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> <span class=free>s</span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> execute_operator_def
      <span class=keyword1><span class=command>using</span></span> b
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO In contrast to the proof above we need proof preparation with auto. Why? *)</span>
<span class=keyword1 id=STRIPS_Semantics-effect__strips_iii_b><span class=command>lemma</span></span> effect__strips_iii_b<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> <span class=main>(</span><span class=free>s</span> <span class=main>⪢</span> <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> Some False"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> a2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?as</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?as</span> <span class=main>=</span> <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> c<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> d<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> effect_to_assignments_ii
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> e<span class=main>:</span> <span class=quoted><span class=quoted>"map_of <span class=var>?as</span> <span class=main>=</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> b Map.map_of_append
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> c map_of_constant_assignments_dom
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a1
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> f <span class=main>=</span> this
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"delete_effects_of <span class=free>op</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?vs</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a2
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=var>?vs</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> d  map_of_constant_assignments_dom
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> g <span class=main>=</span> this
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> <span class=free>s</span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> execute_operator_def
        <span class=keyword1><span class=command>using</span></span> b
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>thm</span></span>  f map_add_dom_app_simps<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> f<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation  map_add_dom_app_simps<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> f<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a2 g
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=skolem>v</span> <span class=main>=</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False"</span></span>
      <span class=keyword1><span class=command>from</span></span> d <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>(</span>Some <span class=main>∘</span> <span class=var>?f</span><span class=main>)</span> <span class=main>|`</span> <span class=main>(</span>set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> map_of_map_restrict
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
        <span class=keyword1><span class=command>using</span></span> a2
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span>  <span class=quoted><span class=quoted>" <span class=free>s'</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO We need proof preparation with auto. Why? *)</span>
<span class=keyword1 id=STRIPS_Semantics-effect__strips_iii_c><span class=command>lemma</span></span> effect__strips_iii_c<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> <span class=main>(</span><span class=free>s</span> <span class=main>⪢</span> <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> <span class=free>s</span> <span class=bound>v</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> a2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?as</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?as</span> <span class=main>=</span> <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> c<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> d<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> effect_to_assignments_ii
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> e<span class=main>:</span> <span class=quoted><span class=quoted>"map_of <span class=var>?as</span> <span class=main>=</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>++</span> map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> b Map.map_of_append
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> c map_of_constant_assignments_dom
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a1
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span>  <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> d map_of_constant_assignments_dom
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=skolem>as<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a2
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>s</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> execute_operator_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> b map_add_dom_app_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The following theorem combines three preceding sublemmas which show
that the following properties hold for the successor state <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>s' ≡ execute_operator op s›</span></span></span></span>
obtained by executing an operator <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>op›</span></span></span></span> in a state <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>s›</span></span></span></span>:
\footnote{Lemmas \path{effect__strips_iii_a}, \path{effect__strips_iii_b}, and
\path{effect__strips_iii_c} (not shown).}

\begin{itemize}
  \item every add effect is satisfied in <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>s'›</span></span></span></span> (sublemma  \isaname{effect__strips_iii_a}); and,
  \item every delete effect that is not also an add effect is not satisfied in <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>s'›</span></span></span></span> (sublemma
\isaname{effect__strips_iii_b}); and finally
  \item the state remains unchanged---i.e. <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>s' v = s v›</span></span></span></span>---for all variables which are neither an
add effect nor a delete effect.
\end{itemize} ›</span></span>

<span class=comment1>(* TODO? Rewrite theorem ‹operator_effect__strips› to match ‹s ++ map_of (
effect_to_assignments op)› rather than ‹execute_operator Π op s› since we need this
form later on for the parallel execution theorem? *)</span>
<span class=keyword1><span class=command>theorem</span></span>  operator_effect__strips<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> <span class=main>(</span><span class=free>s</span> <span class=main>⪢</span> <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>
    <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span>
      <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
      <span class=main>⟹</span> <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> Some True"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span>
      <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
      <span class=main>⟹</span> <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> Some False"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span>
      <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
      <span class=main>⟹</span> <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> <span class=free>s</span> <span class=bound>v</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span>
    <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟹</span> <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> Some True"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms effect__strips_iii_a
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span>
    <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟹</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟹</span>  <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> Some False"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms effect__strips_iii_b
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span>
    <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟹</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟹</span> <span class=free>s'</span> <span class=bound>v</span> <span class=main>=</span> <span class=free>s</span> <span class=bound>v</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms effect__strips_iii_c
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Parallel Plan Semantics"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>are_all_operators_applicable</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
  <span class=main>≡</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> is_operator_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=bound>op</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>are_operator_effects_consistent</span> <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>2</sub></span></span></span> <span class=main>≡</span> <span class=keyword1>let</span>
    <span class=bound>add<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> add_effects_of <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>1</sub></span></span></span>
    <span class=main>;</span> <span class=bound>add<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> add_effects_of <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>2</sub></span></span></span>
    <span class=main>;</span> <span class=bound>del<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> delete_effects_of <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>1</sub></span></span></span>
    <span class=main>;</span> <span class=bound>del<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> delete_effects_of <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>2</sub></span></span></span>
  <span class=keyword1>in</span> <span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>del<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=bound>add<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∧</span> <span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>add<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=bound>del<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>are_all_operator_effects_consistent</span> <span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=main>≡</span>
  list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>execute_parallel_operator</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator list
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>execute_parallel_operator</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
    <span class=main>≡</span> foldl <span class=main>(++)</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span>map <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ The parallel STRIPS execution semantics is defined in similar way as the serial STRIPS
execution semantics. However, the applicability test is lifted to parallel operators and we
additionally test for operator consistency (which was unecessary in the serial case). ›</span></span>

<span class=keyword1><span class=command>fun</span></span>  <span class=entity>execute_parallel_plan</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_parallel_plan
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>execute_parallel_plan</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>s</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>execute_parallel_plan</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>opss</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span>
      are_all_operators_applicable <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
      <span class=main>∧</span> are_all_operator_effects_consistent <span class=free><span class=bound><span class=entity>ops</span></span></span>
    <span class=keyword1>then</span> <span class=free>execute_parallel_plan</span> <span class=main>(</span>execute_parallel_operator <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>opss</span></span></span>
    <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>are_operators_interfering</span> <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>2</sub></span></span></span>
  <span class=main>≡</span> list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>1</sub></span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>precondition_of <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span>
    <span class=main>∨</span>  list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>precondition_of <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>1</sub></span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span>"</span></span>

<span class=comment1>(* TODO rewrite as inductive predicate *)</span>
<span class=keyword1><span class=command>primrec</span></span> <span class=entity>are_all_operators_non_interfering</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_operator list <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>are_all_operators_non_interfering</span> <span class=main>[]</span> <span class=main>=</span> True"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>are_all_operators_non_interfering</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span>list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op'</span><span class=main>.</span> <span class=main>¬</span>are_operators_interfering <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=bound>op'</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
      <span class=main>∧</span> <span class=free>are_all_operators_non_interfering</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Since traces mirror the execution semantics, the same is true for the definition of
parallel STRIPS plan traces. ›</span></span>

<span class=keyword1><span class=command>fun</span></span>  <span class=entity>trace_parallel_plan_strips</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state <span class=main>⇒</span> <span class=tfree>'variable</span> strips_parallel_plan <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>trace_parallel_plan_strips</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>trace_parallel_plan_strips</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>opss</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>if</span>
      are_all_operators_applicable <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
      <span class=main>∧</span> are_all_operator_effects_consistent <span class=free><span class=bound><span class=entity>ops</span></span></span>
    <span class=keyword1>then</span> <span class=free>trace_parallel_plan_strips</span> <span class=main>(</span>execute_parallel_operator <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>opss</span></span></span>
    <span class=keyword1>else</span> <span class=main>[]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Similarly, the definition of parallel solutions requires that the parallel execution
semantics transforms the initial problem into the goal state of the problem and that every
operator of every parallel operator in the parallel plan is an operator that is defined in the
problem description. ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>is_parallel_solution_for_problem</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_parallel_solution_for_problem</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>π</span></span></span>
    <span class=main>≡</span> <span class=main>(</span>strips_problem.goal_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan
        <span class=main>(</span>strips_problem.initial_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>π</span></span></span>
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>ops</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span>
        ListMem <span class=bound>op</span> <span class=main>(</span>strips_problem.operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span><span class=main>)</span> <span class=bound>ops</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>π</span></span></span>"</span></span>


<span class=comment1>(* TODO rename are_all_operators_applicable_in_set *)</span>
<span class=keyword1 id=STRIPS_Semantics-are_all_operators_applicable_set><span class=command>lemma</span></span> are_all_operators_applicable_set<span class=main>:</span>
  <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>
    <span class=main>⟷</span> <span class=main>(</span><span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def
    STRIPS_Representation.is_operator_applicable_in_def list_all_iff
  <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>

<span class=comment1>(* TODO rename are_all_operators_applicable_in_cons *)</span>
<span class=keyword1 id=STRIPS_Semantics-are_all_operators_applicable_cons><span class=command>lemma</span></span> are_all_operators_applicable_cons<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> is_operator_applicable_in <span class=free>s</span> <span class=bound>op</span><span class=main>)</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def is_operator_applicable_in_def
        STRIPS_Representation.is_operator_applicable_in_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>from</span></span> a <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> is_operator_applicable_in <span class=free>s</span> <span class=bound>op</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> are_all_operators_applicable_def is_operator_applicable_in_def
        STRIPS_Representation.is_operator_applicable_in_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-are_operator_effects_consistent_set><span class=command>lemma</span></span> are_operator_effects_consistent_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>
     <span class=main>=</span> <span class=main>(</span>set <span class=main>(</span>add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>
      <span class=main>∧</span> set <span class=main>(</span>delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>(</span>set <span class=main>(</span>add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> list_ex_intersection<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> <span class=quoted><span class=quoted>"add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>(</span>set <span class=main>(</span>delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> list_ex_intersection<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>  <span class=quoted><span class=quoted>"delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>
       <span class=main>=</span> <span class=main>(</span>set <span class=main>(</span>add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>
        <span class=main>∧</span> set <span class=main>(</span>delete_effects_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>add_effects_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-are_all_operator_effects_consistent_set><span class=command>lemma</span></span> are_all_operator_effects_consistent_set<span class=main>:</span>
  <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>
    <span class=main>⟷</span> <span class=main>(</span><span class=main>∀</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span>
      <span class=main>(</span>set <span class=main>(</span>add_effects_of <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>
        <span class=main>∧</span> <span class=main>(</span>set <span class=main>(</span>delete_effects_of <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>add_effects_of <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
        <span class=main>=</span> <span class=main>(</span>set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>
          <span class=main>∧</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> are_operator_effects_consistent_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=quoted><span class=free>ops</span></span> <span class=quoted><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-are_all_effects_consistent_tail><span class=command>lemma</span></span> are_all_effects_consistent_tail<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms
    <span class=keyword1><span class=command>have</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op'</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op'</span><span class=main>)</span>
      <span class=main>(</span>Cons <span class=free>op</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Cons <span class=free>op</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> b_1<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>are_operator_effects_consistent <span class=free>op</span><span class=main>)</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> b_2<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op'</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op'</span><span class=main>)</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>are_operator_effects_consistent <span class=free>op</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> set <span class=main>(</span>Cons <span class=free>op</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>are_operator_effects_consistent <span class=skolem>z</span><span class=main>)</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>are_operator_effects_consistent <span class=skolem>z</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op'</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op'</span><span class=main>)</span> <span class=free>ops</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> list.pred_mono_strong<span class=main>[</span><span class=operator>of</span>
            <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>op'</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op'</span><span class=main>)</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=quoted><span class=quoted>"Cons <span class=free>op</span> <span class=free>ops</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>op'</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op'</span><span class=main>)</span>  <span class=free>ops</span><span class=main>)</span>"</span></span>
          <span class=main>]</span> a
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>are_operator_effects_consistent <span class=free>op</span><span class=main>)</span> <span class=free>ops</span>
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op'</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op'</span><span class=main>)</span> <span class=free>ops</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> are_all_operator_effects_consistent_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-are_all_operators_non_interfering_tail><span class=command>lemma</span></span> are_all_operators_non_interfering_tail<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_non_interfering_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=STRIPS_Semantics-are_operators_interfering_symmetric><span class=command>lemma</span></span> are_operators_interfering_symmetric<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_operators_interfering <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_operators_interfering <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> are_operators_interfering_def list_ex_iff
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>

<span class=comment1>― ‹ A small technical characterizing operator lists with property
\isaname{are_all_operators_non_interfering ops}. We show that pairs of distinct operators which interfere
with one another cannot both be contained in the corresponding operator set. ›</span>
<span class=keyword1 id=STRIPS_Semantics-are_all_operators_non_interfering_set_contains_no_distinct_interfering_operator_pairs><span class=command>lemma</span></span> are_all_operators_non_interfering_set_contains_no_distinct_interfering_operator_pairs<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_operators_interfering <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∉</span> set <span class=free>ops</span> <span class=main>∨</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∉</span> set <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op</span> <span class=skolem>ops</span><span class=main>)</span>
    <span class=keyword1><span class=command>thm</span></span> Cons.IH<span class=main>[</span><span class=operator>OF</span> _ Cons.prems<span class=main><span class=main>(</span></span>2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=skolem>ops</span><span class=main>.</span> <span class=main>¬</span>are_operators_interfering <span class=skolem>op</span> <span class=bound>op'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=skolem>ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_non_interfering.simps<span class=main>(</span>2<span class=main>)</span> list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=main>|</span> <span class=main>(</span>C<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>≠</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∧</span> <span class=skolem>op</span> <span class=main>≠</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> A
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=skolem>op</span> <span class=main>#</span> <span class=skolem>ops</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=skolem>ops</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>3<span class=main>)</span> A
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operators_interfering <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> A
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span>
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span><span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> B
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=skolem>op</span> <span class=main>#</span> <span class=skolem>ops</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=skolem>ops</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>3<span class=main>)</span> B
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operators_interfering <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> B are_operators_interfering_symmetric
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span>
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span><span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> C
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>OF</span> nb<span class=hidden>⇩</span><sub>2</sub> Cons.prems<span class=main><span class=main>(</span></span>2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=comment1>(* TODO The recurring ‹list_all ↝ ∀› transformations could be refactored into a general
lemma.
   TODO refactor (also used in lemma ‹execute_serial_plan_split_i›). *)</span>
<span class=keyword1 id=STRIPS_Semantics-execute_parallel_plan_precondition_cons_i><span class=command>lemma</span></span> execute_parallel_plan_precondition_cons_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>s</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operators_interfering <span class=free>op</span> <span class=free>op'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=free>op'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=comment1>― ‹ TODO slightly hackish to exploit the definition of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>execute_operator›</span></span>, but we
  otherwise have to rewrite theorem <span class=antiquoted><span class=raw_text><span class=operator>‹</span>operator_effect__strips›</span></span> (which is a todo as of now). ›</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>=</span> <span class=free>s</span> <span class=main>⪢</span> <span class=free>op</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> execute_operator_def<span class=main>)</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> <span class=var>?s'</span> <span class=bound>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> <span class=var>?s'</span> <span class=bound>v</span> <span class=main>=</span> Some False"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> <span class=var>?s'</span> <span class=bound>v</span> <span class=main>=</span> <span class=free>s</span> <span class=bound>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> operator_effect__strips
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>note</span></span> a <span class=main>=</span> this
    <span class=comment1>― ‹ TODO refactor lemma <span class=antiquoted><span class=raw_text><span class=operator>‹</span>not_have_interference_set›</span></span>. ›</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> α<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>(=)</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
          <span class=main>=</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v'</span><span class=main>.</span> <span class=main>¬</span><span class=skolem>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> not_list_ex_equals_list_all_not<span class=main>[</span>
              <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(=)</span> <span class=skolem>v</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> xs<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"delete_effects_of <span class=free>op</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> are_operators_interfering_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>¬</span>list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> not_list_ex_equals_list_all_not<span class=main>[</span>
              <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> xs<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"precondition_of <span class=free>op'</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> β<span class=main>:</span>
        <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v'</span><span class=main>.</span> <span class=main>¬</span><span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v'</span><span class=main>.</span> <span class=main>¬</span><span class=skolem>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
          <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v'</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>¬</span><span class=skolem>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> list_all_iff <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v'</span><span class=main>.</span> <span class=main>¬</span><span class=skolem>v</span> <span class=main>=</span> <span class=bound>v'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"delete_effects_of <span class=free>op</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=bound>v'</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>¬</span><span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> β list_all_iff<span class=main>[</span>
          <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v'</span><span class=main>.</span> <span class=main>¬</span><span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
            <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"precondition_of <span class=free>op'</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> α
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>note</span></span> b <span class=main>=</span> this
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span> <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_operator_applicable_in_def
          STRIPS_Representation.is_operator_applicable_in_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>using</span></span> list_all_iff<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>=</span> Some True"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"precondition_of <span class=free>op'</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>using</span></span> a
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>note</span></span> c <span class=main>=</span> this
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> d<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> a
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> e<span class=main>:</span> False
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> b d
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>s</span> <span class=skolem>v</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> a e
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>using</span></span> c d
              <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?s'</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span> <span class=main>(</span>precondition_of <span class=free>op'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> list_all_iff<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?s'</span> <span class=bound>v</span> <span class=main>=</span> Some True"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"precondition_of <span class=free>op'</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> is_operator_applicable_in_def
        STRIPS_Representation.is_operator_applicable_in_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ The third assumption <span class=antiquoted><span class=raw_text><span class=operator>‹</span>are_all_operators_non_interfering (a # ops)›</span></span>" is not part of the
precondition of \isaname{execute_parallel_operator} but is required for the proof of the
subgoal hat applicable is maintained. ›</span>
<span class=keyword1 id=STRIPS_Semantics-execute_parallel_plan_precondition_cons><span class=command>lemma</span></span> execute_parallel_plan_precondition_cons<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_operator"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> are_all_effects_consistent_tail<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
    are_all_operators_non_interfering_tail<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span><span class=main>.</span> is_operator_applicable_in <span class=free>s</span> <span class=bound>op</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> are_all_operators_applicable_set
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def is_operator_applicable_in_def
        STRIPS_Representation.is_operator_applicable_in_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>¬</span>are_operators_interfering <span class=free>a</span> <span class=bound>op</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_non_interfering_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>3</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>a</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> are_all_operators_applicable_set
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def is_operator_applicable_in_def
        STRIPS_Representation.is_operator_applicable_in_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
      <span class=keyword3><span class=command>assume</span></span> op_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=var>?s'</span> <span class=skolem>op</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_parallel_plan_precondition_cons_i<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=skolem>op</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>1</sub> nb<span class=hidden>⇩</span><sub>2</sub> nb<span class=hidden>⇩</span><sub>3</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=var>?s'</span> <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
        is_operator_applicable_in_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_parallel_operator_cons><span class=command>lemma</span></span> execute_parallel_operator_cons<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>
    <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=STRIPS_Semantics-execute_parallel_operator_cons_equals><span class=command>lemma</span></span> execute_parallel_operator_cons_equals<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>
    <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=main>(</span>Cons <span class=free>a</span> <span class=free>ops</span><span class=main>)</span>
        <span class=main>=</span> foldl <span class=main>(++)</span> <span class=free>s</span> <span class=main>(</span>map <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=main>(</span>Cons <span class=free>a</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def
         <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
       <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> foldl <span class=main>(++)</span> <span class=main>(</span><span class=var>?s'</span><span class=main>)</span>
         <span class=main>(</span>map <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
       <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=main>(</span>Cons <span class=free>a</span> <span class=free>ops</span><span class=main>)</span>
         <span class=main>=</span> foldl <span class=main>(++)</span> <span class=main>(</span><span class=var>?s'</span><span class=main>)</span>
          <span class=main>(</span>map <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_def
         <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
     <span class=keyword1><span class=command>}</span></span>
    <span class=comment1>― ‹ NOTE the precondition of \isaname{execute_parallel} for <span class=antiquoted><span class=raw_text><span class=operator>‹</span>a # ops›</span></span> is also true for the tail
    list and <span class=antiquoted><span class=raw_text><span class=operator>‹</span>state ?s'›</span></span> as shown in lemma
    \isaname{execute_parallel_operator_precondition_cons}. Hence the precondition for the r.h.s.
    of the goal also holds. ›</span>
     <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=var>?s'</span> <span class=free>ops</span>
        <span class=main>=</span> foldl <span class=main>(++)</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free>a</span><span class=main>)</span>
          <span class=main>(</span>map <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> execute_parallel_operator_def<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ We show here that following the lemma above, executing one operator of a parallel
operator can be replaced by a (single) STRIPS operator execution. ›</span>
<span class=keyword1><span class=command>corollary</span></span> execute_parallel_operator_cons_equals_corollary<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>
    <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=free>s</span> <span class=main>⪢</span> <span class=free>a</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> assms
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>
      <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_cons_equals
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>=</span> <span class=free>s</span> <span class=main>⪢</span> <span class=free>a</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> execute_operator_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO duplicate? *)</span>
<span class=keyword1 id=STRIPS_Semantics-effect_to_assignments_simp><span class=command>lemma</span></span> effect_to_assignments_simp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span>
  <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>@</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> effect_to_assignments_i<span class=main>)</span>

<span class=keyword1 id=STRIPS_Semantics-effect_to_assignments_set_is><span class=command>lemma</span></span> effect_to_assignments_set_is<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> True<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span> <span class=bound>a</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>}</span>
    <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> False<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span> <span class=bound>a</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>as</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"effect__strips <span class=free>op</span> <span class=main>=</span> <span class=skolem>as</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>as</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
        <span class=main>@</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> effect__strips_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>as</span>
      <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>@</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> map_append map_map comp_apply
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> <span class=skolem>as</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> effect_to_assignments_def calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> effect_to_assignments_construction_from_function_graph<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> map
    <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=keyword1>if</span> ListMem <span class=bound>v</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> True <span class=keyword1>else</span> False<span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> map
    <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=keyword1>if</span> ListMem <span class=bound>v</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> False <span class=keyword1>else</span> True<span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=keyword1>if</span> ListMem <span class=bound>v</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> True <span class=keyword1>else</span> False<span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?g</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=keyword1>if</span> ListMem <span class=bound>v</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> False <span class=keyword1>else</span> True<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map <span class=var>?f</span> <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>
        <span class=main>=</span> map <span class=var>?f</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>@</span> map <span class=var>?f</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> map_append
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=comment1>― ‹ TODO slow. ›</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> map <span class=var>?f</span> <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ListMem_iff assms
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map <span class=var>?g</span> <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>
        <span class=main>=</span> map <span class=var>?g</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>@</span> map <span class=var>?g</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> map_append
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=comment1>― ‹ TODO slow. ›</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> map <span class=var>?g</span> <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ListMem_iff assms
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> map
      <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=keyword1>if</span> ListMem <span class=bound>v</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> True <span class=keyword1>else</span> False<span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> map
      <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=keyword1>if</span> ListMem <span class=bound>v</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> False <span class=keyword1>else</span> True<span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> map_of_effect_to_assignments_is_none_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=var>?l</span>
        <span class=main>=</span> <span class=main>(</span>fst <span class=main>`</span> <span class=main>{</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>}</span><span class=main>)</span>
          <span class=main>∪</span> <span class=main>(</span>fst <span class=main>`</span> <span class=main>{</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> image_Un<span class=main>[</span><span class=operator>of</span> <span class=quoted>fst</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>}</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>}</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=comment1>― ‹ TODO slow.›</span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span>fst <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span>
        <span class=main>∪</span> <span class=main>(</span>fst <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span><span class=main>]</span>
          setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=comment1>― ‹ TODO slow.›</span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> id <span class=main>`</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∪</span> id <span class=main>`</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=comment1>― ‹ TODO slow.›</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=var>?l</span> <span class=main>=</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∪</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> fst <span class=main>`</span> set <span class=var>?l</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> map_of_eq_None_iff<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=quoted><span class=free>v</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_parallel_operator_positive_effect_if_i><span class=command>lemma</span></span> execute_parallel_operator_positive_effect_if_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>if</span> ListMem <span class=bound>x</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> True <span class=keyword1>else</span> False"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?l'</span></span></span><span class=main>=</span> <span class=quoted><span class=quoted>" map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=keyword1>if</span> ListMem <span class=bound>v</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> True <span class=keyword1>else</span> False<span class=main>)</span><span class=main>)</span>
        <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> are_all_operator_effects_consistent_set assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> <span class=var>?l'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> effect_to_assignments_construction_from_function_graph<span class=main>(</span>1<span class=main>)</span> calculation
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span> <span class=main>=</span> map_of <span class=var>?l'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some <span class=main>(</span><span class=var>?f</span> <span class=free>v</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Map_Supplement.map_of_from_function_graph_is_some_if<span class=main>[</span>
          <span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=var>?f</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> _ assms<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> ListMem_iff assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_parallel_operator_positive_effect_if><span class=command>lemma</span></span> execute_parallel_operator_positive_effect_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>ops</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free>ops</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> set_l_is<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=main>`</span> set <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free>op</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?m</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> set_l_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?m</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_positive_effect_if_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>m</span> <span class=main>∈</span> set <span class=var>?l</span><span class=main>.</span> <span class=bound>m</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span>
        <span class=keyword2><span class=keyword>where</span></span> op'_in_set_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> m'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>=</span> <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=skolem>op'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op'</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span> are_all_operator_effects_consistent_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ops</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>v_in_set_add_effects<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
        <span class=main>|</span> <span class=main>(</span>otherwise<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op'</span><span class=main>)</span> <span class=main>∧</span> <span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=free>v</span> <span class=main>=</span> Some True <span class=main>∨</span> <span class=skolem>m'</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> v_in_set_add_effects
          <span class=comment1>― ‹ TODO slow. ›</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_positive_effect_if_i<span class=main>[</span>
                <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> op'_in_set_ops<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>v</span></span><span class=main>]</span> m'_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> otherwise
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> map_of_effect_to_assignments_is_none_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=skolem>op'</span></span><span class=main>]</span> m'_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def
      <span class=keyword1><span class=command>using</span></span> foldl_map_append_is_some_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted>True</span> <span class=var><span class=quoted><span class=var>?l</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_parallel_operator_negative_effect_if_i><span class=command>lemma</span></span> execute_parallel_operator_negative_effect_if_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>if</span> ListMem <span class=bound>x</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> False <span class=keyword1>else</span> True"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?l'</span></span></span><span class=main>=</span> <span class=quoted><span class=quoted>" map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=keyword1>if</span> ListMem <span class=bound>v</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>then</span> False <span class=keyword1>else</span> True<span class=main>)</span><span class=main>)</span>
        <span class=main>(</span>add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>delete_effects_of <span class=free>op</span> <span class=main>@</span> add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span> <span class=main>@</span> add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> are_all_operator_effects_consistent_set assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"effect_to_assignments <span class=free>op</span> <span class=main>=</span> <span class=var>?l'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> effect_to_assignments_construction_from_function_graph<span class=main>(</span>2<span class=main>)</span> calculation
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span> <span class=main>=</span> map_of <span class=var>?l'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some <span class=main>(</span><span class=var>?f</span> <span class=free>v</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Map_Supplement.map_of_from_function_graph_is_some_if<span class=main>[</span>
          <span class=operator>of</span> <span class=quoted><span class=quoted>"add_effects_of <span class=free>op</span> <span class=main>@</span> delete_effects_of <span class=free>op</span>"</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_parallel_operator_negative_effect_if><span class=command>lemma</span></span> execute_parallel_operator_negative_effect_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free>ops</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> set_l_is<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=main>`</span> set <span class=free>ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=free>op</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?m</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> set_l_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?m</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_negative_effect_if_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>m</span> <span class=main>∈</span> set <span class=var>?l</span><span class=main>.</span> <span class=bound>m</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span>
        <span class=keyword2><span class=keyword>where</span></span> op'_in_set_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> m'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=main>=</span> <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> <span class=skolem>op'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>add_effects_of <span class=skolem>op'</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span> are_all_operator_effects_consistent_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ops</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>v_in_set_delete_effects<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
        <span class=main>|</span> <span class=main>(</span>otherwise<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op'</span><span class=main>)</span> <span class=main>∧</span> <span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m'</span> <span class=free>v</span> <span class=main>=</span> Some False <span class=main>∨</span> <span class=skolem>m'</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> v_in_set_delete_effects
          <span class=comment1>― ‹ TODO slow. ›</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_negative_effect_if_i<span class=main>[</span>
                <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> op'_in_set_ops<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>v</span></span><span class=main>]</span> m'_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> otherwise
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> map_of_effect_to_assignments_is_none_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=skolem>op'</span></span><span class=main>]</span> m'_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def
      <span class=keyword1><span class=command>using</span></span> foldl_map_append_is_some_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted>False</span> <span class=var><span class=quoted><span class=var>?l</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_parallel_operator_no_effect_if><span class=command>lemma</span></span> execute_parallel_operator_no_effect_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> <span class=free>s</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>ops</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map_of <span class=main>∘</span> effect_to_assignments"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=skolem>a</span><span class=main>)</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=skolem>a</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=skolem>a</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
        <span class=keyword1><span class=command>using</span></span> map_of_effect_to_assignments_is_none_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=skolem>a</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> dom <span class=main>(</span><span class=var>?f</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span> <span class=main>++</span> <span class=var>?f</span> <span class=skolem>a</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> <span class=skolem>s</span> <span class=free>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> map_add_dom_app_simps<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=skolem>a</span>"</span></span> <span class=quoted><span class=skolem>s</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span><span class=main>∈</span>set <span class=skolem>ops</span><span class=main>.</span> <span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"foldl <span class=main>(++)</span> <span class=main>(</span><span class=skolem>s</span> <span class=main>++</span> <span class=var>?f</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>(</span>map <span class=var>?f</span> <span class=skolem>ops</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>s</span> <span class=main>++</span> <span class=var>?f</span> <span class=skolem>a</span><span class=main>)</span> <span class=free>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>++</span> <span class=var>?f</span> <span class=skolem>a</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map <span class=var>?f</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ops</span><span class=main>)</span> <span class=main>=</span> <span class=var>?f</span> <span class=skolem>a</span> <span class=main>#</span> map <span class=var>?f</span> <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldl <span class=main>(++)</span> <span class=skolem>s</span> <span class=main>(</span>map <span class=var>?f</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ops</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> foldl <span class=main>(++)</span> <span class=main>(</span><span class=skolem>s</span> <span class=main>++</span> <span class=var>?f</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>(</span>map <span class=var>?f</span> <span class=skolem>ops</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> foldl_Cons
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>corollary</span></span> execute_parallel_operators_strips_none_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_no_effect_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>corollary</span></span> execute_parallel_operators_strips_none_if_contraposition<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span>
    <span class=main>∨</span> <span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=main>¬</span><span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span>
      <span class=main>∧</span> <span class=free>s</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Q</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=main>⟹</span> <span class=var>?Q</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> execute_parallel_operators_strips_none_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ops</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?P</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> contrapos_nn<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?Q</span></span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We will now move on to showing the equivalent to theorem \isaname{operator_effect__strips}
in \isaname{execute_parallel_operator_effect}.
Under the condition that for a list of operators <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ops</span></span>›</span></span></span></span> all
operators in the corresponding set are applicable in a given state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>s</span></span>›</span></span></span></span> and all operator effects
are consistent, if an operator <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span>›</span></span></span></span> exists with <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span> <span class=main><span class=main>∈</span></span> set <span class=free><span class=free>ops</span></span>›</span></span></span></span> and with <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span>›</span></span></span></span> being
an add effect of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span>›</span></span></span></span>, then the successor state

  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"s' ≡ execute_parallel_operator s ops"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

will evaluate <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span>›</span></span></span></span> to true, that is

  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"execute_parallel_operator s ops v = Some True"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

Symmetrically, if <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span>›</span></span></span></span> is a delete effect, we have

  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"execute_parallel_operator s ops v = Some False"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

under the same condition as for the positive effect.
Lastly, if <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span>›</span></span></span></span> is neither an add effect nor a delete effect for any operator in the
operator set corresponding to $ops$, then the state after parallel operator execution remains
unchanged, i.e.

  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"execute_parallel_operator s ops v = s v"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
›</span></span>

<span class=keyword1><span class=command>theorem</span></span>  execute_parallel_operator_effect<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
<span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
  <span class=main>⟶</span> execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟶</span> execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span>
    <span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟶</span> execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=free>v</span> <span class=main>=</span> <span class=free>s</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_positive_effect_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    execute_parallel_operator_negative_effect_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    execute_parallel_operator_no_effect_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ops</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>


<span class=keyword1 id=STRIPS_Semantics-is_parallel_solution_for_problem_operator_set><span class=command>lemma</span></span> is_parallel_solution_for_problem_operator_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def list_all_iff ListMem_iff<span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-trace_parallel_plan_strips_not_nil><span class=command>lemma</span></span> trace_parallel_plan_strips_not_nil<span class=main>:</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>π</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>list</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>I</span> <span class=main>(</span>hd <span class=free>π</span><span class=main>)</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=main>(</span>hd <span class=free>π</span><span class=main>)</span>"</span></span>
        <span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>corollary</span></span> length_trace_parallel_plan_gt_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_not_nil<span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>corollary</span></span> length_trace_minus_one_lt_length_trace<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> diff_less<span class=main>[</span><span class=operator>OF</span> _ length_trace_parallel_plan_gt_0<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=STRIPS_Semantics-trace_parallel_plan_strips_head_is_initial_state><span class=command>lemma</span></span> trace_parallel_plan_strips_head_is_initial_state<span class=main>:</span>
  <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>  <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>π</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>list</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=STRIPS_Semantics-trace_parallel_plan_strips_length_gt_one_if><span class=command>lemma</span></span> trace_parallel_plan_strips_length_gt_one_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>

<span class=comment1>― ‹ This lemma simply shows that the last element of a <span class=antiquoted><span class=raw_text><span class=operator>‹</span>trace_parallel_plan_strips execution›</span></span>
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>step s # trace_parallel_plan_strips s' π›</span></span> always is the last element of
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>trace_parallel_plan_strips s' π›</span></span> since <span class=antiquoted><span class=raw_text><span class=operator>‹</span>trace_parallel_plan_strips›</span></span> always returns at least a
singleton list (even if <span class=antiquoted><span class=raw_text><span class=operator>‹</span>π = []›</span></span>). ›</span>
<span class=keyword1 id=STRIPS_Semantics-trace_parallel_plan_strips_last_cons_then><span class=command>lemma</span></span> trace_parallel_plan_strips_last_cons_then<span class=main>:</span>
  <span class=quoted><span class=quoted>"last <span class=main>(</span><span class=free>s</span> <span class=main>#</span> trace_parallel_plan_strips <span class=free>s'</span> <span class=free>π</span><span class=main>)</span> <span class=main>=</span> last <span class=main>(</span>trace_parallel_plan_strips <span class=free>s'</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>π</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Parallel plan traces have some important properties that we want to confirm before
proceeding. Let <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span> <span class=main><span class=main>≡</span></span> trace_parallel_plan_strips <span class=free><span class=free>I</span></span> <span class=free><span class=free>π</span></span>›</span></span></span></span> be a trace for a parallel plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span>
with initial state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>I</span></span>›</span></span></span></span>.

First, all parallel operators <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ops</span></span> <span class=main><span class=main>=</span></span> <span class=free><span class=free>π</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span> for any index <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> with <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=free><span class=free>τ</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span>
(meaning that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> is not the index of the last element).
must be applicable and their effects must be consistent. Otherwise, the trace would have terminated
and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ops</span></span>›</span></span></span></span> would have been the last element. This would violate the assumption that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=free><span class=free>τ</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span>
is not the last index since the index of the last element is <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹length <span class=free><span class=free>τ</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span>.
\footnote{More precisely, the index of the last element is <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹length <span class=free><span class=free>τ</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span> if <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span>›</span></span></span></span> is not
empty which is however always true since the trace contains at least the initial state.} ›</span></span>

<span class=comment1>(* TODO? hide? *)</span>
<span class=keyword1 id=STRIPS_Semantics-trace_parallel_plan_strips_operator_preconditions><span class=command>lemma</span></span>  trace_parallel_plan_strips_operator_preconditions<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>
      <span class=main>∧</span> are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span>  <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"<span class=free>π</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span> <span class=quoted><span class=free>k</span></span><span class=main>)</span>
    <span class=comment1>― ‹ NOTE Base case yields contradiction with assumption and can be left to automation. ›</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>π</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>have</span></span> trace_parallel_plan_strips_cons<span class=main>:</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>
          <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_strips <span class=main>(</span>execute_parallel_operator <span class=skolem>I</span> <span class=skolem>a</span><span class=main>)</span> <span class=skolem>π</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> True
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> 0
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_cons
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> True 0
            <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k'</span><span class=main>)</span>
          <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=skolem>a</span>"</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> Suc <span class=skolem>k'</span> <span class=main>=</span> trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_cons
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> Suc <span class=skolem>k'</span> <span class=main>=</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
              <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> trace_parallel_plan_strips_cons
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Suc Cons.prems
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span><span class=main>)</span> <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span><span class=main>)</span>
            <span class=main>∧</span> are_all_operator_effects_consistent <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k'</span></span><span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> Suc
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>I</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=comment1>― ‹ NOTE Thesis follows from contradiction with assumption. ›</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> Cons.prems
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Another interesting property that we verify below is that elements of the trace
store the result of plan prefix execution. This means that for an index <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> with\newline
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=main><span class=main>(</span></span>trace_parallel_plan_strips <span class=free><span class=free>I</span></span> <span class=free><span class=free>π</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span>, the <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span>-th element of the trace is state
reached by executing the plan prefix <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹take <span class=free><span class=free>k</span></span> <span class=free><span class=free>π</span></span>›</span></span></span></span> consisting of the first <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> parallel
operators of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span>. ›</span></span>

<span class=keyword1 id=STRIPS_Semantics-trace_parallel_plan_plan_prefix><span class=command>lemma</span></span>  trace_parallel_plan_plan_prefix<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> <span class=free>k</span> <span class=main>=</span> execute_parallel_plan <span class=free>I</span> <span class=main>(</span>take <span class=free>k</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span>  <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span> <span class=quoted><span class=free>k</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>π</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?σ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=skolem>a</span>"</span></span>
        <span class=keyword1><span class=command>have</span></span> σ_equals<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?σ</span> <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> True
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> k_is_suc_of_k'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> Suc <span class=skolem>k'</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> not0_implies_Suc<span class=main>[</span><span class=operator>OF</span> False<span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span>take <span class=skolem>k</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
              <span class=main>=</span> execute_parallel_plan <span class=var>?I'</span> <span class=main>(</span>take <span class=skolem>k'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> True
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> <span class=skolem>k</span>
              <span class=main>=</span> trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> σ_equals k_is_suc_of_k'
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span>execute_parallel_operator <span class=skolem>I</span> <span class=skolem>a</span><span class=main>)</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> Cons.prems σ_equals k_is_suc_of_k'
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span>
                <span class=main>=</span> execute_parallel_plan <span class=var>?I'</span> <span class=main>(</span>take <span class=skolem>k'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k'</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span><span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
          <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> operator_precondition_violated<span class=main>:</span> False
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>I</span><span class=main>]</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> operator_precondition_violated
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span>take <span class=skolem>k</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.prems operator_precondition_violated
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.prems nth_Cons_0
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>


<span class=keyword1 id=STRIPS_Semantics-length_trace_parallel_plan_strips_lte_length_plan_plus_one><span class=command>lemma</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>≤</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>π</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=skolem>a</span>"</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> True
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
            <span class=main>=</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>≤</span> length <span class=skolem>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?I'</span></span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> length <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=comment1>― ‹ Show that <span class=antiquoted><span class=raw_text><span class=operator>‹</span>π›</span></span> is at least a singleton list. ›</span>
<span class=keyword1 id=STRIPS_Semantics-plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements><span class=command>lemma</span></span> plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>ops</span> <span class=free>π'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>π</span> <span class=main>=</span> <span class=free>ops</span> <span class=main>#</span> <span class=free>π'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=free>π</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_length_gt_one_if assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"length <span class=free>π</span> <span class=main>=</span> Suc <span class=skolem>k'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> gr0_implies_Suc
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> that
      <span class=keyword1><span class=command>using</span></span> length_Suc_conv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>π</span></span> <span class=quoted><span class=skolem>k'</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that if a parallel plan trace does not have maximum length, in the last state
reached through operator execution the parallel operator execution condition was violated. ›</span>
<span class=keyword1><span class=command>corollary</span></span> length_trace_parallel_plan_strips_lt_length_plan_plus_one_then<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>&lt;</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_all_operators_applicable
      <span class=main>(</span>execute_parallel_plan <span class=free>I</span> <span class=main>(</span>take <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>π</span><span class=main>)</span><span class=main>)</span>
      <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>
    <span class=main>∨</span> <span class=main>¬</span>are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>ops</span> <span class=skolem>π</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=skolem>ops</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>ops</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> τ_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>&lt;</span> length <span class=skolem>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> are_all_operators_applicable
              <span class=main>(</span>execute_parallel_plan <span class=var>?I'</span>
                <span class=main>(</span>take <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
              <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>
            <span class=main>∨</span> <span class=main>¬</span> are_all_operator_effects_consistent
              <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?I'</span></span></span><span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_not_nil
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>unfolding</span></span> take_Cons'
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>≥</span> length <span class=skolem>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>thm</span></span> Cons.prems
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
              <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> True
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>
              <span class=main>&lt;</span> length <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems calculation<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> τ_is_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>I</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> False
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> <span class=main>(</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span>take <span class=main>(</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> τ_is_singleton
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=comment1>― ‹ TODO slow. ›</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> False
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=STRIPS_Semantics-trace_parallel_plan_step_effect_is><span class=command>lemma</span></span> trace_parallel_plan_step_effect_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> Suc <span class=free>k</span>
    <span class=main>=</span> execute_parallel_operator <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=comment1>― ‹ NOTE Rewrite the proposition using lemma <span class=antiquoted><span class=raw_text><span class=operator>‹</span>trace_parallel_plan_strips_subplan›</span></span>. ›</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms
        <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> Suc <span class=free>k</span>
        <span class=main>=</span> execute_parallel_plan <span class=free>I</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_plan_prefix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Suc <span class=free>k</span>"</span></span> <span class=quoted><span class=free>I</span></span> <span class=quoted><span class=free>π</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=free>I</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>=</span> execute_parallel_operator <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>k</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span> <span class=quoted><span class=free>π</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> 0
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span> <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>
            <span class=main>=</span> execute_parallel_operator <span class=skolem>I</span> <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_head_is_initial_state<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=skolem>π</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops</span></span> <span class=skolem><span class=skolem>π'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>=</span> <span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π'</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements<span class=main>[</span><span class=operator>OF</span> <span class=quoted>"0.prems"</span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"take <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=skolem>π</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>]</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=skolem>π</span><span class=main>)</span>
            <span class=main>=</span> execute_parallel_plan <span class=skolem>I</span> <span class=main>[</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>]</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_length_gt_one_if <span class=quoted>"0.prems"</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>
            <span class=main>∧</span> are_all_operator_effects_consistent <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=skolem>π</span></span><span class=main>]</span>
              trace_parallel_plan_strips_head_is_initial_state<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=skolem>π</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops</span></span> <span class=skolem><span class=skolem>π'</span></span> <span class=keyword2><span class=keyword>where</span></span> π_split<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>=</span> <span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements<span class=main>[</span><span class=operator>OF</span> Suc.prems<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span>
            <span class=main>1</span> <span class=main>+</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Suc.prems π_split
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Suc.prems
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=skolem>π</span> <span class=main>!</span> Suc <span class=skolem>k</span>
            <span class=main>=</span> trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π'</span> <span class=main>!</span> <span class=skolem>k</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Suc.prems π_split
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=skolem>π</span> <span class=main>!</span> Suc <span class=skolem>k</span>
            <span class=main>=</span> execute_parallel_plan <span class=var>?I'</span> <span class=main>(</span>take <span class=skolem>k</span> <span class=skolem>π'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_plan_prefix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=quoted><span class=skolem>π'</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span><span class=main>)</span> <span class=skolem>π</span><span class=main>)</span>
          <span class=main>=</span> execute_parallel_plan <span class=var>?I'</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>π'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.prems π_split
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Suc.prems
            <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>
            <span class=main>∧</span> are_all_operator_effects_consistent <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=skolem>π</span></span><span class=main>]</span>
              trace_parallel_plan_strips_head_is_initial_state<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=skolem>π</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.IH Suc.prems π_split
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that every state in a plan execution trace of a valid problem description is defined
for all problem variables. This is true because the initial state is defined for all problem
variables—by definition of <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"is_valid_problem_strips Π"</span><span class=antiquote>}</span></span>—and no operator can remove a
previously defined variable (only positive and negative effects are possible). ›</span>
<span class=comment1>(* TODO refactor ‹STRIPS_Semantics› + abstract/concretize first two assumptions (e.g. second one
only needs all operators are problem operators)? *)</span>
<span class=keyword1 id=STRIPS_Semantics-trace_parallel_plan_strips_none_if><span class=command>lemma</span></span> trace_parallel_plan_strips_none_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> None <span class=main>⟷</span> <span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>k</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> 0
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=var>?I</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_head_is_initial_state
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> k_lt_length_τ_minus_one<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>3<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>trace_parallel_plan_strips <span class=var>?I</span> <span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> None <span class=main>⟷</span> <span class=free>v</span> <span class=main>∉</span>set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.IH<span class=main>[</span><span class=operator>OF</span> Suc.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>have</span></span> τ_Suc_k_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_step_effect_is<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
        <span class=keyword1><span class=command>have</span></span> all_operators_applicable<span class=main>:</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> all_effects_consistent<span class=main>:</span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
            <span class=keyword3><span class=command>assume</span></span> τ_Suc_k_of_v_is_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
            <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
                <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set<span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
                  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span>
                    <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span><span class=main>)</span>
                    <span class=keyword3><span class=command>case</span></span> True
                    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
                      <span class=keyword2><span class=keyword>where</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
                        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span><span class=keyword1><span class=command>..</span></span>
                    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
                      <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
                      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
                      <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_positive_effect_if<span class=main>[</span><span class=operator>OF</span>
                              all_operators_applicable all_effects_consistent op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                            execute_parallel_operator_negative_effect_if<span class=main>[</span><span class=operator>OF</span>
                              all_operators_applicable all_effects_consistent op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                            τ_Suc_k_of_v_is_None τ_Suc_k_is
                      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
                  <span class=keyword1><span class=command>next</span></span>
                    <span class=keyword3><span class=command>case</span></span> False
                    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span>
                      <span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
                      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=free>v</span>"</span></span>
                      <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_no_effect_if τ_Suc_k_is
                      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
                      <span class=keyword1><span class=command>using</span></span> IH  τ_Suc_k_of_v_is_None
                      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
                    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
                      <span class=keyword1><span class=command>using</span></span> v_in_set_vs
                      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                  <span class=keyword1><span class=command>qed</span></span>
              <span class=keyword1><span class=command>qed</span></span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>assume</span></span> v_notin_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
              <span class=keyword3><span class=command>assume</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> length <span class=var>?τ</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_length_gt_one_if<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> k_lt_length_τ_minus_one
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> length <span class=free>π</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one le_diff_conv
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=free>π</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> k_lt_length_τ_minus_one
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> op_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> _ op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
                  <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_operator_variable_sets<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> op_in_ops
                    v_notin_vs
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
                  <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_operator_variable_sets<span class=main>(</span>3<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> op_in_ops
                    v_notin_vs
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=free>v</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_no_effect_if τ_Suc_k_is
              <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> None"</span></span>
              <span class=keyword1><span class=command>using</span></span> IH v_notin_vs
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Finally, given initial and goal states <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>I</span></span>›</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G</span></span>›</span></span></span></span>, we can show that it's
equivalent to say that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> is a solution for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>I</span></span>›</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G</span></span>›</span></span></span></span>---i.e.
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G</span></span> <span class=keyword1><span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span></span> execute_parallel_plan <span class=free><span class=free>I</span></span> <span class=free><span class=free>π</span></span>›</span></span></span></span>---and
that the goal state is subsumed by the last element of the trace of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> with initial state
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>I</span></span>›</span></span></span></span>. ›</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_parallel_plan_reaches_goal_iff_goal_is_last_element_of_trace><span class=command>lemma</span></span>  execute_parallel_plan_reaches_goal_iff_goal_is_last_element_of_trace<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=free>I</span> <span class=free>π</span>
    <span class=main>⟷</span> <span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>  <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?LHS</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=free>I</span> <span class=free>π</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?RHS</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?LHS</span></span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?RHS</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
            <span class=comment1>― ‹ NOTE Nil case follows from simplification. ›</span>
            <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>π</span><span class=main>)</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main>)</span>
                <span class=keyword3><span class=command>case</span></span> True
                <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=skolem>a</span>"</span></span>
                <span class=keyword1><span class=command>{</span></span>
                  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span> execute_parallel_plan <span class=var>?I'</span> <span class=skolem>π</span>"</span></span>
                    <span class=keyword1><span class=command>using</span></span> True
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?I'</span> <span class=skolem>π</span>"</span></span>
                    <span class=keyword1><span class=command>using</span></span> Cons.prems
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
                  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
                    <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?I'</span></span></span><span class=main>]</span>
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword1><span class=command>}</span></span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
                  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>
                    <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span>"</span></span>
                    <span class=keyword1><span class=command>using</span></span> True
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
                  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"last <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>=</span> last <span class=main>(</span><span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
                  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"last <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>=</span> last <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
                    <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_last_cons_then<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=quoted><span class=skolem>π</span></span><span class=main>]</span>
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
                <span class=keyword1><span class=command>}</span></span>
                <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
              <span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?RHS</span></span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?LHS</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
            <span class=comment1>― ‹ NOTE Nil case follows from simplification. ›</span>
            <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>π</span><span class=main>)</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main>)</span>
                <span class=keyword3><span class=command>case</span></span> True
                <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=skolem>a</span>"</span></span>
                <span class=keyword1><span class=command>{</span></span>
                  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
                    <span class=keyword1><span class=command>using</span></span> True
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
                  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"last <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>=</span> last <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
                    <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_last_cons_then<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=quoted><span class=skolem>π</span></span><span class=main>]</span>
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
                  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
                    <span class=keyword1><span class=command>using</span></span> Cons.prems
                    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
                <span class=keyword1><span class=command>}</span></span>
                <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                  <span class=keyword1><span class=command>using</span></span> True Cons
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>next</span></span>
                <span class=keyword3><span class=command>case</span></span> False
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"last <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
                  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>
                <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                  <span class=keyword1><span class=command>using</span></span> Cons.prems
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
              <span class=keyword1><span class=command>qed</span></span>
          <span class=keyword1><span class=command>qed</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Serializable Parallel Plans"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ With the groundwork on parallel and serial execution of STRIPS in place we can now address
the question under which conditions a parallel solution to a problem corresponds to a serial
solution and vice versa.
As we will see (in theorem \ref{isathm:embedding-serial-strips-plan}), while a serial plan can
be trivially rewritten as a parallel plan consisting of singleton operator list for each operator
in the plan, the condition for parallel plan solutions also involves non interference. ›</span></span>


<span class=comment1>― ‹ Given that non interference implies that operator execution order can be switched
arbitrarily, it stands to reason that parallel operator execution can be serialized if non
interference is mandated in addition to the regular parallel execution condition (applicability and
effect consistency). This is in fact true as we show in the lemma below
\footnote{In the source literatur it is required that $\mathrm{app}_S(s)$ is defined which requires that
$\mathrm{app}_o(s)$ is defined for every $o \in S$. This again means that the preconditions
hold in $s$ and the set of effects is consistent which translates to the execution condition
in <span class=antiquoted><span class=raw_text><span class=operator>‹</span>execute_parallel_operator›</span></span>.
\cite[Lemma 2.11., p.1037]{DBLP:journals/ai/RintanenHN06}

Also, the proposition \cite[Lemma 2.11., p.1037]{DBLP:journals/ai/RintanenHN06} is in fact
proposed to be true for any total ordering of the operator set but we only proof it for the
implicit total ordering induced by the specific order in the operator list of the problem
statement.} ›</span>
<span class=comment1>(* TODO rename execute_parallel_operator_equals_execute_serial_if *)</span>
<span class=keyword1 id=STRIPS_Semantics-execute_parallel_operator_equals_execute_sequential_strips_if><span class=command>lemma</span></span> execute_parallel_operator_equals_execute_sequential_strips_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>s</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=free>ops</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=free>s</span> <span class=free>ops</span> <span class=main>=</span> execute_serial_plan <span class=free>s</span> <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> Nil
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>s</span> Nil
      <span class=main>=</span> foldl <span class=main>(++)</span> <span class=skolem>s</span> <span class=main>(</span>map <span class=main>(</span>map_of <span class=main>∘</span> effect_to_assignments<span class=main>)</span> Nil<span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Nil.prems<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=skolem>s</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>s</span> Nil <span class=main>=</span> <span class=skolem>s</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=skolem>s</span> Nil <span class=main>=</span> <span class=skolem>s</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>ops</span><span class=main>)</span>
    <span class=comment1>― ‹ NOTE Use the preceding lemmas to show that the premises hold for the sublist and use the IH
  to obtain the theorem for the sublist ops. ›</span>
    <span class=keyword1><span class=command>have</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=skolem>s</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> are_all_operators_applicable_cons Cons.prems<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>from</span></span> Cons.prems
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=var>?s'</span> <span class=skolem>ops</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=skolem>ops</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_parallel_plan_precondition_cons
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=var>?s'</span> <span class=skolem>ops</span>
        <span class=main>=</span> execute_parallel_operator <span class=var>?s'</span> <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.IH
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> Cons.prems
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>s</span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>ops</span><span class=main>)</span>
      <span class=main>=</span> execute_parallel_operator <span class=var>?s'</span> <span class=skolem>ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_cons_equals_corollary
      <span class=keyword1><span class=command>unfolding</span></span> execute_operator_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>from</span></span> a <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=skolem>s</span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>ops</span><span class=main>)</span>
      <span class=main>=</span> execute_serial_plan <span class=var>?s'</span> <span class=skolem>ops</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> execute_serial_plan_def execute_operator_def
        is_operator_applicable_in_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_serial_plan_split_i><span class=command>lemma</span></span> execute_serial_plan_split_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>π</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=free>s</span> <span class=main>⪢</span> <span class=free>op</span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> Nil
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op'</span> <span class=skolem>π</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>⪢</span> <span class=free>op</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> set <span class=main>(</span><span class=skolem>op'</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=skolem>op'</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operators_interfering <span class=free>op</span> <span class=skolem>x</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_non_interfering_def list_all_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=skolem>s</span> <span class=free>op</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
          is_operator_applicable_in_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=skolem>s</span> <span class=skolem>x</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> are_all_operators_applicable_cons<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
          is_operator_applicable_in_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=var>?t</span> <span class=skolem>x</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_parallel_plan_precondition_cons_i<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>op</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>s</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> execute_operator_def<span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>using</span></span> are_all_operators_applicable_cons<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_operator_applicable_in_def
        STRIPS_Representation.is_operator_applicable_in_def
        are_all_operators_applicable_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that plans $\pi$ can be split into separate executions of partial plans $\pi_1$ and
$\pi_2$ with $\pi = \pi_1 @ \pi_2$, if all operators in $\pi_1$ are applicable in the given state
$s$ and there is no interference between subsequent operators in $\pi_1$. This is the case because
non interference ensures that no precondition for any operator in $\pi_1$ is negated by the
execution of a preceding operator. Note that the non interference constraint excludes partial
plans where a precondition is first violated during execution but later restored which would also
allow splitting but does not meet the non interference constraint (which must hold for all
possible executing orders). ›</span>
<span class=keyword1 id=STRIPS_Semantics-execute_serial_plan_split><span class=command>lemma</span></span> execute_serial_plan_split<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>s</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>s</span> <span class=free>π<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=free>π<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=free>s</span> <span class=main>(</span><span class=free>π<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=free>π<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
    <span class=main>=</span> execute_serial_plan <span class=main>(</span>execute_serial_plan <span class=free>s</span> <span class=free>π<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=free>π<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op</span> <span class=skolem>π<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>⪢</span> <span class=skolem>op</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=skolem>s</span> <span class=main>⪢</span> <span class=skolem>op</span><span class=main>)</span> <span class=skolem>π<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_serial_plan_split_i<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=skolem>π<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> are_all_operators_non_interfering_tail<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=var>?t</span> <span class=main>(</span><span class=skolem>π<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=free>π<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span>
        execute_serial_plan <span class=main>(</span>execute_serial_plan <span class=var>?t</span> <span class=skolem>π<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=free>π<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?t</span></span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Representation.is_operator_applicable_in <span class=skolem>s</span> <span class=skolem>op</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> execute_serial_plan_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=comment1>(* TODO refactor *)</span>
<span class=keyword1 id=STRIPS_Semantics-embedding_lemma_i><span class=command>lemma</span></span> embedding_lemma_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>I</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>I</span> <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=free>op</span> <span class=free>op</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>⪢</span> <span class=free>op</span> <span class=main>=</span> execute_parallel_operator <span class=free>I</span> <span class=main>[</span><span class=free>op</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=free>I</span> <span class=main>[</span><span class=free>op</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff is_operator_applicable_in_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>[</span><span class=free>op</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>[</span><span class=free>op</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>⪢</span> <span class=free>op</span> <span class=main>=</span> execute_serial_plan <span class=free>I</span> <span class=main>[</span><span class=free>op</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span>  is_operator_applicable_in_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> execute_operator_def<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_equals_execute_sequential_strips_if
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-execute_serial_plan_is_execute_parallel_plan_ii><span class=command>lemma</span></span> execute_serial_plan_is_execute_parallel_plan_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>I</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> are_operator_effects_consistent <span class=bound>op</span> <span class=bound>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=free>I</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=free>I</span> <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op</span> <span class=skolem>π</span><span class=main>)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=skolem>I</span> <span class=skolem>op</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?J</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>I</span> <span class=main>⪢</span> <span class=skolem>op</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?J'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=var>?J</span> <span class=skolem>π</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> True
                <span class=keyword1><span class=command>unfolding</span></span> is_operator_applicable_in_def
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> True<span class=main>)</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?J</span> <span class=main>(</span>embed <span class=skolem>π</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?J</span></span></span><span class=main>]</span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> True
                <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
                  is_operator_applicable_in_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span>
                <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?J</span> <span class=main>=</span> <span class=var>?J'</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_equals_execute_sequential_strips_if<span class=main>[</span><span class=operator>OF</span>
                    calculation<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> Cons.prems<span class=main>(</span>1<span class=main>)</span> True
                <span class=keyword1><span class=command>unfolding</span></span>  is_operator_applicable_in_def
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> True<span class=main>)</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span>embed <span class=main>(</span><span class=skolem>op</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
                <span class=main>=</span> execute_parallel_plan <span class=var>?J</span> <span class=main>(</span>embed <span class=skolem>π</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems is_operator_applicable_in_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_all_operators_applicable <span class=skolem>I</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> False
                <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
                  is_operator_applicable_in_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=skolem>I</span> <span class=main>(</span>embed <span class=main>(</span><span class=skolem>op</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-embedding_lemma_iii><span class=command>lemma</span></span> embedding_lemma_iii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=comment1>(* TODO refactor *)</span>
    <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=free>π</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>force</span><span class=main>)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ops</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> set <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> nb calculation
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=skolem>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We show in the following theorem that---as mentioned---a serial solution <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> to a
STRIPS problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span> corresponds directly to a parallel solution obtained by embedding each operator
in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> in a list (by use of function <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹embed›</span></span></span></span>). The proof shows this by first
confirming that

    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"G ⊆<span class=hidden>⇩</span><sub>m</sub> execute_serial_plan ((Π)<span class=hidden>⇩</span><sub>I</sub>) π
    ⟹ G ⊆<span class=hidden>⇩</span><sub>m</sub> execute_serial_plan ((Π)<span class=hidden>⇩</span><sub>I</sub>) (embed π)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

using lemma \isaname{execute_serial_plan_is_execute_parallel_plan_strip_ii}; and
moreover by showing that

    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"∀ops ∈ set (embed π). ∀op ∈ set ops. op ∈ (Π)<span class=hidden>⇩</span><sub>𝒪</sub>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

meaning that under the given assumptions, all parallel operators of the embedded serial plan are
again operators in the operator set of the problem. ›</span></span>
<span class=keyword1><span class=command>theorem</span></span>  embedding_lemma<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>  <span class=operator>-</span>
    <span class=comment1>(* TODO refactor ‹STRIPS_Representation› (characterization of valid operator).
  *)</span><span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_serial_solution_for_problem_def list_all_iff ListMem_iff operators_of_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO refactor lemma is_valid_operator_strips_then
  *)</span>      <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> calculation
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_strips <span class=free>Π</span> <span class=skolem>op</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_problem_strips_def is_valid_problem_strips_def list_all_iff operators_of_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>¬</span>ListMem <span class=bound>v</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>¬</span>ListMem <span class=bound>v</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_strips_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>,</span> 5<span class=main>)</span> not_list_ex_equals_list_all_not
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>6<span class=main>,</span> 7<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> list_ex_iff ListMem_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=skolem>op</span> <span class=skolem>op</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def Let_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_serial_solution_for_problem_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_serial_plan_is_execute_parallel_plan_ii nb<span class=hidden>⇩</span><sub>2</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> embedding_lemma_iii<span class=main>[</span><span class=operator>OF</span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def goal_of_def
        initial_of_def operators_of_def list_all_iff ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-flattening_lemma_i><span class=command>lemma</span></span> flattening_lemma_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>concat <span class=free>π</span><span class=main>)</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span>concat <span class=free>π</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> set <span class=bound>ops</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation
        <span class=keyword1><span class=command>unfolding</span></span> set_concat<span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> UN_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=STRIPS_Semantics-flattening_lemma_ii><span class=command>lemma</span></span> flattening_lemma_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>I</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>∃</span><span class=bound>op</span><span class=main>.</span> <span class=bound>ops</span> <span class=main>=</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span> <span class=main>∧</span> is_valid_operator_strips <span class=free>Π</span> <span class=bound>op</span> "</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=free>I</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=free>I</span> <span class=main>(</span>concat <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=free>π</span>"</span></span>
    <span class=comment1>(* TODO refactor lemma is_valid_operator_strips_then *)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_valid_operator_strips <span class=free>Π</span> <span class=skolem>op</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>¬</span>ListMem <span class=bound>v</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>¬</span>ListMem <span class=bound>v</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_strips_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span> not_list_ex_equals_list_all_not
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>,</span> 5<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> list_ex_iff ListMem_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=skolem>op</span> <span class=skolem>op</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def Let_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>ops</span> <span class=skolem>π</span><span class=main>)</span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> ops_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> is_valid_op<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_strips <span class=free>Π</span> <span class=skolem>op</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?J</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?J'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>I</span> <span class=main>⪢</span> <span class=skolem>op</span>"</span></span>
            <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=skolem>I</span> <span class=skolem>op</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> True ops_is
              <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
                is_operator_applicable_in_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>3</sub><span class=main>:</span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=skolem>op</span> <span class=skolem>op</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>[</span><span class=operator>OF</span> is_valid_op<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=skolem>ops</span>"</span></span>
                <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff
                <span class=keyword1><span class=command>using</span></span> ops_is
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?J</span> <span class=skolem>π</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> ops_is True
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=skolem>I</span> <span class=main>(</span>concat <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
              <span class=main>=</span> execute_serial_plan <span class=var>?J'</span> <span class=main>(</span>concat <span class=skolem>π</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> ops_is nb<span class=hidden>⇩</span><sub>2</sub>
              <span class=keyword1><span class=command>unfolding</span></span> is_operator_applicable_in_def
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> execute_operator_def nb<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?J</span> <span class=main>=</span> <span class=var>?J'</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def execute_operator_def comp_apply
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.IH Cons.prems
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> calculation
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>is_operator_applicable_in <span class=skolem>I</span> <span class=skolem>op</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> ops_is False
                <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
                  is_operator_applicable_in_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=skolem>I</span> <span class=main>(</span>concat <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> ops_is is_operator_applicable_in_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ The opposite direction is also easy to show if we can normalize the parallel plan to the
form of an embedded serial plan as shown below. ›</span></span>

<span class=keyword1 id=STRIPS_Semantics-flattening_lemma><span class=command>lemma</span></span> flattening_lemma<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>∃</span><span class=bound>op</span><span class=main>.</span> <span class=bound>ops</span> <span class=main>=</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Π</span> <span class=main>(</span>concat <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>  <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=free>π</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def list_all_iff ListMem_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?π'</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> flattening_lemma_i
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ops</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> calculation
          <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def list_all_iff ListMem_iff
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_strips <span class=free>Π</span> <span class=skolem>op</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>3<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> is_valid_problem_strips_def Let_def list_all_iff ListMem_iff
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span><span class=main>.</span> <span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span> <span class=main>∧</span> is_valid_operator_strips <span class=free>Π</span> <span class=bound>op</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=var>?π'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> flattening_lemma_ii
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Π</span> <span class=var>?π'</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> is_serial_solution_for_problem_def list_all_iff ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Finally, we can obtain the important result that a parallel plan with a trace that
reaches the goal state of a given problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span>, and for which both the parallel operator execution
condition as well as non interference is assured at every point <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=free><span class=free>π</span></span>›</span></span></span></span>, the flattening of
the parallel plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹concat <span class=free><span class=free>π</span></span>›</span></span></span></span> is a serial solution for the initial and goal state of the problem.
To wit, by lemma \ref{isathm:parallel-solution-trace-strips} we have

    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"(G ⊆<span class=hidden>⇩</span><sub>m</sub> execute_parallel_plan I π)
      = (G ⊆<span class=hidden>⇩</span><sub>m</sub> last (trace_parallel_plan_strips I π))"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

so the second assumption entails that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> is a solution for the initial state and the goal state
of the problem. (which implicitely means that  <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> is a solution
for the inital state and goal state of the problem). The trace formulation is used in this case
because it allows us to write the---state dependent---applicability condition more succinctly. The
proof (shown below) is by structural induction on <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> with arbitrary initial state.›</span></span>

<span class=comment1>(* TODO Demote to lemma; add theorem about problem solutions. Move text to theorem. *)</span>
<span class=keyword1><span class=command>theorem</span></span>  execute_parallel_plan_is_execute_sequential_plan_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>I</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> bool<span class=main>)</span> state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>is_valid_problem</span> <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>k</span></span> <span class=main>&lt;</span> length <span class=free>π</span><span class=main>.</span>
      are_all_operators_applicable <span class=main>(</span>trace_parallel_plan_strips <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span>
      <span class=main>∧</span> are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span>
      <span class=main>∧</span> are_all_operators_non_interfering <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=free>I</span> <span class=main>(</span>concat <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>ops</span> <span class=skolem>π</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"take <span class=main>(</span>length <span class=skolem>ops</span><span class=main>)</span> <span class=main>(</span>concat <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?J</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?J'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=skolem>I</span> <span class=var>?ops'</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=skolem>π</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> trace_parallel_plan_strips_head_is_initial_state
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=skolem>ops</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>
        <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_strips <span class=var>?J</span> <span class=skolem>π</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"last <span class=main>(</span>trace_parallel_plan_strips <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> last <span class=main>(</span>trace_parallel_plan_strips <span class=var>?J</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_last_cons_then nb
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_strips <span class=var>?J</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=skolem>π</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>+</span> <span class=main>1</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable
        <span class=main>(</span>trace_parallel_plan_strips <span class=var>?J</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>3<span class=main>)</span> nb
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=var>?J</span> <span class=main>(</span>concat <span class=skolem>π</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=var><span class=quoted><span class=var>?J</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=skolem>I</span> <span class=main>(</span>concat <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> execute_serial_plan <span class=var>?J'</span> <span class=main>(</span>concat <span class=skolem>π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_serial_plan_split<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=skolem>ops</span></span><span class=main>]</span> Cons.prems<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>thm</span></span> execute_parallel_operator_equals_execute_sequential_strips_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?J</span> <span class=main>=</span> <span class=var>?J'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_equals_execute_sequential_strips_if Cons.prems<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan <span class=skolem>I</span> <span class=main>(</span>concat <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> execute_serial_plan <span class=var>?J</span> <span class=main>(</span>concat <span class=skolem>π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_serial_plan_split<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=skolem>ops</span></span><span class=main>]</span> Cons.prems<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Auxiliary lemmas about STRIPS"</span></span>

<span class=keyword1 id=STRIPS_Semantics-set_to_precondition_of_op_is><span class=command>lemma</span></span> set_to_precondition_of_op_is<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>to_precondition <span class=free>op</span><span class=main>)</span>
  <span class=main>=</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> to_precondition_def STRIPS_Representation.to_precondition_def set_map
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=SAS_Plus_Representation><div class=head><h1>Theory SAS_Plus_Representation</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> SAS_Plus_Representation
<span class=keyword2><span class=keyword>imports</span></span> <a href=State_Variable_Representation.html>State_Variable_Representation</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"SAS+ Representation"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We now continue by defining a concrete implementation of SAS+.›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ SAS+ operators and SAS+ problems again use records. In contrast to STRIPS, the operator 
effect is contracted into a single list however since we now potentially deal with more than two 
possible values for each problem variable. ›</span></span>

<span class=keyword1><span class=command>record</span></span>  <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator <span class=main>=</span> 
  precondition_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> assignment list"</span></span> 
  effect_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> assignment list"</span></span> 

<span class=keyword1><span class=command>record</span></span>  <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem <span class=main>=</span>
  variables_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> list"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>
  operators_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator list"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>
  initial_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>
  goal_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>
  range_of <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> <span class=main>⇀</span> <span class=tfree>'domain</span> list"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>range_of'</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem <span class=main>⇒</span> <span class=tfree>'variable</span> <span class=main>⇒</span> <span class=tfree>'domain</span> set"</span></span>  <span class=main>(</span><span class=quoted>"<span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> _ _"</span> 52<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>range_of'</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>≡</span>
     <span class=main>(</span><span class=keyword1>case</span> sas_plus_problem.range_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=keyword1>of</span> None <span class=main>⇒</span> <span class=main>{}</span> 
           <span class=main>|</span> Some <span class=bound>as</span> <span class=main>⇒</span> set <span class=bound>as</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>to_precondition</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> assignment list"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>to_precondition</span> <span class=main>≡</span> precondition_of"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>to_effect</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> Effect"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>to_effect</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=main>[</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>.</span> <span class=main>(</span>v<span class=main>,</span> a<span class=main>)</span> <span class=main>←</span> effect_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span>  <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_plan 
  <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator list"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span>  <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_parallel_plan 
  <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator list list"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span>  <span class=entity>empty_operator</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>ρ</span>"</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>empty_operator</span> <span class=main>≡</span> <span class=main>⦇</span> precondition_of <span class=main>=</span> <span class=main>[]</span><span class=main>,</span> effect_of <span class=main>=</span> <span class=main>[]</span> <span class=main>⦈</span>"</span></span> 

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_valid_operator_sas_plus</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem  <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator <span class=main>⇒</span> bool"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_valid_operator_sas_plus</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span> 
      <span class=bound>pre</span> <span class=main>=</span> precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span>
      <span class=main>;</span> <span class=bound>eff</span> <span class=main>=</span> effect_of <span class=free><span class=bound><span class=entity>op</span></span></span>
      <span class=main>;</span> <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
      <span class=main>;</span> <span class=bound>D</span> <span class=main>=</span> range_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
    <span class=keyword1>in</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=bound>vs</span><span class=main>)</span> <span class=bound>pre</span>
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>D</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>∧</span> ListMem <span class=bound>a</span> <span class=main>(</span>the <span class=main>(</span><span class=bound>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>pre</span> 
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> ListMem <span class=bound>v</span> <span class=bound>vs</span><span class=main>)</span> <span class=bound>eff</span>
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>D</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>∧</span> ListMem <span class=bound>a</span> <span class=main>(</span>the <span class=main>(</span><span class=bound>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>eff</span>
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=bound>pre</span><span class=main>)</span> <span class=bound>pre</span>
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=bound>eff</span><span class=main>)</span> <span class=bound>eff</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>is_valid_problem_sas_plus</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> 
  <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
      <span class=main>;</span> <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
      <span class=main>;</span> <span class=bound>I</span> <span class=main>=</span> initial_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
      <span class=main>;</span> <span class=bound>G</span> <span class=main>=</span> goal_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
      <span class=main>;</span> <span class=bound>D</span> <span class=main>=</span> range_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
    <span class=keyword1>in</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=bound>D</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=bound>vs</span>
    <span class=main>∧</span> list_all <span class=main>(</span>is_valid_operator_sas_plus <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span> <span class=bound>ops</span> 
    <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟷</span> ListMem <span class=bound>v</span> <span class=bound>vs</span><span class=main>)</span> 
    <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟶</span> ListMem <span class=main>(</span>the <span class=main>(</span><span class=bound>I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=bound>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟶</span> ListMem <span class=bound>v</span> <span class=main>(</span>variables_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span><span class=main>)</span>
    <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=bound>G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟶</span> ListMem <span class=main>(</span>the <span class=main>(</span><span class=bound>G</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=bound>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_operator_applicable_in</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator 
    <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_operator_applicable_in</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> 
    <span class=main>≡</span> map_of <span class=main>(</span>precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>s</span></span></span>"</span></span> 

<span class=comment1>(* TODO rename execute_operator_in *)</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>execute_operator_sas_plus</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>⪢<span class=hidden>⇩</span><sub>+</sub></span>"</span> 52<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>execute_operator_sas_plus</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span>"</span></span>

<span class=comment1>― ‹ Set up simp rules to keep use of local parameters transparent within proofs (i.e. 
automatically substitute definitions). ›</span>
<span class=keyword1><span class=command>lemma</span></span><span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span> <span class=main>=</span> <span class=main>(</span>map_of <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span><span class=main>)</span>"</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>op</span> <span class=main>=</span> <span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> initial_of_def goal_of_def variables_of_def range_of_def operators_of_def      
    SAS_Plus_Representation.is_operator_applicable_in_def
    SAS_Plus_Representation.execute_operator_sas_plus_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SAS_Plus_Representation-range_of_not_empty><span class=command>lemma</span></span> range_of_not_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span> <span class=free>v</span> <span class=main>≠</span> None <span class=main>∧</span> sas_plus_problem.range_of <span class=free>Ψ</span> <span class=free>v</span> <span class=main>≠</span> Some <span class=main>[]</span><span class=main>)</span>
    <span class=main>⟷</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"sas_plus_problem.range_of <span class=free>Ψ</span> <span class=free>v</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> SAS_Plus_Representation.range_of'_def<span class=main>)</span>

<span class=keyword1 id=SAS_Plus_Representation-is_valid_operator_sas_plus_then><span class=command>lemma</span></span> is_valid_operator_sas_plus_then<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Ψ</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'v</span><span class=main>,</span><span class=tfree>'d</span><span class=main>)</span> sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=free>op</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> 
      <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.variables_of <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?pre</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"precondition_of <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?eff</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"effect_of <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.range_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=var>?pre</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=var>?pre</span><span class=main>.</span>
          <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>∧</span>
          <span class=bound>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=var>?eff</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=var>?eff</span><span class=main>.</span>
          <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>∧</span>
          <span class=bound>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=var>?pre</span><span class=main>.</span>
          <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>∈</span>set <span class=var>?pre</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=var>?eff</span><span class=main>.</span> 
      <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>∈</span>set <span class=var>?eff</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def Let_def list_all_iff ListMem_iff 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?pre</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?eff</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?pre</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?pre</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?eff</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?eff</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> calculation 
    <span class=keyword1><span class=command>unfolding</span></span> variables_of_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?pre</span><span class=main>.</span> <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms 
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def Let_def list_all_iff ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?pre</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> range_of'_def 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?eff</span><span class=main>.</span> <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms 
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def Let_def list_all_iff ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?eff</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> range_of'_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> 
      <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO can be replaced by proof for sublocale? *)</span>
<span class=keyword1 id=SAS_Plus_Representation-is_valid_problem_sas_plus_then><span class=command>lemma</span></span> is_valid_problem_sas_plus_then<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Ψ</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'v</span><span class=main>,</span><span class=tfree>'d</span><span class=main>)</span> sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.operators_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.initial_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.goal_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.range_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?D</span> <span class=skolem>v</span> <span class=main>≠</span> None <span class=main>∧</span> <span class=var>?D</span> <span class=skolem>v</span> <span class=main>≠</span> Some <span class=main>[]</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=var>?D</span> <span class=skolem>v</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> range_of'_def<span class=main>)</span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> <span class=var>?D</span> <span class=bound>v</span> <span class=main>≠</span> None"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟶</span> the <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟶</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> nb<span class=hidden>⇩</span><sub>3</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>.</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>⟶</span> the <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms 
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_Representation.is_valid_problem_sas_plus_def Let_def 
      list_all_iff ListMem_iff 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> G3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> G4<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> G5<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> variables_of_def operators_of_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?D</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> G6 <span class=main>=</span> this
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> G4 calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sas_plus_problem.range_of <span class=free>Ψ</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
        <span class=keyword1><span class=command>using</span></span> range_of_not_empty
        <span class=keyword1><span class=command>unfolding</span></span> range_of'_def
        <span class=keyword1><span class=command>using</span></span> G6 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹sas_plus_problem.range_of <span class=free>Ψ</span> <span class=skolem>v</span> <span class=main>≠</span> None›</span></span> option.case_eq_if range_of'_def<span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> G5 calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sas_plus_problem.range_of <span class=free>Ψ</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
        <span class=keyword1><span class=command>using</span></span> range_of_not_empty
        <span class=keyword1><span class=command>using</span></span> G6
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹sas_plus_problem.range_of <span class=free>Ψ</span> <span class=skolem>v</span> <span class=main>≠</span> None›</span></span> option.case_eq_if range_of'_def<span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set<span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=SAS_Plus_Semantics><div class=head><h1>Theory SAS_Plus_Semantics</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> SAS_Plus_Semantics  
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=SAS_Plus_Representation.html>SAS_Plus_Representation</a>"</span> <span class=quoted>"<a href=List_Supplement.html>List_Supplement</a>"</span>
    <span class=quoted>"<a href=Map_Supplement.html>Map_Supplement</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"SAS+ Semantics"</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Serial Execution Semantics"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Serial plan execution is implemented recursively just like in the STRIPS case. By and large, 
compared to definition \ref{isadef:plan-execution-strips}, we only substitute the operator 
applicability function with its SAS+ counterpart. ›</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>execute_serial_plan_sas_plus</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>execute_serial_plan_sas_plus</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>s</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>execute_serial_plan_sas_plus</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> 
    <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> is_operator_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> 
    <span class=keyword1>then</span> <span class=free>execute_serial_plan_sas_plus</span> <span class=main>(</span>execute_operator_sas_plus <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
    <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Similarly, serial SAS+ solutions are defined just like in STRIPS but based on the 
corresponding SAS+ definitions. ›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_serial_solution_for_problem</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_plan <span class=main>⇒</span> bool"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_serial_solution_for_problem</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>ψ</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> 
        <span class=bound>I</span> <span class=main>=</span> sas_plus_problem.initial_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
        <span class=main>;</span> <span class=bound>G</span> <span class=main>=</span> sas_plus_problem.goal_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
        <span class=main>;</span> <span class=bound>ops</span> <span class=main>=</span> sas_plus_problem.operators_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
      <span class=keyword1>in</span> <span class=bound>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan_sas_plus <span class=bound>I</span> <span class=free><span class=bound><span class=entity>ψ</span></span></span>
        <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=bound>op</span> <span class=bound>ops</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ψ</span></span></span>"</span></span> 


<span class=keyword1><span class=command>context</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_Semantics-execute_operator_sas_plus_effect_i><span class=command>lemma</span></span> execute_operator_sas_plus_effect_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
      <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?effect</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"effect_of <span class=free>op</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=var>?effect</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> map_of_constant_assignments_defined_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>try0</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> execute_operator_sas_plus_def map_add_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>
    
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_Semantics-execute_operator_sas_plus_effect_ii><span class=command>lemma</span></span>  execute_operator_sas_plus_effect_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v'</span> <span class=main>≠</span> <span class=free>v</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> <span class=free>s</span> <span class=free>v</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?effect</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"effect_of <span class=free>op</span>"</span></span> 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> fst <span class=main>`</span> set <span class=var>?effect</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=var>?effect</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> dom_map_of_conv_image_fst<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?effect</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=var>?effect</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> <span class=free>s</span> <span class=free>v</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> map_add_dom_app_simps<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=quoted>"map_of <span class=var>?effect</span>"</span></span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Given an operator <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span>›</span></span></span></span> that is applicable in a state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>s</span></span>›</span></span></span></span> and has a consistent set 
of effects (second assumption) we can now show that the successor state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>s'</span></span> <span class=main><span class=main>≡</span></span> <span class=free><span class=free>s</span></span> <span class=main><span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span></span> <span class=free><span class=free>op</span></span>›</span></span></span></span> 
has the following properties:
\begin{itemize}
  \item <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>s'</span></span> <span class=free><span class=free>v</span></span> <span class=main><span class=main>=</span></span> Some <span class=free><span class=free>a</span></span>›</span></span></span></span> if <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=free><span class=free>v</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>a</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> exist in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹set <span class=main><span class=main>(</span></span>effect_of <span class=free><span class=free>op</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span>; and,
  \item <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>s'</span></span> <span class=free><span class=free>v</span></span> <span class=main><span class=main>=</span></span> <span class=free><span class=free>s</span></span> <span class=free><span class=free>v</span></span>›</span></span></span></span> if no <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=free><span class=free>v</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>a'</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> exist in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹set <span class=main><span class=main>(</span></span>effect_of <span class=free><span class=free>op</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span>.
\end{itemize} 
The second property is the case if the operator doesn't have an effect for a variable <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span>›</span></span></span></span>. ›</span></span>

<span class=keyword1><span class=command>theorem</span></span> execute_operator_sas_plus_effect<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> 
      <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span> 
      <span class=main>⟶</span> <span class=main>(</span><span class=free>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>a</span><span class=main>.</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>)</span> 
      <span class=main>⟶</span> <span class=main>(</span><span class=free>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> <span class=free>s</span> <span class=free>v</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span> 
    <span class=main>⟶</span> <span class=main>(</span><span class=free>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> execute_operator_sas_plus_effect_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span> 
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>a</span><span class=main>.</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>)</span> 
    <span class=main>⟶</span> <span class=main>(</span><span class=free>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>op</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> <span class=free>s</span> <span class=free>v</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> execute_operator_sas_plus_effect_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Parallel Execution Semantics"</span></span>

<span class=comment1>― ‹ Define a type synonym for \emph{SAS+ parallel plans} and add a definition lifting SAS+
operator applicability to parallel plans. ›</span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_parallel_plan 
  <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator list list"</span></span> 
    
<span class=keyword1><span class=command>definition</span></span> <span class=entity>are_all_operators_applicable_in</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator list
    <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>are_all_operators_applicable_in</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span> 
    <span class=main>≡</span> list_all <span class=main>(</span>is_operator_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>are_operator_effects_consistent</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator
    <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>are_operator_effects_consistent</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=free><span class=bound><span class=entity>op'</span></span></span> 
    <span class=main>≡</span> <span class=keyword1>let</span> 
        <span class=bound>effect</span> <span class=main>=</span> effect_of <span class=free><span class=bound><span class=entity>op</span></span></span>
        <span class=main>;</span> <span class=bound>effect'</span> <span class=main>=</span> effect_of <span class=free><span class=bound><span class=entity>op'</span></span></span>
      <span class=keyword1>in</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=bound>effect'</span><span class=main>)</span> <span class=bound>effect</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>are_all_operator_effects_consistent</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator list
    <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>are_all_operator_effects_consistent</span> <span class=free><span class=bound><span class=entity>ops</span></span></span> 
    <span class=main>≡</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>"</span></span>   

<span class=keyword1><span class=command>definition</span></span> <span class=entity>execute_parallel_operator_sas_plus</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator list 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>execute_parallel_operator_sas_plus</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span> 
    <span class=main>≡</span> foldl <span class=main>(++)</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span>map <span class=main>(</span>map_of <span class=main>∘</span> effect_of<span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We now define parallel execution and parallel traces for SAS+ by lifting the tests for 
applicability and effect consistency to parallel SAS+ operators. The definitions are again very
similar to their STRIPS analogs (definitions \ref{isadef:parallel-plan-execution-strips} and 
\ref{isadef:parallel-plan-trace-strips}). ›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>execute_parallel_plan_sas_plus</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_parallel_plan
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>execute_parallel_plan_sas_plus</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>s</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>execute_parallel_plan_sas_plus</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>opss</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> 
      are_all_operators_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span> 
      <span class=main>∧</span> are_all_operator_effects_consistent <span class=free><span class=bound><span class=entity>ops</span></span></span>
    <span class=keyword1>then</span> <span class=free>execute_parallel_plan_sas_plus</span> 
      <span class=main>(</span>execute_parallel_operator_sas_plus <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>opss</span></span></span>
    <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>trace_parallel_plan_sas_plus</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state  
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_parallel_plan 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>trace_parallel_plan_sas_plus</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>trace_parallel_plan_sas_plus</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>opss</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>if</span> 
      are_all_operators_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span> 
      <span class=main>∧</span> are_all_operator_effects_consistent <span class=free><span class=bound><span class=entity>ops</span></span></span>
    <span class=keyword1>then</span> <span class=free>trace_parallel_plan_sas_plus</span> 
      <span class=main>(</span>execute_parallel_operator_sas_plus <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>opss</span></span></span>
    <span class=keyword1>else</span> <span class=main>[]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ A plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> is a solution for a SAS+ problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span> if 
\begin{enumerate}
  \item starting from the initial state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span>, SAS+ parallel plan execution 
    reaches a state which satisfies the described goal state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹sas_plus_problem.goal_of <span class=free><span class=free>Ψ</span></span>›</span></span></span></span>; and,
  \item all parallel operators <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ops</span></span>›</span></span></span></span> in the plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> only consist of operators that
    are specified in the problem description.
\end{enumerate} ›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_parallel_solution_for_problem</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_parallel_plan 
    <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_parallel_solution_for_problem</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>ψ</span></span></span> 
    <span class=main>≡</span> <span class=keyword1>let</span> 
        <span class=bound>G</span> <span class=main>=</span> sas_plus_problem.goal_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
        <span class=main>;</span> <span class=bound>I</span> <span class=main>=</span> sas_plus_problem.initial_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
        <span class=main>;</span> <span class=bound>Ops</span> <span class=main>=</span> sas_plus_problem.operators_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span>
      <span class=keyword1>in</span> <span class=bound>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=bound>I</span> <span class=free><span class=bound><span class=entity>ψ</span></span></span>
      <span class=main>∧</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>ops</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=bound>op</span> <span class=bound>Ops</span><span class=main>)</span> <span class=bound>ops</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ψ</span></span></span>"</span></span> 

<span class=keyword1><span class=command>context</span></span> 
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-execute_parallel_operator_sas_plus_cons><span class=command>lemma</span></span> execute_parallel_operator_sas_plus_cons<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=free>s</span> <span class=main>(</span><span class=free>op</span> <span class=main>#</span> <span class=free>ops</span><span class=main>)</span>
    <span class=main>=</span> execute_parallel_operator_sas_plus <span class=main>(</span><span class=free>s</span> <span class=main>++</span>  map_of <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=free>ops</span>"</span></span> 
  <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_sas_plus_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The following lemmas show the properties of SAS+ parallel plan execution traces. 
The results are analogous to those for STRIPS. So, let <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span> <span class=main><span class=main>≡</span></span> trace_parallel_plan_sas_plus <span class=free><span class=free>I</span></span> <span class=free><span class=free>ψ</span></span>›</span></span></span></span> 
be a trace of a parallel SAS+ plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> with initial state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>I</span></span>›</span></span></span></span>, then
\begin{itemize}
  \item the head of the trace <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span> <span class=main><span class=main>!</span></span> <span class=main><span class=main>0</span></span>›</span></span></span></span> is the initial state of the 
problem (lemma \ref{isathm:head-parallel-plan-trace-sas-plus}); moreover,
  \item for all but the last element of the trace---i.e. elements with index 
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=free><span class=free>τ</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span>---the parallel operator <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span> is executable (lemma 
\ref{isathm:parallel-plan-trace-operator-execution-conditions-sas-plus}); and 
finally, 
  \item for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=free><span class=free>τ</span></span>›</span></span></span></span>, the parallel execution of the plan prefix <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹take <span class=free><span class=free>k</span></span> <span class=free><span class=free>ψ</span></span>›</span></span></span></span> with 
initial state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>I</span></span>›</span></span></span></span> equals the <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span>-th element of the trace <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span> (lemma 
\ref{isathm:parallel-trace-plan-prefixes-sas-plus}).
\end{itemize} ›</span></span>

<span class=comment1>(* TODO? Make invisible? *)</span>
<span class=keyword1 id=SAS_Plus_Semantics-trace_parallel_plan_sas_plus_head_is_initial_state><span class=command>lemma</span></span> trace_parallel_plan_sas_plus_head_is_initial_state<span class=main>:</span> 
  <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>ψ</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>list</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=free>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main><span class=keyword3>;</span></span> 
        <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SAS_Plus_Semantics-trace_parallel_plan_sas_plus_length_gt_one_if><span class=command>lemma</span></span> trace_parallel_plan_sas_plus_length_gt_one_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>  
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
    
<span class=keyword1 id=SAS_Plus_Semantics-length_trace_parallel_plan_sas_plus_lte_length_plan_plus_one><span class=command>lemma</span></span> length_trace_parallel_plan_sas_plus_lte_length_plan_plus_one<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span><span class=main>)</span> <span class=main>≤</span> length <span class=free>ψ</span> <span class=main>+</span> <span class=main>1</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>ψ</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> True
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> 
          <span class=main>=</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ</span><span class=main>)</span> <span class=main>≤</span> length <span class=skolem>ψ</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?I'</span></span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> length <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
    
<span class=keyword1 id=SAS_Plus_Semantics-plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements><span class=command>lemma</span></span> plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span> 
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>ops</span> <span class=free>ψ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>ψ</span> <span class=main>=</span> <span class=free>ops</span> <span class=main>#</span> <span class=free>ψ'</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> length <span class=free>ψ</span> <span class=main>+</span> <span class=main>1</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_sas_plus_lte_length_plan_plus_one
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=free>ψ</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus_length_gt_one_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"length <span class=free>ψ</span> <span class=main>=</span> Suc <span class=skolem>k'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> gr0_implies_Suc
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> that  
    <span class=keyword1><span class=command>using</span></span> length_Suc_conv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ψ</span></span> <span class=quoted><span class=skolem>k'</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-trace_parallel_plan_sas_plus_step_implies_operator_execution_condition_holds><span class=command>lemma</span></span> trace_parallel_plan_sas_plus_step_implies_operator_execution_condition_holds<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>
      <span class=main>∧</span> are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms 
<span class=keyword1><span class=command>proof</span></span>  <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"<span class=free>π</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span> <span class=quoted><span class=free>k</span></span><span class=main>)</span>
  <span class=comment1>― ‹ NOTE Base case yields contradiction with assumption and can be left to automation. ›</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>π</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>have</span></span> trace_parallel_plan_sas_plus_cons<span class=main>:</span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> 
        <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_sas_plus <span class=main>(</span>execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>a</span><span class=main>)</span> <span class=skolem>π</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> True
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>  
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> 0
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus_cons
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>using</span></span> True 0
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k'</span><span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> Suc <span class=skolem>k'</span> 
          <span class=main>=</span> trace_parallel_plan_sas_plus <span class=main>(</span>execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>a</span><span class=main>)</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus_cons
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>!</span> Suc <span class=skolem>k'</span> <span class=main>=</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>a</span>"</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> 
            <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus_cons 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Cons.prems Suc
            <span class=keyword1><span class=command>unfolding</span></span> Suc_eq_plus1
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in
            <span class=main>(</span>trace_parallel_plan_sas_plus <span class=main>(</span>execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>a</span><span class=main>)</span> <span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span><span class=main>)</span>
            <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span><span class=main>)</span> 
          <span class=main>∧</span> are_all_operator_effects_consistent <span class=main>(</span><span class=skolem>π</span> <span class=main>!</span> <span class=skolem>k'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k'</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>a</span>"</span></span><span class=main>]</span> Cons.prems Suc trace_parallel_plan_sas_plus_cons
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>using</span></span> Suc
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>qed</span></span> 
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>I</span><span class=main>]</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=comment1>― ‹ NOTE Thesis follows from contradiction with assumption. ›</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.prems
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=SAS_Plus_Semantics-trace_parallel_plan_sas_plus_prefix><span class=command>lemma</span></span> trace_parallel_plan_sas_plus_prefix<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span> <span class=main>!</span> <span class=free>k</span> <span class=main>=</span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=main>(</span>take <span class=free>k</span> <span class=free>ψ</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span>  <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span> <span class=quoted><span class=free>k</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>ψ</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=skolem>a</span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>a</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?σ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>have</span></span> σ_equals<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?σ</span> <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> True
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> k_is_suc_of_k'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> Suc <span class=skolem>k'</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> not0_implies_Suc<span class=main>[</span><span class=operator>OF</span> False<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span>take <span class=skolem>k</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span>
            <span class=main>=</span> execute_parallel_plan_sas_plus <span class=var>?I'</span> <span class=main>(</span>take <span class=skolem>k'</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> True
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span> <span class=main>!</span> <span class=skolem>k</span> 
            <span class=main>=</span> trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ</span> <span class=main>!</span> <span class=skolem>k'</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> σ_equals k_is_suc_of_k'
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems σ_equals k_is_suc_of_k'
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ</span> <span class=main>!</span> <span class=skolem>k'</span> 
              <span class=main>=</span> execute_parallel_plan_sas_plus <span class=var>?I'</span> <span class=main>(</span>take <span class=skolem>k'</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k'</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span><span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
        <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> operator_precondition_violated<span class=main>:</span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>I</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> operator_precondition_violated
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span>take <span class=skolem>k</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> Cons.prems operator_precondition_violated 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>using</span></span> Cons.prems nth_Cons_0
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SAS_Plus_Semantics-trace_parallel_plan_sas_plus_step_effect_is><span class=command>lemma</span></span> trace_parallel_plan_sas_plus_step_effect_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span> <span class=main>!</span> Suc <span class=free>k</span> 
    <span class=main>=</span> execute_parallel_operator_sas_plus <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>ψ</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=free>k</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ<span class=hidden>⇩</span><sub>k</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> Suc <span class=free>k</span>"</span></span>
  <span class=comment1>― ‹ NOTE rewrite the goal using the subplan formulation to be able. This allows us to make the 
    initial state arbitrary. ›</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> suc_k_lt_length_τ<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=free>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?τ<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=main>=</span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=free>ψ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus_prefix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Suc <span class=free>k</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> rewrite_goal <span class=main>=</span> this
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=free>I</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=free>ψ</span><span class=main>)</span> 
    <span class=main>=</span> execute_parallel_operator_sas_plus <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>ψ</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>k</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span> <span class=quoted><span class=free>ψ</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> 0
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops</span></span> <span class=skolem><span class=skolem>ψ'</span></span> <span class=keyword2><span class=keyword>where</span></span> ψ_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ψ</span> <span class=main>=</span> <span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ'</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements<span class=main>[</span><span class=operator>OF</span> <span class=quoted>"0.prems"</span><span class=main>]</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"take <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=skolem>ψ</span>  <span class=main>=</span> <span class=main>[</span><span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>]</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> ψ_is
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=skolem>ψ</span><span class=main>)</span> 
          <span class=main>=</span> execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>[</span><span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus_head_is_initial_state<span class=keyword1><span class=command>.</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus_step_implies_operator_execution_condition_holds<span class=main>[</span><span class=operator>OF</span>
                <span class=quoted>"0.prems"</span><span class=main>]</span> calculation 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>[</span><span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>]</span> 
            <span class=main>=</span> execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span> 
            <span class=main>(</span><span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span>
          <span class=main>=</span> execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>[</span><span class=skolem>ψ</span> <span class=main>!</span> <span class=main>0</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops</span></span> <span class=skolem><span class=skolem>ψ'</span></span> <span class=keyword2><span class=keyword>where</span></span> ψ_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ψ</span> <span class=main>=</span> <span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ'</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> plan_is_at_least_singleton_plan_if_trace_has_at_least_two_elements<span class=main>[</span><span class=operator>OF</span> Suc.prems<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span><span class=main>)</span> <span class=skolem>ψ</span><span class=main>)</span>
        <span class=main>=</span> execute_parallel_plan_sas_plus <span class=var>?I'</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>ψ'</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Suc.prems ψ_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>thm</span></span> Suc.IH<span class=main>[</span><span class=operator>of</span> <span class=main>]</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=skolem>ψ</span><span class=main>)</span>
          <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ'</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> ψ_is Suc.prems
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ'</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.prems calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=var>?I'</span> <span class=main>(</span>take <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>ψ'</span><span class=main>)</span> <span class=main>=</span>
          execute_parallel_operator_sas_plus <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ'</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> 
          <span class=main>(</span><span class=skolem>ψ'</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=quoted><span class=skolem>ψ'</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>          
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?I'</span> <span class=skolem>ψ'</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> 
          <span class=main>(</span><span class=skolem>ψ'</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>
        <span class=main>=</span> execute_parallel_operator_sas_plus <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=skolem>ψ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span>
          <span class=main>(</span><span class=skolem>ψ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Suc.prems ψ_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span> 
    <span class=keyword1><span class=command>qed</span></span> 
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> rewrite_goal
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Finally, we obtain the result corresponding to lemma 
\ref{isathm:parallel-solution-trace-strips} in the SAS+ case: it is equivalent to say that parallel 
SAS+ execution reaches the problem's goal state and that the last element of the corresponding 
trace satisfies the goal state. ›</span></span>
<span class=keyword1 id=SAS_Plus_Semantics-execute_parallel_plan_sas_plus_reaches_goal_iff_goal_is_last_element_of_trace><span class=command>lemma</span></span>  execute_parallel_plan_sas_plus_reaches_goal_iff_goal_is_last_element_of_trace<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span> 
    <span class=main>⟷</span> <span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span>   <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span>"</span></span> 
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=var>?τ</span>"</span></span> 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
        <span class=comment1>― ‹ NOTE Base case follows from simplification. ›</span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>ops</span> <span class=skolem>ψ</span><span class=main>)</span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=skolem>ops</span> 
            <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>ops</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> True Cons.prems
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> Cons.IH
                <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span> 
                <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> True 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus.elims
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"last <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> 
                <span class=main>=</span> last <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> last_ConsR
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>using</span></span> False
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>next</span></span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=var>?τ</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span>"</span></span> 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>ops</span> <span class=skolem>ψ</span><span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=skolem>ops</span>
            <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>ops</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span> 
                <span class=main>=</span> <span class=skolem>I</span> <span class=main>#</span> trace_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> True 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_sas_plus.elims
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"last <span class=main>(</span>trace_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> 
                <span class=main>=</span> last <span class=main>(</span>trace_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> last_ConsR
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?s</span></span></span><span class=main>]</span> Cons.prems 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span> 
                <span class=main>=</span> execute_parallel_plan_sas_plus <span class=var>?s</span> <span class=skolem>ψ</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> True
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems False 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>using</span></span> False
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-is_parallel_solution_for_problem_plan_operator_set><span class=command>lemma</span></span> is_parallel_solution_for_problem_plan_operator_set<span class=main>:</span>
  <span class=comment1>(* TODO refactor move + make visible? *)</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Ψ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'v</span><span class=main>,</span> <span class=tfree>'d</span><span class=main>)</span> sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def list_all_iff ListMem_iff operators_of_def 
  <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>

<span class=keyword2><span class=keyword>end</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Serializable Parallel Plans"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Again we want to establish conditions for the serializability of plans. Let
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span> be a SAS+ problem instance and let <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> be a serial solution. We obtain the following 
two important results, namely that
\begin{enumerate}
  \item the embedding <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹embed <span class=free><span class=free>ψ</span></span>›</span></span></span></span> of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> is a parallel solution for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span> 
(lemma \ref{isathm:serial-sas-plus-embedding}); and conversely that,
  \item a parallel solution to <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span> that has the form of an embedded serial plan can be 
concatenated to obtain a serial solution (lemma 
\ref{isathm:embedded-serial-solution-flattening-sas-plus}).
\end{enumerate} ›</span></span>


<span class=keyword1><span class=command>context</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* TODO refactor *)</span>
<span class=keyword1 id=SAS_Plus_Semantics-execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_i><span class=command>lemma</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=free>s</span> <span class=free>op</span>"</span></span>
    <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=free>op</span> <span class=free>op</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>op</span> <span class=main>=</span> execute_parallel_operator_sas_plus <span class=free>s</span> <span class=main>[</span><span class=free>op</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=free>s</span> <span class=main>[</span><span class=free>op</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def 
       SAS_Plus_Representation.execute_operator_sas_plus_def
      is_operator_applicable_in_def SAS_Plus_Representation.is_operator_applicable_in_def
      list_all_iff  
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>[</span><span class=free>op</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_sas_plus_def execute_operator_sas_plus_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_ii><span class=command>lemma</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>I</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> are_operator_effects_consistent <span class=bound>op</span> <span class=bound>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op</span> <span class=skolem>ψ</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?J</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_operator_sas_plus <span class=skolem>I</span> <span class=skolem>op</span>"</span></span> 
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?J'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Representation.is_operator_applicable_in <span class=skolem>I</span> <span class=skolem>op</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> True 
        <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def list_all_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan_sas_plus <span class=var>?J</span> <span class=skolem>ψ</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff Let_def
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=main>[</span><span class=skolem>op</span><span class=main>]</span> <span class=main>#</span> embed <span class=skolem>ψ</span><span class=main>)</span> 
        <span class=main>=</span> execute_parallel_plan_sas_plus <span class=var>?J'</span> <span class=main>(</span>embed <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> True calculation<span class=main>(</span>3<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=skolem>I</span> <span class=skolem>op</span>"</span></span> 
          <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=skolem>op</span> <span class=skolem>op</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> True Cons.prems<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def 
            SAS_Plus_Representation.is_operator_applicable_in_def list_all_iff 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?J</span> <span class=main>=</span> <span class=var>?J'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_i
            calculation<span class=main>(</span>1<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?J</span></span></span><span class=main>]</span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>is_operator_applicable_in <span class=skolem>I</span> <span class=skolem>op</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> calculation 
        <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def 
          SAS_Plus_Representation.is_operator_applicable_in_def list_all_iff 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> calculation<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_operator_applicable_in_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=main>[</span><span class=skolem>op</span><span class=main>]</span> <span class=main>#</span> embed <span class=skolem>ψ</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SAS_Plus_Semantics-execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iii><span class=command>lemma</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=free>op</span> <span class=free>op</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> is_serial_solution_for_problem_def Let_def list_all_iff ListMem_iff 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=free>op</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>,</span> 3<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def Let_def list_all_iff ListMem_iff
    <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>6<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iv><span class=command>lemma</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iv<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Ψ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'v</span><span class=main>,</span> <span class=tfree>'d</span><span class=main>)</span> sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"embed <span class=free>ψ</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=var>?ψ'</span> <span class=main>=</span> <span class=main>{</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span> <span class=main>}</span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>force</span><span class=main>)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ops</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> set <span class=var>?ψ'</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> nb calculation 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=skolem>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>theorem</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span>  <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.operators_of <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ψ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"embed <span class=free>ψ</span>"</span></span> 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>thm</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_ii<span class=main>[</span><span class=operator>OF</span><span class=main>]</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan_sas_plus <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=free>ψ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> is_serial_solution_for_problem_def Let_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> are_operator_effects_consistent <span class=bound>op</span> <span class=bound>op</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iii<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=var>?ψ'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_ii
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> is_serial_solution_for_problem_def Let_def list_all_iff ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=var>?ψ'</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_iv
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def list_all_iff ListMem_iff Let_def goal_of_def 
      initial_of_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-flattening_lemma_i><span class=command>lemma</span></span> flattening_lemma_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Ψ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'v</span><span class=main>,</span> <span class=tfree>'d</span><span class=main>)</span> sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>concat <span class=free>π</span><span class=main>)</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span>concat <span class=free>π</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> set <span class=bound>ops</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>unfolding</span></span> set_concat<span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=skolem>ops</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> UN_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-flattening_lemma_ii><span class=command>lemma</span></span> flattening_lemma_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>I</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=main>∃</span><span class=bound>op</span><span class=main>.</span> <span class=bound>ops</span> <span class=main>=</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span> <span class=main>∧</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span> "</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan_sas_plus <span class=free>I</span> <span class=main>(</span>concat <span class=free>ψ</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>ops</span> <span class=skolem>ψ</span><span class=main>)</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> ops_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> is_valid_op<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?J</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?J'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_operator_sas_plus <span class=skolem>I</span> <span class=skolem>op</span>"</span></span> 
          <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_operator_applicable_in <span class=skolem>I</span> <span class=skolem>op</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> True ops_is
            <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def is_operator_applicable_in_def 
              list_all_iff 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=skolem>op</span> <span class=skolem>op</span>"</span></span> 
            <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def list_all_iff Let_def 
            <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>6<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> is_valid_op<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=skolem>ops</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> ops_is 
            <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=var>?J</span> <span class=skolem>ψ</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> True calculation ops_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span>concat <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> 
              <span class=main>=</span> execute_serial_plan_sas_plus <span class=var>?J'</span> <span class=main>(</span>concat <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> ops_is nb<span class=hidden>⇩</span><sub>1</sub> is_operator_applicable_in_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?J</span> <span class=main>=</span> <span class=var>?J'</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus_i<span class=main>[</span><span class=operator>OF</span> nb<span class=hidden>⇩</span><sub>1</sub> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?J</span></span></span><span class=main>]</span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> calculation
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>is_operator_applicable_in <span class=skolem>I</span> <span class=skolem>op</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> False ops_is
              <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def 
                is_operator_applicable_in_def list_all_iff
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span>concat <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> 
              <span class=main>=</span> execute_serial_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=skolem>op</span> <span class=main>#</span> concat <span class=skolem>ψ</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> ops_is 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_serial_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span>concat <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> False 
              <span class=keyword1><span class=command>unfolding</span></span> is_operator_applicable_in_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>qed</span></span>  
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-flattening_lemma><span class=command>lemma</span></span> flattening_lemma<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=main>∃</span><span class=bound>op</span><span class=main>.</span> <span class=bound>ops</span> <span class=main>=</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Ψ</span> <span class=main>(</span>concat <span class=free>ψ</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>  <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=free>ψ</span>"</span></span> 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def list_all_iff ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ψ'</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> flattening_lemma_i
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ops</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> set <span class=free>ψ</span>"</span></span> 
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> calculation
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> calculation
        <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def list_all_iff ListMem_iff 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_problem_sas_plus_def Let_def list_all_iff 
          ListMem_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span><span class=main>.</span> <span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span> <span class=main>∧</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=free>ψ</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan_sas_plus <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=var>?ψ'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> flattening_lemma_ii
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Ψ</span> <span class=var>?ψ'</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> is_serial_solution_for_problem_def list_all_iff ListMem_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Auxiliary lemmata on SAS+"</span></span>


<span class=keyword1><span class=command>context</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>― ‹ Relate the locale definition <span class=antiquoted><span class=raw_text><span class=operator>‹</span>range_of›</span></span> with its corresponding implementation for valid 
operators and given an effect <span class=antiquoted><span class=raw_text><span class=operator>‹</span>(v, a)›</span></span>. ›</span>
<span class=keyword1 id=SAS_Plus_Semantics-is_valid_operator_sas_plus_then_range_of_sas_plus_op_is_set_range_of_op><span class=command>lemma</span></span> is_valid_operator_sas_plus_then_range_of_sas_plus_op_is_set_range_of_op<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=free>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>the <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span><span class=keyword1><span class=command>..</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> A
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms 
        <span class=keyword1><span class=command>unfolding</span></span> range_of_def
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>unfolding</span></span> range_of'_def option.case_eq_if
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> B
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms 
        <span class=keyword1><span class=command>unfolding</span></span> range_of_def
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>unfolding</span></span> range_of'_def option.case_eq_if
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>  
<span class=keyword1><span class=command>qed</span></span> 

<span class=keyword1 id=SAS_Plus_Semantics-set_the_range_of_is_range_of_sas_plus_if><span class=command>lemma</span></span> set_the_range_of_is_range_of_sas_plus_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Ψ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'v</span><span class=main>,</span> <span class=tfree>'d</span><span class=main>)</span> sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>the <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set<span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> variables_of_def<span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation is_valid_problem_sas_plus_then<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sas_plus_problem.range_of <span class=free>Ψ</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sas_plus_problem.range_of <span class=free>Ψ</span> <span class=free>v</span> <span class=main>≠</span> Some <span class=main>[]</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span> range_of_not_empty
    <span class=keyword1><span class=command>unfolding</span></span> range_of_def 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> option.case_eq_if range_of'_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_Semantics-sublocale_sas_plus_finite_domain_representation_ii><span class=command>lemma</span></span> sublocale_sas_plus_finite_domain_representation_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Ψ</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'v</span><span class=main>,</span><span class=tfree>'d</span><span class=main>)</span> sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=SAS_Plus_STRIPS><div class=head><h1>Theory SAS_Plus_STRIPS</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> SAS_Plus_STRIPS
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=STRIPS_Semantics.html>STRIPS_Semantics</a>"</span> <span class=quoted>"<a href=SAS_Plus_Semantics.html>SAS_Plus_Semantics</a>"</span> 
    <span class=quoted>"<a href=Map_Supplement.html>Map_Supplement</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"SAS+/STRIPS Equivalence"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ The following part is concerned with showing the equivalent expressiveness of SAS+ and
STRIPS as discussed in \autoref{sub:equivalence-sas-plus-strips}. ›</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Translation of SAS+ Problems to STRIPS Problems"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>possible_assignments_for</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem <span class=main>⇒</span> <span class=tfree>'variable</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> list"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>possible_assignments_for</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>≡</span> <span class=main>[</span><span class=main>(</span><span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> a <span class=main>←</span> the <span class=main>(</span>range_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>all_possible_assignments_for</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>all_possible_assignments_for</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> 
    <span class=main>≡</span> concat <span class=main>[</span>possible_assignments_for <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=bound>v</span><span class=main>.</span> v <span class=main>←</span> variables_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>]</span>"</span></span> 

<span class=keyword1><span class=command>definition</span></span> <span class=entity>state_to_strips_state</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> assignment strips_state"</span></span> 
  <span class=main>(</span><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>state_to_strips_state</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> 
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>defined</span> <span class=main>=</span> filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>(</span>variables_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span> <span class=keyword1>in</span>
      map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> the <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> 
        <span class=main>(</span>concat <span class=main>[</span>possible_assignments_for <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=bound>v</span><span class=main>.</span> v <span class=main>←</span> <span class=bound>defined</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>sasp_op_to_strips</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> assignment strips_operator"</span></span> 
  <span class=main>(</span><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>sasp_op_to_strips</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>pre</span> <span class=main>=</span> precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span>
      <span class=main>;</span> <span class=bound>add</span> <span class=main>=</span> effect_of <span class=free><span class=bound><span class=entity>op</span></span></span>
      <span class=main>;</span> <span class=bound>delete</span> <span class=main>=</span> <span class=main>[</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>v<span class=main>,</span> a<span class=main>)</span> <span class=main>←</span> effect_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>,</span> a' <span class=main>←</span> filter <span class=main>(</span><span class=main>(≠)</span> <span class=bound>a</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>range_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>]</span>
    <span class=keyword1>in</span> STRIPS_Representation.operator_for <span class=bound>pre</span> <span class=bound>add</span> <span class=bound>delete</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>sas_plus_problem_to_strips_problem</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> assignment strips_problem"</span></span> 
  <span class=main>(</span><span class=quoted>"<span class=keyword1>φ</span> _ "</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>sas_plus_problem_to_strips_problem</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span> 
      <span class=bound>vs</span> <span class=main>=</span> <span class=main>[</span><span class=bound>as</span><span class=main>.</span> v <span class=main>←</span> variables_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>,</span> as <span class=main>←</span> <span class=main>(</span>possible_assignments_for <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span> <span class=bound>v</span><span class=main>]</span>
      <span class=main>;</span> <span class=bound>ops</span> <span class=main>=</span> map <span class=main>(</span>sasp_op_to_strips <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span> <span class=main>(</span>operators_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span>
      <span class=main>;</span> <span class=bound>I</span> <span class=main>=</span> state_to_strips_state <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=main>(</span>initial_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span>
      <span class=main>;</span> <span class=bound>G</span> <span class=main>=</span> state_to_strips_state <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=main>(</span>goal_of <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span>
    <span class=keyword1>in</span> STRIPS_Representation.problem_for <span class=bound>vs</span> <span class=bound>ops</span> <span class=bound>I</span> <span class=bound>G</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>sas_plus_parallel_plan_to_strips_parallel_plan</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_parallel_plan
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> strips_parallel_plan"</span></span> 
  <span class=main>(</span><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>sas_plus_parallel_plan_to_strips_parallel_plan</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>ψ</span></span></span>
    <span class=main>≡</span> <span class=main>[</span><span class=main>[</span>sasp_op_to_strips <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ops</span><span class=main>]</span><span class=main>.</span> ops <span class=main>←</span> <span class=free><span class=bound><span class=entity>ψ</span></span></span><span class=main>]</span>"</span></span>

<span class=comment1>(* TODO first argument should be ('variable, 'domain) strips_problem *)</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>strips_state_to_state</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> assignment strips_state
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span> 
  <span class=main>(</span><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>strips_state_to_state</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> 
    <span class=main>≡</span> map_of <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span> <span class=main>(</span>all_possible_assignments_for <span class=free><span class=bound><span class=entity>Ψ</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=comment1>(* TODO remove problem argument *)</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>strips_op_to_sasp</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> strips_operator
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_operator"</span></span>
  <span class=main>(</span><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>strips_op_to_sasp</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> 
    <span class=main>≡</span> <span class=keyword1>let</span> 
        <span class=bound>precondition</span> <span class=main>=</span> strips_operator.precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span>
        <span class=main>;</span> <span class=bound>effect</span> <span class=main>=</span> strips_operator.add_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span> 
      <span class=keyword1>in</span> <span class=main>⦇</span> precondition_of <span class=main>=</span> <span class=bound>precondition</span><span class=main>,</span> effect_of <span class=main>=</span> <span class=bound>effect</span> <span class=main>⦈</span>"</span></span> 

<span class=comment1>(* TODO ‹strips_parallel_plan_to_sas_plus_parallel_plan ↝ φ_P¯› and 
‹strips_op_to_sasp ↝ φ_O¯› *)</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>strips_parallel_plan_to_sas_plus_parallel_plan</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> strips_parallel_plan
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_parallel_plan"</span></span> 
  <span class=main>(</span><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>strips_parallel_plan_to_sas_plus_parallel_plan</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>π</span></span></span>
    <span class=main>≡</span> <span class=main>[</span><span class=main>[</span>strips_op_to_sasp <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ops</span><span class=main>]</span><span class=main>.</span> ops <span class=main>←</span> <span class=free><span class=bound><span class=entity>π</span></span></span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ To set up the equivalence proof context, we declare a common locale 
\isaname{sas_plus_strips_equivalence} for both the STRIPS and SAS+ formalisms and make it a 
sublocale of both locale \isaname{strips} as well as \isaname{sas_plus}.
The declaration itself is omitted for brevity since it basically just joins locales 
\isaname{sas_plus} and \isaname{strips} while renaming the locale parameter to avoid name clashes.
The sublocale proofs are shown below.
\footnote{We append a suffix identifying the respective formalism to the the parameter names 
passed to the parameter names in the locale. This is necessary to avoid ambiguous names in the 
sublocale declarations. For example, without addition of suffixes the type for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>initial_of›</span></span></span></span> is 
ambiguous and will therefore not be bound to either <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>strips_problem.initial_of›</span></span></span></span> or 
<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>sas_plus_problem.initial_of›</span></span></span></span>. 
Isabelle in fact considers it to be a a free variable in this case. We also qualify the parent 
locales in the sublocale declarations by adding \texttt{strips:} and \texttt{sas\_plus:} before 
the respective parent locale identifiers. } ›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>range_of_strips</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>≡</span> <span class=main>{</span> True<span class=main>,</span> False <span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>context</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>― ‹ Set-up simp rules. ›</span>
<span class=keyword1><span class=command>lemma</span></span><span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> 
      <span class=bound>vs</span> <span class=main>=</span> <span class=main>[</span><span class=bound>as</span><span class=main>.</span> v <span class=main>←</span> variables_of <span class=free>Ψ</span><span class=main>,</span> as <span class=main>←</span> <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span><span class=main>)</span> <span class=bound>v</span><span class=main>]</span>
      <span class=main>;</span> <span class=bound>ops</span> <span class=main>=</span> map <span class=main>(</span>sasp_op_to_strips <span class=free>Ψ</span><span class=main>)</span> <span class=main>(</span>operators_of <span class=free>Ψ</span><span class=main>)</span>
      <span class=main>;</span> <span class=bound>I</span> <span class=main>=</span> state_to_strips_state <span class=free>Ψ</span> <span class=main>(</span>initial_of <span class=free>Ψ</span><span class=main>)</span>
      <span class=main>;</span> <span class=bound>G</span> <span class=main>=</span> state_to_strips_state <span class=free>Ψ</span> <span class=main>(</span>goal_of <span class=free>Ψ</span><span class=main>)</span>
    <span class=keyword1>in</span> STRIPS_Representation.problem_for <span class=bound>vs</span> <span class=bound>ops</span> <span class=bound>I</span> <span class=bound>G</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>defined</span> <span class=main>=</span> filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>(</span>variables_of <span class=free>Ψ</span><span class=main>)</span> <span class=keyword1>in</span>
      map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> 
        <span class=main>(</span>concat <span class=main>[</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> v <span class=main>←</span> <span class=bound>defined</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span>
      <span class=bound>pre</span> <span class=main>=</span> precondition_of <span class=free>op</span>
      <span class=main>;</span> <span class=bound>add</span> <span class=main>=</span> effect_of <span class=free>op</span>
      <span class=main>;</span> <span class=bound>delete</span> <span class=main>=</span> <span class=main>[</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>v<span class=main>,</span> a<span class=main>)</span> <span class=main>←</span> effect_of <span class=free>op</span><span class=main>,</span> a' <span class=main>←</span> filter <span class=main>(</span><span class=main>(≠)</span> <span class=bound>a</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>]</span>
    <span class=keyword1>in</span> STRIPS_Representation.operator_for <span class=bound>pre</span> <span class=bound>add</span> <span class=bound>delete</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=free>ψ</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ops</span><span class=main>]</span><span class=main>.</span> ops <span class=main>←</span> <span class=free>ψ</span><span class=main>]</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=free>s'</span><span class=main>)</span><span class=main>=</span> map_of <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=free>s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span> 
    <span class=main>(</span>all_possible_assignments_for <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> 
        <span class=bound>precondition</span> <span class=main>=</span> strips_operator.precondition_of <span class=free>op'</span>
        <span class=main>;</span> <span class=bound>effect</span> <span class=main>=</span> strips_operator.add_effects_of <span class=free>op'</span> 
      <span class=keyword1>in</span> <span class=main>⦇</span> precondition_of <span class=main>=</span> <span class=bound>precondition</span><span class=main>,</span> effect_of <span class=main>=</span> <span class=bound>effect</span> <span class=main>⦈</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ops</span><span class=main>]</span><span class=main>.</span> ops <span class=main>←</span> <span class=free>π</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span>
    SAS_Plus_STRIPS.sas_plus_problem_to_strips_problem_def
    sas_plus_problem_to_strips_problem_def
    SAS_Plus_STRIPS.state_to_strips_state_def
    state_to_strips_state_def
    SAS_Plus_STRIPS.sasp_op_to_strips_def
    sasp_op_to_strips_def
    SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def
    sas_plus_parallel_plan_to_strips_parallel_plan_def
    SAS_Plus_STRIPS.strips_state_to_state_def
    strips_state_to_state_def 
    SAS_Plus_STRIPS.strips_op_to_sasp_def
    strips_op_to_sasp_def 
    SAS_Plus_STRIPS.strips_parallel_plan_to_sas_plus_parallel_plan_def
    strips_parallel_plan_to_sas_plus_parallel_plan_def 
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> range_of'_def

<span class=keyword1 id=SAS_Plus_STRIPS-is_valid_problem_sas_plus_dom_sas_plus_problem_range_of><span class=command>lemma</span></span> is_valid_problem_sas_plus_dom_sas_plus_problem_range_of<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> is_valid_problem_sas_plus_then<span class=main>(</span>1<span class=main>)</span>
  <span class=keyword1><span class=command>unfolding</span></span> is_valid_problem_sas_plus_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> domIff list.pred_set<span class=main>)</span>

<span class=keyword1 id=SAS_Plus_STRIPS-possible_assignments_for_set_is><span class=command>lemma</span></span> possible_assignments_for_set_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> dom <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span> <span class=free>v</span><span class=main>)</span> 
    <span class=main>=</span> <span class=main>{</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span> <span class=main>}</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sas_plus_problem.range_of <span class=free>Ψ</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span>  <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> possible_assignments_for_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-all_possible_assignments_for_set_is><span class=command>lemma</span></span> all_possible_assignments_for_set_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> range_of <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>≠</span> None"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>all_possible_assignments_for <span class=free>Ψ</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>all_possible_assignments_for <span class=free>Ψ</span><span class=main>)</span> <span class=main>=</span> 
    <span class=main>(</span><span class=main>⋃</span><span class=main>(</span>set <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> all_possible_assignments_for_def set_concat
    <span class=keyword1><span class=command>using</span></span> set_map 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> set <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> image_comp set_map
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=comment1>(* TODO slow *)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> possible_assignments_for_set_is assms 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-state_to_strips_state_dom_is_i><span class=command>lemma</span></span> state_to_strips_state_dom_is_i<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>concat 
      <span class=main>[</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> v <span class=main>←</span> filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>(</span>variables_of <span class=free>Ψ</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?defined</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=main>[</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> v <span class=main>←</span> <span class=var>?defined</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=var>?defined</span> <span class=main>=</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> set_filter
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>set <span class=main>`</span> set <span class=main>(</span>map <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span><span class=main>)</span> <span class=var>?defined</span> <span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> set_concat image_Union
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>set <span class=main>`</span> <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?defined</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> set_map
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?defined</span><span class=main>.</span> set <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>.</span>
    set <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nb 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> possible_assignments_for_set_is 
      is_valid_problem_sas_plus_dom_sas_plus_problem_range_of assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-state_to_strips_state_dom_is><span class=command>lemma</span></span> state_to_strips_state_dom_is<span class=main>:</span>
  <span class=comment1>― ‹ NOTE A transformed state is defined on all possible assignments for all variables defined 
in the original state. ›</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> 
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=main>[</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> v <span class=main>←</span> filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_dom_sas_plus_problem_range_of assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>`</span> set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=var>?l</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_def 
      SAS_Plus_STRIPS.state_to_strips_state_def 
    <span class=keyword1><span class=command>using</span></span> dom_map_of_conv_image_fst<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=var>?l</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> fst <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?l</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> set_map
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> fst  <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?l</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>fst</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span><span class=main>)</span>"</span></span><span class=main>]</span> comp_apply<span class=main>[</span><span class=operator>of</span> 
        <span class=quoted>fst</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>,</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span><span class=main>)</span>"</span></span><span class=main>]</span> prod.case_distrib
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_dom_is_i<span class=main>[</span><span class=operator>OF</span> nb<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> state_to_strips_state_dom_element_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>
    <span class=main>∧</span> <span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None
    <span class=main>∧</span> <span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span> 
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> 
        <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None <span class=main>∧</span> <span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>next</span></span> 
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None <span class=main>∧</span> <span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> a_in_range_of_v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> a_in_range_of_v
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-state_to_strips_state_range_is><span class=command>lemma</span></span> state_to_strips_state_range_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?defined</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=main>[</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> v <span class=main>←</span> <span class=var>?defined</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> s_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> a_in_range_of_v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> is_valid_problem_sas_plus_then<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_problem_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_dom_is_i<span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> s_of_v_is_not_None a_in_range_of_v v_in_set_vs
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> map_of_from_function_graph_is_some_if<span class=main>[</span><span class=operator>of</span> 
          <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span>"</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.state_to_strips_state_def
        state_to_strips_state_def Let_def case_prod_beta'
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>


<span class=comment1>― ‹ Show that a STRIPS state corresponding to a SAS+ state via transformation is consistent
w.r.t. to the variable subset with same left component (i.e. the original SAS+ variable). This is
the consistency notion corresponding to SAS+ consistency: i.e. if no two assignments with different
values for the same variable exist in the SAS+ state, then assigning the corresponding assignment
both to <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"True"</span><span class=antiquote>}</span></span> is impossible. Vice versa, if both are assigned to <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"True"</span><span class=antiquote>}</span></span> then the
assignment variables must be the same SAS+ variable/SAS+ value pair. ›</span>
<span class=keyword1 id=SAS_Plus_STRIPS-state_to_strips_state_effect_consistent><span class=command>lemma</span></span> state_to_strips_state_effect_consistent<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a'</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
    <span class=keyword2><span class=keyword>and</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a'</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a'</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>s</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>s</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>a'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=SAS_Plus_STRIPS-sasp_op_to_strips_set_delete_effects_is><span class=command>lemma</span></span> sasp_op_to_strips_set_delete_effects_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=free>op</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>strips_operator.delete_effects_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span> 
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?effect</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"effect_of <span class=free>op</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?delete</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>v<span class=main>,</span> a<span class=main>)</span> <span class=main>←</span> <span class=var>?effect</span><span class=main>,</span> a' <span class=main>←</span> filter <span class=main>(</span><span class=main>(≠)</span> <span class=bound>a</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?effect</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms 
      <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then_range_of_sas_plus_op_is_set_range_of_op
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>filter <span class=main>(</span><span class=main>(≠)</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=bound><span class=bound>a'</span></span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=skolem>a</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> set_filter 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?delete</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>set <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> map <span class=main>(</span>Pair <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>filter <span class=main>(</span><span class=main>(≠)</span> <span class=bound>a</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
      <span class=main>`</span> <span class=main>(</span>set <span class=var>?effect</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> set_concat
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> Pair <span class=bound>v</span> <span class=main>`</span> set <span class=main>(</span>filter <span class=main>(</span><span class=main>(≠)</span> <span class=bound>a</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
      <span class=main>`</span> <span class=main>(</span>set <span class=var>?effect</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>set</span><span class=main>]</span> set_map 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?effect</span><span class=main>.</span> Pair <span class=bound>v</span> <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>a'</span></span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?delete</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?effect</span><span class=main>.</span>
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
      sasp_op_to_strips_def Let_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_problem_to_strips_problem_variable_set_is><span class=command>lemma</span></span> sas_plus_problem_to_strips_problem_variable_set_is<span class=main>:</span>
  <span class=comment1>― ‹ The variable set of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>Π›</span></span> is the set of all possible 
assignments that are possible using the variables of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒱›</span></span> and the corresponding domains. ›</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>strips_problem.variables_of <span class=var>?Π</span><span class=main>)</span> 
      <span class=main>=</span> set <span class=main>[</span><span class=bound>as</span><span class=main>.</span> v <span class=main>←</span> <span class=var>?vs</span><span class=main>,</span> as <span class=main>←</span> possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> sas_plus_problem_to_strips_problem_def 
        SAS_Plus_STRIPS.sas_plus_problem_to_strips_problem_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span>set <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> set_concat
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=main>(</span>set <span class=main>∘</span> possible_assignments_for <span class=free>Ψ</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>set</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> <span class=quoted><span class=quoted>"set <span class=var>?vs</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>strips_problem.variables_of <span class=var>?Π</span><span class=main>)</span> 
      <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> set <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> o_apply
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_dom_sas_plus_problem_range_of assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> possible_assignments_for_set_is
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> sas_plus_problem_to_strips_problem_variable_set_element_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>  <span class=main>⟷</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> sas_plus_problem_to_strips_problem_variable_set_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>

<span class=keyword1 id=SAS_Plus_STRIPS-sasp_op_to_strips_effect_consistent><span class=command>lemma</span></span> sasp_op_to_strips_effect_consistent<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op'</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=free>op'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def 
      SAS_Plus_Representation.is_valid_operator_sas_plus_def list_all_iff ListMem_iff Let_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> v_a_in_add_effects_of_op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> 
          <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a''</span><span class=main>)</span> 
            <span class=main>|</span> <span class=bound>a''</span><span class=main>.</span> <span class=bound>a''</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a''</span> <span class=main>≠</span> <span class=bound>a'</span> <span class=main>}</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> calculation sasp_op_to_strips_set_delete_effects_is 
            assms 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=skolem>a'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>3<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def
            SAS_Plus_STRIPS.sasp_op_to_strips_def
            Let_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> v_a_in_add_effects_of_op calculation<span class=main>(</span>5<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def 
            SAS_Plus_STRIPS.sasp_op_to_strips_def
            Let_def 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span> 
          <span class=keyword1><span class=command>using</span></span> nb 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> v_a_in_delete_effects_of_op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> 
          <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a''</span><span class=main>)</span> 
            <span class=main>|</span> <span class=bound>a''</span><span class=main>.</span> <span class=bound>a''</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a''</span> <span class=main>≠</span> <span class=bound>a'</span> <span class=main>}</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_set_delete_effects_is  
            nb assms<span class=main>(</span>1<span class=main>,</span> 3<span class=main>)</span> v_a_in_delete_effects_of_op
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=skolem>a'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>4<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def 
            SAS_Plus_STRIPS.sasp_op_to_strips_def
            Let_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=free>op'</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>2<span class=main>,</span> 6<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def 
            SAS_Plus_STRIPS.sasp_op_to_strips_def Let_def 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span> 
          <span class=keyword1><span class=command>using</span></span> nb 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span> 
      <span class=main>⟶</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span> 
      <span class=main>⟶</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-is_valid_problem_sas_plus_then_strips_transformation_too_iii><span class=command>lemma</span></span> is_valid_problem_sas_plus_then_strips_transformation_too_iii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>is_valid_operator_strips <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>strips_problem.operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=var>?Π</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=var>?Π</span><span class=main>)</span>"</span></span> 
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span> 
      <span class=keyword2><span class=keyword>where</span></span> op_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> op'_in_operators<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sas_plus_problem_to_strips_problem_def
        sas_plus_problem_to_strips_problem_def 
        sasp_op_to_strips_def 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> is_valid_op'<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sublocale_sas_plus_finite_domain_representation_ii<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
      <span class=comment1>― ‹ TODO slow. ›</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>sas_plus_operator.precondition_of <span class=skolem>op'</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> op_is
        <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def 
          sasp_op_to_strips_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> is_valid_op' calculation
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span>  <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> is_valid_op' calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>2<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> sas_plus_problem_to_strips_problem_variable_set_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op'</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> op_is
        <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
          sasp_op_to_strips_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then is_valid_op'
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> sas_plus_problem_to_strips_problem_variable_set_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a'</span>
      <span class=keyword3><span class=command>assume</span></span> v_a'_in_delete_effects<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>strips_operator.delete_effects_of <span class=skolem>op</span><span class=main>)</span> 
        <span class=main>=</span>  <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op'</span><span class=main>)</span><span class=main>.</span> 
          <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_set_delete_effects_is<span class=main>[</span><span class=operator>OF</span> is_valid_op'<span class=main>]</span>
          op_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=comment1>― ‹ TODO slow. ›</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> 
        <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op'</span><span class=main>)</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> a'_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound><span class=bound>a'</span></span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=skolem>a</span> <span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> op'_in_operators assms<span class=main>(</span>1<span class=main>)</span> 
          is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then calculation<span class=main>(</span>1<span class=main>,</span> 3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> a'_in 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> sas_plus_problem_to_strips_problem_variable_set_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>strips_operator.precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=var>?vs</span>
      <span class=main>∧</span> set <span class=main>(</span>strips_operator.add_effects_of <span class=skolem>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=var>?vs</span>
      <span class=main>∧</span> set <span class=main>(</span>strips_operator.delete_effects_of <span class=skolem>op</span><span class=main>)</span> <span class=main>⊆</span> set <span class=var>?vs</span>
      <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>
      <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_effect_consistent<span class=main>[</span><span class=operator>OF</span> 
          op_is op'_in_operators is_valid_op'<span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_strips_def STRIPS_Representation.is_valid_operator_strips_def 
      list_all_iff ListMem_iff Let_def 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-is_valid_problem_sas_plus_then_strips_transformation_too_iv><span class=command>lemma</span></span> is_valid_problem_sas_plus_then_strips_transformation_too_iv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=bound>x</span> <span class=main>≠</span> None
    <span class=main>⟷</span> ListMem <span class=bound>x</span> <span class=main>(</span>strips_problem.variables_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"initial_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=var>?Π</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?I'</span> <span class=skolem>x</span> <span class=main>≠</span> None <span class=main>⟷</span> ListMem <span class=skolem>x</span> <span class=var>?vs'</span>"</span></span> 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> I'_of_x_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?I'</span> <span class=skolem>x</span> <span class=main>≠</span> None"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> dom <span class=var>?I'</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> x_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?I'</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>v</span></span> <span class=quoted><span class=skolem>a</span></span>  <span class=var><span class=quoted><span class=var>?I</span></span></span><span class=main>]</span> 
          <span class=keyword1><span class=command>unfolding</span></span> sas_plus_problem_to_strips_problem_def 
            SAS_Plus_STRIPS.sas_plus_problem_to_strips_problem_def 
            state_to_strips_state_def
            SAS_Plus_STRIPS.state_to_strips_state_def 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"ListMem <span class=skolem>x</span> <span class=var>?vs'</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> ListMem_iff
          <span class=keyword1><span class=command>using</span></span> sas_plus_problem_to_strips_problem_variable_set_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
            x_is
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span> 
        <span class=keyword3><span class=command>assume</span></span> list_mem_x_vs'<span class=main>:</span> <span class=quoted><span class=quoted>"ListMem <span class=skolem>x</span> <span class=var>?vs'</span>"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> x_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?vs'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> list_mem_x_vs'
          <span class=keyword1><span class=command>unfolding</span></span> ListMem_iff
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> sas_plus_problem_to_strips_problem_variable_set_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
          <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>3<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?I'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>v</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span><span class=main>]</span>
          <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sas_plus_problem_to_strips_problem_def 
            sas_plus_problem_to_strips_problem_def
            SAS_Plus_STRIPS.state_to_strips_state_def
            state_to_strips_state_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?I'</span> <span class=skolem>x</span> <span class=main>≠</span> None"</span></span>
          <span class=keyword1><span class=command>using</span></span> x_is 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-is_valid_problem_sas_plus_then_strips_transformation_too_v><span class=command>lemma</span></span> is_valid_problem_sas_plus_then_strips_transformation_too_v<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>x</span> <span class=main>≠</span> None
    <span class=main>⟶</span> ListMem <span class=bound>x</span> <span class=main>(</span>strips_problem.variables_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"goal_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.goal_of <span class=var>?Π</span>"</span></span> 
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?G</span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=skolem>x</span> <span class=main>≠</span> None"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?G'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> domIff calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=var><span class=quoted><span class=var>?G</span></span></span><span class=main>]</span> nb calculation<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> set <span class=var>?vs'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sas_plus_problem_to_strips_problem_variable_set_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> ListMem_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We now show that given <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span> is a valid SASPlus problem, then <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span> <span class=main><span class=main>≡</span></span> <span class=keyword1><span class=keyword1>φ</span></span> <span class=free><span class=free>Ψ</span></span>›</span></span></span></span> is a valid
STRIPS problem as well. 
The proof unfolds the definition of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹is_valid_problem_strips›</span></span></span></span> and then shows each of the conjuncts 
for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span>. These are:
\begin{itemize}
  \item <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span> has at least one variable;
  \item <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span> has at least one operator;
  \item all operators are valid STRIPS operators;
  \item <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=free><span class=free>Π</span></span><span class=main><span class=main>::</span></span><span class=tfree><span class=tfree>'a</span></span> strips_problem<span class=main><span class=main>)</span></span><span class=keyword1><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span></span>›</span></span></span></span> is defined for all variables in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=free><span class=free>Π</span></span><span class=main><span class=main>::</span></span><span class=tfree><span class=tfree>'a</span></span> strips_problem<span class=main><span class=main>)</span></span><span class=keyword1><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span></span>›</span></span></span></span>; and finally,
  \item if <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>Π</span></span><span class=main><span class=main>::</span></span><span class=tfree><span class=tfree>'a</span></span> strips_problem<span class=main><span class=main>)</span></span><span class=keyword1><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>x</span></span>›</span></span></span></span> is defined, then <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>x</span></span>›</span></span></span></span> is in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=free><span class=free>Π</span></span><span class=main><span class=main>::</span></span><span class=tfree><span class=tfree>'a</span></span> strips_problem<span class=main><span class=main>)</span></span><span class=keyword1><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span></span>›</span></span></span></span>.
\end{itemize} ›</span></span>

<span class=keyword1><span class=command>theorem</span></span>
  is_valid_problem_sas_plus_then_strips_transformation_too<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>is_valid_operator_strips <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>
   <span class=main>(</span>strips_problem.operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too_iii<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=bound>x</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>=</span>
    ListMem <span class=bound>x</span> <span class=main>(</span>strips_problem.variables_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too_iv<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>x</span> <span class=main>≠</span> None <span class=main>⟶</span>
    ListMem <span class=bound>x</span> <span class=main>(</span>strips_problem.variables_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too_v<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_def 
    <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Representation.is_valid_problem_strips_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span> 

<span class=keyword1 id=SAS_Plus_STRIPS-set_filter_all_possible_assignments_true_is><span class=command>lemma</span></span> set_filter_all_possible_assignments_true_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span> 
      <span class=main>(</span>all_possible_assignments_for <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span>  <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> Pair <span class=bound>v</span> <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>a</span></span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=var>?P</span> <span class=main>(</span>all_possible_assignments_for <span class=free>Ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> set <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span>filter <span class=var>?P</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span><span class=main>)</span> <span class=var>?vs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> all_possible_assignments_for_def
      filter_concat<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=quoted><span class=quoted>"map <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span><span class=main>)</span> <span class=main>(</span>sas_plus_problem.variables_of <span class=free>Ψ</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> set <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> filter <span class=var>?P</span> <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> map_map comp_apply 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> set <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> map <span class=main>(</span>Pair <span class=bound>v</span><span class=main>)</span> 
    <span class=main>(</span>filter <span class=main>(</span><span class=var>?P</span> <span class=main>∘</span> Pair <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> possible_assignments_for_def filter_map
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> set <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> map <span class=main>(</span>Pair <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>a</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span> 
    <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> comp_apply
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>set <span class=main>`</span> <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> map <span class=main>(</span>Pair <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>a</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span> 
    <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> set_concat set_map<span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> Pair <span class=bound>v</span> <span class=main>`</span> set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>a</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span> 
    <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>set</span><span class=main>]</span> comp_apply set_map<span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> Pair <span class=bound>v</span> 
    <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>a</span></span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> set_filter<span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> set_the_range_of_is_range_of_sas_plus_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-strips_state_to_state_dom_is><span class=command>lemma</span></span> strips_state_to_state_dom_is<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> 
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> 
      <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=var>?P</span> <span class=main>(</span>all_possible_assignments_for <span class=free>Ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=var>?l</span> <span class=main>=</span> fst <span class=main>`</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> Pair <span class=bound>v</span> 
      <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>a</span></span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> set_filter_all_possible_assignments_true_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> fst <span class=main>`</span> Pair <span class=bound>v</span> 
      <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>a</span></span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>}</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> <span class=main>(</span><span class=main>λ</span><span class=bound>a</span><span class=main>.</span> fst <span class=main>(</span>Pair <span class=bound>v</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> 
      <span class=main>{</span> <span class=bound><span class=bound>a</span></span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>}</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>fst</span><span class=main>]</span> comp_apply
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> 
      <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>}</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> setcompr_eq_image fst_conv 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_state_to_state_def 
      strips_state_to_state_def dom_map_of_conv_image_fst
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-strips_state_to_state_range_is><span class=command>lemma</span></span> strips_state_to_state_range_is<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=free>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=free>s'</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> dom <span class=free>s'</span><span class=main>.</span> <span class=free>s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>∧</span> <span class=free>s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>=</span> Some True 
      <span class=main>⟶</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=free>s'</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span> <span class=main>⟷</span> the <span class=main>(</span><span class=free>s'</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=free>s'</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?as</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"all_possible_assignments_for <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=free>s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span> <span class=var>?as</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> s_of_v_is_Some_a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> s_of_v_is_Some_a 
          <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_state_to_state_def 
            strips_state_to_state_def 
          <span class=keyword1><span class=command>using</span></span> map_of_SomeD
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> all_possible_assignments_for_set_is set_filter
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>s'</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span> 
      <span class=keyword3><span class=command>assume</span></span> the_of_s'_of_v_a_is<span class=main>:</span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>s'</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> s'_of_v_a_is_Some_true<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> domIff 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=comment1>― ‹ TODO slow. ›</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>v'</span> <span class=skolem>a</span> <span class=skolem>a'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> <span class=skolem>v'</span> <span class=main>∨</span> <span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a'</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>5<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> sas_plus_problem.range_of <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>≠</span> None"</span></span>  
          <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>1<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
            range_of_not_empty 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> Set.filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=free>s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span> 
          <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span>  <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> all_possible_assignments_for_set_is calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span> s'_of_v_a_is_Some_true
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span>  
        <span class=keyword1><span class=command>using</span></span> map_of_constant_assignments_defined_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_state_to_state_def
          strips_state_to_state_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE A technical lemma which characterizes the return values for possible assignments 
<span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"(v, a)"</span><span class=antiquote>}</span></span> when used as variables on a state <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"s"</span><span class=antiquote>}</span></span> which was transformed from. ›</span> 
<span class=keyword1 id=SAS_Plus_STRIPS-strips_state_to_state_inverse_is_i><span class=command>lemma</span></span> strips_state_to_state_inverse_is_i<span class=main>:</span>
<span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
<span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
   <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.variables_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>=</span> <span class=bound>a</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=main>(</span>map <span class=main>(</span>possible_assignments_for <span class=free>Ψ</span><span class=main>)</span> <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span>
        <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>,</span> 4<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span>sas_plus_problem.range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_dom_sas_plus_problem_range_of<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_dom_is_i<span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> calculation
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=comment1>― ‹ TODO slow.›</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.state_to_strips_state_def
      state_to_strips_state_def 
    <span class=keyword1><span class=command>using</span></span> map_of_from_function_graph_is_some_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span>"</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>unfolding</span></span> split_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE Show that the transformed strips state is consistent for pairs of assignments 
<span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"(v, a)"</span><span class=antiquote>}</span></span> and <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"(v, a')"</span><span class=antiquote>}</span></span> in the same variable domain. ›</span>
<span class=comment1>(* TODO make private. *)</span>
<span class=keyword1><span class=command>corollary</span></span> strips_state_to_state_inverse_is_ii<span class=main>:</span>
<span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span>  
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a'</span> <span class=main>≠</span> <span class=free>a</span>"</span></span>
<span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a'</span><span class=main>)</span> <span class=main>=</span> Some False"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>s</span> <span class=free>v</span><span class=main>)</span> <span class=main>≠</span> <span class=free>a'</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>,</span> 6<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> strips_state_to_state_inverse_is_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> _ assms<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE Follows from the corollary above by contraposition. ›</span>
<span class=comment1>(* TODO make private. *)</span>
<span class=keyword1><span class=command>corollary</span></span> strips_state_to_state_inverse_is_iii<span class=main>:</span>
<span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a'</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
<span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=free>a'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> strips_state_to_state_inverse_is_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>4<span class=main>,</span> 5<span class=main>,</span> 6<span class=main>,</span> 7<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private. *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-strips_state_to_state_inverse_is_iv><span class=command>lemma</span></span> strips_state_to_state_inverse_is_iv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>s</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=free>v</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s''</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=var>?s'</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?as</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=var>?P</span> <span class=main>(</span>all_possible_assignments_for <span class=free>Ψ</span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?As</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Set.filter <span class=var>?P</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> range_of <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword1><span class=command>using</span></span> sublocale_sas_plus_finite_domain_representation_ii<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
        range_of_not_empty
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"set <span class=var>?as</span> <span class=main>=</span> <span class=var>?As</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> set_filter 
      <span class=keyword1><span class=command>using</span></span> all_possible_assignments_for_set_is
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>v'</span> <span class=skolem>a</span> <span class=skolem>a'</span> 
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?as</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?as</span>"</span></span> 
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?As</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?As</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> nb 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> v'_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> a_in_range_of_v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> a'_in_range_of_v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v'</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> s'_of_v_a_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> <span class=keyword2><span class=keyword>and</span></span> s'_of_v'_a'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span>  
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> s_of_v_is_Some_a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span>  
        <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
          state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> s'_of_v_a_is 
           <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> <span class=skolem>v'</span> <span class=main>∨</span> <span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a'</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=skolem>v</span> <span class=main>≠</span> <span class=skolem>v'</span> <span class=main>∨</span> <span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=skolem>v'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=skolem>a'</span>"</span></span> 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
            <span class=keyword1><span class=command>using</span></span> a'_in_range_of_v a_in_range_of_v assms<span class=main>(</span>1<span class=main>)</span> v'_in_set_vs s'_of_v'_a'_is 
              s'_of_v_a_is s_of_v_is_Some_a strips_state_to_state_inverse_is_iii
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
        <span class=keyword1><span class=command>using</span></span> strips_state_to_state_inverse_is_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span> _ assms<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span><span class=main>]</span> 
          assms<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=comment1>(* TODO slow *)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?as</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> all_possible_assignments_for_set_is assms<span class=main>(</span>3<span class=main>,</span> 5<span class=main>)</span> nb
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=var>?as</span> <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> map_of_constant_assignments_defined_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?as</span></span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>a</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=comment1>― ‹ TODO slow. ›</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_state_to_state_def
      strips_state_to_state_def all_possible_assignments_for_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO the constraints on the state @{text "s"} could be refactored into a definition of valid 
states for a problem description. *)</span>
<span class=comment1>(* TODO The proof is not very elegant. Should be simplified. *)</span>
<span class=comment1>― ‹ Show that that <span class=antiquoted><span class=raw_text><span class=operator>‹</span>φ<span class=hidden>⇩</span><sub>S</sub>¯ Ψ›</span></span> is the inverse of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>φ<span class=hidden>⇩</span><sub>S</sub> Ψ›</span></span>. The additional constraints 
<span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹dom <span class=free>s</span> <span class=main>=</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>›</span></span> and <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>s</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>›</span></span> are needed because the 
transformation functions only take into account variables and domains declared in the problem 
description. They also sufficiently characterize a state that was transformed from SAS+ to STRIPS. ›</span>
<span class=keyword1 id=SAS_Plus_STRIPS-strips_state_to_state_inverse_is><span class=command>lemma</span></span> strips_state_to_state_inverse_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>s</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>s</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s''</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=var>?s'</span>"</span></span>
  <span class=comment1>― ‹ NOTE Show the thesis by proving that <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"s"</span><span class=antiquote>}</span></span> and <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"?s'"</span><span class=antiquote>}</span></span> are mutual submaps. ›</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> v_in_dom_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=free>s</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> 
      <span class=keyword2><span class=keyword>where</span></span> the_s_v_is_a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> a_in_dom_v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span> v_in_dom_s
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s''</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> strips_state_to_state_inverse_is_iv<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> v_in_set_vs
        the_s_v_is_a a_in_dom_v 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?s''</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?s''</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> 
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
      <span class=keyword1><span class=command>using</span></span> strips_state_to_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?s''</span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>s</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=comment1>― ‹ TODO slow.›</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> map_le_antisym<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>s</span></span> <span class=var><span class=quoted><span class=var>?s''</span></span></span><span class=main>]</span> map_le_def
    <span class=keyword1><span class=command>unfolding</span></span> strips_state_to_state_def 
      state_to_strips_state_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ An important lemma which shows that the submap relation does not change if we transform the 
states on either side from SAS+ to STRIPS. 
% TODO what is this called generally? Predicate monotony?? ›</span>
<span class=keyword1 id=SAS_Plus_STRIPS-state_to_strips_state_map_le_iff><span class=command>lemma</span></span> state_to_strips_state_map_le_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>s</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>s</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>t</span> <span class=main>⟷</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>t</span>"</span></span> 
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> s_map_le_t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>t</span>"</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>1<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=free>s</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>t</span> <span class=skolem>v</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> s_map_le_t calculation<span class=main>(</span>6<span class=main>)</span> 
          <span class=keyword1><span class=command>unfolding</span></span> map_le_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>,</span> 7<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>2<span class=main>,</span> 4<span class=main>,</span> 8<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>t</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>9<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?t'</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> map_le_def 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> s'_map_le_t'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?t'</span>"</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> 
        <span class=keyword3><span class=command>assume</span></span> v_in_dom_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=free>s</span>"</span></span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> the_of_s_of_v_is_a<span class=main>:</span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> v_in_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> s_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> a_in_range_of_v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span> v_in_dom_s calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span>  
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
            calculation<span class=main>(</span>3<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> s'_map_le_t' calculation
          <span class=keyword1><span class=command>unfolding</span></span> map_le_def 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation 
          <span class=keyword1><span class=command>unfolding</span></span> domIff
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>t</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>,</span> 4<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>9<span class=main>,</span> 11<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>7<span class=main>,</span> 12<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>t</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>10<span class=main>,</span> 13<span class=main>)</span> <span class=keyword1><span class=command>try0</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=free>t</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
              calculation<span class=main>(</span>8<span class=main>)</span> 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>14<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>t</span> <span class=skolem>v</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>t</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> map_le_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ We also show that <span class=antiquoted><span class=raw_text><span class=operator>‹</span>φ<span class=hidden>⇩</span><sub>O</sub>¯ Π›</span></span> is the inverse of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>φ<span class=hidden>⇩</span><sub>O</sub> Ψ›</span></span>. Note that this proof is completely 
mechanical since both the precondition and effect lists are simply being copied when transforming 
from SAS+ to STRIPS and when transforming back from STRIPS to SAS+. ›</span>
<span class=comment1>(* TODO rename ‹sasp_op_to_strips_inverse_is› *)</span>
<span class=comment1>(* TODO prune assumptions (not required) *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_operator_inverse_is><span class=command>lemma</span></span> sas_plus_operator_inverse_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>op</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?op</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"precondition_of <span class=var>?op</span> <span class=main>=</span> precondition_of <span class=free>op</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_op_to_sasp_def
      strips_op_to_sasp_def
      SAS_Plus_STRIPS.sasp_op_to_strips_def
      sasp_op_to_strips_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"effect_of <span class=var>?op</span> <span class=main>=</span> effect_of <span class=free>op</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_op_to_sasp_def
      strips_op_to_sasp_def
      SAS_Plus_STRIPS.sasp_op_to_strips_def
      sasp_op_to_strips_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Note that we have to make the assumption that <span class=antiquoted><span class=raw_text><span class=operator>‹</span>op'›</span></span> is a member of the operator set of the 
induced STRIPS problem <span class=antiquoted><span class=raw_text><span class=operator>‹</span>φ Ψ›</span></span>. This implies that <span class=antiquoted><span class=raw_text><span class=operator>‹</span>op'›</span></span> was transformed from an 
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>op ∈ operators_of Ψ›</span></span>. If we don't make this assumption, then multiple STRIPS operators of the 
form  <span class=antiquoted><span class=raw_text><span class=operator>‹</span>⦇ precondition_of = [], add_effects_of = [], delete_effects_of = [(v, a), ...] ⦈›</span></span> correspond 
to one SAS+ operator (since the delete effects are being discarded in the transformation function). 
›</span>
<span class=keyword1 id=SAS_Plus_STRIPS-strips_operator_inverse_is><span class=command>lemma</span></span> strips_operator_inverse_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>op'</span>"</span></span> 
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span> <span class=main>=</span> <span class=skolem>op</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* 
  ▪ TODO Simplify | refactor proof. 
  ▪ TODO make private. *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_I><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_I<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=free>ops'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=free>ops'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=var>?s'</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?pre</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"precondition_of <span class=free>op</span>"</span></span> 
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span><span class=main>.</span> 
    <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span><span class=main>.</span> 
      <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>∧</span> <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>=</span> Some True
      <span class=main>⟶</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> state_to_strips_state_effect_consistent<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> calculation 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=skolem>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op''</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op''</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> calculation<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=skolem>op''</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>2<span class=main>,</span> 4<span class=main>)</span>  
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>3</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> v_a_in_precondition_of_op'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"strips_operator.precondition_of <span class=skolem>op'</span> <span class=main>=</span> precondition_of <span class=skolem>op</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_op_to_sasp_def
        strips_op_to_sasp_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=free>ops'</span><span class=main>.</span> <span class=skolem>op</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>)</span>
      <span class=main>∧</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.precondition_of <span class=bound>op'</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>4</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op'</span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> v_a_in_precondition_of_op'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.precondition_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> s'_of_v_a_is_Some_True<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_set
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> calculation<span class=main>(</span>1<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"strips_operator.precondition_of <span class=skolem>op'</span> <span class=main>=</span> precondition_of <span class=skolem>op</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span> 
        <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
          sasp_op_to_strips_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> v_a_in_precondition_of_op' calculation<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span> calculation<span class=main>(</span>4<span class=main>,</span> 5<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?s</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> strips_state_to_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=var><span class=quoted><span class=var>?s'</span></span></span><span class=main>]</span> 
          s'_of_v_a_is_Some_True calculation<span class=main>(</span>6<span class=main>,</span> 7<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> s'_of_v_a_is_Some_True domIff 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> strips_state_to_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ _ _ nb<span class=hidden>⇩</span><sub>1</sub><span class=main>]</span> 
          s'_of_v_a_is_Some_True 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>5</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=var>?pre</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"map_of <span class=var>?pre</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?pre</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> map_of_SomeD calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> nb<span class=hidden>⇩</span><sub>3</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=free>op</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?pre</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?pre</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>5<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=var>?pre</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> map_of_constant_assignments_defined_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?pre</span></span></span><span class=main>]</span> calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.precondition_of <span class=skolem>op'</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>4</sub><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>5</sub> calculation<span class=main>(</span>5<span class=main>,</span> 6<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=var>?pre</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?s</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> map_le_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-to_sas_plus_list_of_transformed_sas_plus_problem_operators_structure><span class=command>lemma</span></span> to_sas_plus_list_of_transformed_sas_plus_problem_operators_structure<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=free>ops'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=free>ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op''</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op''</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>=</span> <span class=skolem>op''</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>2<span class=main>,</span> 5<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ▪ TODO Prune premises (2nd premise and ‹are_all_operators_applicable s' ops'› can be removed?). 
   ▪ TODO make private. 
   ▪ TODO adjust nb indexes *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_II><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_II<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Ψ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>s</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> state"</span></span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=free>ops'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=main>(</span><span class=free>φ<span class=hidden>⇩</span><sub>s</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=free>ops'</span> 
      <span class=main>∧</span> STRIPS_Semantics.are_all_operator_effects_consistent <span class=free>ops'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=var>?s'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span><span class=main>.</span> 
    <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span><span class=main>.</span> 
      <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>∧</span> <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>=</span> Some True
      <span class=main>⟶</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> state_to_strips_state_effect_consistent<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.are_all_operator_effects_consistent_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>
    <span class=keyword3><span class=command>assume</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>1</sub>'_in_ops'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>1</sub>'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> is_valid_op<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>'_in_ops'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> is_valid_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span>
          <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span> 
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span> 
        <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>v'</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=skolem>v'</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=skolem>a'</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=comment1>― ‹ TODO slow. ›</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>  
          <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>1</sub>'_is op<span class=hidden>⇩</span><sub>2</sub>'_is calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
            sasp_op_to_strips_def 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>2</sub>'_is calculation<span class=main>(</span>2<span class=main>)</span> 
            <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
              sasp_op_to_strips_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then is_valid_op<span class=hidden>⇩</span><sub>2</sub> calculation<span class=main>(</span>3<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_set_delete_effects_is
            op<span class=hidden>⇩</span><sub>1</sub>'_is is_valid_op<span class=hidden>⇩</span><sub>1</sub> calculation<span class=main>(</span>3<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>,</span> 6<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>STRIPS_Semantics.are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span> 
          <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.are_operator_effects_consistent_def list_ex_iff 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>,</span> 7<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span> 
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> op<span class=hidden>⇩</span><sub>1</sub>'_in_ops' op<span class=hidden>⇩</span><sub>2</sub>'_in_ops'
          <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.are_all_operator_effects_consistent_def list_all_iff
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>3</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=keyword3><span class=command>assume</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in_operators_of_Ψ<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_operators_of_Ψ<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> to_sas_plus_list_of_transformed_sas_plus_problem_operators_structure<span class=main>[</span><span class=operator>OF</span> 
          assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> is_valid_operator_op<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> is_valid_operator_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> op<span class=hidden>⇩</span><sub>1</sub>_in_operators_of_Ψ op<span class=hidden>⇩</span><sub>2</sub>_in_operators_of_Ψ
        assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span></span> 
      <span class=keyword2><span class=keyword>where</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in_ops'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>1</sub>_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_ops'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> to_sas_plus_list_of_transformed_sas_plus_problem_operators_structure<span class=main>[</span><span class=operator>OF</span> 
          assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> op<span class=hidden>⇩</span><sub>1</sub>_in_ops op<span class=hidden>⇩</span><sub>2</sub>_in_ops
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>― ‹ TODO slow.›</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span>
          <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>1</sub>_is op<span class=hidden>⇩</span><sub>2</sub>_is 
      <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def
        sasp_op_to_strips_def 
        SAS_Plus_STRIPS.sasp_op_to_strips_def
        list_all_iff Let_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ A technical lemmas used in <span class=antiquoted><span class=raw_text><span class=operator>‹</span>sas_plus_equivalent_to_strips_i_a›</span></span> showing that 
the execution precondition is linear w.r.t. to STRIPS transformation to SAS+. 

The second premise states that the given STRIPS state corresponds to a consistent SAS+ state (i.e.
no two assignments of the same variable to different values exist). ›</span>
<span class=comment1>(* 
  ▪ TODO make private. 
  ▪ TODO decrement suffix *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_IV><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_IV<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=free>ops'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=free>ops'</span> 
      <span class=main>∧</span> STRIPS_Semantics.are_all_operator_effects_consistent <span class=free>ops'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span> <span class=main>∧</span>
    are_all_operator_effects_consistent <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=var>?Π</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=var>?s'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span><span class=main>.</span> 
    <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span><span class=main>.</span> 
      <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>∧</span> <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>=</span> Some True
      <span class=main>⟶</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> state_to_strips_state_effect_consistent<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=var>?s'</span> <span class=free>ops'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> map_of <span class=main>(</span>precondition_of <span class=bound>op</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?s</span><span class=main>)</span> <span class=var>?ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_I<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> calculation
      <span class=keyword1><span class=command>unfolding</span></span> list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> list_all <span class=main>(</span>are_operator_effects_consistent <span class=bound>op</span><span class=main>)</span> <span class=var>?ops</span><span class=main>)</span> <span class=var>?ops</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_II assms nb
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def is_valid_operator_sas_plus_def list_all_iff 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=var>?s</span> <span class=var>?ops</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def is_operator_applicable_in_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=var>?ops</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_II assms nb
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO:
  ▪ prune premises + make private. 
  ▪ decrement suffixes 
*)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_VI><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_VI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>s</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>s</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=free>ops'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=free>s</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span> <span class=main>∧</span>
      are_all_operator_effects_consistent <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span>  
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=free>ops'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>   
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op'</span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op''</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op''</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op''</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=skolem>op''</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>3<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span><span class=main>)</span> 
      <span class=main>∧</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span><span class=main>.</span> 
    <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span><span class=main>.</span> 
      <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True <span class=main>∧</span> <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>=</span> Some True
      <span class=main>⟶</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> state_to_strips_state_effect_consistent<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>5<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def 
        is_operator_applicable_in_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>3</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> op_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> op_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> is_valid_operator_op<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> preconditions_are_consistent<span class=main>:</span> 
      <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>5<span class=main>)</span> calculation<span class=main>(</span>3<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.precondition_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> v_a_in_precondition_of_op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> op_is calculation 
        <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_op_to_sasp_def
          strips_op_to_sasp_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> map_of_constant_assignments_defined_if<span class=main>[</span><span class=operator>OF</span> 
            preconditions_are_consistent calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> s_of_v_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub><span class=main>[</span><span class=operator>OF</span> op_in_ops<span class=main>]</span> calculation<span class=main>(</span>3<span class=main>)</span> 
        <span class=keyword1><span class=command>unfolding</span></span> map_le_def 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> is_valid_operator_op
          v_a_in_precondition_of_op 
        <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def 
          SAS_Plus_Representation.is_valid_operator_sas_plus_def Let_def list_all_iff ListMem_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> s_of_v_is 
        calculation 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=var>?s'</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> strips_state_to_state_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span><span class=main>]</span> s_of_v_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=comment1>― ‹ TODO slow. ›</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
        <span class=keyword1><span class=command>using</span></span> strips_state_to_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>2</sub> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.precondition_of <span class=skolem>op'</span><span class=main>)</span><span class=main>.</span> <span class=var>?s'</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def is_operator_applicable_in_def 
      STRIPS_Representation.is_operator_applicable_in_def list_all_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO Prune premises. *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_VII><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_VII<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>s</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>s</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=free>ops'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=free>s</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span> <span class=main>∧</span>
    are_all_operator_effects_consistent <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span>  
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operator_effects_consistent <span class=free>ops'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op'</span> 
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op''</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op''</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op''</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=skolem>op''</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>3<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=skolem>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>)</span>
      <span class=main>∧</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this  
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span>
        <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> is_valid_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>v'</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>a'</span></span> 
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>5<span class=main>,</span> 10<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
        sasp_op_to_strips_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=skolem>v'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>12<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=comment1>― ‹ The next proof block shows that <span class=antiquoted><span class=raw_text><span class=operator>‹</span>(v', a')›</span></span> is constructed from an effect <span class=antiquoted><span class=raw_text><span class=operator>‹</span>(v'', a'')›</span></span>
      s.t. <span class=antiquoted><span class=raw_text><span class=operator>‹</span>a' ≠ a''›</span></span>.  ›</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=comment1>(* TODO slow. *)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v''</span><span class=main>,</span> <span class=bound>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> 
        <span class=main>{</span> <span class=main>(</span><span class=bound>v''</span><span class=main>,</span> <span class=bound>a'''</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'''</span><span class=main>.</span> <span class=bound>a'''</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v''</span><span class=main>)</span> <span class=main>∧</span>  <span class=bound>a'''</span> <span class=main>≠</span> <span class=bound>a''</span> <span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_set_delete_effects_is 
          calculation<span class=main>(</span>8<span class=main>,</span> 11<span class=main>)</span> is_valid_op<span class=hidden>⇩</span><sub>2</sub> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v''</span></span> <span class=skolem><span class=skolem>a''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v''</span><span class=main>,</span> <span class=skolem>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=skolem>v''</span><span class=main>,</span> <span class=bound>a'''</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'''</span><span class=main>.</span> <span class=bound>a'''</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v''</span><span class=main>)</span> <span class=main>∧</span>  <span class=bound>a'''</span> <span class=main>≠</span> <span class=skolem>a''</span> <span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> calculation 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v''</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>≠</span> <span class=skolem>a''</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a''</span><span class=main>.</span> <span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=bound>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=skolem>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v'</span><span class=main>)</span> 
        <span class=main>∧</span> <span class=skolem>a'</span> <span class=main>≠</span> <span class=bound>a''</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>≠</span> <span class=skolem>a''</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>16<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> 
      <span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>a'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>13<span class=main>,</span> 14<span class=main>,</span> 15<span class=main>,</span> 17<span class=main>,</span> 19<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def list_all_iff
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>20<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_all_operator_effects_consistent <span class=var>?ops</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>
    <span class=keyword3><span class=command>assume</span></span> op<span class=hidden>⇩</span><sub>1</sub>'_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>'_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> set <span class=free>ops'</span>"</span></span> 
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>STRIPS_Semantics.are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> 
          <span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span>
          <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span> 
          <span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.are_operator_effects_consistent_def list_ex_iff
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> 
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>[</span><span class=operator>OF</span> op<span class=hidden>⇩</span><sub>1</sub>'_in_ops op<span class=hidden>⇩</span><sub>2</sub>'_in_ops<span class=main>]</span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>[</span><span class=operator>OF</span> op<span class=hidden>⇩</span><sub>2</sub>'_in_ops op<span class=hidden>⇩</span><sub>1</sub>'_in_ops<span class=main>]</span> assms<span class=main>(</span>5<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>argo</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.are_all_operator_effects_consistent_def 
      STRIPS_Semantics.are_operator_effects_consistent_def list_all_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_VIII><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_VIII<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>s</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>s</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=free>ops'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=free>s</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span> <span class=main>∧</span>
    are_all_operator_effects_consistent <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span>  
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=free>ops'</span> 
    <span class=main>∧</span> STRIPS_Semantics.are_all_operator_effects_consistent <span class=free>ops'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_VI sas_plus_equivalent_to_strips_i_a_VII assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=comment1>(* TODO refactor. *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_IX><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_IX<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dom <span class=free>s</span> <span class=main>⊆</span> <span class=free>V</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> <span class=free>V</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>execute_parallel_operator_sas_plus <span class=free>s</span> <span class=free>ops</span><span class=main>)</span> <span class=main>⊆</span> <span class=free>V</span>"</span></span>  
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> Nil 
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
        <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_sas_plus_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op</span> <span class=skolem>ops</span><span class=main>)</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
      <span class=comment1>― ‹ TODO Wrap IH instantiation in block. ›</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> <span class=free>V</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span> <span class=main>⊆</span> <span class=free>V</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?s'</span> <span class=main>⊆</span> <span class=free>V</span>"</span></span> 
          <span class=keyword1><span class=command>unfolding</span></span> dom_map_add dom_map_of_conv_image_fst
          <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=skolem>ops</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> <span class=free>V</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>execute_parallel_operator_sas_plus <span class=var>?s'</span> <span class=skolem>ops</span><span class=main>)</span> <span class=main>⊆</span> <span class=free>V</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?s'</span></span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_sas_plus_cons<span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE Show that the domain value constraint on states is monotonous w.r.t. to valid operator 
execution. I.e. if a parallel operator is executed on a state for which the domain value constraint 
holds, the domain value constraint will also hold on the resultant state. ›</span>
<span class=comment1>(* TODO refactor. 
  TODO Rewrite lemma without domain function, i.e. ‹set (the (D v)) ↝ D› *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_X><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_X<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dom <span class=free>s</span> <span class=main>⊆</span> <span class=free>V</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>V</span> <span class=main>⊆</span> dom <span class=free>D</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>s</span><span class=main>.</span> the <span class=main>(</span><span class=free>s</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=free>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> <span class=free>V</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=free>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span>execute_parallel_operator_sas_plus <span class=free>s</span> <span class=free>ops</span><span class=main>)</span><span class=main>.</span> 
    the <span class=main>(</span>execute_parallel_operator_sas_plus <span class=free>s</span> <span class=free>ops</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=free>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>  
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> Nil 
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
        <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_sas_plus_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op</span> <span class=skolem>ops</span><span class=main>)</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> <span class=free>V</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>4<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span> <span class=main>⊆</span> <span class=free>V</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> calculation
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?s'</span> <span class=main>⊆</span> <span class=free>V</span>"</span></span> 
            <span class=keyword1><span class=command>unfolding</span></span> dom_map_add dom_map_of_conv_image_fst
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
          <span class=keyword3><span class=command>assume</span></span> v_in_dom_s'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=var>?s'</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=free>D</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> True
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span>map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span>"</span></span>
                <span class=keyword1><span class=command>unfolding</span></span> map_add_dom_app_simps<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> True<span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span> 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> map_of_SomeD calculation<span class=main>(</span>3<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=free>D</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>4<span class=main>)</span> calculation<span class=main>(</span>4<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> False
              <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>unfolding</span></span> map_add_dom_app_simps<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> False<span class=main>]</span>
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>3<span class=main>)</span> v_in_dom_s'
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=skolem>ops</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> <span class=free>V</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=free>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>4<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=main>(</span>execute_parallel_operator_sas_plus <span class=var>?s'</span> <span class=skolem>ops</span><span class=main>)</span><span class=main>.</span>
          the <span class=main>(</span>execute_parallel_operator_sas_plus <span class=var>?s'</span> <span class=skolem>ops</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=free>D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> _ Cons.prems<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_sas_plus_cons
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-transfom_sas_plus_problem_to_strips_problem_operators_valid><span class=command>lemma</span></span> transfom_sas_plus_problem_to_strips_problem_operators_valid<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>op</span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=free>op</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>)</span>
      <span class=main>∧</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> 
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> that
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_XI><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_XI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span> 
    <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span><span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=var>?Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>                 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> op'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> op_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> is_valid_operator_op<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> transfom_sas_plus_problem_to_strips_problem_operators_valid<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>op</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> op'_is op_in_ops 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>{</span></span>

    <span class=comment1>(*have "fst ` set (effect_to_assignments op') ≡
fst ` ((λv. (v, True)) ` set (add_effects_of op') ∪ (λv. (v, False)) ` set (delete_effects_of op'))"
      
      by auto
    then*)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span> 
      <span class=main>=</span> set <span class=main>(</span>strips_operator.add_effects_of <span class=free>op'</span><span class=main>)</span> <span class=main>∪</span> set <span class=main>(</span>strips_operator.delete_effects_of <span class=free>op'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> dom_map_of_conv_image_fst
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=comment1>― ‹ TODO slow.›</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span> <span class=main>∪</span> set <span class=main>(</span>strips_operator.delete_effects_of <span class=free>op'</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> op'_is 
      <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
        sasp_op_to_strips_def 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>― ‹ TODO slow.›</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>
      <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_set_delete_effects_is<span class=main>[</span><span class=operator>OF</span> 
          is_valid_operator_op<span class=main>]</span> op'_is
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>3</sub><span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=var>?t</span> <span class=main>=</span> dom <span class=var>?s'</span> <span class=main>∪</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>
    <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> nb<span class=hidden>⇩</span><sub>2</sub> dom_map_add
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>4</sub><span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
    <span class=main>=</span> dom <span class=free>s</span> <span class=main>∪</span> fst <span class=main>`</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> dom_map_add dom_map_of_conv_image_fst nb<span class=hidden>⇩</span><sub>1</sub>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?u</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?t'</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=var>?u</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>5</sub> <span class=main>=</span> this
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>6</sub><span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> op'_is 
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
      sasp_op_to_strips_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>7</sub><span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_set_delete_effects_is<span class=main>[</span><span class=operator>OF</span> 
        is_valid_operator_op<span class=main>]</span> op'_is
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Add</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Delete</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>have</span></span> dom_add<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?Add</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> dom_map_of_conv_image_fst set_map image_comp comp_apply 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>6</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>have</span></span> dom_delete<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?Delete</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> dom_map_of_conv_image_fst set_map image_comp comp_apply 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>7</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span> 
        <span class=keyword3><span class=command>assume</span></span> v_a_in_dom_add<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span> 
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Delete</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Add</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> dom_add dom_delete v_a_in_dom_add
              <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span><span class=main><span class=keyword3>+</span></span>   
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Add</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=skolem>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>6<span class=main>)</span> is_valid_operator_op
                calculation<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"disjnt <span class=main>(</span>dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
        <span class=main>(</span>dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> disjnt_def Int_def
        <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>7</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?Add</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?Delete</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"disjnt <span class=main>(</span>dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
        <span class=main>(</span>dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> dom_add dom_delete
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>8</sub> <span class=main>=</span> this
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Add</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Delete</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
    <span class=comment1>― ‹ TODO slow.›</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Add</span><span class=main>.</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Delete</span><span class=main>.</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some False"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Add</span>"</span></span> 
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> effect_to_assignments_simp
            <span class=keyword1><span class=command>using</span></span>  nb<span class=hidden>⇩</span><sub>6</sub> map_of_defined_if_constructed_from_list_of_constant_assignments<span class=main>[</span><span class=operator>of</span> 
                <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span>"</span></span> <span class=quoted>True</span> <span class=quoted><span class=quoted>"add_effects_of <span class=free>op'</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Delete</span>"</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>8</sub><span class=main>(</span>2<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> True<span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>8</sub>
            <span class=keyword1><span class=command>unfolding</span></span> disjnt_def 
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> 
            <span class=main>=</span> map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> effect_to_assignments_simp map_of_append 
            <span class=keyword1><span class=command>using</span></span> map_add_dom_app_simps<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span> 
          <span class=comment1>― ‹ TODO slow. ›</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some False"</span></span>
            <span class=keyword1><span class=command>using</span></span> map_of_defined_if_constructed_from_list_of_constant_assignments<span class=main>[</span>
                <span class=operator>of</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> False<span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op'</span><span class=main>)</span>"</span></span> <span class=quoted>False</span> <span class=quoted><span class=quoted>"delete_effects_of <span class=free>op'</span>"</span></span><span class=main>]</span>
               nb<span class=hidden>⇩</span><sub>7</sub>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Add</span><span class=main>.</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Delete</span><span class=main>.</span> map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> Some False"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>9</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then is_valid_operator_op
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> map_of_constant_assignments_defined_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"effect_of <span class=skolem>op</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>0</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> v_a_in_effect_of_op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> is_valid_operator_op is_valid_operator_sas_plus_then<span class=main>(</span>3<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=var>?Π</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too 
          assms<span class=main>(</span>1<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>thm</span></span> calculation<span class=main>(</span>1<span class=main>)</span> nb<span class=hidden>⇩</span><sub>6</sub> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op'</span><span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> is_valid_problem_strips_operator_variable_sets<span class=main>(</span>2<span class=main>)</span>
          calculation 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> v_a_in_effect_of_op nb<span class=hidden>⇩</span><sub>6</sub> calculation<span class=main>(</span>2<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> sas_plus_problem_to_strips_problem_variable_set_element_iff<span class=main>[</span><span class=operator>OF</span> 
            assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>  
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> 
          <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> dom_map_of_conv_image_fst 
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> map_add_dom_app_simps<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>1</sub>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>0</sub> calculation<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>1</sub> calculation<span class=main>(</span>1<span class=main>,</span> 4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span>   
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span>  <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> dom_map_of_conv_image_fst 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>)</span> is_valid_operator_sas_plus_then<span class=main>(</span>3<span class=main>)</span> is_valid_operator_op
      <span class=keyword1><span class=command>unfolding</span></span> dom_map_of_conv_image_fst is_valid_operator_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>≠</span> <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> map_add_dom_app_simps<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>1</sub>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>0</sub> calculation<span class=main>(</span>5<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>8<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> 
        <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span> calculation<span class=main>(</span>4<span class=main>,</span> 6<span class=main>,</span> 9<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>=</span> Some False"</span></span> 
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> 
          <span class=operator>of</span> <span class=quoted><span class=skolem>v</span></span> <span class=quoted><span class=skolem>a'</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>3</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> dom_map_add
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> map_add_dom_app_simps<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>4</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> v_a_not_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> dom_map_add
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span> <span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>.</span>
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=comment1>― ‹ NOTE Hasn't this been proved before? ›</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>}</span><span class=main>)</span> 
        <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> 
          <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> nb<span class=hidden>⇩</span><sub>2</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>}</span> 
          <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span> 
        <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>}</span> 
          <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> 
        <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> v_a_not_in
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> dom_map_of_conv_image_fst calculation 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>s</span> <span class=skolem>v</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> nb<span class=hidden>⇩</span><sub>1</sub> map_add_dom_app_simps<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>9<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> 
        <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span> calculation<span class=main>(</span>5<span class=main>,</span> 6<span class=main>,</span> 7<span class=main>,</span> 8<span class=main>,</span> 10<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>5</sub> <span class=main>=</span> this
  <span class=comment1>― ‹ TODO refactor. ›</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>6</sub><span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=var>?t</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span> <span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>.</span> 
      <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>}</span><span class=main>)</span> 
    <span class=main>∪</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span> 
    <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span><span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> dom_map_add nb<span class=hidden>⇩</span><sub>2</sub>
    <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span>"</span></span> 
        <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t'</span>"</span></span> 
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> A
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>thm</span></span> map_add_None state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
            <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> B
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> 
              set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span> 
              <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>unfolding</span></span> nb<span class=hidden>⇩</span><sub>2</sub>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>B<span class=hidden>⇩</span><sub>1</sub><span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
            <span class=main>|</span> <span class=main>(</span>B<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> 
            <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>thm</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>2</sub> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>3</sub> nb<span class=hidden>⇩</span><sub>2</sub>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> B<span class=hidden>⇩</span><sub>1</sub>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>2</sub>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> B<span class=hidden>⇩</span><sub>2</sub>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>3</sub> B
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>qed</span></span> 
        <span class=keyword1><span class=command>qed</span></span> 
    <span class=keyword1><span class=command>}</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?u</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> v_a_in_dom_t'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t'</span>"</span></span>
      <span class=keyword1><span class=command>thm</span></span> nb<span class=hidden>⇩</span><sub>5</sub>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> v_in_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> u_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?u</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> a_in_range_of_v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
          v_a_in_dom_t'
        <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> dom <span class=var>?t</span>"</span></span> 
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> contradiction<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∉</span> 
          <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>}</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span> 
          <span class=main>∪</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span> 
          <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span><span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span><span class=main>}</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>unfolding</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>6</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span> 
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=free>op'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> None"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
              <span class=keyword1><span class=command>using</span></span> u_of_v_is_not_None
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>s</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>}</span><span class=main>.</span> 
              <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>|</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> v_in_vs a_in_range_of_v 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
              <span class=keyword1><span class=command>using</span></span> contradiction
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> u_of_v_is_not_None nb<span class=hidden>⇩</span><sub>1</sub> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword>where</span></span> map_of_effect_of_op_v_is<span class=main>:</span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a'</span>"</span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> v_a'_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> map_of_SomeD 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a'</span>"</span></span><span class=main>)</span>
                <span class=keyword3><span class=command>case</span></span> True
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
                  <span class=keyword1><span class=command>using</span></span> v_a'_in
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
                  <span class=keyword1><span class=command>using</span></span> contradiction
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>next</span></span>
                <span class=keyword3><span class=command>case</span></span> False
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> 
                  <span class=main>{</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span><span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span><span class=main>}</span><span class=main>)</span>"</span></span> 
                  <span class=keyword1><span class=command>using</span></span> v_a'_in calculation a_in_range_of_v
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                  <span class=keyword1><span class=command>using</span></span> contradiction
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
              <span class=keyword1><span class=command>qed</span></span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?t</span> <span class=main>⊆</span> dom <span class=var>?t'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?t'</span> <span class=main>⊆</span> dom <span class=var>?t</span>"</span></span> 
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> 
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span> subrelI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"dom <span class=var>?t</span>"</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?t'</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span> subrelI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"dom <span class=var>?t'</span>"</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?t</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?t</span> <span class=main>=</span> dom <span class=var>?t'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>7</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> v_a_in_dom_t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t</span>"</span></span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>effect_to_assignments <span class=free>op'</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=comment1>― ‹ TODO slow. ›</span>
        <span class=comment1>― ‹ NOTE Split on the (disjunct) domain variable sets of 
          <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"map_of (effect_to_assignments op')"</span><span class=antiquote>}</span></span>. ›</span> 
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A1<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
          <span class=main>|</span> <span class=main>(</span>A2<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span>
            <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> A1
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
              <span class=keyword1><span class=command>unfolding</span></span> map_add_dom_app_simps<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> True<span class=main>]</span>
              <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>9</sub><span class=main>(</span>1<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
              <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>2</sub><span class=main>[</span><span class=operator>OF</span> A1<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> A2
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some False"</span></span> 
              <span class=keyword1><span class=command>unfolding</span></span> map_add_dom_app_simps<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> True<span class=main>]</span>
              <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>9</sub><span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some False"</span></span>
              <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>3</sub><span class=main>[</span><span class=operator>OF</span> True A2<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>4</sub><span class=main>[</span><span class=operator>OF</span> v_a_in_dom_t False<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>5</sub><span class=main>[</span><span class=operator>OF</span> v_a_in_dom_t False<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>8</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?t'</span>"</span></span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=var>?t'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>7</sub> nb<span class=hidden>⇩</span><sub>1</sub><span class=hidden>⇩</span><sub>8</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=comment1>― ‹ TODO slow.›</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?t'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?t</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> map_le_def 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> map_le_antisym<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE This is the essential step in the SAS+/STRIPS equivalence theorem. We show that executing
a given parallel STRIPS operator <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"ops'"</span><span class=antiquote>}</span></span> on the corresponding STRIPS state 
<span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"s' = φ<span class=hidden>⇩</span><sub>S</sub> Ψ s"</span><span class=antiquote>}</span></span> yields the same state as executing the transformed SAS+ parallel operator
<span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"ops = [φ<span class=hidden>⇩</span><sub>O</sub>¯ (φ Ψ) op'. op' ← ops']"</span><span class=antiquote>}</span></span> on the original SAS+ state <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"s"</span><span class=antiquote>}</span></span> and the 
transforming the resultant SAS+ state to its corresponding STRIPS state. ›</span>
<span class=comment1>(* TODO refactor. *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_XII><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_XII<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=free>ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=free>ops'</span> 
    <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span>execute_parallel_operator_sas_plus <span class=free>s</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops'</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def execute_parallel_operator_sas_plus_def 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op'</span> <span class=skolem>ops'</span><span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=skolem>op'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?t</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_XI<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=skolem>ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=var>?Π</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?t</span><span class=main>)</span> <span class=skolem>ops'</span> 
      <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span>execute_parallel_operator_sas_plus <span class=var>?t</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>x</span><span class=main>.</span> x <span class=main>←</span> <span class=skolem>ops'</span><span class=main>]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=var><span class=quoted><span class=var>?t</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=var>?t'</span> <span class=skolem>ops'</span>
      <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span>execute_parallel_operator_sas_plus <span class=var>?t</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>x</span><span class=main>.</span> x <span class=main>←</span> <span class=skolem>ops'</span><span class=main>]</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a_XIII><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a_XIII<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=free>ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan 
      <span class=main>(</span>execute_parallel_operator <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>I</span><span class=main>)</span> <span class=free>ops'</span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan 
    <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span>execute_parallel_operator_sas_plus <span class=free>I</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=free>π</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>I</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?J</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=free>I</span> <span class=var>?ops</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?G'</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> execute_parallel_plan 
      <span class=main>(</span>execute_parallel_operator <span class=var>?I'</span> <span class=free>ops'</span><span class=main>)</span> <span class=free>π</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> map_le_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> execute_parallel_plan <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?J</span><span class=main>)</span> <span class=free>π</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_XII<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> map_le_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE This is a more abstract formulation of the proposition in 
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>sas_plus_equivalent_to_strips_i›</span></span> which is better suited for induction proofs. We essentially claim 
that given a plan the execution in STRIPS semantics of which solves the problem of reaching a 
transformed goal state <span class=antiquoted><span class=raw_text><span class=operator>‹</span>φ<span class=hidden>⇩</span><sub>S</sub> Ψ G›</span></span> from a transformed initial state <span class=antiquoted><span class=raw_text><span class=operator>‹</span>φ<span class=hidden>⇩</span><sub>S</sub> Ψ I›</span></span>—such as 
the goal and initial state of an induced STRIPS problem for a SAS+ problem—is equivalent to an
execution in SAS+ semantics of the transformed plan <span class=antiquoted><span class=raw_text><span class=operator>‹</span>φ<span class=hidden>⇩</span><sub>P</sub>¯ (φ Ψ) π›</span></span> w.r.t to the original 
initial state <span class=antiquoted><span class=raw_text><span class=operator>‹</span>I›</span></span> and original goal state <span class=antiquoted><span class=raw_text><span class=operator>‹</span>G›</span></span>. ›</span> 
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i_a><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>I</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>I</span><span class=main>.</span> the <span class=main>(</span><span class=free>I</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>G</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>G</span><span class=main>.</span> the <span class=main>(</span><span class=free>G</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops'</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=bound>ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>I</span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ψ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> Nil
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=skolem>I</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> state_to_strips_state_map_le_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_parallel_plan_to_sas_plus_parallel_plan_def
          strips_parallel_plan_to_sas_plus_parallel_plan_def 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>ops'</span> <span class=skolem>π</span><span class=main>)</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=skolem>I</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span>"</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op'</span><span class=main>.</span> op' <span class=main>←</span> <span class=skolem>ops'</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?J</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=var>?ops</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?J'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=var>?I'</span> <span class=skolem>ops'</span>"</span></span> 
      <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=skolem>ops'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>6<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.is_parallel_solution_for_problem_def list_all_iff ListMem_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span> 
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=skolem>ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> calculation<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op''</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op''</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=skolem>op''</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>3<span class=main>,</span> 6<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=skolem>ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span> <span class=skolem>v</span> <span class=skolem>a</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> calculation<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> Cons.prems<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>3<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>3<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>3</sub> <span class=main>=</span> this
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> 
          <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>3<span class=main>,</span>4<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>4</sub> <span class=main>=</span> this
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=var>?I'</span> <span class=skolem>ops'</span> 
          <span class=main>∧</span> STRIPS_Semantics.are_all_operator_effects_consistent <span class=skolem>ops'</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>I</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Ψ</span> <span class=var>?I'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>I</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> strips_state_to_state_inverse_is<span class=main>[</span><span class=operator>OF</span> 
                    Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ Cons.prems<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=var>?ops</span>
              <span class=main>∧</span> are_all_operator_effects_consistent <span class=var>?ops</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_IV<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span><span class=main>]</span> True
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=skolem>ops'</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?ops</span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>π</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_parallel_plan_to_sas_plus_parallel_plan_def
                strips_parallel_plan_to_sas_plus_parallel_plan_def
                SAS_Plus_STRIPS.strips_op_to_sasp_def
                  strips_op_to_sasp_def  
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=skolem>ops'</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> 
              <span class=main>=</span> execute_parallel_plan_sas_plus <span class=var>?J</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>π</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>5</sub> <span class=main>=</span> this
          <span class=comment1>― ‹ Show the goal using the IH. ›</span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> dom_J_subset_eq_vs<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=var>?J</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_IX<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>2</sub> nb<span class=hidden>⇩</span><sub>4</sub>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>⊆</span> dom <span class=main>(</span>range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=skolem>I</span><span class=main>.</span> the <span class=main>(</span><span class=skolem>I</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> set_the_range_of_is_range_of_sas_plus_if 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
                <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> set_the_range_of_is_range_of_sas_plus_if assms<span class=main>(</span>1<span class=main>)</span> nb<span class=hidden>⇩</span><sub>4</sub> 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> v_in_dom_J_range<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=var>?J</span><span class=main>.</span> the <span class=main>(</span><span class=var>?J</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span><span class=var>?D</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_X<span class=main>[</span><span class=operator>of</span> 
                    <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span><span class=main>,</span> <span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>,</span> 3<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> 
                <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?J</span>"</span></span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> calculation dom_J_subset_eq_vs 
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
                  <span class=keyword1><span class=command>using</span></span> set_the_range_of_is_range_of_sas_plus_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
                    calculation<span class=main>(</span>2<span class=main>)</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
                <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=var>?J</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
                  <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub> v_in_dom_J_range
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=var>?J</span><span class=main>.</span> the <span class=main>(</span><span class=var>?J</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops'</span> <span class=main>∈</span> set <span class=skolem>π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op'</span><span class=main>∈</span>set <span class=bound>ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>6<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?J'</span> <span class=skolem>π</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>7<span class=main>)</span> True
                <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?J</span><span class=main>)</span> <span class=skolem>π</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_XIII<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>1</sub>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=skolem>ops'</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?J</span></span></span><span class=main>,</span> <span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ _ Cons.prems<span class=main><span class=main>(</span></span>4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span><span class=main>]</span> Cons.prems<span class=main>(</span>6<span class=main>)</span> nb<span class=hidden>⇩</span><sub>5</sub> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span><span class=keyword1><span class=command>.</span></span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?I'</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>7<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>I</span> <span class=main>⊆</span> set <span class=var>?vs</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span>are_all_operators_applicable_in <span class=skolem>I</span> <span class=var>?ops</span>
              <span class=main>∧</span> are_all_operator_effects_consistent <span class=var>?ops</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_VIII<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ Cons.prems<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>]</span> 
                False
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=skolem>ops'</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?ops</span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>π</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_parallel_plan_to_sas_plus_parallel_plan_def
                strips_parallel_plan_to_sas_plus_parallel_plan_def
                SAS_Plus_STRIPS.strips_op_to_sasp_def
                strips_op_to_sasp_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=skolem>I</span> <span class=main>(</span><span class=var>?ops</span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>π</span><span class=main>)</span><span class=main>)</span>
              <span class=main>⟷</span> <span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
            <span class=keyword1><span class=command>using</span></span> state_to_strips_state_map_le_iff<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span><span class=main>]</span> 
            <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.strips_parallel_plan_to_sas_plus_parallel_plan_def
              strips_parallel_plan_to_sas_plus_parallel_plan_def
              SAS_Plus_STRIPS.strips_op_to_sasp_def
              strips_op_to_sasp_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE Show that a solution for the induced STRIPS problem for the given valid SAS+ problem, 
  corresponds to a solution for the given SAS+ problem.

Note that in the context of the SAS+ problem solving pipeline, we
\begin{enumerate}
  \item convert the given valid SAS+ <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"Ψ"</span><span class=antiquote>}</span></span> problem to the corresponding STRIPS problem 
<span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"Π"</span><span class=antiquote>}</span></span> (this is implicitely also valid by lemma 
<span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"is_valid_problem_sas_plus_then_strips_transformation_too"</span><span class=antiquote>}</span></span>); then,
  \item get a solution <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"π"</span><span class=antiquote>}</span></span>—if it exists—for the induced STRIPS problem by executing 
SATPlan; and finally,
  \item convert <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"π"</span><span class=antiquote>}</span></span> back to a solution <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"ψ"</span><span class=antiquote>}</span></span> for the SAS+ problem.
\end{enumerate} ›</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_i><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_parallel_solution_for_problem 
    <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"goal_of <span class=free>Ψ</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus 
    <span class=main>(</span>sas_plus_problem.initial_of <span class=free>Ψ</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"initial_of <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"goal_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?G'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.goal_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=var>?Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?I</span> <span class=main>⊆</span> set <span class=var>?vs</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>3<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=var>?I</span><span class=main>.</span> the <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>4<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> calculation
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?G</span> <span class=main>⊆</span> set <span class=var>?vs</span>"</span></span>  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=var>?G</span><span class=main>.</span> the <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>5<span class=main>,</span> 6<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops'</span><span class=main>∈</span>set <span class=free>π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op'</span><span class=main>∈</span>set <span class=bound>ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?I'</span> <span class=free>π</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.is_parallel_solution_for_problem_def<span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?G</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?I'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?I</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?G</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?I</span><span class=main>)</span> <span class=free>π</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ NOTE Show that the operators for a given solution <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"π"</span><span class=antiquote>}</span></span> to the induced STRIPS problem 
for a given SAS+ problem correspond to operators of the SAS+ problem. ›</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_equivalent_to_strips_ii><span class=command>lemma</span></span> sas_plus_equivalent_to_strips_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_parallel_solution_for_problem <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=bound>op</span> <span class=main>(</span>operators_of <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ψ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=var>?Π</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>  
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ops'</span> <span class=skolem>op'</span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops'</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=skolem>ops'</span>"</span></span> 
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=var>?Π</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> list_all_iff ListMem_iff 
      strips_parallel_plan_to_sas_plus_parallel_plan_def
      SAS_Plus_STRIPS.strips_parallel_plan_to_sas_plus_parallel_plan_def
      SAS_Plus_STRIPS.strips_op_to_sasp_def
      strips_op_to_sasp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We now show that for a parallel solution <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span> the SAS+ plan 
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span> <span class=main><span class=main>≡</span></span> <span class=keyword1><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span></span> <span class=free><span class=free>Ψ</span></span> <span class=free><span class=free>π</span></span>›</span></span></span></span> yielded by the STRIPS to SAS+ plan transformation is a solution for 
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span>. The proof uses the definition of parallel STRIPS solutions and shows that the 
execution of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> on the initial state of the SAS+ problem yields a state satisfying the 
problem's goal state, i.e.
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4]<span class=raw_text><span class=raw_text>"G ⊆<span class=hidden>⇩</span><sub>m</sub> execute_parallel_plan_sas_plus I ψ"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
and by showing that all operators in all parallel operators of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> are operators of the 
problem. ›</span></span>

<span class=keyword1><span class=command>theorem</span></span>
  sas_plus_equivalent_to_strips<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_parallel_solution_for_problem <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>π</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"initial_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"goal_of <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ψ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=free>π</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def Let_def
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=var>?I</span> <span class=var>?ψ</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>next</span></span> 
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=bound>op</span> <span class=var>?ops</span><span class=main>)</span><span class=main>)</span> <span class=var>?ψ</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a_I><span class=command>lemma</span></span> strips_equivalent_to_sas_plus_i_a_I<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>op</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> that
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1><span class=command>corollary</span></span> strips_equivalent_to_sas_plus_i_a_II<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span><span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_valid_operator_strips <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>op'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=var>?Π</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> op_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> op'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_i_a_I<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> op_in op'_is 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_valid_operator_strips <span class=var>?Π</span> <span class=free>op'</span>"</span></span> 
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=var>?ops'</span><span class=main>.</span> is_valid_operator_strips <span class=var>?Π</span> <span class=bound>op'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too_iii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> list_all_iff<span class=keyword1><span class=command>.</span></span> 
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"is_valid_operator_strips <span class=var>?Π</span> <span class=free>op'</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> nb
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a_III><span class=command>lemma</span></span> strips_equivalent_to_sas_plus_i_a_III<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span>
    <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span>execute_parallel_operator_sas_plus <span class=free>s</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>++</span> map_of <span class=main>(</span>effect_to_assignments <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=skolem>s</span> <span class=main>++</span> map_of <span class=main>(</span>effect_of <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_XI<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>op</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sas_plus_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>⪢</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=skolem>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> execute_operator_def execute_operator_sas_plus_def 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> Nil
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> execute_parallel_operator_def execute_parallel_operator_sas_plus_def 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op</span> <span class=skolem>ops</span><span class=main>)</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>⪢<span class=hidden>⇩</span><sub>+</sub></span> <span class=skolem>op</span>"</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=skolem>s</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>op</span> <span class=main>#</span> <span class=skolem>ops</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>⪢</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=var>?s'</span> <span class=var>?ops'</span> 
        <span class=main>=</span> execute_parallel_operator <span class=var>?t'</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>x</span><span class=main>.</span> x <span class=main>←</span> <span class=skolem>ops</span><span class=main>]</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> execute_operator_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span>execute_parallel_operator_sas_plus <span class=skolem>s</span> <span class=main>(</span><span class=skolem>op</span> <span class=main>#</span> <span class=skolem>ops</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span>execute_parallel_operator_sas_plus <span class=var>?t</span> <span class=skolem>ops</span><span class=main>)</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> execute_operator_sas_plus_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?t</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> Cons.prems<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=var>?t'</span><span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>x</span><span class=main>.</span> x <span class=main>←</span> <span class=skolem>ops</span><span class=main>]</span> 
          <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=main>(</span>execute_parallel_operator_sas_plus <span class=var>?t</span> <span class=skolem>ops</span><span class=main>)</span><span class=main>)</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?t</span></span></span><span class=main>]</span> Cons.prems
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a_IV><span class=command>lemma</span></span> strips_equivalent_to_sas_plus_i_a_IV<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=free>I</span> <span class=free>ops</span> 
    <span class=main>∧</span> are_all_operator_effects_consistent <span class=free>ops</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>I</span><span class=main>)</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span>
    <span class=main>∧</span> STRIPS_Semantics.are_all_operator_effects_consistent <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>I</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> is_operator_applicable_in <span class=free>I</span> <span class=bound>op</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> 
    <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def list_all_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=bound>op</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>3</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> map_of <span class=main>(</span>precondition_of <span class=bound>op</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>I</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> 
    <span class=keyword1><span class=command>unfolding</span></span> is_operator_applicable_in_def list_all_iff 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def list_all_iff 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>4</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
      <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>4</sub>
      <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def Let_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>5</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=skolem>I</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span>
        <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_i_a_I<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> is_valid_operator_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>,</span> 6<span class=main>)</span> nb<span class=hidden>⇩</span><sub>2</sub> 
       <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>v'</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>a'</span></span> 
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>5<span class=main>,</span> 10<span class=main>)</span> 
      <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
        sasp_op_to_strips_def Let_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=skolem>v'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>12<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> 
        <span class=main>{</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∧</span>  <span class=bound>a'</span> <span class=main>≠</span> <span class=bound>a</span> <span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_set_delete_effects_is 
          calculation<span class=main>(</span>7<span class=main>,</span> 9<span class=main>,</span> 11<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v''</span></span> <span class=skolem><span class=skolem>a''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v''</span><span class=main>,</span> <span class=skolem>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=skolem>v''</span><span class=main>,</span> <span class=bound>a'''</span><span class=main>)</span> <span class=main>|</span> <span class=bound>a'''</span><span class=main>.</span> <span class=bound>a'''</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v''</span><span class=main>)</span> <span class=main>∧</span>  <span class=bound>a'''</span> <span class=main>≠</span> <span class=skolem>a''</span> <span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> calculation 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v''</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>≠</span> <span class=skolem>a''</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a''</span><span class=main>.</span> <span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=bound>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=skolem>a'</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v'</span><span class=main>)</span> 
        <span class=main>∧</span> <span class=skolem>a'</span> <span class=main>≠</span> <span class=bound>a''</span>"</span></span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a''</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v'</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a''</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>≠</span> <span class=skolem>a''</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>16<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> 
      <span class=bound>v</span> <span class=main>=</span> <span class=bound>v'</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>a'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>13<span class=main>,</span> 14<span class=main>,</span> 15<span class=main>,</span> 17<span class=main>,</span> 18<span class=main>,</span> 19<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>― ‹ TODO slow. ›</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>∃</span><span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>¬</span>are_operator_effects_consistent <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> are_operator_effects_consistent_def list_all_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>6</sub> <span class=main>=</span> this
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op'</span> 
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> op_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> op'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> op'_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> is_valid_op'<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_strips <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=skolem>op'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_i_a_I<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
            strips_equivalent_to_sas_plus_i_a_II<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>1<span class=main><span class=main><span class=main>,</span></span></span> 2<span class=main><span class=main><span class=main>)</span></span></span><span class=main>]</span> calculation 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> is_valid_op<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> calculation<span class=main>(</span>2<span class=main>)</span><span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>a</span>
          <span class=keyword3><span class=command>assume</span></span> v_a_in_preconditions'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.precondition_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>have</span></span> v_a_in_preconditions<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> op'_is
            <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
              sasp_op_to_strips_def Let_def
            <span class=keyword1><span class=command>using</span></span> v_a_in_preconditions' 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span> is_valid_op calculation<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span>
              <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>5<span class=main>)</span> is_valid_op
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> map_of_constant_assignments_defined_if<span class=main>[</span><span class=operator>OF</span> _ v_a_in_preconditions<span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub> 
            <span class=keyword1><span class=command>unfolding</span></span> map_le_def 
            <span class=keyword1><span class=command>using</span></span> op_in calculation<span class=main>(</span>4<span class=main>,</span> 5<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?I'</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
              calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>,</span> 6<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?I'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span> 
            <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"STRIPS_Representation.is_operator_applicable_in <span class=var>?I'</span> <span class=skolem>op'</span>"</span></span> 
          <span class=keyword1><span class=command>unfolding</span></span> 
            STRIPS_Representation.is_operator_applicable_in_def 
            Let_def list_all_iff 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=var>?I'</span> <span class=var>?ops'</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def list_all_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span> 
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>
        <span class=keyword3><span class=command>assume</span></span> op<span class=hidden>⇩</span><sub>1</sub>'_in_ops'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>'_in_ops'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span> 
          <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.are_operator_effects_consistent_def Let_def
          <span class=comment1>― ‹ TODO proof is symmetrical... refactor into nb. ›</span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>          
            <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>)</span> 
              <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
                <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>)</span> 
                  <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span> 
                  <span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
                  <span class=keyword1><span class=command>unfolding</span></span> list_ex_iff 
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
                  <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>6</sub><span class=main>[</span><span class=operator>OF</span> op<span class=hidden>⇩</span><sub>1</sub>'_in_ops' op<span class=hidden>⇩</span><sub>2</sub>'_in_ops'<span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> 
                  <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>4</sub>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>              
              <span class=keyword1><span class=command>qed</span></span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
                <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>¬</span>list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>(=)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>)</span> 
                  <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span> 
                  <span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span> 
                  <span class=keyword1><span class=command>unfolding</span></span> list_ex_iff
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operator_effects_consistent <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
                  <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>6</sub><span class=main>[</span><span class=operator>OF</span> op<span class=hidden>⇩</span><sub>2</sub>'_in_ops' op<span class=hidden>⇩</span><sub>1</sub>'_in_ops'<span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> 
                  <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>4</sub>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>qed</span></span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operator_effects_consistent <span class=var>?ops'</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.are_all_operator_effects_consistent_def list_all_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a_V><span class=command>lemma</span></span> strips_equivalent_to_sas_plus_i_a_V<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span>are_all_operators_applicable_in <span class=free>s</span> <span class=free>ops</span> 
    <span class=main>∧</span> are_all_operator_effects_consistent <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span>STRIPS_Semantics.are_all_operators_applicable <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span><span class=main>)</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span>
    <span class=main>∧</span> STRIPS_Semantics.are_all_operator_effects_consistent <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=var>?ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span>
      <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>5<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_all_operators_applicable_in <span class=free>s</span> <span class=free>ops</span>"</span></span> 
      <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_all_operator_effects_consistent <span class=free>ops</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>STRIPS_Semantics.are_all_operators_applicable <span class=var>?s'</span> <span class=var>?ops'</span> 
      <span class=main>∨</span> <span class=main>¬</span>STRIPS_Semantics.are_all_operator_effects_consistent <span class=var>?ops'</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> A
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> op_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> not_precondition_map_le_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span>map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> A
          <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_in_def list_all_iff 
            is_operator_applicable_in_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span> <span class=keyword2><span class=keyword>where</span></span> op'_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> op'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_all_operators_applicable <span class=var>?s'</span> <span class=var>?ops'</span>"</span></span> 
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>¬</span>are_all_operators_applicable <span class=var>?s'</span> <span class=var>?ops'</span>"</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> all_operators_applicable<span class=main>:</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=var>?s'</span> <span class=var>?ops'</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> 
              <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> calculation
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> map_of_SomeD<span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_operator.precondition_of <span class=skolem>op'</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> op'_is 
                <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def
                  SAS_Plus_STRIPS.sasp_op_to_strips_def
                <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>)</span> 
                <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> 
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
                <span class=keyword1><span class=command>using</span></span> all_operators_applicable calculation 
                <span class=keyword1><span class=command>unfolding</span></span> are_all_operators_applicable_def 
                    STRIPS_Representation.is_operator_applicable_in_def 
                    is_operator_applicable_in_def Let_def list_all_iff 
                <span class=keyword1><span class=command>using</span></span> op'_in
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> dom <span class=var>?s'</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>5<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> op'_is calculation<span class=main>(</span>3<span class=main>)</span>
                <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def Let_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span> 
                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span> 
                <span class=keyword1><span class=command>using</span></span> state_to_strips_state_dom_element_iff<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
                  calculation<span class=main>(</span>6<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s'</span> <span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> state_to_strips_state_range_is<span class=main>[</span><span class=operator>OF</span> 
                    assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>6<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=free>s</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>5<span class=main>,</span> 11<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>12<span class=main>)</span> option.collapse<span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>10<span class=main><span class=main>)</span></span><span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=skolem>a</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> map_of_constant_assignments_defined_if<span class=main>[</span><span class=operator>OF</span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main><span class=main>[</span></span><span class=operator>OF</span> op_in<span class=main><span class=main>]</span></span> calculation<span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>s</span> <span class=skolem>v</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span>"</span></span> 
              <span class=keyword1><span class=command>unfolding</span></span> map_le_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> 
              <span class=keyword1><span class=command>using</span></span> not_precondition_map_le_s
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> B
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=skolem><span class=skolem>v</span></span> <span class=skolem><span class=skolem>v'</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>a'</span></span> 
            <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> v_a_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> v'_a'_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v'</span><span class=main>,</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
              <span class=keyword2><span class=keyword>and</span></span> v_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=skolem>v'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> a_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=skolem>a'</span>"</span></span>  
            <span class=keyword1><span class=command>using</span></span> B 
            <span class=keyword1><span class=command>unfolding</span></span> are_all_operator_effects_consistent_def 
              are_operator_effects_consistent_def list_all_iff Let_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>=</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>,</span> 8<span class=main>)</span>
            <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sasp_op_to_strips_def
              sasp_op_to_strips_def Let_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
              <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> sublocale_sas_plus_finite_domain_representation_ii<span class=main>(</span>2<span class=main>)</span><span class=main>[</span>
                  <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>)</span> op<span class=hidden>⇩</span><sub>2</sub>_in 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>4<span class=main>)</span> calculation v_a_in
              <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_set_delete_effects_is<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Ψ</span></span> <span class=quoted><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main>]</span>
                v'_a'_in v_is a_is 
              <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>2</sub>'_is 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=comment1>― ‹ TODO slow. ›</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> set <span class=var>?ops'</span><span class=main>.</span> <span class=main>∃</span><span class=bound>op<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> set <span class=var>?ops'</span><span class=main>.</span> 
            <span class=main>∃</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>.</span> <span class=main>∃</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>.</span>
            <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>STRIPS_Semantics.are_all_operator_effects_consistent <span class=var>?ops'</span>"</span></span> 
          <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.are_all_operator_effects_consistent_def 
            STRIPS_Semantics.are_operator_effects_consistent_def list_all_iff list_ex_iff Let_def 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i_a><span class=command>lemma</span></span> strips_equivalent_to_sas_plus_i_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>I</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>I</span><span class=main>.</span> the <span class=main>(</span><span class=free>I</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>G</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=free>G</span><span class=main>.</span> the <span class=main>(</span><span class=free>G</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=free>I</span> <span class=free>ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>I</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=free>ψ</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>I</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> Nil
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=skolem>I</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> Nil
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?I'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> state_to_strips_state_map_le_iff<span class=main>[</span><span class=operator>OF</span> Nil.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span><span class=main>]</span> 
          calculation<span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def
          sas_plus_parallel_plan_to_strips_parallel_plan_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>ops</span> <span class=skolem>ψ</span><span class=main>)</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?J</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator_sas_plus <span class=skolem>I</span> <span class=skolem>ops</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=skolem>I</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?J'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=var>?J</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>ops</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span> <span class=skolem>v</span> <span class=skolem>a</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=skolem>ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>v</span><span class=main>,</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=skolem>op</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>6<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_operator_sas_plus <span class=free>Ψ</span> <span class=skolem>op</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>2<span class=main>)</span> Cons.prems<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>3<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> is_valid_operator_sas_plus_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> is_valid_operator_sas_plus_then<span class=main>(</span>3<span class=main>,</span>4<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"are_all_operators_applicable_in <span class=skolem>I</span> <span class=skolem>ops</span> 
        <span class=main>∧</span> are_all_operator_effects_consistent <span class=skolem>ops</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=skolem>ops</span> <span class=main>#</span> <span class=skolem>ψ</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?ops'</span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> sas_plus_parallel_plan_to_strips_parallel_plan_def
              SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def 
              sasp_op_to_strips_def
              SAS_Plus_STRIPS.sasp_op_to_strips_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=skolem>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>6<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operators_applicable <span class=var>?I'</span> <span class=var>?ops'</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.are_all_operator_effects_consistent <span class=var>?ops'</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_i_a_IV<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ True<span class=main>]</span> calculation
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=var>?I'</span> <span class=var>?π</span> 
            <span class=main>=</span> execute_parallel_plan <span class=main>(</span>execute_parallel_operator <span class=var>?I'</span> <span class=var>?ops'</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=comment1>― ‹ NOTE Instantiate the IH on the next state of the SAS+ execution 
          <span class=antiquoted><span class=raw_text><span class=operator>‹</span>execute_parallel_operator_sas_plus I ops›</span></span>. ›</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>I</span> <span class=main>⊆</span> set <span class=main>(</span>sas_plus_problem.variables_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=skolem>ops</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>effect_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span> 
              <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>(</span>1<span class=main>)</span> 
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?J</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_IX<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=quoted>"set <span class=var>?vs</span>"</span></span><span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=skolem>I</span> <span class=main>⊆</span> set <span class=main>(</span>sas_plus_problem.variables_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>sas_plus_problem.variables_of <span class=free>Ψ</span><span class=main>)</span>
              <span class=main>⊆</span> dom <span class=main>(</span>range_of <span class=free>Ψ</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_dom_sas_plus_problem_range_of assms<span class=main>(</span>1<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
           <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> 
              <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=skolem>I</span>"</span></span>  
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span> calculation
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=skolem>I</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>3<span class=main>)</span>
                <span class=keyword1><span class=command>using</span></span> set_the_range_of_is_range_of_sas_plus_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span><span class=main>∈</span>set <span class=skolem>ops</span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>∈</span>set <span class=main>(</span>effect_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
              <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>sas_plus_problem.variables_of <span class=free>Ψ</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> set_the_range_of_is_range_of_sas_plus_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>(</span>1<span class=main>)</span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>3</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=var>?J</span><span class=main>.</span> the <span class=main>(</span><span class=var>?J</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span> 
              <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips_i_a_X<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=quoted>"set <span class=var>?vs</span>"</span></span> <span class=quoted><span class=quoted>"range_of <span class=free>Ψ</span>"</span></span> <span class=quoted><span class=skolem>ops</span></span><span class=main>]</span> 
                calculation
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
              <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
              <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?J</span>"</span></span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> calculation
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>the <span class=main>(</span>range_of <span class=free>Ψ</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> set_the_range_of_is_range_of_sas_plus_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
                  calculation<span class=main>(</span>2<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=var>?J</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=skolem>v</span>"</span></span> 
                <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=var>?J</span><span class=main>.</span> the <span class=main>(</span><span class=var>?J</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span><span class=main>∈</span>set <span class=skolem>ψ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span><span class=main>∈</span>set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>6<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=var>?J</span> <span class=skolem>ψ</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>7<span class=main>)</span> True
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>S</sub></span> <span class=free>Ψ</span> <span class=free>G</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?J'</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?J</span></span></span><span class=main>,</span> <span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ _ Cons.prems<span class=main><span class=main>(</span></span>4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=var>?I'</span> <span class=var>?ops'</span> <span class=main>=</span> <span class=var>?J'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> strips_equivalent_to_sas_plus_i_a_III<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> Cons.prems<span class=main>(</span>6<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>I</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>7<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?π</span> <span class=main>=</span> <span class=var>?ops'</span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=skolem>ψ</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> sas_plus_parallel_plan_to_strips_parallel_plan_def
              SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def 
              sasp_op_to_strips_def
              SAS_Plus_STRIPS.sasp_op_to_strips_def Let_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?ops'</span> <span class=main>⊆</span> set <span class=main>(</span>strips_problem.operators_of <span class=var>?Π</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_i_a_II<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> Cons.prems<span class=main>(</span>6<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span>STRIPS_Semantics.are_all_operators_applicable <span class=var>?I'</span> <span class=var>?ops'</span> 
            <span class=main>∧</span> STRIPS_Semantics.are_all_operator_effects_consistent <span class=var>?ops'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_i_a_V<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ False<span class=main>]</span> Cons.prems<span class=main>(</span>6<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span> 
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_plan <span class=var>?I'</span> <span class=var>?π</span> <span class=main>=</span> <span class=var>?I'</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?I'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> state_to_strips_state_map_le_iff<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span><span class=main>]</span> nb
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
        <span class=keyword1><span class=command>qed</span></span> 
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_i><span class=command>lemma</span></span> strips_equivalent_to_sas_plus_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>strips_problem.goal_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan 
    <span class=main>(</span>strips_problem.initial_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=free>ψ</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"variables_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"initial_of <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"goal_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.goal_of <span class=var>?Π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?I</span> <span class=main>⊆</span> set <span class=var>?vs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>3<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>dom <span class=var>?I</span><span class=main>.</span> the <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>4<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span> calculation
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?G</span> <span class=main>⊆</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>5<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=main>∈</span> dom <span class=var>?G</span><span class=main>.</span> the <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=keyword1>ℛ<span class=hidden>⇩</span><sub>+</sub></span> <span class=free>Ψ</span> <span class=bound>v</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then<span class=main>(</span>6<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_plan_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan_sas_plus <span class=var>?I</span> <span class=free>ψ</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> 
    <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=comment1>(* TODO slow *)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_i_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=quoted><span class=free>ψ</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> sas_plus_problem_to_strips_problem_def
      SAS_Plus_STRIPS.sas_plus_problem_to_strips_problem_def 
      state_to_strips_state_def
      SAS_Plus_STRIPS.state_to_strips_state_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAS_Plus_STRIPS-strips_equivalent_to_sas_plus_ii><span class=command>lemma</span></span> strips_equivalent_to_sas_plus_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=bound>op</span> <span class=main>(</span>strips_problem.operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=free>ψ</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"operators_of <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=var>?Π</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> 
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>op'</span> <span class=main>∈</span> set <span class=var>?ops'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> sas_plus_problem_to_strips_problem_def
      SAS_Plus_STRIPS.sas_plus_problem_to_strips_problem_def Let_def 
      sasp_op_to_strips_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ops</span> <span class=skolem>op</span> <span class=skolem>op'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> set <span class=free>ψ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=skolem>ops</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_plan_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> 
        calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> calculation<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?ops'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> list_all_iff ListMem_iff Let_def  
      sas_plus_problem_to_strips_problem_def
      SAS_Plus_STRIPS.sas_plus_problem_to_strips_problem_def
      sas_plus_parallel_plan_to_strips_parallel_plan_def
      SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def 
      sasp_op_to_strips_def
      SAS_Plus_STRIPS.sasp_op_to_strips_def 
      Let_def 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ The following lemma proves the complementary proposition to theorem 
\ref{isathm:equivalence-parallel-strips-parallel-sas-plus}. Namely, given a parallel solution
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> for a SAS+ problem, the transformation to a STRIPS plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span></span> <span class=free><span class=free>Ψ</span></span> <span class=free><span class=free>ψ</span></span>›</span></span></span></span> also is a solution 
to the corresponding STRIPS problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span> <span class=main><span class=main>≡</span></span> <span class=main><span class=main>(</span></span><span class=keyword1><span class=keyword1>φ</span></span> <span class=free><span class=free>Ψ</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span>. In this direction, we have to show that the 
execution of the transformed plan reaches the goal state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G'</span></span> <span class=main><span class=main>≡</span></span> strips_problem.goal_of <span class=free><span class=free>Π</span></span>›</span></span></span></span> 
of the corresponding STRIPS problem, i.e.
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"G' ⊆<span class=hidden>⇩</span><sub>m</sub> execute_parallel_plan I' π"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> 
and that all operators in the transformed plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> are operators of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span>. ›</span></span>

<span class=keyword1><span class=command>theorem</span></span>
  strips_equivalent_to_sas_plus<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_parallel_solution_for_problem <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=free>ψ</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.goal_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=var>?Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.is_parallel_solution_for_problem_def 
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?G'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?I'</span> <span class=var>?π</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span> 
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span>list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=bound>op</span> <span class=var>?ops'</span><span class=main>)</span><span class=main>)</span> <span class=var>?π</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-embedded_serial_sas_plus_plan_operator_structure><span class=command>lemma</span></span> embedded_serial_sas_plus_plan_operator_structure<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>∈</span> set <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>op</span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"embed <span class=free>ψ</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?ψ'</span> <span class=main>=</span> <span class=main>[</span><span class=main>[</span><span class=bound>op</span><span class=main>]</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ψ</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>force</span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ψ</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms calculation 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> that
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-serial_sas_plus_equivalent_to_serial_strips_i><span class=command>lemma</span></span> serial_sas_plus_equivalent_to_serial_strips_i<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>∈</span> set <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>op</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ψ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op</span><span class=main>]</span>"</span></span>  
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"embed <span class=free>ψ</span>"</span></span> 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ops</span><span class=main>]</span>  <span class=main>|</span> <span class=bound>ops</span><span class=main>.</span> <span class=bound>ops</span> <span class=main>∈</span> set <span class=var>?ψ'</span> <span class=main>}</span>"</span></span>
      
      <span class=keyword1><span class=command>unfolding</span></span> sas_plus_parallel_plan_to_strips_parallel_plan_def  
        SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def
        sasp_op_to_strips_def set_map
      <span class=keyword1><span class=command>using</span></span> setcompr_eq_image  
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops'</span> <span class=main>∈</span> set <span class=var>?ψ'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>ops'</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ψ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> embedded_serial_sas_plus_plan_operator_structure calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> that<span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-serial_sas_plus_equivalent_to_serial_strips_ii><span class=command>lemma</span></span> serial_sas_plus_equivalent_to_serial_strips_ii<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"concat <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ψ</span><span class=main>]</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List_Supplement.embed <span class=free>ψ</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"concat <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=var>?ψ'</span><span class=main>)</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>)</span> <span class=main>(</span>concat <span class=var>?ψ'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> sas_plus_parallel_plan_to_strips_parallel_plan_def
      SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def
      sasp_op_to_strips_def
      SAS_Plus_STRIPS.sasp_op_to_strips_def Let_def
      map_concat
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>)</span> <span class=free>ψ</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> concat_is_inverse_of_embed<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ψ</span></span><span class=main>]</span><span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"concat <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ψ</span><span class=main>]</span>"</span></span><span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Having established the equivalence of parallel STRIPS and SAS+, we can now show the 
equivalence in the serial case. The proof combines the 
embedding theorem for serial SAS+ solutions (\ref{isathm:serial-sas-plus-embedding}), the parallel 
plan equivalence theorem \ref{isathm:equivalence-parallel-sas-plus-parallel-strips}, and the 
flattening theorem for parallel STRIPS plans (\ref{isathm:embedded-serial-plan-flattening-strips}).
More precisely, given a serial SAS+ solution <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> for a SAS+ problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span>, the embedding 
theorem confirms that the embedded plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹embed <span class=free><span class=free>ψ</span></span>›</span></span></span></span> is an equivalent parallel solution to
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span>. By parallel plan equivalence, <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span> <span class=main><span class=main>≡</span></span> <span class=keyword1><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span></span> <span class=free><span class=free>Ψ</span></span> <span class=main><span class=main>(</span></span>embed <span class=free><span class=free>ψ</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> is a parallel solution for the 
corresponding STRIPS problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>φ</span></span> <span class=free><span class=free>Ψ</span></span>›</span></span></span></span>. Moreover, since <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹embed <span class=free><span class=free>ψ</span></span>›</span></span></span></span> is a plan consisting of 
singleton parallel operators, the same is true for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span>. Hence, the flattening lemma applies 
and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹concat <span class=free><span class=free>π</span></span>›</span></span></span></span> is a serial solution for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>φ</span></span> <span class=free><span class=free>Ψ</span></span>›</span></span></span></span>. Since <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹concat›</span></span></span></span> moreover can be shown 
to be the inverse of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹embed›</span></span></span></span>, the term 
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"concat π = concat (φ<span class=hidden>⇩</span><sub>P</sub> Ψ (embed ψ))"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
can be reduced to the intuitive form 
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"π = [φ<span class=hidden>⇩</span><sub>O</sub> Ψ op. op ← ψ]"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
which concludes the proof. ›</span></span>

<span class=keyword1><span class=command>theorem</span></span> 
  serial_sas_plus_equivalent_to_serial_strips<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_serial_solution_for_problem <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ψ</span><span class=main>]</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"embed <span class=free>ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=var>?ψ'</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=var>?π'</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=var>?ψ'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_parallel_solution_for_problem <span class=var>?Π</span> <span class=var>?π'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> strips_equivalent_to_sas_plus<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?π</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ψ</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=var>?Π</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=var>?π'</span><span class=main>.</span> <span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span><span class=main>.</span> <span class=bound>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>]</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> serial_sas_plus_equivalent_to_serial_strips_i<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>Ψ</span></span> <span class=quoted><span class=free>ψ</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> STRIPS_Semantics.flattening_lemma<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?Π</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=SAS_Plus_STRIPS-embedded_serial_strips_plan_operator_structure><span class=command>lemma</span></span> embedded_serial_strips_plan_operator_structure<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ops'</span> <span class=main>∈</span> set <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>op</span> 
    <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=free>op</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"embed <span class=free>π</span>"</span></span> 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?π'</span> <span class=main>=</span> <span class=main>[</span><span class=main>[</span><span class=bound>op</span><span class=main>]</span><span class=main>.</span> op <span class=main>←</span> <span class=free>π</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>π</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>force</span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>ops'</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation assms 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>ops'</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> that
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-serial_strips_equivalent_to_serial_sas_plus_i><span class=command>lemma</span></span> serial_strips_equivalent_to_serial_sas_plus_i<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>∈</span> set <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Π</span> <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>op</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=free>op</span><span class=main>]</span>"</span></span>  
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"embed <span class=free>π</span>"</span></span> 
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Π</span> <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ops</span><span class=main>]</span>  <span class=main>|</span> <span class=bound>ops</span><span class=main>.</span> <span class=bound>ops</span> <span class=main>∈</span> set <span class=var>?π'</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> strips_parallel_plan_to_sas_plus_parallel_plan_def
        SAS_Plus_STRIPS.strips_parallel_plan_to_sas_plus_parallel_plan_def
        strips_op_to_sasp_def set_map
      <span class=keyword1><span class=command>using</span></span> setcompr_eq_image 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops'</span> <span class=main>∈</span> set <span class=var>?π'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>ops'</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=skolem>op</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> embedded_serial_strips_plan_operator_structure calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=free>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> that<span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-serial_strips_equivalent_to_serial_sas_plus_ii><span class=command>lemma</span></span> serial_strips_equivalent_to_serial_sas_plus_ii<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"concat <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Π</span> <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>π</span><span class=main>]</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List_Supplement.embed <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"concat <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Π</span> <span class=var>?π'</span><span class=main>)</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>)</span> <span class=main>(</span>concat <span class=var>?π'</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> strips_parallel_plan_to_sas_plus_parallel_plan_def
      SAS_Plus_STRIPS.strips_parallel_plan_to_sas_plus_parallel_plan_def
      strips_op_to_sasp_def
      SAS_Plus_STRIPS.strips_op_to_sasp_def Let_def
      map_concat 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>)</span> <span class=free>π</span>"</span></span> 
    <span class=keyword1><span class=command>unfolding</span></span> concat_is_inverse_of_embed<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>π</span></span><span class=main>]</span><span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"concat <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Π</span> <span class=main>(</span>embed <span class=free>π</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Π</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>π</span><span class=main>]</span>"</span></span><span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Using the analogous lemmas for the opposite direction, we can show the counterpart to 
theorem \ref{isathm:equivalence-serial-sas-plus-serial-strips} which shows that serial solutions 
to STRIPS solutions can be transformed to serial SAS+ solutions via composition of embedding, 
transformation and flattening. ›</span></span>

<span class=keyword1><span class=command>theorem</span></span> 
  serial_strips_equivalent_to_serial_sas_plus<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_serial_solution_for_problem <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>π</span><span class=main>]</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"embed <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub>¯</span> <span class=free>Ψ</span> <span class=var>?π'</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=var>?ψ'</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_parallel_solution_for_problem <span class=var>?Π</span> <span class=var>?π'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> embedding_lemma<span class=main>[</span><span class=operator>OF</span> 
          is_valid_problem_sas_plus_then_strips_transformation_too<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_parallel_solution_for_problem <span class=free>Ψ</span> <span class=var>?ψ'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sas_plus_equivalent_to_strips<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?ψ</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=free>π</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=var>?Π</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=var>?ψ'</span><span class=main>.</span> <span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=bound>ops</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>]</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> serial_strips_equivalent_to_serial_sas_plus_i
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> flattening_lemma<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Equivalence of SAS+ and STRIPS"</span></span> 

<span class=comment1>― ‹ Define the sets of plans with upper length bound as well as the sets of solutions with 
upper length bound for  SAS problems and induced STRIPS problems.

 We keep this polymorphic by not specifying concrete types so it applies to both STRIPS and 
SAS+ plans. ›</span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>bounded_plan_set</span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bounded_plan_set</span> <span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>≡</span> <span class=main>{</span> <span class=bound>π</span><span class=main>.</span> set <span class=bound>π</span> <span class=main>⊆</span> set <span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=main>∧</span> length <span class=bound>π</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bounded_solution_set_sas_plus'</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem 
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_plan set"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bounded_solution_set_sas_plus'</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span> 
    <span class=main>≡</span> <span class=main>{</span> <span class=bound>ψ</span><span class=main>.</span> is_serial_solution_for_problem <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=bound>ψ</span> <span class=main>∧</span> length <span class=bound>ψ</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>bounded_solution_set_sas_plus</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_problem 
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span><span class=main>,</span> <span class=tfree>'domain</span><span class=main>)</span> sas_plus_plan set"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bounded_solution_set_sas_plus</span> <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=free><span class=bound><span class=entity>N</span></span></span> 
    <span class=main>≡</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=free><span class=bound><span class=entity>N</span></span></span><span class=main>}</span><span class=main>.</span> bounded_solution_set_sas_plus' <span class=free><span class=bound><span class=entity>Ψ</span></span></span> <span class=bound>k</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bounded_solution_set_strips'</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> strips_problem 
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> strips_plan set"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bounded_solution_set_strips'</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span>
    <span class=main>≡</span> <span class=main>{</span> <span class=bound>π</span><span class=main>.</span> STRIPS_Semantics.is_serial_solution_for_problem <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>π</span> <span class=main>∧</span> length <span class=bound>π</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>bounded_solution_set_strips</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> strips_problem 
    <span class=main>⇒</span> nat 
    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'variable</span> <span class=main>×</span> <span class=tfree>'domain</span><span class=main>)</span> strips_plan set"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bounded_solution_set_strips</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>N</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=free><span class=bound><span class=entity>N</span></span></span><span class=main>}</span><span class=main>.</span> bounded_solution_set_strips' <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>k</span><span class=main>)</span>"</span></span>

<span class=comment1>― ‹ Show that plan transformation for all SAS Plus solutions yields a STRIPS solution for the
induced STRIPS problem with same length. 

We first show injectiveness of plan transformation <span class=antiquoted><span class=raw_text><span class=operator>‹</span>λψ. [φ<span class=hidden>⇩</span><sub>O</sub> Ψ op. op ← ψ]›</span></span> on the set of plans 
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>P<span class=hidden>⇩</span><sub>k</sub> ≡ bounded_plan_set (operators_of Ψ) k›</span></span> with length bound <span class=antiquoted><span class=raw_text><span class=operator>‹</span>k›</span></span>. The injectiveness of 
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>Sol<span class=hidden>⇩</span><sub>k</sub> ≡ bounded_solution_set_sas_plus Ψ k›</span></span>---the set of solutions with length bound <span class=antiquoted><span class=raw_text><span class=operator>‹</span>k›</span></span>--then 
follows from the subset relation <span class=antiquoted><span class=raw_text><span class=operator>‹</span>Sol<span class=hidden>⇩</span><sub>k</sub> ⊆ P<span class=hidden>⇩</span><sub>k</sub>›</span></span>. ›</span>
<span class=keyword1 id=SAS_Plus_STRIPS-sasp_op_to_strips_injective><span class=command>lemma</span></span> sasp_op_to_strips_injective<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
  <span class=keyword1><span class=command>proof</span></span>  <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?op<span class=hidden>⇩</span><sub>1</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> 
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?op<span class=hidden>⇩</span><sub>2</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"strips_operator.precondition_of <span class=var>?op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> strips_operator.precondition_of <span class=var>?op<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sas_plus_operator.precondition_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> sas_plus_operator.precondition_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def
          SAS_Plus_STRIPS.sasp_op_to_strips_def
          Let_def 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"strips_operator.add_effects_of <span class=var>?op<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> strips_operator.add_effects_of <span class=var>?op<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms 
        <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def Let_def 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sas_plus_operator.effect_of <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> sas_plus_operator.effect_of <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> sasp_op_to_strips_def Let_def
          SAS_Plus_STRIPS.sasp_op_to_strips_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_a><span class=command>lemma</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ψ</span><span class=main>]</span><span class=main>)</span> <span class=main>(</span>bounded_plan_set <span class=main>(</span>sas_plus_problem.operators_of <span class=free>Ψ</span><span class=main>)</span> <span class=free>k</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.operators_of <span class=free>Ψ</span>"</span></span>
      <span class=comment1>(* TODO refactor transformation definitions *)</span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ψ</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"bounded_plan_set <span class=var>?ops</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span>
      <span class=keyword3><span class=command>assume</span></span> ψ<span class=hidden>⇩</span><sub>1</sub>_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> <span class=var>?P</span> <span class=free>k</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> ψ<span class=hidden>⇩</span><sub>2</sub>_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> <span class=var>?P</span> <span class=free>k</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> φ<span class=hidden>⇩</span><sub>P</sub>_of_ψ<span class=hidden>⇩</span><sub>1</sub>_is_φ<span class=hidden>⇩</span><sub>P</sub>_of_ψ<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>k</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=quoted><span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> 0
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=main>0</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>0</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> ψ<span class=hidden>⇩</span><sub>1</sub>_in ψ<span class=hidden>⇩</span><sub>2</sub>_in
            <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_sas_plus'_def 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> Suc <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> Suc <span class=skolem>k</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> length_Suc_conv Suc<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span> 
            <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_sas_plus'_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>#</span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>#</span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span> <span class=main>⊆</span> set <span class=var>?ops</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> <span class=skolem>k</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>5<span class=main>)</span> Suc<span class=main>(</span>2<span class=main>)</span>
            <span class=keyword1><span class=command>unfolding</span></span> length_Suc_conv
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=skolem><span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>#</span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>#</span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span> <span class=main>⊆</span> set <span class=var>?ops</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>=</span> <span class=skolem>k</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>6<span class=main>)</span> Suc<span class=main>(</span>3<span class=main>)</span>
            <span class=keyword1><span class=command>unfolding</span></span> length_Suc_conv
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>⊆</span> set <span class=var>?ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>⊆</span> set <span class=var>?ops</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>8<span class=main>,</span> 11<span class=main>)</span> 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>∈</span> <span class=var>?P</span> <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>∈</span> <span class=var>?P</span> <span class=skolem>k</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>9<span class=main>,</span> 12<span class=main>,</span> 13<span class=main>,</span> 14<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>3<span class=main>)</span> calculation<span class=main>(</span>7<span class=main>,</span> 10<span class=main>)</span> 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=main>=</span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Suc.IH<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span></span> <span class=quoted><span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span></span><span class=main>,</span> <span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>15<span class=main><span class=main>,</span></span> 16<span class=main><span class=main>,</span></span> 17<span class=main><span class=main>)</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>#</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>1</sub>'</span>"</span></span> 
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>#</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ<span class=hidden>⇩</span><sub>2</sub>'</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>3<span class=main>)</span> calculation<span class=main>(</span>7<span class=main>,</span> 10<span class=main>)</span> 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>3<span class=main>)</span> calculation<span class=main>(</span>17<span class=main>,</span> 19<span class=main>,</span> 20<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> 
            <span class=keyword1><span class=command>using</span></span> sasp_op_to_strips_injective<span class=main>[</span><span class=operator>OF</span> calculation<span class=main><span class=main>(</span></span>21<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> inj_on_def 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1><span class=command>corollary</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_b<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ψ</span><span class=main>]</span><span class=main>)</span> <span class=main>(</span>bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sas_plus_problem.operators_of <span class=free>Ψ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ψ</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ψ</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ</span> <span class=main>∈</span> bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span>"</span></span> 
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>ψ</span> <span class=main>⊆</span> set <span class=var>?ops</span>"</span></span> 
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ</span> <span class=main>=</span> <span class=free>k</span>"</span></span> 
        <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_sas_plus'_def is_serial_solution_for_problem_def Let_def 
          list_all_iff ListMem_iff 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ</span> <span class=main>∈</span> bounded_plan_set <span class=var>?ops</span> <span class=free>k</span>"</span></span> 
         <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span> <span class=main>⊆</span> bounded_plan_set <span class=var>?ops</span> <span class=free>k</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>(</span>bounded_plan_set <span class=var>?ops</span> <span class=free>k</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> inj_on_subset<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=quoted><span class=quoted>"bounded_plan_set <span class=var>?ops</span> <span class=free>k</span>"</span></span> <span class=quoted><span class=quoted>"bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(*
lemma "card ((λψ. [φ<span class=hidden>⇩</span><sub>O</sub> Ψ op. op ← ψ]) ` (bounded_solution_set_sas_plus' Ψ k)) 
  = card (bounded_solution_set_strips' (φ Ψ) k)"  sorry
*)</span>

<span class=comment1>― ‹ Show that mapping plan transformation <span class=antiquoted><span class=raw_text><span class=operator>‹</span>λψ. [φ<span class=hidden>⇩</span><sub>O</sub> Ψ op. op ← ψ]›</span></span> over the solution set for a 
given SAS+ problem yields the solution set for the induced STRIPS problem. ›</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_c><span class=command>lemma</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_c<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ψ</span><span class=main>]</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span>bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span><span class=main>)</span> 
    <span class=main>=</span> bounded_solution_set_strips' <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>k</span>"</span></span> 
 <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
   <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
     <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ψ</span><span class=main>]</span>"</span></span>
   <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"bounded_solution_set_strips' <span class=var>?Π</span> <span class=free>k</span>"</span></span>
   <span class=keyword1><span class=command>{</span></span>
     <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>`</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>≠</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span> 
     <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>π</span> <span class=main>∈</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>`</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span><span class=main>.</span> <span class=bound>π</span> <span class=main>∉</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span>
       <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>π</span> <span class=main>∈</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span><span class=main>.</span> <span class=bound>π</span> <span class=main>∉</span>  <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>`</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
     <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span> 
       <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
         <span class=keyword3><span class=command>case</span></span> A
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>π</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∈</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>`</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∉</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> calculation
           <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ψ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ</span> <span class=main>=</span> <span class=free>k</span>"</span></span> 
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> <span class=skolem>ψ</span>"</span></span> 
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>=</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=skolem>ψ</span>"</span></span> 
           <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span>
           <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_sas_plus'_def 
           <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>π</span> <span class=main>=</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_serial_solution_for_problem <span class=var>?Π</span> <span class=skolem>π</span>"</span></span>
           <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> 
             <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>,</span> 6<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
           <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
             <span class=keyword1><span class=command>using</span></span> serial_sas_plus_equivalent_to_serial_strips
               assms<span class=main>(</span>1<span class=main>)</span> calculation<span class=main>(</span>5<span class=main>)</span> calculation<span class=main>(</span>6<span class=main>)</span> 
             <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
           <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∈</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span> 
           <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_strips'_def 
           <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>7<span class=main>,</span> 8<span class=main>)</span> 
           <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
         <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
           <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
       <span class=keyword1><span class=command>next</span></span>
         <span class=keyword3><span class=command>case</span></span> B
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>π</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∈</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∉</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>`</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> calculation
           <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_serial_solution_for_problem <span class=var>?Π</span> <span class=skolem>π</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>π</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>)</span>
           <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_strips'_def 
           <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
         <span class=comment1>― ‹ Construct the counter example <span class=antiquoted><span class=raw_text><span class=operator>‹</span>ψ ≡ [φ<span class=hidden>⇩</span><sub>O</sub>¯ ?Π op. op ← π]›</span></span> and show that <span class=antiquoted><span class=raw_text><span class=operator>‹</span>ψ ∈ ?Sol<span class=hidden>⇩</span><sub>k</sub>›</span></span>
            as well as <span class=antiquoted><span class=raw_text><span class=operator>‹</span>?φ<span class=hidden>⇩</span><sub>P</sub> ψ = π›</span></span> hence <span class=antiquoted><span class=raw_text><span class=operator>‹</span>π ∈ ?φ<span class=hidden>⇩</span><sub>P</sub> ` ?Sol<span class=hidden>⇩</span><sub>k</sub>›</span></span>. ›</span>
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>π</span><span class=main>]</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>π</span><span class=main>]</span>"</span></span> 
           <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> 
             <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>5<span class=main>)</span> 
             <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
           <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> 
             <span class=keyword1><span class=command>using</span></span> serial_strips_equivalent_to_serial_sas_plus<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
               calculation<span class=main>(</span>4<span class=main>)</span>
             <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
           <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>π</span><span class=main>]</span> <span class=main>∈</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> 
           <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_sas_plus'_def 
           <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>6<span class=main>,</span> 7<span class=main>)</span> 
           <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
         <span class=comment1>(* TODO refactor transformation lemmas *)</span>
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
           <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=skolem>π</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
             <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>4<span class=main>)</span>
             <span class=keyword1><span class=command>unfolding</span></span> STRIPS_Semantics.is_serial_solution_for_problem_def list_all_iff ListMem_iff
             <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
           <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>π</span><span class=main>]</span> <span class=main>=</span> <span class=skolem>π</span>"</span></span> 
             <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>π</span></span><span class=main>)</span>
               <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op</span> <span class=skolem>π</span><span class=main>)</span>
               <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>op</span> <span class=main>#</span> <span class=skolem>π</span><span class=main>]</span> 
                <span class=main>=</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>#</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>π</span><span class=main>]</span>"</span></span>
                 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
               <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span>  set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span> 
                 <span class=keyword1><span class=command>using</span></span> Cons.prems
                 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
               <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=main>(</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>op</span>"</span></span>
                 <span class=keyword1><span class=command>using</span></span> strips_operator_inverse_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
               <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>π</span><span class=main>]</span> <span class=main>=</span> <span class=skolem>π</span>"</span></span> 
                 <span class=keyword1><span class=command>using</span></span> Cons.IH Cons.prems 
                 <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
               <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
                 <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
             <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
         <span class=keyword1><span class=command>}</span></span>
         <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∈</span> <span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>`</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> 
           <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>8<span class=main>,</span> 9<span class=main>)</span> 
           <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
         <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
           <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>qed</span></span>
   <span class=keyword1><span class=command>}</span></span>
   <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
     <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_d><span class=command>lemma</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_d<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span><span class=main>)</span> <span class=main>≤</span> card <span class=main>(</span>bounded_solution_set_strips' <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ψ</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"bounded_solution_set_strips' <span class=var>?Π</span> <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span><span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>`</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span><span class=main>)</span> <span class=main>=</span> card <span class=main>(</span><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span><span class=main>)</span>"</span></span>
     <span class=keyword1><span class=command>using</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_b<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
       card_image 
     <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>`</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>=</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span>
     <span class=keyword1><span class=command>using</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_c<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
     <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ The set of fixed length plans with operators in a given operator set is finite. ›</span>
<span class=keyword1 id=SAS_Plus_STRIPS-bounded_plan_set_finite><span class=command>lemma</span></span> bounded_plan_set_finite<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>{</span> <span class=bound>π</span><span class=main>.</span> set <span class=bound>π</span> <span class=main>⊆</span> set <span class=free>ops</span> <span class=main>∧</span> length <span class=bound>π</span> <span class=main>=</span> <span class=free>k</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>k</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=bound>π</span><span class=main>.</span> set <span class=bound>π</span> <span class=main>⊆</span> set <span class=free>ops</span> <span class=main>∧</span> length <span class=bound>π</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?P'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=bound>π</span><span class=main>.</span> set <span class=bound>π</span> <span class=main>⊆</span> set <span class=free>ops</span> <span class=main>∧</span> length <span class=bound>π</span> <span class=main>=</span> Suc <span class=skolem>k</span> <span class=main>}</span>"</span></span>  
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P''</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span><span class=main>.</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>π</span> <span class=main>∈</span> <span class=var>?P</span><span class=main>.</span> <span class=main>{</span> <span class=bound>op</span> <span class=main>#</span> <span class=bound>π</span> <span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span> 
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=bound>π</span><span class=main>.</span> finite <span class=main>{</span> <span class=bound>op</span> <span class=main>#</span> <span class=bound>π</span> <span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span><span class=main>.</span> finite <span class=main>(</span><span class=main>⋃</span><span class=bound>π</span> <span class=main>∈</span> <span class=var>?P</span><span class=main>.</span> <span class=main>{</span> <span class=bound>op</span> <span class=main>#</span> <span class=bound>π</span> <span class=main>}</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> finite_UN<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?P</span></span></span><span class=main>]</span> Suc 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"finite <span class=var>?P''</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> finite_UN<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"set <span class=free>ops</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>π</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∈</span> <span class=var>?P'</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>π</span> <span class=main>⊆</span> set <span class=free>ops</span>"</span></span> 
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>π</span> <span class=main>=</span> Suc <span class=skolem>k</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> <span class=skolem><span class=skolem>π'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>=</span> <span class=skolem>op</span> <span class=main>#</span> <span class=skolem>π'</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation <span class=main>(</span>3<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> length_Suc_conv 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>π'</span> <span class=main>⊆</span> set <span class=free>ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>,</span> 4<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>π'</span> <span class=main>=</span> <span class=skolem>k</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>,</span> 4<span class=main>)</span> 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π'</span> <span class=main>∈</span> <span class=var>?P</span>"</span></span> 
          <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>5<span class=main>,</span> 7<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∈</span> <span class=var>?P''</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?P'</span> <span class=main>⊆</span> <span class=var>?P''</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
      <span class=keyword1><span class=command>using</span></span> rev_finite_subset<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?P''</span></span></span> <span class=var><span class=quoted><span class=var>?P'</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>force</span>

<span class=comment1>― ‹ The set of fixed length SAS+ solutions are subsets of the set of plans with fixed length and 
therefore also finite. ›</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_a><span class=command>lemma</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=main>(</span><span class=free>Ψ</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub><span class=hidden>⇩</span><sub>+</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=free>k</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?P<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=bound>π</span><span class=main>.</span> set <span class=bound>π</span> <span class=main>⊆</span> <span class=var>?Ops</span> <span class=main>∧</span> length <span class=bound>π</span> <span class=main>=</span> <span class=free>k</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ψ</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ</span> <span class=main>∈</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>ψ</span> <span class=main>=</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>ψ</span> <span class=main>⊆</span> <span class=var>?Ops</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_sas_plus'_def 
        SAS_Plus_Semantics.is_serial_solution_for_problem_def Let_def list_all_iff ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ψ</span> <span class=main>∈</span> <span class=var>?P<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>⊆</span> <span class=var>?P<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> bounded_plan_set_finite rev_finite_subset<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?P<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=var><span class=quoted><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ The set of fixed length STRIPS solutions are subsets of the set of plans with fixed length and 
therefore also finite. ›</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAS_Plus_STRIPS-sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_b><span class=command>lemma</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_b<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>bounded_solution_set_strips' <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=main>(</span><span class=var>?Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"bounded_solution_set_strips' <span class=var>?Π</span> <span class=free>k</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?P<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=bound>π</span><span class=main>.</span> set <span class=bound>π</span> <span class=main>⊆</span> <span class=var>?Ops</span> <span class=main>∧</span> length <span class=bound>π</span> <span class=main>=</span> <span class=free>k</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>π</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∈</span> <span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>π</span> <span class=main>=</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>π</span> <span class=main>⊆</span> <span class=var>?Ops</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_strips'_def 
        STRIPS_Semantics.is_serial_solution_for_problem_def Let_def list_all_iff ListMem_iff
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>π</span> <span class=main>∈</span> <span class=var>?P<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>⊆</span> <span class=var>?P<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> bounded_plan_set_finite rev_finite_subset<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?P<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=var><span class=quoted><span class=var>?Sol<span class=hidden>⇩</span><sub>k</sub></span></span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>unfolding</span></span> state_to_strips_state_def
      SAS_Plus_STRIPS.state_to_strips_state_def operators_of_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ With the results on the equivalence of SAS+ and STRIPS solutions, we can now show that given 
problems in both formalisms, the solution sets have the same size.
This is the property required by the definition of planning formalism equivalence presented earlier 
in theorem \ref{thm:solution-sets-sas-plus-strips-f} (\autoref{sub:equivalence-sas-plus-strips}) and 
thus end up with the desired equivalence result.

The proof uses the finiteness and disjunctiveness of the solution sets for either problem to be 
able to equivalently transform the set cardinality over the union of sets of solutions with bounded 
lengths into a sum over the cardinality of the sets of solutions with bounded length. Moreover, 
since we know that for each SAS+ solution with a given length an equivalent STRIPS solution exists 
in the solution set of the transformed problem with the same length, both sets must have the same 
cardinality. 

Hence the cardinality of the  SAS+ solution set over all lengths up to a given upper bound <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>N</span></span>›</span></span></span></span> 
has the same size as the solution set of the corresponding STRIPS problem over all length up to a 
given upper bound <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>N</span></span>›</span></span></span></span>. ›</span></span>

<span class=keyword1><span class=command>theorem</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>bounded_solution_set_sas_plus <span class=free>Ψ</span> <span class=free>N</span><span class=main>)</span> 
    <span class=main>=</span> card <span class=main>(</span>bounded_solution_set_strips <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>N</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?R</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=free>N</span><span class=main>}</span>"</span></span> 
    <span class=comment1>― ‹ Due to the disjoint nature of the bounded solution sets for fixed plan length for different 
    lengths, we can sum the individual set cardinality to obtain the cardinality of the overall SAS+ 
    resp. STRIPS solution sets. ›</span>
    <span class=keyword1><span class=command>have</span></span> finite_R<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=var>?R</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span> <span class=main>∈</span> <span class=var>?R</span><span class=main>.</span> finite <span class=main>(</span>bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=bound>k</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_a<span class=main>[</span><span class=operator>OF</span> 
            assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span> <span class=main>∈</span> <span class=var>?R</span><span class=main>.</span> <span class=main>∀</span><span class=bound>k</span> <span class=main>∈</span> <span class=var>?R</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=bound>k</span> 
        <span class=main>⟶</span> bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=bound>j</span> 
          <span class=main>∩</span> bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=bound>k</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_sas_plus'_def 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=comment1>(* TODO slow. *)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>bounded_solution_set_sas_plus <span class=free>Ψ</span> <span class=free>N</span><span class=main>)</span>
        <span class=main>=</span> <span class=main>(</span><span class=main>∑</span><span class=bound>k</span> <span class=main>∈</span> <span class=var>?R</span><span class=main>.</span> card <span class=main>(</span>bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> card_UN_disjoint 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span> <span class=main>∈</span> <span class=var>?R</span><span class=main>.</span> finite <span class=main>(</span>bounded_solution_set_strips' <span class=var>?Π</span> <span class=bound>k</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_ii_b<span class=main>[</span><span class=operator>OF</span> 
            assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span> <span class=main>∈</span> <span class=var>?R</span><span class=main>.</span> <span class=main>∀</span><span class=bound>k</span> <span class=main>∈</span> <span class=var>?R</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=bound>k</span> 
        <span class=main>⟶</span> bounded_solution_set_strips' <span class=var>?Π</span> <span class=bound>j</span> 
          <span class=main>∩</span> bounded_solution_set_strips' <span class=var>?Π</span> <span class=bound>k</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> bounded_solution_set_strips'_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=comment1>(* TODO slow. *)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>bounded_solution_set_strips <span class=var>?Π</span> <span class=free>N</span><span class=main>)</span>
        <span class=main>=</span> <span class=main>(</span><span class=main>∑</span><span class=bound>k</span> <span class=main>∈</span> <span class=var>?R</span><span class=main>.</span> card <span class=main>(</span>bounded_solution_set_strips' <span class=var>?Π</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> card_UN_disjoint
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=skolem>k</span><span class=main>)</span>
        <span class=main>=</span> card <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>ψ</span><span class=main>.</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ψ</span><span class=main>]</span><span class=main>)</span> 
          <span class=main>`</span> bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_b<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
          card_image<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>bounded_solution_set_sas_plus' <span class=free>Ψ</span> <span class=skolem>k</span><span class=main>)</span>
        <span class=main>=</span> card <span class=main>(</span>bounded_solution_set_strips' <span class=var>?Π</span> <span class=skolem>k</span><span class=main>)</span>"</span></span> 
        <span class=keyword1><span class=command>using</span></span> sas_plus_formalism_and_induced_strips_formalism_are_equally_expressive_i_c<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>}</span></span> 
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>qed</span></span>


<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=SAT_Plan_Base><div class=head><h1>Theory SAT_Plan_Base</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> SAT_Plan_Base
  <span class=keyword2><span class=keyword>imports</span></span>  <span class=quoted>"<a href=../List-Index/List_Index.html>List-Index.List_Index</a>"</span>
    <span class=quoted>"<a href=../Propositional_Proof_Systems/Formulas.html>Propositional_Proof_Systems.Formulas</a>"</span>
    <span class=quoted>"<a href=STRIPS_Semantics.html>STRIPS_Semantics</a>"</span>
    <span class=quoted>"<a href=Map_Supplement.html>Map_Supplement</a>"</span> <span class=quoted>"<a href=List_Supplement.html>List_Supplement</a>"</span>
    <span class=quoted>"<a href=CNF_Semantics_Supplement.html>CNF_Semantics_Supplement</a>"</span> <span class=quoted>"<a href=CNF_Supplement.html>CNF_Supplement</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>― ‹ Hide constant and notation for \isaname{Orderings.bot_class.bot} (<span class=antiquoted><span class=raw_text><span class=operator>‹</span>⊥›</span></span>) to prevent warnings. ›</span>
<span class=keyword1><span class=command>hide_const</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>open</span></span><span class=main>)</span> Orderings.bot_class.bot
<span class=keyword1><span class=command>no_notation</span></span> Orderings.bot_class.bot <span class=main>(</span><span class=quoted>"<span class=keyword1>⊥</span>"</span><span class=main>)</span>

<span class=comment1>― ‹ Hide constant and notation for \isaname{Transitive_Closure.trancl} (<span class=antiquoted><span class=raw_text><span class=operator>‹</span>(_<span class=hidden>⇧</span><sup>+</sup>)›</span></span>) to prevent
warnings. ›</span>
<span class=keyword1><span class=command>hide_const</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>open</span></span><span class=main>)</span> Transitive_Closure.trancl
<span class=keyword1><span class=command>no_notation</span></span> Transitive_Closure.trancl <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1><span class=hidden>⇧</span><sup>+</sup></span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>

<span class=comment1>― ‹ Hide constant and notation for \isaname{Relation.converse} (<span class=antiquoted><span class=raw_text><span class=operator>‹</span>(_<span class=hidden>⇧</span><sup>+</sup>)›</span></span>) to prevent
warnings. ›</span>
<span class=keyword1><span class=command>hide_const</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>open</span></span><span class=main>)</span> Relation.converse
<span class=keyword1><span class=command>no_notation</span></span> Relation.converse  <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword1>¯</span><span class=keyword3>)</span>"</span> <span class=main>[</span>1000<span class=main>]</span> 999<span class=main>)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"The Basic SATPlan Encoding"</span></span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We now move on to the formalization of the basic SATPlan encoding (see
\autoref{def:basic-sat-plan-encoding-strips-problem}).

The two major results that we will obtain here are the soundness and completeness result outlined
in \autoref{thm:soundness-and-completeness-satplan-base} in
\autoref{sub:soundness-completeness-satplan}.

Let in the following <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Φ ≡ encode_to_sat Π t›</span></span></span></span> denote the SATPlan encoding for a STRIPS problem <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Π›</span></span></span></span>
and makespan <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>t›</span></span></span></span>. Let <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>I ≡ (Π)<span class=hidden>⇩</span><sub>I</sub>›</span></span></span></span> be the initial state of <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Π›</span></span></span></span>, <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>G ≡ (Π)<span class=hidden>⇩</span><sub>G</sub>›</span></span></span></span> be
its goal state, <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>𝒱 ≡ (Π)<span class=hidden>⇩</span><sub>𝒱</sub>›</span></span></span></span> its variable set, and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>𝒪 ≡ (Π)<span class=hidden>⇩</span><sub>𝒪</sub>›</span></span></span></span> its operator set. ›</span></span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Encoding Function Definitions"</span></span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Since the SATPlan encoding uses propositional variables for both operators and state
variables of the problem as well as time points, we define a datatype using separate constructors
---<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>State</span></span> <span class=free><span class=free>k</span></span> <span class=free><span class=free>n</span></span>›</span></span></span></span> for state variables resp. <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Operator</span></span> <span class=free><span class=free>k</span></span> <span class=free><span class=free>n</span></span>›</span></span></span></span> for operator activation---to
facilitate case distinction.
The natural number values store the time index resp. the indexes of the variable or operator
within their lists in the problem representation.
% TODO Note on why formulas are used instead of CNF (simple representation and good basis; e.g.
% export to cnf lists using CNF_Formulas.cnf_lists) ›</span></span>

<span class=keyword1><span class=command>datatype</span></span>  sat_plan_variable <span class=main>=</span>
  State <span class=quoted>nat</span> <span class=quoted>nat</span>
  <span class=main>|</span> Operator <span class=quoted>nat</span> <span class=quoted>nat</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ A SATPlan formula is a regular propositional formula over SATPlan variables. We add a type
synonym to improve readability. ›</span></span>

<span class=keyword1><span class=command>type_synonym</span></span>  sat_plan_formula <span class=main>=</span> <span class=quoted><span class=quoted>"sat_plan_variable formula"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We now continue with the concrete definitions used in the implementation of the SATPlan
encoding.  State variables are encoded as literals over SATPlan variables using the <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>State›</span></span></span></span>
constructor of \isaname{sat_plan_variable}. ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>encode_state_variable</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat <span class=main>⇒</span> bool option <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_state_variable</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=keyword1>of</span>
    Some True <span class=main>⇒</span> Atom <span class=main>(</span>State <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span>
    <span class=main>|</span> Some False <span class=main>⇒</span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ The initial state encoding (definition \ref{isadef:initial-state-encoding}) is a conjunction
of state variable encodings <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>A</span></span> <span class=main><span class=main>≡</span></span> encode_state_variable <span class=main><span class=main>0</span></span> <span class=free><span class=free>n</span></span> <span class=free><span class=free>b</span></span>›</span></span></span></span> with <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>n ≡ index vs v›</span></span></span></span> and
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>b</span></span> <span class=main><span class=main>≡</span></span> <span class=free><span class=free>I</span></span> <span class=free><span class=free>v</span></span> <span class=main><span class=main>=</span></span> Some True›</span></span></span></span> for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>𝒱</span></span>›</span></span></span></span>. As we can see below, the same function but
substituting the initial state with the goal state and zero with the makespan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>t</span></span>›</span></span></span></span> produces the
goal state encoding (\ref{isadef:goal-state-encoding}).
Note that both functions construct a conjunction of clauses <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>A <span class=hidden>❙</span><b>∨</b> ⊥›</span></span></span></span> for which it
is easy to show that we can normalize to conjunctive normal form (CNF). ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>encode_initial_state</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem <span class=main>⇒</span> sat_plan_variable formula"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_initial_state</span> <span class=free><span class=bound><span class=entity>Π</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>I</span> <span class=main>=</span> initial_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
        <span class=main>;</span> <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=keyword1>in</span> <span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=bound>I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
    <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=bound>I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=bound>vs</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>encode_goal_state</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem <span class=main>⇒</span> nat <span class=main>⇒</span> sat_plan_variable formula"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_goal_state</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>G</span> <span class=main>=</span> goal_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
    <span class=keyword1>in</span> <span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=bound>G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
      <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=bound>G</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=bound>vs</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Operator preconditions are encoded using activation-implies-precondition formulation as
mentioned in \autoref{subsub:basic-sat-plan-encoding}: i.e. for each
operator <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>𝒪</span></span>›</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>p</span></span> <span class=main><span class=main>∈</span></span> set <span class=main><span class=main>(</span></span>precondition_of <span class=free><span class=free>op</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> we have to encode
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"Atom (Operator k (index ops op)) <span class=hidden>❙</span><b>→</b> Atom (State k (index vs v))"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
We use the equivalent disjunction in the formalization to simplify conversion to CNF.

›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>encode_operator_precondition</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator
    <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_operator_precondition</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
    <span class=keyword1>in</span> <span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span>
        <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>ops</span> <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>encode_all_operator_preconditions</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator list
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_all_operator_preconditions</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>l</span> <span class=main>=</span> List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>]</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
    <span class=keyword1>in</span> foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_precondition <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=bound>l</span><span class=main>)</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Analogously to the operator precondition, add and delete effects of operators have to be
implied by operator activation. That being said, we have to encode both positive and negative
effects and the effect must be active at the following time point: i.e.
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"Atom (Operator k m) <span class=hidden>❙</span><b>→</b> Atom (State (Suc k) n)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
for add effects respectively
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"Atom (Operator k m) <span class=hidden>❙</span><b>→</b> <span class=hidden>❙</span><b>¬</b>Atom (State (Suc k) n)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
for delete effects. We again encode the implications as their equivalent disjunctions in
definition \ref{isadef:operator-effect-encoding}. ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>encode_operator_effect</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator
    <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_operator_effect</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span>
        <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
        <span class=main>;</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=keyword1>in</span> <span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span>
              <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>ops</span> <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
              <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
            <span class=main>(</span>add_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span>
          <span class=main>@</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span>
              <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>ops</span> <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
               <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
            <span class=main>(</span>delete_effects_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>encode_all_operator_effects</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator list
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_all_operator_effects</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>ops</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>l</span> <span class=main>=</span> List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>]</span> <span class=free><span class=bound><span class=entity>ops</span></span></span>
      <span class=keyword1>in</span> foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_effect <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=bound>l</span><span class=main>)</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>encode_operators</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem <span class=main>⇒</span> nat <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_operators</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=keyword1>in</span> encode_all_operator_preconditions <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>ops</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main><span class=hidden>❙</span><b>∧</b></span> encode_all_operator_effects <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>ops</span> <span class=free><span class=bound><span class=entity>t</span></span></span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹

Definitions \ref{isadef:negative-transition-frame-axiom-encoding} and
\ref{isadef:positive-transition-frame-axiom-encoding} similarly encode the negative resp. positive
transition frame axioms as disjunctions.  ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>encode_negative_transition_frame_axiom</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span>
    <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_negative_transition_frame_axiom</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
        <span class=main>;</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
        <span class=main>;</span> <span class=bound>deleting_operators</span> <span class=main>=</span> filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=bound>ops</span>
      <span class=keyword1>in</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>vs</span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
          <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>(</span>index <span class=bound>vs</span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span><span class=main>)</span>
          <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>deleting_operators</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>encode_positive_transition_frame_axiom</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span>
    <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_positive_transition_frame_axiom</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
        <span class=main>;</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
        <span class=main>;</span> <span class=bound>adding_operators</span> <span class=main>=</span> filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=bound>ops</span>
      <span class=keyword1>in</span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>vs</span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span><span class=main>)</span>
          <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>(</span>index <span class=bound>vs</span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
          <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>(</span>index <span class=bound>ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>adding_operators</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>encode_all_frame_axioms</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem <span class=main>⇒</span> nat <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_all_frame_axioms</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>l</span> <span class=main>=</span> List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>]</span> <span class=main>(</span>variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span>
      <span class=keyword1>in</span> <span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_negative_transition_frame_axiom <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>l</span>
            <span class=main>@</span> map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_positive_transition_frame_axiom <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>l</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Finally, the basic SATPlan encoding is the
conjunction of the initial state, goal state, operator and frame axiom encoding for all time steps.
The functions \isaname{encode_operators} and \isaname{encode_all_frame_axioms}\footnote{Not shown.}
take care of mapping the operator precondition, effect and frame axiom encoding over all possible
combinations of time point and operators resp. time points, variables, and operators. ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>encode_problem</span> <span class=main>(</span><span class=quoted>"<span class=keyword1>Φ</span> _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_problem</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
    <span class=main>≡</span> encode_initial_state <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span>encode_operators <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
      <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span>encode_all_frame_axioms <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
      <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span>encode_goal_state <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Decoding Function Definitions"</span></span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Decoding plans from a valuation <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> of a
SATPlan encoding entails extracting all activated operators for all
time points except the last one. We implement this by mapping over all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span>
 and extracting activated operators---i.e. operators for which the model valuates the respective
operator encoding at time <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> to true---into a parallel operator (see definition
\ref{isadef:satplan-plan-decoding}).
\footnote{This is handled by function \texttt{decode\_plan'} (not shown).} ›</span></span>

<span class=comment1>― ‹ Note that due to the implementation based on lists, we have to address the problem of duplicate
operator declarations in the operator list of the problem. Since <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹index <span class=free>op</span> <span class=main>=</span> index <span class=free>op'</span>›</span></span> for equal
operators, the parallel operator obtained from \isaname{decode_plan'} will contain
duplicates in case the problem's operator list does. We therefore remove duplicates first using
<span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹remdups <span class=free>ops</span>›</span></span> and then filter out activated operators. ›</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>decode_plan'</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> sat_plan_variable valuation
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>decode_plan'</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>𝒜</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
        <span class=main>;</span> <span class=bound>vs</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Operator <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>(</span>index <span class=bound>ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>remdups <span class=bound>ops</span><span class=main>)</span>
      <span class=keyword1>in</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=keyword1>case</span> <span class=bound>v</span> <span class=keyword1>of</span> Operator <span class=main><span class=bound>_</span></span> <span class=bound>k</span> <span class=main>⇒</span> <span class=bound>ops</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>filter <span class=free><span class=bound><span class=entity>𝒜</span></span></span> <span class=bound>vs</span><span class=main>)</span>"</span></span>


<span class=comment1>― ‹ We decode maps over range <span class=antiquoted><span class=raw_text><span class=operator>‹</span>0, …, t - 1›</span></span> because the last operator takes effect in <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>t</span>›</span></span> and
must therefore have been applied in step <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>t</span> <span class=main>-</span> <span class=main>1</span>›</span></span>. ›</span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>decode_plan</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> sat_plan_variable valuation
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_parallel_plan"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>Φ¯</span> _ _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>decode_plan</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>𝒜</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> map <span class=main>(</span>decode_plan' <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>𝒜</span></span></span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Similarly to the operator decoding, we can decode a state at time <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> from a valuation
of of the SATPlan encoding <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> by constructing a map from list of assignments
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=free><span class=free>v</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>𝒜</span></span> <span class=main><span class=main>(</span></span>State <span class=free><span class=free>k</span></span> <span class=main><span class=main>(</span></span>index <span class=free><span class=free>vs</span></span> <span class=free><span class=free>v</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>𝒱</span></span>›</span></span></span></span>. ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>decode_state_at</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> sat_plan_variable valuation
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> _ _ _"</span> 99<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>decode_state_at</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>𝒜</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>state_encoding_to_assignment</span> <span class=main>=</span> <span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>𝒜</span></span></span> <span class=main>(</span>State <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=keyword1>in</span> map_of <span class=main>(</span>map <span class=bound>state_encoding_to_assignment</span> <span class=bound>vs</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We continue by setting up the \isaname{sat_plan} context for the proofs of soundness and
completeness. ›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>encode_transitions</span> <span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem <span class=main>⇒</span> nat <span class=main>⇒</span> sat_plan_variable formula"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>T</sub></span> _ _"</span> 99<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>encode_transitions</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
      <span class=main>≡</span> SAT_Plan_Base.encode_operators <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main><span class=hidden>❙</span><b>∧</b></span>
        SAT_Plan_Base.encode_all_frame_axioms <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>"</span></span>

<span class=comment1>― ‹ Immediately proof the sublocale proposition for strips in order to gain access to definitions
and lemmas. ›</span>

<span class=comment1>― ‹ Setup simp rules. ›</span>
<span class=keyword1><span class=command>lemma</span></span>   <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"encode_transitions <span class=free>Π</span> <span class=free>t</span>
    <span class=main>=</span> SAT_Plan_Base.encode_operators <span class=free>Π</span> <span class=free>t</span> <span class=main><span class=hidden>❙</span><b>∧</b></span>
      SAT_Plan_Base.encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def encode_initial_state_def encode_transitions_def
    encode_goal_state_def decode_plan_def decode_state_at_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>context</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_state_variable_is_lit_plus_if><span class=command>lemma</span></span> encode_state_variable_is_lit_plus_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> dom <span class=free>s</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_lit_plus <span class=main>(</span>encode_state_variable <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span><span class=free>s</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>s_of_v_is_some_true<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
    <span class=main>|</span> <span class=main>(</span>s_of_v_is_some_false<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-is_cnf_encode_initial_state><span class=command>lemma</span></span> is_cnf_encode_initial_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
    <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> c_in_set_l<span class=main>:</span><span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span> <span class=main>`</span>
      set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span>"</span></span>
          <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span> <span class=main>`</span>
      <span class=main>{</span><span class=bound><span class=bound>v</span></span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_filter<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None"</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> c_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=skolem>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> I_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword1><span class=command>using</span></span> c_in_set_l
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>(* TODO refactor. *)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?I</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> I_of_v_is_not_None
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_lit_plus <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> encode_state_variable_is_lit_plus_if<span class=main>[</span><span class=operator>OF</span> _ calculation<span class=main>]</span> assms<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_lit_plus <span class=main>⊥</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=skolem>C</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> c_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
      <span class=keyword1><span class=command>using</span></span> c_is
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_initial_state_def SAT_Plan_Base.encode_initial_state_def Let_def initial_of_def
    <span class=keyword1><span class=command>using</span></span> is_cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?l</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> is_cnf_BigAnd<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_goal_state_is_cnf><span class=command>lemma</span></span> encode_goal_state_is_cnf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_goal_state <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
      <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
    <span class=comment1>(* TODO refactor (lemma ‹encode_goal_state_is_cnf_i›) *)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
        <span class=main>`</span> set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> set_map
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>{</span> encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span>
        <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=keyword2><span class=keyword>where</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=skolem>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span> "</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> G_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>(* TODO refactor. *)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?G</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> G_of_v_is_not_None
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_lit_plus <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> calculation
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> encode_state_variable_is_lit_plus_if<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_lit_plus <span class=main>⊥</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=skolem>C</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> C_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_goal_state_def SAT_Plan_Base.encode_goal_state_def Let_def
    <span class=keyword1><span class=command>using</span></span> is_cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?l</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-encode_operator_precondition_is_cnf><span class=command>lemma</span></span> encode_operator_precondition_is_cnf<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_operator_precondition <span class=free>Π</span> <span class=free>k</span> <span class=free>op</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main>`</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>{</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
      <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> set_l_is <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_l_is
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_operator_precondition_def
    <span class=keyword1><span class=command>using</span></span> is_cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?l</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-set_map_operator_precondition><span class=command>lemma</span></span> set_map_operator_precondition<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>)</span> <span class=main>(</span>List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=free>ops</span><span class=main>)</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>)</span> <span class=var>?l'</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> set_l'_is<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=var>?l'</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=free>ops</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>)</span>
      <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=free>ops</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map set_l'_is
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>{</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=free>ops</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> setcompr_eq_image
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs</span>  <span class=main>=</span> <span class=main>{</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span>
      <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=free>ops</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-is_cnf_encode_all_operator_preconditions><span class=command>lemma</span></span> is_cnf_encode_all_operator_preconditions<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_all_operator_preconditions <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>)</span> <span class=var>?l'</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=var>?fs</span><span class=main>.</span> is_cnf <span class=bound>f</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_operator_precondition_is_cnf
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_all_operator_preconditions_def
    <span class=keyword1><span class=command>using</span></span> is_cnf_foldr_and_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor Appendix *)</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-set_map_or><span class=command>lemma</span></span> set_map_or<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>A</span> <span class=bound>v</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>B</span> <span class=bound>v</span><span class=main>)</span> <span class=free>vs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=free>A</span> <span class=bound>v</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>B</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=free>vs</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>A</span> <span class=bound>v</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>B</span> <span class=bound>v</span><span class=main>)</span> <span class=free>vs</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>A</span> <span class=bound>v</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>B</span> <span class=bound>v</span><span class=main>)</span> <span class=main>`</span> set <span class=free>vs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> set_map
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> setcompr_eq_image
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-encode_operator_effects_is_cnf_i><span class=command>lemma</span></span> encode_operator_effects_is_cnf_i<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> set <span class=var>?fs</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
          <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> is_cnf_BigAnd
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-encode_operator_effects_is_cnf_ii><span class=command>lemma</span></span> encode_operator_effects_is_cnf_ii<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> set <span class=var>?fs</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
          <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> is_cnf_BigAnd
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-encode_operator_effect_is_cnf><span class=command>lemma</span></span> encode_operator_effect_is_cnf<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_operator_effect <span class=free>Π</span> <span class=free>t</span> <span class=free>op</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?fs'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
        <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"encode_operator_effect <span class=free>Π</span> <span class=free>t</span> <span class=free>op</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span><span class=var>?fs</span> <span class=main>@</span> <span class=var>?fs'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_operator_effect_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span> <span class=quoted><span class=free>op</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=var>?fs</span><span class=main>.</span> is_cnf <span class=bound>f</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=var>?fs'</span><span class=main>.</span> is_cnf <span class=bound>f</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> encode_operator_effects_is_cnf_i<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>t</span></span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>op</span></span><span class=main>]</span>
        encode_operator_effects_is_cnf_ii<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>t</span></span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>op</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=main>(</span><span class=var>?fs</span> <span class=main>@</span> <span class=var>?fs'</span><span class=main>)</span><span class=main>.</span> is_cnf <span class=bound>f</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> is_cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?fs</span> <span class=main>@</span> <span class=var>?fs'</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-set_map_encode_operator_effect><span class=command>lemma</span></span> set_map_encode_operator_effect<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_effect <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=main>(</span>List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span>
      <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span> encode_operator_effect <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span>
      <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_effect <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=main>(</span>List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=var>?ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_effect <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_operator_effect_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_effect <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span>"</span></span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-encode_all_operator_effects_is_cnf><span class=command>lemma</span></span> encode_all_operator_effects_is_cnf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=var>?ops</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_effect <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=var>?l</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=var>?fs</span><span class=main>.</span> is_cnf <span class=bound>f</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_operator_effect_is_cnf
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_all_operator_effects_def
    <span class=keyword1><span class=command>using</span></span> is_cnf_foldr_and_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_operators_is_cnf><span class=command>lemma</span></span> encode_operators_is_cnf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_operators <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_operators_def
  <span class=keyword1><span class=command>using</span></span> is_cnf_encode_all_operator_preconditions<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span>
    encode_all_operator_effects_is_cnf<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>t</span></span><span class=main>]</span>
    is_cnf.simps<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"encode_all_operator_preconditions <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span>
      <span class=quoted><span class=quoted>"encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>

<span class=comment1>― ‹ Simp flag alone did not do it, so we have to assign a name to this lemma as well. ›</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-set_map_to_operator_atom><span class=command>lemma</span></span> set_map_to_operator_atom<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=free>vs</span><span class=main>)</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>
      <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=free>vs</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=free>vs</span><span class=main>)</span> <span class=var>?ops</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=free>vs</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_filter
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=free>vs</span><span class=main>)</span> <span class=var>?ops</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>{</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=free>vs</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ListMem_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=free>vs</span><span class=main>)</span> <span class=var>?ops</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>v</span> <span class=main>∈</span> set <span class=free>vs</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> set_map<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor ‹Formula_Supplement› *)</span>
<span class=keyword1 id=SAT_Plan_Base-is_disj_big_or_if><span class=command>lemma</span></span> is_disj_big_or_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=free>fs</span><span class=main>.</span> is_lit_plus <span class=bound>f</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=free>fs</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>fs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>f</span> <span class=skolem>fs</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_lit_plus <span class=skolem>f</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Cons.prems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=skolem>fs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Cons
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SAT_Plan_Base-is_cnf_encode_negative_transition_frame_axiom><span class=command>lemma</span></span> is_cnf_encode_negative_transition_frame_axiom<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=free>t</span> <span class=free>v</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?deleting</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=var>?ops</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?deleting</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>f</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∈</span> set <span class=var>?fs</span>"</span></span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>=</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map_to_operator_atom<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>t</span></span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>v</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_lit_plus <span class=skolem>f</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_disj_big_or_if nb
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main>(</span><span class=var>?B</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main>(</span><span class=var>?A</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span><span class=var>?B</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=var>?A</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span><span class=var>?B</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_negative_transition_frame_axiom_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-is_cnf_encode_positive_transition_frame_axiom><span class=command>lemma</span></span> is_cnf_encode_positive_transition_frame_axiom<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=free>t</span> <span class=free>v</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?adding</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=var>?ops</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?adding</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Atom <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>f</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∈</span> set <span class=var>?fs</span>"</span></span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>=</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map_to_operator_atom<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>t</span></span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>v</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_lit_plus <span class=skolem>f</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_disj_big_or_if nb
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main>(</span><span class=var>?B</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_disj <span class=main>(</span><span class=var>?A</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span><span class=var>?B</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=var>?A</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span><span class=var>?B</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_positive_transition_frame_axiom_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-encode_all_frame_axioms_set><span class=command>lemma</span></span> encode_all_frame_axioms_set<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span>
        <span class=main>(</span>List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span>
      <span class=main>@</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span>
        <span class=main>(</span>List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>
        <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>
        <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?l</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?l</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=var>?l</span>
      <span class=main>@</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=var>?l</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> set_l_is<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs</span> <span class=main>=</span> <span class=var>?A</span> <span class=main>∪</span> <span class=var>?B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> set_append
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>=</span> <span class=main>{</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>
    <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> set_l_is setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>"</span></span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?B</span> <span class=main>=</span> <span class=main>{</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>
    <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> set_l_is setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>"</span></span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* rename ‹is_cnf_encode_all_frame_axioms›. *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_frame_axioms_is_cnf><span class=command>lemma</span></span> encode_frame_axioms_is_cnf<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>
    <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>
    <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=var>?l</span>
      <span class=main>@</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=var>?l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>f</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∈</span> set <span class=var>?fs</span>"</span></span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>f_encodes_negative_frame_axiom<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span>
      <span class=main>|</span> <span class=main>(</span>f_encodes_positive_frame_axiom<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∈</span> <span class=var>?B</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=skolem>f</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_cnf_encode_negative_transition_frame_axiom
        is_cnf_encode_positive_transition_frame_axiom
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> mem_Collect_eq<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_all_frame_axioms_def
    <span class=keyword1><span class=command>using</span></span> is_cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-is_cnf_encode_problem><span class=command>lemma</span></span> is_cnf_encode_problem<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_cnf_encode_initial_state assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_goal_state <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_goal_state_is_cnf<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_operators <span class=free>Π</span> <span class=free>t</span> <span class=main><span class=hidden>❙</span><b>∧</b></span> encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_operators_is_cnf<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> encode_frame_axioms_is_cnf
    <span class=keyword1><span class=command>unfolding</span></span> encode_transitions_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def SAT_Plan_Base.encode_problem_def
      encode_transitions_def encode_initial_state_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> encode_goal_state_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_problem_has_model_then_also_partial_encodings><span class=command>lemma</span></span> encode_problem_has_model_then_also_partial_encodings<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_problem <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_initial_state <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_goal_state <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_operators <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> SAT_Plan_Base.encode_problem_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_problem_structure><span class=command>lemma</span></span> cnf_of_encode_problem_structure<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>SAT_Plan_Base.encode_initial_state <span class=free>Π</span><span class=main>)</span>
    <span class=main>⊆</span> cnf <span class=main>(</span>SAT_Plan_Base.encode_problem <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>SAT_Plan_Base.encode_goal_state <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>
      <span class=main>⊆</span> cnf <span class=main>(</span>SAT_Plan_Base.encode_problem <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>SAT_Plan_Base.encode_operators <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>
      <span class=main>⊆</span> cnf <span class=main>(</span>SAT_Plan_Base.encode_problem <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>SAT_Plan_Base.encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>
      <span class=main>⊆</span> cnf <span class=main>(</span>SAT_Plan_Base.encode_problem <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> SAT_Plan_Base.encode_problem_def
    SAT_Plan_Base.encode_problem_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span> SAT_Plan_Base.encode_initial_state_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span><span class=main>]</span>
    SAT_Plan_Base.encode_goal_state_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span> SAT_Plan_Base.encode_operators_def
    SAT_Plan_Base.encode_all_frame_axioms_def<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>― ‹ A technical lemma which shows a simpler form of the CNF of the initial state encoding. ›</span>
<span class=comment1>(* TODO generalize for more encodings? *)</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_initial_state_set_i><span class=command>lemma</span></span> cnf_of_encode_initial_state_set_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>=</span> <span class=main>⋃</span> <span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span>
    <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
      <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ls</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
    <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?ls</span> <span class=main>=</span> cnf <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
      <span class=main>`</span> set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span><span class=main>)</span>
      <span class=main>`</span> set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> image_comp
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>v</span></span> <span class=main>∈</span> set <span class=var>?vs</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_filter<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None"</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?ls</span> <span class=main>=</span> <span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
      <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>=</span> <span class=main>⋃</span> <span class=main>(</span>cnf <span class=main>`</span> set <span class=var>?ls</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_initial_state_def SAT_Plan_Base.encode_initial_state_def
    <span class=keyword1><span class=command>using</span></span> cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?ls</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ A simplification lemma for the above one. ›</span>
<span class=comment1>(* TODO Replace above lemma with this?. *)</span>
<span class=keyword1><span class=command>corollary</span></span> cnf_of_encode_initial_state_set_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span>
    literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span>
      <span class=main>(</span>strips_problem.initial_of <span class=free>Π</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span> <span class=main>=</span> set <span class=var>?vs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=comment1>(* TODO generalize and refactor. *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>I_v_is_Some_True<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
      <span class=main>|</span> <span class=main>(</span>I_v_is_Some_False<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>
       <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None"</span></span><span class=main>]</span> <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>
      <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>
        <span class=main>`</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_of_encode_initial_state_set_i
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> Collect_cong<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO ‹∃!› is superfluous now? rm? + Above lemma basically covers this one. *)</span>
<span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_initial_state_set><span class=command>lemma</span></span>  cnf_of_encode_initial_state_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> dom <span class=main>(</span>strips_problem.initial_of <span class=free>Π</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span> <span class=free>v</span> <span class=main>=</span> Some True <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>C</span><span class=main>.</span> <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>
      <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span> <span class=free>v</span> <span class=main>=</span> Some False <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>C</span><span class=main>.</span> <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>
      <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>=</span> <span class=main>⋃</span> <span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span>
      <span class=main>(</span>strips_problem.initial_of <span class=free>Π</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_of_encode_initial_state_set_i
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?I</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span> <span class=free>v</span> <span class=main>=</span> Some True <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>C</span><span class=main>.</span> <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>
      <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span> <span class=free>v</span> <span class=main>=</span> Some False <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>C</span><span class=main>.</span> <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>
      <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> i_v_is_some_true<span class=main>:</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∈</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
        <span class=keyword1><span class=command>using</span></span> i_v_is_some_true
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∈</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> nb<span class=hidden>⇩</span><sub>2</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> i_v_is_some_false<span class=main>:</span> <span class=quoted><span class=quoted>"strips_problem.initial_of <span class=free>Π</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
        <span class=main>∈</span> cnf <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
        <span class=keyword1><span class=command>using</span></span> i_v_is_some_false
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
        <span class=main>∈</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> nb<span class=hidden>⇩</span><sub>2</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-cnf_of_operator_encoding_structure><span class=command>lemma</span></span> cnf_of_operator_encoding_structure<span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_operators <span class=free>Π</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> cnf <span class=main>(</span>encode_all_operator_preconditions <span class=free>Π</span>
      <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
    <span class=main>∪</span> cnf <span class=main>(</span>encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_operators_def
  <span class=keyword1><span class=command>using</span></span> cnf.simps<span class=main>(</span>5<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>corollary</span></span> cnf_of_operator_precondition_encoding_subset_encoding<span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_all_operator_preconditions <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
    <span class=main>⊆</span> cnf <span class=main>(</span><span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> cnf_of_operator_encoding_structure cnf_of_encode_problem_structure subset_trans
  <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=comment1>(* TODO refactor ‹CNF_Supplement› *)</span>
<span class=keyword1 id=SAT_Plan_Base-cnf_foldr_and><span class=command>lemma</span></span>  cnf_foldr_and<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=free>fs</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>f</span> <span class=main>∈</span> set <span class=free>fs</span><span class=main>.</span> cnf <span class=bound>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>fs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>f</span> <span class=skolem>fs</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> ih<span class=main>:</span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=skolem>fs</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>f</span> <span class=main>∈</span> set <span class=skolem>fs</span><span class=main>.</span> cnf <span class=bound>f</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Cons.IH
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=main>(</span><span class=skolem>f</span> <span class=main>#</span> <span class=skolem>fs</span><span class=main>)</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> cnf <span class=main>(</span><span class=skolem>f</span> <span class=main><span class=hidden>❙</span><b>∧</b></span> foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=skolem>fs</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> cnf <span class=skolem>f</span> <span class=main>∪</span> cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=skolem>fs</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=main>(</span><span class=skolem>f</span> <span class=main>#</span> <span class=skolem>fs</span><span class=main>)</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> cnf <span class=skolem>f</span> <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>f</span> <span class=main>∈</span> set <span class=skolem>fs</span><span class=main>.</span> cnf <span class=bound>f</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ih
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=comment1>(* TODO rm (unused)? *)</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_operator_precondition><span class=command>lemma</span></span> cnf_of_encode_operator_precondition<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_operator_precondition <span class=free>Π</span> <span class=free>t</span> <span class=free>op</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
    <span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_operator_precondition <span class=free>Π</span> <span class=free>t</span> <span class=free>op</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main>`</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_operator_precondition <span class=free>Π</span> <span class=free>t</span> <span class=free>op</span><span class=main>)</span> <span class=main>=</span> cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=var>?fs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_operator_precondition_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span> <span class=main>(</span>cnf <span class=main>`</span> set <span class=var>?fs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_BigAnd
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>cnf <span class=main>`</span> <span class=var>?A</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> set_map<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=quoted><span class=quoted>"precondition_of <span class=free>op</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
    cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO Shorten proof. *)</span>
<span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_all_operator_preconditions_structure><span class=command>lemma</span></span> cnf_of_encode_all_operator_preconditions_structure<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_all_operator_preconditions <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
      <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=bound>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
          <span class=main>,</span> <span class=main>(</span>State <span class=bound>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=var>?ops</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_preconditions <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=var>?l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=main>=</span> cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_precondition <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=var>?l</span><span class=main>)</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_all_operator_preconditions_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>f</span> <span class=main>∈</span> <span class=var>?A</span><span class=main>.</span> cnf <span class=bound>f</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
    cnf <span class=main>(</span>encode_operator_precondition <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nb
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=comment1>(* TODO very slow. *)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
     <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
 <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> cnf_of_encode_all_operator_preconditions_contains_clause_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'variable</span> STRIPS_Representation.strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=main>(</span><span class=free>Π</span><span class=main>::</span><span class=tfree>'variable</span> STRIPS_Representation.strips_problem<span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
    <span class=main>,</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
  <span class=main>∈</span> cnf <span class=main>(</span>encode_all_operator_preconditions <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_preconditions <span class=free>Π</span> <span class=var>?ops</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span><span class=main>∈</span>set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span>
          <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> UN_iff<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> A<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> B<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span>
          <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>"</span></span><span class=main>]</span> assms<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>.</span>
        <span class=var>?C</span> <span class=main>∈</span> <span class=main>(</span><span class=keyword1>case</span> <span class=bound>x</span> <span class=keyword1>of</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>⋃</span><span class=bound>v</span><span class=main>∈</span>set <span class=main>(</span>precondition_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span>
          <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> nb
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
      <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=bound>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_preconditions_structure<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> cnf_of_encode_all_operator_effects_subset_cnf_of_encode_problem<span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
    <span class=main>⊆</span> cnf <span class=main>(</span><span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> cnf_of_encode_problem_structure<span class=main>(</span>3<span class=main>)</span> cnf_of_operator_encoding_structure
  <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_operator_effect_structure><span class=command>lemma</span></span> cnf_of_encode_operator_effect_structure<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_operator_effect <span class=free>Π</span> <span class=free>t</span> <span class=free>op</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
        <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>
      <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
          <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> cnf
        <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
        <span class=main>`</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> image_comp
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> cnf <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
        <span class=main>`</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
        <span class=main>`</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> image_comp
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>
        <span class=main>`</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_operator_effect <span class=free>Π</span> <span class=free>t</span> <span class=free>op</span><span class=main>)</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>cnf <span class=main>`</span> set <span class=main>(</span><span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> encode_operator_effect_def
      <span class=keyword1><span class=command>using</span></span> cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>@</span> <span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∪</span> cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_append<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span>"</span></span><span class=main>]</span> image_Un<span class=main>[</span><span class=operator>of</span> <span class=quoted>cnf</span> <span class=quoted><span class=quoted>"set <span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∪</span> <span class=main>⋃</span><span class=main>(</span>cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Union_Un_distrib<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs<span class=hidden>⇩</span><sub>2</sub></span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_operator_effect <span class=free>Π</span> <span class=free>t</span> <span class=free>op</span><span class=main>)</span>
        <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
          <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>
        <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
          <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> nb<span class=hidden>⇩</span><sub>2</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_all_operator_effects_structure><span class=command>lemma</span></span> cnf_of_encode_all_operator_effects_structure<span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
          <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>
      <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
          <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_effects <span class=free>Π</span> <span class=var>?ops</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=var>?ops</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_effect <span class=free>Π</span> <span class=bound>t</span> <span class=bound>op</span><span class=main>)</span> <span class=var>?l</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=var>?ops</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs</span> <span class=main>=</span> cnf <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> encode_operator_effect <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> cnf <span class=main>(</span>encode_operator_effect <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> image_comp
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
          <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
            <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
              <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>
        <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
            <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
              <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>
      <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_encode_operator_effect_structure
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_all_operator_effects_def
    <span class=keyword1><span class=command>using</span></span> cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> cnf_of_operator_effect_encoding_contains_add_effect_clause_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
    <span class=main>∈</span> cnf <span class=main>(</span>encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Add</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>∈</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>.</span>
    <span class=main>⋃</span><span class=bound>v</span><span class=main>∈</span>set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Add</span> <span class=main>⊆</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_effects_structure<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span> Un_upper1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?Add</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span>  <span class=main>∈</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span><span class=main>∈</span>set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Complete_Lattices.UN_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
          <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>"</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=comment1>(* TODO slow step. *)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> <span class=var>?Add</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> subset_eq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?Add</span>"</span></span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> cnf_of_operator_effect_encoding_contains_delete_effect_clause_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
    <span class=main>∈</span> cnf <span class=main>(</span>encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Delete</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>∈</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>.</span>
    <span class=main>⋃</span><span class=bound>v</span><span class=main>∈</span>set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Delete</span> <span class=main>⊆</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_effects_structure<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span> Un_upper2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?Delete</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=comment1>(* TODO slow step. *)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> <span class=var>?Delete</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=comment1>(* TODO slow step. *)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> subset_eq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?Delete</span>"</span></span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor ‹CNF_Supplement›. *)</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-cnf_of_big_or_of_literal_formulas_is><span class=command>lemma</span></span> cnf_of_big_or_of_literal_formulas_is<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f</span> <span class=main>∈</span> set <span class=free>fs</span><span class=main>.</span> is_literal_formula <span class=bound>f</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=free>fs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=bound>f</span> <span class=main>|</span> <span class=bound>f</span><span class=main>.</span> <span class=bound>f</span> <span class=main>∈</span> set <span class=free>fs</span> <span class=main>}</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>fs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>f</span> <span class=skolem>fs</span><span class=main>)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> is_literal_formula_f<span class=main>:</span> <span class=quoted><span class=quoted>"is_literal_formula <span class=skolem>f</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=skolem>f</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=skolem>f</span> <span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_literal_formula
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>f'</span> <span class=main>∈</span> set <span class=skolem>fs</span><span class=main>.</span> is_literal_formula <span class=bound>f'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.prems
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=skolem>fs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=bound>f</span> <span class=main>|</span> <span class=bound>f</span><span class=main>.</span> <span class=bound>f</span> <span class=main>∈</span> set <span class=skolem>fs</span> <span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.IH
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=main>(</span><span class=skolem>f</span> <span class=main>#</span> <span class=skolem>fs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>g</span><span class=main>,</span> <span class=bound>h</span><span class=main>)</span><span class=main>.</span> <span class=bound>g</span> <span class=main>∪</span> <span class=bound>h</span><span class=main>)</span>
      <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=skolem>f</span><span class=main>}</span><span class=main>}</span>
        <span class=main>×</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=bound>f'</span> <span class=main>|</span> <span class=bound>f'</span><span class=main>.</span> <span class=bound>f'</span> <span class=main>∈</span> set <span class=skolem>fs</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub> nb<span class=hidden>⇩</span><sub>2</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=skolem>f</span><span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> literal_formula_to_literal <span class=bound>f'</span> <span class=main>|</span> <span class=bound>f'</span><span class=main>.</span> <span class=bound>f'</span> <span class=main>∈</span> set <span class=skolem>fs</span> <span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=main>(</span><span class=skolem>f</span> <span class=main>#</span> <span class=skolem>fs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=bound>f'</span> <span class=main>|</span> <span class=bound>f'</span><span class=main>.</span> <span class=bound>f'</span> <span class=main>∈</span> set <span class=main>(</span><span class=skolem>f</span> <span class=main>#</span> <span class=skolem>fs</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-set_filter_op_list_mem_vs><span class=command>lemma</span></span> set_filter_op_list_mem_vs<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=free>vs</span><span class=main>)</span> <span class=free>ops</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=free>ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=free>vs</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> set_filter<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=free>vs</span>"</span></span> <span class=quoted><span class=free>ops</span></span><span class=main>]</span> ListMem_iff
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-cnf_of_positive_transition_frame_axiom><span class=command>lemma</span></span>  cnf_of_positive_transition_frame_axiom<span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=free>k</span> <span class=free>v</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
        <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
        <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?adding_operators</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=var>?ops</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?adding_operators</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?adding_operators</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?adding_operators</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>`</span> set <span class=var>?fs</span>
      <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span> <span class=main>`</span> set <span class=var>?adding_operators</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>literal_formula_to_literal</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"set <span class=var>?adding_operators</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>
        <span class=main>`</span> <span class=main>{</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_filter_op_list_mem_vs<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span> <span class=main>_</span>  <span class=var><span class=quoted><span class=var>?ops</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>`</span> set <span class=var>?fs</span>
      <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span>set <span class=var>?adding_operators</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
      <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_big_or_of_literal_formulas_is<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
        setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted>literal_formula_to_literal</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>f</span><span class=main>.</span> <span class=bound>f</span> <span class=main>∈</span> set <span class=var>?fs</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span>
  <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>  <span class=main>}</span> <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
    <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main>(</span>Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=comment1>(* TODO No idea why this is necessary (apparently only metis unfolds the definition properly). *)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=free>k</span> <span class=free>v</span><span class=main>)</span>
    <span class=main>=</span> cnf <span class=main>(</span><span class=main>(</span>Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_positive_transition_frame_axiom_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-cnf_of_negative_transition_frame_axiom><span class=command>lemma</span></span> cnf_of_negative_transition_frame_axiom<span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=free>k</span> <span class=free>v</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
        <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>  <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
        <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?deleting_operators</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=free>v</span> <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=var>?ops</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?deleting_operators</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?deleting_operators</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_map<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?deleting_operators</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>`</span> set <span class=var>?fs</span>
      <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span> <span class=main>`</span> set <span class=var>?deleting_operators</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>literal_formula_to_literal</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"set <span class=var>?deleting_operators</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>
        <span class=main>`</span> <span class=main>{</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_filter_op_list_mem_vs<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span> <span class=main>_</span>  <span class=var><span class=quoted><span class=var>?ops</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>`</span> set <span class=var>?fs</span>
      <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span>set <span class=var>?deleting_operators</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
      <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_big_or_of_literal_formulas_is<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
        setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted>literal_formula_to_literal</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>f</span><span class=main>.</span> <span class=bound>f</span> <span class=main>∈</span> set <span class=var>?fs</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span>
  <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>  <span class=main>}</span> <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
    <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=comment1>(* TODO unfold Let_def + remove metis. *)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=free>k</span> <span class=free>v</span><span class=main>)</span>
    <span class=main>=</span> cnf <span class=main>(</span><span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span><span class=var>?fs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_negative_transition_frame_axiom_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_all_frame_axioms_structure><span class=command>lemma</span></span> cnf_of_encode_all_frame_axioms_structure<span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of  <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of  <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>  <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of  <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>
      <span class=main>∪</span> <span class=main>⋃</span><span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span> <span class=var>?vs</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=var>?l</span>
    <span class=main>@</span> map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=var>?l</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>
        <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span>
        <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> set_l<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_product
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=comment1>(* TODO slow *)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs</span> <span class=main>=</span> <span class=var>?A</span> <span class=main>∪</span> <span class=var>?B</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> set_append set_map
      <span class=keyword1><span class=command>using</span></span> encode_all_frame_axioms_set
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs</span> <span class=main>=</span> cnf <span class=main>`</span> <span class=var>?A</span> <span class=main>∪</span> cnf <span class=main>`</span> <span class=var>?B</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> image_Un<span class=main>[</span><span class=operator>of</span> <span class=quoted>cnf</span> <span class=quoted><span class=quoted>"<span class=var>?A</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?B</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span> encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span> <span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span>  <span class=quoted><span class=quoted>"cnf <span class=main>`</span> <span class=var>?A</span>  <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span> cnf <span class=main>(</span>encode_negative_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span> <span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> <span class=var>?A</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_negative_transition_frame_axiom<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?B</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span> encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span>  <span class=quoted><span class=quoted>"cnf <span class=main>`</span> <span class=var>?B</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span> cnf <span class=main>(</span>encode_positive_transition_frame_axiom <span class=free>Π</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span>  <span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> <span class=var>?B</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_positive_transition_frame_axiom<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=comment1>(* TODO slow *)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs</span>
      <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>
      <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> set_append set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>
      <span class=main>∪</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_all_frame_axioms_def Let_def
    <span class=keyword1><span class=command>using</span></span> cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> Union_Un_distrib<span class=main>[</span><span class=operator>of</span>
        <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>,</span>  <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
        <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
            <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
          <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ A technical lemma used in \isaname{cnf_of_encode_goal_state_set}. ›</span>
<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_goal_state_set_i><span class=command>lemma</span></span> cnf_of_encode_goal_state_set_i<span class=main>:</span>
    <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span> <span class=main>)</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span>
      <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
      <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs</span>  <span class=main>=</span> cnf <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>
      <span class=main>`</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> set_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span><span class=main>)</span>
      <span class=main>`</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>cnf</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs</span> <span class=main>=</span> <span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
        <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>⊥</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=main>⋃</span> <span class=main>(</span>cnf <span class=main>`</span> set <span class=var>?fs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_goal_state_def SAT_Plan_Base.encode_goal_state_def Let_def
    <span class=keyword1><span class=command>using</span></span> cnf_BigAnd<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ A simplification lemma for the above one. ›</span>
<span class=comment1>(* TODO Replace above lemma with this?. *)</span>
<span class=keyword1><span class=command>corollary</span></span> cnf_of_encode_goal_state_set_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>{</span><span class=main>{</span><span class=main>{</span> literal_formula_to_literal
      <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span>
    <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> G_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
      <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>  <span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>have</span></span>  <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
    <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_of_encode_goal_state_set_i
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>`</span> <span class=main>{</span> <span class=bound>v</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span> <span class=main>≠</span> None"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> literal_formula_to_literal
      <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>
    <span class=main>`</span>  <span class=main>{</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nb
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> nb
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ This lemma essentially states that the cnf for the cnf formula for the encoding has a
clause for each variable whose state is defined in the goal state with the corresponding literal. ›</span>
<span class=comment1>(* TODO is ‹∃!› still needed? *)</span>
<span class=keyword1 id=SAT_Plan_Base-cnf_of_encode_goal_state_set><span class=command>lemma</span></span> cnf_of_encode_goal_state_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> dom <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>C</span><span class=main>.</span> <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
      <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some False <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>C</span><span class=main>.</span> <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
      <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>  <span class=main>=</span> <span class=main>⋃</span> <span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span>
      <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_of_encode_goal_state_set_i
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> <span class=main>{</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_dom_of_goal_state_is assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>3</sub><span class=main>:</span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⊆</span> <span class=main>(</span><span class=main>⋃</span><span class=main>{</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span>
      <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=var>?G</span> <span class=bound>v</span> <span class=main>≠</span> None <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> UN_upper<span class=main>[</span><span class=operator>OF</span> nb<span class=hidden>⇩</span><sub>2</sub><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> cnf <span class=main>(</span>encode_state_variable <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>2</sub>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>C</span><span class=main>.</span> <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
      <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some False <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>C</span><span class=main>.</span> <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span>
      <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub>
    <span class=keyword1><span class=command>unfolding</span></span> nb<span class=hidden>⇩</span><sub>1</sub> encode_state_variable_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ We omit the proofs that the partial encoding functions produce formulas in CNF form due to
their more technical nature.
The following sublocale proof confirms that definition \ref{isadef:encode-problem-sat-plan-base}
encodes a valid problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span> into a formula that can be transformed to CNF
(<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹is_cnf <span class=main><span class=main>(</span></span><span class=keyword1><span class=keyword1>Φ</span></span> <span class=free><span class=free>Π</span></span> <span class=free><span class=free>t</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span>) and that its CNF has the required form. ›</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Soundness of the Basic SATPlan Algorithm"</span></span>


<span class=keyword1 id=SAT_Plan_Base-valuation_models_encoding_cnf_formula_equals><span class=command>lemma</span></span> valuation_models_encoding_cnf_formula_equals<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span> <span class=main>=</span> cnf_semantics <span class=free>𝒜</span> <span class=main>(</span>cnf <span class=main>(</span><span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=var>?Φ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_cnf_encode_problem<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_nnf <span class=var>?Φ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_nnf_cnf
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_semantics<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?Φ</span></span></span> <span class=quoted><span class=free>𝒜</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor *)</span>
<span class=keyword1><span class=command>corollary</span></span> valuation_models_encoding_cnf_formula_equals_corollary<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=main>(</span><span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span><span class=main>.</span> <span class=main>∃</span><span class=bound>L</span> <span class=main>∈</span> <span class=bound>C</span><span class=main>.</span> lit_semantics <span class=free>𝒜</span> <span class=bound>L</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> valuation_models_encoding_cnf_formula_equals<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def clause_semantics_def encode_problem_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>

<span class=comment1>― ‹ A couple of technical lemmas about <span class=antiquoted><span class=raw_text><span class=operator>‹</span>decode_plan›</span></span>. ›</span>
<span class=keyword1 id=SAT_Plan_Base-decode_plan_length><span class=command>lemma</span></span> decode_plan_length<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>π</span> <span class=main>=</span> <span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>ν</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=free>π</span> <span class=main>=</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def SAT_Plan_Base.decode_plan_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id="SAT_Plan_Base-decode_plan'_set_is"><span class=command>lemma</span></span> decode_plan'_set_is<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span>decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>!</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span>
      <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span>
        <span class=main>∧</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=var>?f</span> <span class=var>?ops</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>filter <span class=free>𝒜</span> <span class=var>?vs</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>map <span class=var>?f</span> <span class=main>(</span>filter <span class=main>(</span><span class=free>𝒜</span> <span class=main>∘</span> <span class=var>?f</span><span class=main>)</span> <span class=var>?ops</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> filter_map<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>𝒜</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span>"</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span><span class=main>]</span><span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>filter <span class=free>𝒜</span> <span class=var>?vs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span>
      <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> set_map set_filter
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=keyword1>case</span> <span class=bound>v</span> <span class=keyword1>of</span> Operator <span class=bound>k</span> <span class=bound>i</span> <span class=main>⇒</span> <span class=var>?ops</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>
    <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> decode_plan'_def set_map Let_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>case</span> Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=keyword1>of</span> Operator <span class=bound>k</span> <span class=bound>i</span> <span class=main>⇒</span> <span class=var>?ops</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>
    <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> image_comp comp_apply
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=var>?ops</span> <span class=main>!</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>
    <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-decode_plan_set_is><span class=command>lemma</span></span> decode_plan_set_is<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>k</span> <span class=main>∈</span> <span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>.</span> <span class=main>{</span> decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=bound>k</span> <span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def SAT_Plan_Base.decode_plan_def set_map
  <span class=keyword1><span class=command>using</span></span> atLeast_upt
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SAT_Plan_Base-decode_plan_step_element_then_i><span class=command>lemma</span></span> decode_plan_step_element_then_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>!</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span>
      <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span> <span class=main>=</span> decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def SAT_Plan_Base.decode_plan_def
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that each operator $op$ in the $k$-th parallel operator in a decoded parallel plan is
contained within the problem's operator set and the valuation is true for the corresponding SATPlan
variable. ›</span>
<span class=keyword1 id=SAT_Plan_Base-decode_plan_step_element_then><span class=command>lemma</span></span> decode_plan_step_element_then<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?ops</span> <span class=main>!</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span>
    <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> <span class=var>?Ops</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> decode_plan_step_element_then_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> calculation
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that the <span class=antiquoted><span class=raw_text><span class=operator>‹</span>k›</span></span>-th parallel operators of the decoded plan are distinct lists (i.e. do not
contain duplicates). ›</span>
<span class=keyword1 id=SAT_Plan_Base-decode_plan_step_distinct><span class=command>lemma</span></span> decode_plan_step_distinct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?g</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=keyword1>case</span> <span class=bound>v</span> <span class=keyword1>of</span> Operator <span class=main><span class=bound>_</span></span> <span class=bound>k</span> <span class=main>⇒</span> <span class=var>?ops</span> <span class=main>!</span> <span class=bound>k</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=var>?f</span> <span class=main>(</span>remdups <span class=var>?ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>=</span> decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def SAT_Plan_Base.decode_plan_def
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span>remdups <span class=var>?ops</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on <span class=var>?f</span> <span class=main>(</span>set <span class=main>(</span>remdups <span class=var>?ops</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> inj_on_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"distinct <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> distinct_map
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on <span class=var>?g</span> <span class=main>(</span>set <span class=var>?vs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> inj_on_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span>map <span class=var>?g</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> distinct_map nb<span class=hidden>⇩</span><sub>2</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> distinct_map_filter<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?g</span></span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=quoted><span class=free>𝒜</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> nb<span class=hidden>⇩</span><sub>1</sub> decode_plan'_def Let_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-decode_state_at_valid_variable><span class=command>lemma</span></span> decode_state_at_valid_variable<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>≠</span> None"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=main>(</span>map <span class=var>?f</span> <span class=var>?vs</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> fst <span class=main>(</span><span class=bound>v</span><span class=main>,</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>`</span> set <span class=main>(</span>map <span class=var>?f</span> <span class=var>?vs</span><span class=main>)</span> <span class=main>=</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>v</span> <span class=main>∉</span> fst <span class=main>`</span> set <span class=main>(</span>map <span class=var>?f</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> map_of_eq_None_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"map <span class=var>?f</span> <span class=var>?vs</span>"</span></span> <span class=quoted><span class=free>v</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>unfolding</span></span> decode_state_at_def SAT_Plan_Base.decode_state_at_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that there exists an equivalence between a model <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span> of the (CNF of the) encoded
problem and the state at step <span class=antiquoted><span class=raw_text><span class=operator>‹</span>k›</span></span> decoded from the encoded problem. ›</span>
<span class=keyword1 id=SAT_Plan_Base-decode_state_at_encoding_variables_equals_some_of_valuation_if><span class=command>lemma</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=free>v</span>
    <span class=main>=</span> Some <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?vs</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?vs</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=var>?l</span> <span class=free>v</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> map_of_from_function_graph_is_some_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=quoted><span class=free>v</span></span>
        <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span> assms<span class=main>(</span>4<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> decode_state_at_def SAT_Plan_Base.decode_state_at_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-decode_state_at_dom><span class=command>lemma</span></span> decode_state_at_dom<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=var>?s</span> <span class=main>=</span> fst <span class=main>`</span> set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> decode_state_at_def SAT_Plan_Base.decode_state_at_def
    <span class=keyword1><span class=command>using</span></span> dom_map_of_conv_image_fst<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> fst <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> set_map<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> image_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>fst</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO shorten the proof (there are a lot of duplicate parts still!). *)</span>
<span class=keyword1 id=SAT_Plan_Base-decode_state_at_initial_state><span class=command>lemma</span></span> decode_state_at_initial_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=main>⊆</span> cnf <span class=var>?Φ</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> is_cnf_encode_initial_state<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_encode_problem_structure<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> encode_initial_state_def encode_problem_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>(</span>cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_semantics_monotonous_in_cnf_subsets_if is_cnf_encode_problem<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span><span class=main>.</span> clause_semantics <span class=free>𝒜</span> <span class=bound>C</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def encode_initial_state_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=comment1>(* TODO refactor. *)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> v_in_dom_i<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?I</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span>  <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> v_in_variable_set<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom assms<span class=main>(</span>1<span class=main>)</span> v_in_dom_i
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>0</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span>
              assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> _ v_in_variable_set<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
      <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>v_initially_true<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=main>|</span> <span class=main>(</span>v_initially_false<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
        <span class=keyword1><span class=command>using</span></span> v_in_dom_i
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?s</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> v_initially_true
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span>
            <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> c_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> cnf_of_encode_initial_state_set v_in_dom_i assms<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> v_initially_true
            <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> v_initially_false
          <span class=comment1>(* TODO slow *)</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span>
            <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> c_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> cnf_of_encode_initial_state_set assms<span class=main>(</span>1<span class=main>)</span> v_in_dom_i
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> False"</span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> v_initially_false
            <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?s</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> map_le_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> v_in_dom_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?s</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> decode_state_at_dom<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>have</span></span> v_in_dom_I<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?I</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom assms<span class=main>(</span>1<span class=main>)</span> v_in_set_vs
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>have</span></span> s_v_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>0</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
          v_in_set_vs
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le0<span class=main>)</span>
      <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>s_v_is_some_true<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=main>|</span> <span class=main>(</span>s_v_is_some_false<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
        <span class=keyword1><span class=command>using</span></span> v_in_dom_s
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?I</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> s_v_is_some_true
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> 𝒜_of_s_v<span class=main>:</span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> s_v_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>I_v_is_some_true<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
            <span class=main>|</span> <span class=main>(</span>I_v_is_some_false<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
            <span class=keyword1><span class=command>using</span></span> v_in_dom_I
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> I_v_is_some_true
              <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> s_v_is_some_true
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> I_v_is_some_false
              <span class=comment1>(* TODO slow *)</span>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span>
                <span class=keyword2><span class=keyword>where</span></span> C_in_encode_initial_state<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>  <span class=main>}</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> cnf_of_encode_initial_state_set assms<span class=main>(</span>1<span class=main>)</span> v_in_dom_I
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> 𝒜_of_s_v
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> s_v_is_some_false
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> 𝒜_of_s_v<span class=main>:</span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> s_v_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>I_v_is_some_true<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
            <span class=main>|</span> <span class=main>(</span>I_v_is_some_false<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
            <span class=keyword1><span class=command>using</span></span> v_in_dom_I
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> I_v_is_some_true
              <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span>
                <span class=keyword2><span class=keyword>where</span></span> C_in_encode_initial_state<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>  <span class=main>}</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> cnf_of_encode_initial_state_set assms<span class=main>(</span>1<span class=main>)</span> v_in_dom_I
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> 𝒜_of_s_v
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> I_v_is_some_false
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> s_v_is_some_false
                <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?I</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> map_le_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> map_le_antisym
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-decode_state_at_goal_state><span class=command>lemma</span></span> decode_state_at_goal_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=main>⊆</span> cnf <span class=var>?Φ</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> encode_goal_state_is_cnf<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_encode_problem_structure<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> encode_goal_state_def encode_problem_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>(</span>cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_semantics_monotonous_in_cnf_subsets_if is_cnf_encode_problem<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
        assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span><span class=main>.</span> clause_semantics <span class=free>𝒜</span> <span class=bound>C</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def encode_initial_state_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=comment1>(* TODO refactor. *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?vs</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>
      <span class=main>=</span> map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=var>?vs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> decode_state_at_def SAT_Plan_Base.decode_state_at_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> map_of_from_function_graph_is_some_if
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> v_in_dom_G<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?G</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> v_in_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_dom_of_goal_state_is assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> decode_state_at_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
      <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
      <span class=keyword1><span class=command>using</span></span> v_in_dom_G
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?G'</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> A
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>⊆</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> cnf_of_encode_goal_state_set<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> v_in_dom_G<span class=main>]</span> A
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> decode_state_at_is A
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> B
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>⊆</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> cnf_of_encode_goal_state_set<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> v_in_dom_G<span class=main>]</span> B
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> False"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> decode_state_at_is B
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> map_le_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that the operator activation implies precondition constraints hold at every time step
of the decoded plan. ›</span>
<span class=keyword1 id=SAT_Plan_Base-decode_state_at_preconditions><span class=command>lemma</span></span> decode_state_at_preconditions<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>O</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_operators <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_preconditions <span class=free>Π</span> <span class=var>?ops</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>3<span class=main><span class=main><span class=main>,</span></span></span> 4<span class=main><span class=main><span class=main>)</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span>
      <span class=keyword2><span class=keyword>where</span></span> clause_is_in_operator_encoding<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span>
        <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_preconditions_contains_clause_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span>
          calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> assms<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> clause_semantics_𝒜_Φ<span class=hidden>⇩</span><sub>P</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span><span class=main>.</span> clause_semantics <span class=free>𝒜</span> <span class=bound>C</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_semantics_monotonous_in_cnf_subsets_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span>
          is_cnf_encode_problem<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span>
        cnf_of_operator_precondition_encoding_subset_encoding<span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow step *)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span>Pos <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> lit_semantics_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ This lemma shows that for a problem encoding with makespan zero for which a model exists,
the goal state encoding must be subset of the initial state encoding. In this case, the state
variable encodings for the goal state are included in the initial state encoding. ›</span>
<span class=comment1>(* TODO simplify/refactor proof. *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_i><span class=command>lemma</span></span> encode_problem_parallel_correct_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>0</span><span class=main>)</span> <span class=main>⊆</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>0</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ</span> <span class=free>Π</span> <span class=main>0</span>"</span></span>
  <span class=comment1>(* TODO refactor and generalize for all partial encodings? *)</span>
  <span class=comment1>― ‹ Show that the model of the encoding is also a model of the partial encodings. ›</span>
  <span class=keyword1><span class=command>have</span></span> 𝒜_models_Φ<span class=hidden>⇩</span><sub>I</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 𝒜_models_Φ<span class=hidden>⇩</span><sub>G</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> encode_problem_has_model_then_also_partial_encodings<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def encode_initial_state_def encode_goal_state_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=comment1>― ‹ Show that every clause in the CNF of the goal state encoding <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"Φ<span class=hidden>⇩</span><sub>G</sub>"</span><span class=antiquote>}</span></span> is also in
  the CNF of the initial state encoding <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"Φ<span class=hidden>⇩</span><sub>I</sub>"</span><span class=antiquote>}</span></span> thus making it a subset. We can conclude this
  from the fact that both <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"Φ<span class=hidden>⇩</span><sub>I</sub>"</span><span class=antiquote>}</span></span> and <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"Φ<span class=hidden>⇩</span><sub>G</sub>"</span><span class=antiquote>}</span></span> contain singleton clauses—which must all
  be evaluated to true by the given model <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span>—and the similar structure of the clauses in both
  partial encodings.

  By extension, if we decode the goal state <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"G"</span><span class=antiquote>}</span></span> and the initial state <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"I"</span><span class=antiquote>}</span></span> from a
  model of the encoding,  <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"G v = I v"</span><span class=antiquote>}</span></span> must hold for variable <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"v"</span><span class=antiquote>}</span></span> in the domain of
  the goal state. ›</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C'</span>
    <span class=keyword3><span class=command>assume</span></span> C'_in_cnf_Φ<span class=hidden>⇩</span><sub>G</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> v_in_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> G_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> C'_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>=</span> <span class=main>{</span> literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span>
          <span class=main>(</span><span class=var>?G</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_encode_goal_state_set_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C</span></span>
      <span class=keyword2><span class=keyword>where</span></span> C_in_cnf_Φ<span class=hidden>⇩</span><sub>I</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span>
          <span class=main>(</span><span class=var>?I</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_encode_initial_state_set_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> v_in_vs
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?L</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?L</span> <span class=main>}</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> C_in_cnf_Φ<span class=hidden>⇩</span><sub>I</sub> C_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=var>?L</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> model_then_all_singleton_clauses_modelled<span class=main>[</span><span class=operator>OF</span>
            is_cnf_encode_initial_state<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span>_ 𝒜_models_Φ<span class=hidden>⇩</span><sub>I</sub><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> lit_semantics_𝒜_L <span class=main>=</span> this
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?L'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?G</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?L'</span> <span class=main>}</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> C'_in_cnf_Φ<span class=hidden>⇩</span><sub>G</sub> C'_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=var>?L'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> model_then_all_singleton_clauses_modelled<span class=main>[</span><span class=operator>OF</span>
            encode_goal_state_is_cnf<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span>_ 𝒜_models_Φ<span class=hidden>⇩</span><sub>G</sub><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> lit_semantics_𝒜_L' <span class=main>=</span> this
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?G</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
          <span class=keyword3><span class=command>assume</span></span> contradiction<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>≠</span> <span class=var>?G</span> <span class=skolem>v</span>"</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
            <span class=keyword1><span class=command>using</span></span> v_in_vs is_valid_problem_strips_initial_of_dom assms<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some True <span class=main>∧</span> <span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
            <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some False <span class=main>∧</span> <span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
            <span class=keyword1><span class=command>using</span></span> G_of_v_is_not_None
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
            <span class=keyword1><span class=command>using</span></span> lit_semantics_𝒜_L lit_semantics_𝒜_L'
            <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> C_is C_in_cnf_Φ<span class=hidden>⇩</span><sub>I</sub> C'_is C'_in_cnf_Φ<span class=hidden>⇩</span><sub>G</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that the encoding secures that for every parallel operator <span class=antiquoted><span class=raw_text><span class=operator>‹</span>ops›</span></span>
decoded from the plan at every time step <span class=antiquoted><span class=raw_text><span class=operator>‹</span>t &lt; length pi›</span></span> the following hold:
\begin{enumerate}
\item  <span class=antiquoted><span class=raw_text><span class=operator>‹</span>ops›</span></span> is applicable, and
\item the effects of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>ops›</span></span> are consistent.
\end{enumerate}›</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_ii><span class=command>lemma</span></span> encode_problem_parallel_correct_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span>
    <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_effects <span class=free>Π</span> <span class=var>?ops</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> k_lt_t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> decode_plan_length assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> op_in_kth_of_decoded_plan_set<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> v_in_precondition_set<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t op_in_kth_of_decoded_plan_set<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> decode_state_at_preconditions<span class=main>[</span>
              <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> _ op_in_kth_of_decoded_plan_set v_in_precondition_set<span class=main>]</span> k_lt_t
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> <span class=free>t</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> k_lt_t
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t op_in_kth_of_decoded_plan_set<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span>  <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_operator_variable_sets<span class=main>(</span>1<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
            v_in_precondition_set
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=var>?s</span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> are_all_operators_applicable_set<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?s</span></span></span> <span class=quoted><span class=quoted>"<span class=var>?π</span> <span class=main>!</span> <span class=free>k</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
      <span class=keyword3><span class=command>assume</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in_k_th_of_decoded_plan<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_k_th_of_decoded_plan<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in_set_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_set_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>1</sub>_active_at_k<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_active_at_k<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
          <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t op<span class=hidden>⇩</span><sub>1</sub>_in_k_th_of_decoded_plan<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
          <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t op<span class=hidden>⇩</span><sub>2</sub>_in_k_th_of_decoded_plan<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
          <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t op<span class=hidden>⇩</span><sub>1</sub>_in_k_th_of_decoded_plan<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
          <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t op<span class=hidden>⇩</span><sub>2</sub>_in_k_th_of_decoded_plan<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
      <span class=comment1>(* TODO the following two blocks could be contracted and refactored into a single lemma. *)</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
        <span class=keyword3><span class=command>assume</span></span> v_in_add_effects_set_of_op<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span>  v_in_delete_effects_set_of_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?C<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span>
          <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C<span class=hidden>⇩</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span>
          <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?C<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span>
          <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
            <span class=keyword1><span class=command>using</span></span> cnf_of_operator_effect_encoding_contains_add_effect_clause_if<span class=main>[</span><span class=operator>OF</span>
                assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> k_lt_t op<span class=hidden>⇩</span><sub>1</sub>_in_set_ops v_in_add_effects_set_of_op<span class=hidden>⇩</span><sub>1</sub><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
            <span class=keyword1><span class=command>using</span></span> cnf_of_operator_effect_encoding_contains_delete_effect_clause_if<span class=main>[</span><span class=operator>OF</span>
                assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> k_lt_t op<span class=hidden>⇩</span><sub>2</sub>_in_set_ops v_in_delete_effects_set_of_op<span class=hidden>⇩</span><sub>2</sub><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> cnf <span class=var>?Φ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?C<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> cnf <span class=var>?Φ</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_effects_subset_cnf_of_encode_problem
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> C<span class=hidden>⇩</span><sub>1</sub>_true<span class=main>:</span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=var>?C<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C<span class=hidden>⇩</span><sub>2</sub>_true<span class=main>:</span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=var>?C<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> valuation_models_encoding_cnf_formula_equals<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>(</span><span class=free>k</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
            <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>1</sub>_active_at_k C<span class=hidden>⇩</span><sub>1</sub>_true
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
            <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>2</sub>_active_at_k C<span class=hidden>⇩</span><sub>2</sub>_true
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
        <span class=keyword3><span class=command>assume</span></span> v_in_delete_effects_set_of_op<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span>  v_in_add_effects_set_of_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?C<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C<span class=hidden>⇩</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?C<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span>
          <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
            <span class=keyword1><span class=command>using</span></span> cnf_of_operator_effect_encoding_contains_delete_effect_clause_if<span class=main>[</span><span class=operator>OF</span>
                assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> k_lt_t op<span class=hidden>⇩</span><sub>1</sub>_in_set_ops v_in_delete_effects_set_of_op<span class=hidden>⇩</span><sub>1</sub><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
            <span class=keyword1><span class=command>using</span></span> cnf_of_operator_effect_encoding_contains_add_effect_clause_if<span class=main>[</span><span class=operator>OF</span>
                assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> k_lt_t op<span class=hidden>⇩</span><sub>2</sub>_in_set_ops v_in_add_effects_set_of_op<span class=hidden>⇩</span><sub>2</sub><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> cnf <span class=var>?Φ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?C<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> cnf <span class=var>?Φ</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_effects_subset_cnf_of_encode_problem
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> C<span class=hidden>⇩</span><sub>1</sub>_true<span class=main>:</span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=var>?C<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C<span class=hidden>⇩</span><sub>2</sub>_true<span class=main>:</span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=var>?C<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> valuation_models_encoding_cnf_formula_equals<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>(</span><span class=free>k</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
            <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>1</sub>_active_at_k C<span class=hidden>⇩</span><sub>1</sub>_true
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
            <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>2</sub>_active_at_k  C<span class=hidden>⇩</span><sub>2</sub>_true
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>delete_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∩</span> set <span class=main>(</span>add_effects_of <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> are_all_operator_effects_consistent_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?π</span> <span class=main>!</span> <span class=free>k</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=var>?s</span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Show that for all operators <span class=antiquoted><span class=raw_text><span class=operator>‹</span>op›</span></span> at timestep <span class=antiquoted><span class=raw_text><span class=operator>‹</span>k›</span></span> of the plan
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>Φ¯ Π 𝒜 t›</span></span> decoded from the model <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span>, both add effects as
well as delete effects will hold in the next timestep <span class=antiquoted><span class=raw_text><span class=operator>‹</span>Suc k›</span></span>. ›</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_iii><span class=command>lemma</span></span> encode_problem_parallel_correct_iii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟶</span> <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟶</span> <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_effects <span class=free>Π</span> <span class=var>?ops</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>∈</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>t</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span>
        <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>∈</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>.</span>
       <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span>
          <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>t</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span>
        <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> k_lt_t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> decode_plan_length assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>have</span></span> op_is_valid<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t assms<span class=main><span class=main><span class=main>(</span></span></span>4<span class=main><span class=main><span class=main>)</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> k_op_included<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> k_lt_t op_is_valid
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span>  <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>
    <span class=main>⟶</span> <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>
      <span class=main>⟶</span> <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> v_is_add_effect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t assms<span class=main><span class=main><span class=main>(</span></span></span>4<span class=main><span class=main><span class=main>)</span></span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>
          <span class=main>∈</span> <span class=main>{</span><span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>
            <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=free>op</span><span class=main>)</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> v_is_add_effect
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> k_op_included cnf_of_operator_encoding_structure
            UN_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>"</span></span>
              <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span> <span class=main>∈</span> <span class=main>⋃</span> <span class=var>?A</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Union_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?A</span> <span class=main>⊆</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_effects_structure
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> in_mono<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?A</span>"</span></span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=comment1>(* TODO slow. *)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_effects_subset_cnf_of_encode_problem
              assms<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>unfolded</span> valuation_models_encoding_cnf_formula_equals_corollary<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> Bex_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> assms<span class=main>(</span>2<span class=main>)</span>
          decode_state_at_encoding_variables_equals_some_of_valuation_if
          is_valid_problem_strips_operator_variable_sets<span class=main>(</span>2<span class=main>)</span> k_lt_t op_is_valid subsetD
          v_is_add_effect
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> v_is_delete_effect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t assms<span class=main><span class=main><span class=main>(</span></span></span>4<span class=main><span class=main><span class=main>)</span></span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span><span class=main>}</span>
          <span class=main>∈</span> <span class=main>{</span><span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span><span class=main>}</span>
            <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=free>op</span><span class=main>)</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> v_is_delete_effect
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span><span class=main>}</span> <span class=main>∈</span> <span class=var>?B</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> k_op_included cnf_of_encode_all_operator_effects_structure
            UN_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>"</span></span>
              <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span> <span class=main>∈</span> <span class=main>⋃</span> <span class=var>?B</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Union_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?B</span> <span class=main>⊆</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_effects_structure Un_upper2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?B</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?A</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> in_mono<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?B</span>"</span></span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=comment1>(* TODO slow. *)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_effects_subset_cnf_of_encode_problem
          valuation_models_encoding_cnf_formula_equals_corollary<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>k</span> <span class=main>≤</span> <span class=free>t</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> k_lt_t
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set<span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> v_is_delete_effect is_valid_problem_strips_operator_variable_sets<span class=main>(</span>3<span class=main>)</span> assms<span class=main>(</span>1<span class=main>)</span>
            op_is_valid
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
        <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ In broad strokes, this lemma shows that the operator frame axioms ensure that state is
propagated—i.e. the valuation of a variable does not change inbetween time steps—, if there is
no operator active which has an effect on a given variable a: i.e.

  \begin{align*}
    \mathcal A &amp;\vDash (\lnot a_i \land a_{i+1})
      \longrightarrow \bigvee\{op_i, k: op_i \text{ has add effect } a\}\\
    \mathcal A &amp;\vDash (a_i \land \lnot a_{i+1})
      \longrightarrow \bigvee\{op_i, k: op_i \text{ has delete effect } a\}
  \end{align*}

Now, if the disjunctions are empty—i.e. if no operator which is activated at time step $k$ has
either a positive or negative effect—, we have by simplification

  \begin{align*}
    \mathcal A \vDash \lnot(\lnot a_i \land a_{i+1})
      &amp;\equiv \mathcal A \vDash a_i \lor \lnot a_{i+1}\\
    \mathcal A \vDash \lnot(a_i \land \lnot a_{i+1})
      &amp;\equiv \mathcal A \vDash \lnot a_i \lor a_{i+1}
  \end{align*}

hence

   \begin{align*}
      \mathcal A &amp;\vDash (\lnot a_i \lor a_{i+1}) \land (a_i \lor \lnot a_{i+1})\\
      \leadsto \mathcal A &amp;\vDash \{\{\lnot a_i, a_{i+1}\}, \{a_i, \lnot a_{i+1}\}\}
    \end{align*}

The lemma characterizes this simplification.
\footnote{This part of the soundness proof is only treated very briefly in
\cite[theorem 3.1, p.1044]{DBLP:journals/ai/RintanenHN06}} ›</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_iv><span class=command>lemma</span></span> encode_problem_parallel_correct_iv<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span><span class=main>.</span>
      <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
    <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
      <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>  <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>  <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=comment1>(* TODO refactor (next two blocks)? *)</span>
  <span class=keyword1><span class=command>have</span></span> k_v_included<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>,</span> 4<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> operator_encoding_subset_encoding<span class=main>:</span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span> <span class=main>⊆</span> cnf <span class=var>?Φ</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_of_encode_problem_structure<span class=main>(</span>4<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=comment1>― ‹ Given the premise that no operator in <span class=antiquoted><span class=raw_text><span class=operator>‹</span>π<span class=hidden>⇩</span><sub>k</sub>›</span></span> exists with add-effect respectively delete
effect <span class=antiquoted><span class=raw_text><span class=operator>‹</span>v›</span></span>, we have the following situation for the EPC (effect precondition) sets:
  \begin{itemize}
    \item assuming <span class=antiquoted><span class=raw_text><span class=operator>‹</span>op›</span></span> is in <span class=antiquoted><span class=raw_text><span class=operator>‹</span>set ?ops›</span></span>, either <span class=antiquoted><span class=raw_text><span class=operator>‹</span>op›</span></span> is in <span class=antiquoted><span class=raw_text><span class=operator>‹</span>π<span class=hidden>⇩</span><sub>k</sub>›</span></span> (then it doesn't have effect on <span class=antiquoted><span class=raw_text><span class=operator>‹</span>v›</span></span>
      and therefore is not in either of the sets), or if is not, then
      <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜 (Operator k (index ?ops op) = ⊥›</span></span> by definition of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>decode_plan›</span></span>; moreover,
    \item assuming <span class=antiquoted><span class=raw_text><span class=operator>‹</span>op›</span></span> is not in <span class=antiquoted><span class=raw_text><span class=operator>‹</span>set ?ops›</span></span>—this is implicitely encoded as <span class=antiquoted><span class=raw_text><span class=operator>‹</span>Operator k
      (length ?ops)›</span></span> and <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜 (Operator k (length ?ops))›</span></span> may or may not be true—, then it's not
      in either of the sets.
  \end{itemize}.
Altogether, we have the situation that the sets only have members <span class=antiquoted><span class=raw_text><span class=operator>‹</span>Operator k (index ?ops op)›</span></span>
with <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜 (Operator k (index ?ops op)) = ⊥›</span></span>, hence the clause can be reduced to the state
variable literals.

More concretely, the following proof block shows that the following two conditions hold for the
operators:

  <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span>[display, indent=4] <span class=raw_text>"∀op. op ∈ { ((Operator k (index ?ops op))<span class=hidden>⇧</span><sup>+</sup>)
      | op. op ∈ set ?ops ∧ v ∈ set (add_effects_of op)}
    ⟶ ¬lit_semantics 𝒜 op"</span> <span class=antiquote>}</span></span>

and

  <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span>[display, indent=4] <span class=raw_text>"∀op. op ∈ { ((Operator k (index ?ops op))<span class=hidden>⇧</span><sup>+</sup>)
      | op. op ∈ set ?ops ∧ v ∈ set (delete_effects_of op)}
    ⟶ ¬lit_semantics 𝒜 op"</span> <span class=antiquote>}</span></span>

Hence, the operators are irrelevant for <span class=antiquoted><span class=raw_text><span class=operator>‹</span>cnf_semantics 𝒜 { C }›</span></span> where <span class=antiquoted><span class=raw_text><span class=operator>‹</span>C›</span></span> is
a clause encoding a positive or negative transition frame axiom for a given variable <span class=antiquoted><span class=raw_text><span class=operator>‹</span>v›</span></span> of the
problem. ›</span>
  <span class=comment1>(* TODO refactor. *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?add</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>
        <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?delete</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>
        <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
      <span class=keyword3><span class=command>assume</span></span> operator_encoding_in_add<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>∈</span> <span class=var>?add</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>5<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>∉</span> <span class=var>?add</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> operator_encoding_in_add
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> True
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?ops</span> <span class=main>!</span> index <span class=var>?ops</span> <span class=bound>op</span> <span class=main>|</span><span class=bound>op</span><span class=main>.</span>
                   <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>
                <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> operator_active_at_k<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> calculation
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> True
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?ops</span> <span class=main>!</span> index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span>
                  <span class=keyword1><span class=command>using</span></span> False
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> False
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∉</span> <span class=main>{</span><span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>}</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?add</span> <span class=main>=</span>
                <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>
                  <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>"</span></span>
                    <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span><span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=comment1>(* TODO slow. *)</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>∉</span> <span class=var>?add</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> operator_encoding_in_add
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
      <span class=keyword3><span class=command>assume</span></span> operator_encoding_in_delete<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?delete</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>5<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>∉</span> <span class=var>?delete</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> operator_encoding_in_delete
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> True
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?ops</span> <span class=main>!</span> index <span class=var>?ops</span> <span class=bound>op</span> <span class=main>|</span><span class=bound>op</span><span class=main>.</span>
                   <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>}</span>"</span></span>
                <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> operator_active_at_k<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> calculation
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> True
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
                <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?ops</span> <span class=main>!</span> index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
                <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span>
                  <span class=keyword1><span class=command>using</span></span> False
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> False
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∉</span> <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?delete</span> <span class=main>=</span>
                <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>
                  <span class=main>`</span> <span class=main>{</span> <span class=bound><span class=bound>op</span></span> <span class=main>∈</span> set <span class=var>?ops</span><span class=main>.</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>"</span></span>
                    <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span><span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=comment1>(* TODO slow. *)</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>∉</span> <span class=var>?delete</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> operator_encoding_in_delete
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> <span class=var>?add</span> <span class=main>⟶</span> <span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=bound>op</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> <span class=var>?delete</span> <span class=main>⟶</span> <span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=bound>op</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
      <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Ops</span> <span class=main>⊆</span> <span class=var>?C</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>-</span> <span class=var>?Ops</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>  <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>L</span> <span class=main>∈</span> <span class=var>?Ops</span><span class=main>.</span> <span class=main>¬</span> lit_semantics <span class=free>𝒜</span> <span class=bound>L</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=var>?C</span>
      <span class=main>=</span> clause_semantics <span class=free>𝒜</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> lit_semantics_reducible_to_subset_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span>  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Ops'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
      <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Ops'</span> <span class=main>⊆</span> <span class=var>?C'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C'</span> <span class=main>-</span> <span class=var>?Ops'</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>L</span> <span class=main>∈</span> <span class=var>?Ops'</span><span class=main>.</span> <span class=main>¬</span> lit_semantics <span class=free>𝒜</span> <span class=bound>L</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=var>?C'</span>
      <span class=main>=</span> clause_semantics <span class=free>𝒜</span> <span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> lit_semantics_reducible_to_subset_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?Ops'</span></span></span> <span class=var><span class=quoted><span class=var>?C'</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span>  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> cnf_semantics_𝒜_Φ<span class=main>:</span><span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>(</span>cnf <span class=var>?Φ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> valuation_models_encoding_cnf_formula_equals<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> k_v_included<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>,</span> 4<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>have</span></span> c_in_un_a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> <span class=main>⋃</span><span class=var>?A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> c'_in_un_b<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?C'</span> <span class=main>∈</span> <span class=main>⋃</span><span class=var>?B</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> k_v_included
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?C'</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_frame_axioms_structure UnI1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?A</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?B</span>"</span></span><span class=main>]</span> c_in_un_a
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_frame_axioms_structure UnI2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?C'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?B</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?A</span>"</span></span><span class=main>]</span> c'_in_un_b
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?C</span> <span class=main>}</span> <span class=main>⊆</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> c'_subset_frame_axiom_encoding<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?C'</span> <span class=main>}</span> <span class=main>⊆</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?C</span> <span class=main>}</span> <span class=main>⊆</span> cnf <span class=var>?Φ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?C'</span> <span class=main>}</span> <span class=main>⊆</span> cnf <span class=var>?Φ</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> operator_encoding_subset_encoding
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span>
        <span class=keyword1><span class=command>using</span></span> c'_subset_frame_axiom_encoding operator_encoding_subset_encoding
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span> <span class=var>?C</span> <span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span> <span class=var>?C'</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_semantics_𝒜_Φ model_for_cnf_is_model_of_all_subsets
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_v><span class=command>lemma</span></span> encode_problem_parallel_correct_v<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?π</span> <span class=main>!</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> k_lt_t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> k_lte_t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> suc_k_lte_t<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=free>k</span> <span class=main>≤</span> <span class=free>t</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> decode_plan_length<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>𝒜</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>argo</span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> operator_preconditions_hold<span class=main>:</span>
    <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>∧</span> are_all_operator_effects_consistent <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>1<span class=main><span class=main><span class=main>,</span></span></span> 2<span class=main><span class=main><span class=main>,</span></span></span> 3<span class=main><span class=main><span class=main>)</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=comment1>― ‹ We show the goal in classical fashion by proving that
      <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span>[display, indent=4] <span class=raw_text>"Φ<span class=hidden>⇩</span><sub>S</sub>¯ Π 𝒜 (Suc k) v
        = execute_parallel_operator (Φ<span class=hidden>⇩</span><sub>S</sub>¯ Π 𝒜 k)
          ((Φ¯ Π 𝒜 t) ! k) v"</span><span class=antiquote>}</span></span>
    ---i.e. the state decoded at time <span class=antiquoted><span class=raw_text><span class=operator>‹</span>k + 1›</span></span> is equivalent to the state obtained by executing the
    parallel operator <span class=antiquoted><span class=raw_text><span class=operator>‹</span>(Φ¯ Π 𝒜 t) ! k›</span></span> on the previous state
    <span class=antiquoted><span class=raw_text><span class=operator>‹</span>Φ<span class=hidden>⇩</span><sub>S</sub>¯ Π 𝒜 k›</span></span>—for all variables <span class=antiquoted><span class=raw_text><span class=operator>‹</span>v›</span></span> given <span class=antiquoted><span class=raw_text><span class=operator>‹</span>k &lt; t›</span></span>, a model <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span>,
    and makespan <span class=antiquoted><span class=raw_text><span class=operator>‹</span>t›</span></span>. ›</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> v_in_dom_s<span class=hidden>⇩</span><sub>k</sub>'<span class=main>:</span><span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> s<span class=hidden>⇩</span><sub>k</sub>'_not_none<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∨</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
            <span class=keyword2><span class=keyword>where</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span> <span class=main>∨</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>v_is_add_effect<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=main>|</span> <span class=main>(</span>v_is_delete_effect<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> v_is_add_effect
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
                <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_iii<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                  v_is_add_effect
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> operator_preconditions_hold v_is_add_effect
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
                <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_positive_effect_if<span class=main>[</span><span class=operator>of</span>
                    <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span>"</span></span><span class=main>]</span> op_in_π<span class=hidden>⇩</span><sub>k</sub>
                  v_is_add_effect calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> v_is_delete_effect
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
                <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_iii<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                  v_is_delete_effect
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> operator_preconditions_hold
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
                <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_effect<span class=main>(</span>2<span class=main>)</span> op_in_π<span class=hidden>⇩</span><sub>k</sub>
                  v_is_delete_effect calculation<span class=main>(</span>2<span class=main>,</span> 3<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> execute_parallel_operator_negative_effect_if op_in_π<span class=hidden>⇩</span><sub>k</sub> operator_preconditions_hold v_is_delete_effect<span class=main>)</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=comment1>(* TODO slow. *)</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=skolem>v</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_no_effect_if
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> decode_state_at_valid_variable<span class=main>[</span><span class=operator>OF</span> s<span class=hidden>⇩</span><sub>k</sub>'_not_none<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> state_propagation_positive<span class=main>:</span>
              <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span><span class=main>{</span><span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
                <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> state_propagation_negative<span class=main>:</span>
              <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span><span class=main>{</span><span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
                <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span><span class=main>}</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_iv<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>1<span class=main><span class=main><span class=main>,</span></span></span> 2<span class=main><span class=main><span class=main>)</span></span></span> k_lt_t _ False<span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
            <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>s<span class=hidden>⇩</span><sub>k</sub>'_v_positive<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
              <span class=main>|</span> <span class=main>(</span>s<span class=hidden>⇩</span><sub>k</sub>'_v_negative<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
              <span class=keyword1><span class=command>using</span></span> s<span class=hidden>⇩</span><sub>k</sub>'_not_none
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=skolem>v</span>"</span></span>
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
                <span class=keyword3><span class=command>case</span></span> s<span class=hidden>⇩</span><sub>k</sub>'_v_positive
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span>
                      assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> suc_k_lte_t v_in_set_vs<span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=comment1>(* TODO slow. *)</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> state_propagation_negative
                  <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def clause_semantics_def
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span>
                      assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> k_lte_t v_in_set_vs<span class=main>]</span> s<span class=hidden>⇩</span><sub>k</sub>'_v_positive
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>next</span></span>
                <span class=keyword3><span class=command>case</span></span> s<span class=hidden>⇩</span><sub>k</sub>'_v_negative
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span>
                      <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> suc_k_lte_t v_in_set_vs<span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=comment1>(* TODO slow. *)</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> state_propagation_positive
                  <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def clause_semantics_def
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span>
                      assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> k_lte_t v_in_set_vs<span class=main>]</span> s<span class=hidden>⇩</span><sub>k</sub>'_v_negative
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>qed</span></span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> map_le_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> t<span class=hidden>⇩</span><sub>k</sub>'_not_none<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> contradiction<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> None"</span></span>
            <span class=keyword1><span class=command>using</span></span> decode_state_at_valid_variable
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
            <span class=keyword2><span class=keyword>where</span></span> op_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> v_is_or<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>
                <span class=main>∨</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> execute_parallel_operators_strips_none_if_contraposition<span class=main>[</span><span class=operator>OF</span>
                t<span class=hidden>⇩</span><sub>k</sub>'_not_none<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>have</span></span> op_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> op_in decode_plan_step_element_then<span class=main>(</span>1<span class=main>)</span> k_lt_t
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> v_is_or
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> A
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_operator_variable_sets<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span>
                    assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> op_in A
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
                <span class=keyword1><span class=command>using</span></span> contradiction
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> B
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_operator_variable_sets<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>OF</span>
                    assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> op_in B
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
                <span class=keyword1><span class=command>using</span></span> contradiction
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>qed</span></span>
          <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>hence</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>op</span><span class=main>∈</span>set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∨</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
            <span class=keyword2><span class=keyword>where</span></span> op_in_set_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> v_options<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span> <span class=main>∨</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> k_lt_t<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>v_is_add_effect<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=main>|</span> <span class=main>(</span>v_is_delete_effect<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> v_options
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> v_is_add_effect
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
                <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_positive_effect_if<span class=main>[</span><span class=operator>OF</span> _ _ op_in_set_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                  operator_preconditions_hold
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
                <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_iii<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span> op_in_set_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                  v_is_add_effect
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> v_is_delete_effect
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
                <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_negative_effect_if<span class=main>[</span><span class=operator>OF</span> _ _ op_in_set_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                  operator_preconditions_hold
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
                <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_iii<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span> op_in_set_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
                  v_is_delete_effect
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>have</span></span> state_propagation_positive<span class=main>:</span>
            <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span><span class=main>{</span><span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>}</span><span class=main>}</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> state_propagation_negative<span class=main>:</span>
            <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>{</span><span class=main>{</span><span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_iv<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>1<span class=main><span class=main><span class=main>,</span></span></span> 2<span class=main><span class=main><span class=main>)</span></span></span> k_lt_t v_in_set_vs
                False<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> all_op_in_set_π<span class=hidden>⇩</span><sub>k</sub>_have_no_effect<span class=main>:</span>
              <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> False
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=skolem>v</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_no_effect_if<span class=main>[</span><span class=operator>OF</span> all_op_in_set_π<span class=hidden>⇩</span><sub>k</sub>_have_no_effect<span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> t<span class=hidden>⇩</span><sub>k</sub>'_equals_s<span class=hidden>⇩</span><sub>k</sub> <span class=main>=</span> this
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
              <span class=keyword1><span class=command>using</span></span> t<span class=hidden>⇩</span><sub>k</sub>'_not_none t<span class=hidden>⇩</span><sub>k</sub>'_equals_s<span class=hidden>⇩</span><sub>k</sub>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>s<span class=hidden>⇩</span><sub>k</sub>_v_is_some_true<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
              <span class=main>|</span> <span class=main>(</span>s<span class=hidden>⇩</span><sub>k</sub>_v_is_some_false<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> s<span class=hidden>⇩</span><sub>k</sub>_v_is_some_true
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span>
                      assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> k_lte_t v_in_set_vs<span class=main>]</span> s<span class=hidden>⇩</span><sub>k</sub>_v_is_some_true
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> state_propagation_positive
                  <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def clause_semantics_def
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span>
                      assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> suc_k_lte_t v_in_set_vs<span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> t<span class=hidden>⇩</span><sub>k</sub>'_equals_s<span class=hidden>⇩</span><sub>k</sub>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> s<span class=hidden>⇩</span><sub>k</sub>_v_is_some_false
              <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span>
                      assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> k_lte_t v_in_set_vs<span class=main>]</span> s<span class=hidden>⇩</span><sub>k</sub>_v_is_some_false
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span><span class=main>(</span>State <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> state_propagation_negative
                  <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def clause_semantics_def
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
                  <span class=keyword1><span class=command>using</span></span> decode_state_at_encoding_variables_equals_some_of_valuation_if<span class=main>[</span><span class=operator>OF</span>
                      assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> suc_k_lte_t v_in_set_vs<span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> t<span class=hidden>⇩</span><sub>k</sub>'_equals_s<span class=hidden>⇩</span><sub>k</sub>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?t<span class=hidden>⇩</span><sub>k</sub>'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?s<span class=hidden>⇩</span><sub>k</sub>'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> map_le_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> map_le_antisym
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_vi><span class=command>lemma</span></span> encode_problem_parallel_correct_vi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span>
    <span class=main>=</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>k</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> 0
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=var>?I</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_head_is_initial_state
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>0</span> <span class=main>=</span> <span class=var>?I</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> decode_state_at_initial_state<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=skolem>k</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> k_lt_length_τ_minus_one<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> k_lt_length_τ<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span><span class=main><span class=keyword3>+</span></span>
      <span class=comment1>― ‹ Use the induction hypothesis to obtain the proposition for the previous step $k$.
        Then, show that applying the $k$-th parallel operator in the plan $\pi$ on either the state
        obtained from the trace or decoded from the model yields the same successor state. ›</span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span> <span class=main>=</span> execute_parallel_plan <span class=var>?I</span> <span class=main>(</span>take <span class=skolem>k</span> <span class=var>?π</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_plan_prefix k_lt_length_τ
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?τ<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>=</span> <span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.IH<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> k_lt_length_τ<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span> <span class=main>!</span> Suc <span class=skolem>k</span>
        <span class=main>=</span> execute_parallel_operator <span class=var>?τ<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_step_effect_is<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>thm</span></span> Suc.prems<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span><span class=main>)</span> <span class=main>≤</span> length <span class=var>?π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?π</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Suc.prems<span class=main>(</span>3<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> Suc_eq_plus1
          <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span>
          <span class=main>=</span> execute_parallel_operator <span class=var>?s<span class=hidden>⇩</span><sub>k</sub></span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_v<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_vii><span class=command>lemma</span></span> encode_problem_parallel_correct_vii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>map <span class=main>(</span>decode_state_at <span class=free>Π</span> <span class=free>𝒜</span><span class=main>)</span>
      <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=main>(</span>length <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>
    <span class=main>=</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?σ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span>decode_state_at <span class=free>Π</span> <span class=free>𝒜</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=main>(</span>length <span class=var>?π</span><span class=main>)</span><span class=main>]</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> "</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?k</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?l</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> length_σ_neq_length_τ<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=var>?σ</span> <span class=main>≠</span> length <span class=var>?τ</span>"</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?σ</span> <span class=main>=</span> length <span class=var>?π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> length <span class=var>?π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>&lt;</span> length <span class=var>?π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> length_σ_neq_length_τ calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=var>?τ</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_not_nil<span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> length <span class=var>?π</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>=</span> Suc <span class=skolem>k'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> less_imp_Suc_add<span class=main>[</span><span class=operator>OF</span> length_trace_parallel_plan_gt_0<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?k</span> <span class=main>&lt;</span> length <span class=var>?π</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>3</sub> <span class=main>=</span> this
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=var>?k</span> <span class=main>=</span> execute_parallel_plan <span class=var>?I</span> <span class=main>(</span>take <span class=var>?k</span> <span class=var>?π</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_plan_prefix<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?k</span></span></span><span class=main>]</span>
            length_trace_minus_one_lt_length_trace
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>thm</span></span> encode_problem_parallel_correct_vi<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>3</sub>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=var>?k</span><span class=main>)</span> <span class=main>=</span> <span class=var>?τ</span> <span class=main>!</span> <span class=var>?k</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_vi<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span>
              length_trace_minus_one_lt_length_trace<span class=main>]</span><span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=var>?k</span><span class=main>)</span>  <span class=main>=</span> execute_parallel_plan <span class=var>?I</span> <span class=main>(</span>take <span class=var>?k</span> <span class=var>?π</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>4</sub> <span class=main>=</span> this
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=var>?k</span><span class=main>)</span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=var>?k</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=var>?k</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_ii<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>1<span class=main><span class=main><span class=main>,</span></span></span> 2<span class=main><span class=main><span class=main>)</span></span></span><span class=main>]</span> nb<span class=hidden>⇩</span><sub>3</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=comment1>― ‹ Unsure why <span class=antiquoted><span class=raw_text><span class=operator>‹</span>calculation(1, 2)›</span></span> is needed for this proof step. Should just require the
          default proof. ›</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_all_operators_applicable <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=var>?k</span><span class=main>)</span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=var>?k</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_all_operator_effects_consistent <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=var>?k</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lt_length_plan_plus_one_then<span class=main>[</span><span class=operator>OF</span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>]</span>
            calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
          <span class=keyword1><span class=command>unfolding</span></span> nb<span class=hidden>⇩</span><sub>3</sub> nb<span class=hidden>⇩</span><sub>4</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_x><span class=command>lemma</span></span> encode_problem_parallel_correct_x<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"map <span class=main>(</span>decode_state_at <span class=free>Π</span> <span class=free>𝒜</span><span class=main>)</span>
      <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=main>(</span>length <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>]</span>
    <span class=main>=</span> trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?σ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span>decode_state_at <span class=free>Π</span> <span class=free>𝒜</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=main>(</span>length <span class=var>?π</span><span class=main>)</span><span class=main>]</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>=</span> length <span class=var>?σ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_vii<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
      <span class=keyword3><span class=command>assume</span></span> k_lt_length_τ<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=skolem>k</span>
        <span class=main>=</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=skolem>k</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_vi<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> length <span class=var>?π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> k_lt_length_τ
          <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> Suc <span class=main>(</span>length <span class=var>?π</span><span class=main>)</span> <span class=main>-</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?σ</span> <span class=main>!</span> <span class=skolem>k</span> <span class=main>=</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=skolem>k</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nth_map_upt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=quoted>"Suc <span class=main>(</span>length <span class=var>?π</span><span class=main>)</span>"</span></span> <span class=quoted><span class=main>0</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span> <span class=main>=</span> <span class=var>?σ</span> <span class=main>!</span> <span class=skolem>k</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>=</span> <span class=var>?σ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> list_eq_iff_nth_eq<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=var><span class=quoted><span class=var>?σ</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_correct_xi><span class=command>lemma</span></span> encode_problem_parallel_correct_xi<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>∈</span> set <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
 <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?π</span> <span class=main>=</span> <span class=free>t</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> decode_plan_length
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>=</span> <span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> in_set_conv_nth<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ops</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span><span class=main>]</span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> calculation
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> decode_plan_step_element_then<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ To show soundness, we have to prove the following: given the existence of a model
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> of the basic SATPlan encoding <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹encode_problem <span class=free><span class=free>Π</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span> for a given valid problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span>
and hypothesized plan length <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>t</span></span>›</span></span></span></span>, the decoded plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span> <span class=main><span class=main>≡</span></span> <span class=keyword1><span class=keyword1>Φ¯</span></span> <span class=free><span class=free>Π</span></span> <span class=free><span class=free>𝒜</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span> is a parallel solution
for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span>.

We show this theorem by showing equivalence between the execution trace of the decoded plan and the
sequence of states

  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"σ = map (λ k. Φ<span class=hidden>⇩</span><sub>S</sub>¯ Π 𝒜 k) [0..&lt;Suc (length ?π)]"</span></span> <span class=antiquote><span class=antiquote>}</span></span></span></span>

decoded from the model <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span>. Let

  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"τ ≡ trace_parallel_plan_strips I π"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

be the trace of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span>. Theorem \ref{isathm:soundness-satplan-encoding} first establishes the
equality <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>σ</span></span> <span class=main><span class=main>=</span></span> <span class=free><span class=free>τ</span></span>›</span></span></span></span> of the decoded state sequence and the trace of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span>.
We can then derive that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G</span></span> <span class=keyword1><span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span></span> last <span class=free><span class=free>σ</span></span>›</span></span></span></span> by lemma \ref{isathm:parallel-solution-trace-strips}, i.e. the last
state reached by plan execution (and moreover the last state decoded from the model), satisfies the
goal state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G</span></span>›</span></span></span></span> defined by the problem. By lemma \ref{isathm:parallel-solution-trace-strips}, we
can conclude that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> is a solution for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>I</span></span>›</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G</span></span>›</span></span></span></span>.

Moreover, we show that all operators <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span>›</span></span></span></span> in all parallel operators <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ops</span></span> <span class=main><span class=main>∈</span></span> set <span class=free><span class=free>π</span></span>›</span></span></span></span>
are also contained in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒪</span></span>›</span></span></span></span>. This is the case because the plan decoding function reverses the
encoding function (which only encodes operators in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒪</span></span>›</span></span></span></span>).

By definition \ref{isadef:parallel-solution-strips} this means that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> is a parallel solution
for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span>. Moreover <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> has length <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>t</span></span>›</span></span></span></span> as confirmed by lemma
\isaname{decode_plan_length}.
\footnote{This lemma is used in the proof but not shown.} ›</span></span>

<span class=keyword1><span class=command>theorem</span></span>  encode_problem_parallel_sound<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?σ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span> <span class=bound>k</span><span class=main>.</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>S</sub>¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=bound>k</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=main>(</span>length <span class=var>?π</span><span class=main>)</span><span class=main>]</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span>"</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?σ</span> <span class=main>=</span> <span class=var>?τ</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_x<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?π</span> <span class=main>=</span> <span class=free>t</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> decode_plan_length
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=var>?σ</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> decode_state_at_goal_state<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> execute_parallel_plan_reaches_goal_iff_goal_is_last_element_of_trace
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=var>?π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_xi<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def
      <span class=keyword1><span class=command>unfolding</span></span> list_all_iff ListMem_iff operators_of_def STRIPS_Representation.operators_of_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>value</span></span>  <span class=quoted><span class=quoted>"<span class=free>stop</span>"</span></span> <span class=comment1>(* Tell document preparation to stop collecting for the last tag *)</span>



<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Completeness"</span></span>

<span class=comment1>(* TODO make abbreviation *)</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>empty_valuation</span> <span class=main>::</span> <span class=quoted><span class=quoted>"sat_plan_variable valuation"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>"</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>empty_valuation</span> <span class=main>≡</span>  <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>valuation_for_state</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> list
    <span class=main>⇒</span><span class=tfree>'variable</span> strips_state
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span>
    <span class=main>⇒</span> sat_plan_variable valuation
    <span class=main>⇒</span> sat_plan_variable valuation"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>valuation_for_state</span> <span class=free><span class=bound><span class=entity>vs</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=free><span class=bound><span class=entity>𝒜</span></span></span>
    <span class=main>≡</span> <span class=free><span class=bound><span class=entity>𝒜</span></span></span><span class=main>(</span>State <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>(</span>index <span class=free><span class=bound><span class=entity>vs</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span> <span class=main>:=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>=</span> Some True<span class=main>)</span><span class=main>)</span>"</span></span>

<span class=comment1>― ‹ Since the trace may be shorter than the plan length even though the last trace element
subsumes the goal state---namely in case plan execution is impossible due to violation of the
execution condition but the reached state serendipitously subsumes the goal state---, we also have
to repeat the valuation for all time steps <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>k'</span> <span class=main>∈</span> <span class=main>{</span>length <span class=free>τ</span><span class=main>..</span><span class=main>(</span>length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span>›</span></span> for all \
<span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>v</span> <span class=main>∈</span> <span class=free>𝒱</span>›</span></span> (see <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>𝒜<span class=hidden>⇩</span><sub>2</sub></span>›</span></span>). ›</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>valuation_for_state_variables</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator list list
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state list
    <span class=main>⇒</span> sat_plan_variable valuation"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>valuation_for_state_variables</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>π</span></span></span> <span class=free><span class=bound><span class=entity>τ</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>t'</span> <span class=main>=</span> length <span class=free><span class=bound><span class=entity>τ</span></span></span>
      <span class=main>;</span> <span class=bound>τ<span class=hidden>⇩</span><sub>Ω</sub></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>τ</span></span></span> <span class=main>!</span> <span class=main>(</span><span class=bound>t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>
      <span class=main>;</span> <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>V<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>t'</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=bound>vs</span> <span class=main>}</span>
      <span class=main>;</span> <span class=bound>V<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>t'</span><span class=main>..</span><span class=main>(</span>length <span class=free><span class=bound><span class=entity>π</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=bound>vs</span> <span class=main>}</span>
      <span class=main>;</span> <span class=bound>𝒜<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> foldr
        <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> valuation_for_state <span class=main>(</span>variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>τ</span></span></span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>k</span> <span class=bound>v</span> <span class=bound>𝒜</span><span class=main>)</span>
        <span class=main>(</span>List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>t'</span><span class=main>]</span> <span class=bound>vs</span><span class=main>)</span>
        <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>
      <span class=main>;</span> <span class=bound>𝒜<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> foldr
        <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> valuation_for_state <span class=main>(</span>variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span> <span class=bound>τ<span class=hidden>⇩</span><sub>Ω</sub></span> <span class=bound>k</span> <span class=bound>v</span> <span class=bound>𝒜</span><span class=main>)</span>
        <span class=main>(</span>List.product <span class=main>[</span><span class=bound>t'</span><span class=main>..&lt;</span>length <span class=free><span class=bound><span class=entity>π</span></span></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>]</span> <span class=bound>vs</span><span class=main>)</span>
        <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>
    <span class=keyword1>in</span> override_on <span class=main>(</span>override_on <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=bound>𝒜<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>V<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=bound>𝒜<span class=hidden>⇩</span><sub>2</sub></span> <span class=bound>V<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>

<span class=comment1>― ‹ The valuation is left to yield false for the potentially remaining
<span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>k'</span> <span class=main>∈</span> <span class=main>{</span>length <span class=free>τ</span><span class=main>..</span><span class=main>(</span>length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span>›</span></span> since no more operators are executed after the trace ends
anyway. The definition of <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>›</span></span> as the valuation that is false for every argument ensures
this implicitely. ›</span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>valuation_for_operator_variables</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator list list
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_state list
    <span class=main>⇒</span> sat_plan_variable valuation"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>valuation_for_operator_variables</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>π</span></span></span> <span class=free><span class=bound><span class=entity>τ</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>Op</span> <span class=main>=</span> <span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=bound>ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free><span class=bound><span class=entity>τ</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span> <span class=main>}</span>
    <span class=keyword1>in</span> override_on
      <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>
      <span class=main>(</span>foldr
        <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=bound>ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>:=</span> True<span class=main>)</span><span class=main>)</span>
        <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> map <span class=main>(</span>Pair <span class=bound>k</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>π</span></span></span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free><span class=bound><span class=entity>τ</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>
        <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span><span class=main>)</span>
      <span class=bound>Op</span>"</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ The completeness proof requires that we show that the SATPlan encoding <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>Φ</span></span> <span class=free><span class=free>Π</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span> of a
problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span> has a model <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> in case a solution <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> with length <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>t</span></span>›</span></span></span></span> exists.
Since a plan corresponds to a state trace <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span> <span class=main><span class=main>≡</span></span> trace_parallel_plan_strips <span class=free><span class=free>I</span></span> <span class=free><span class=free>π</span></span>›</span></span></span></span> with
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"τ ! k = execute_parallel_plan I (take k π)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=free><span class=free>τ</span></span>›</span></span></span></span> we can construct a valuation <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜<span class=hidden>⇩</span><sub>V</sub></span></span>›</span></span></span></span> modeling the state sequence in
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span>›</span></span></span></span> by letting
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"𝒜(State k (index vs v) := (s v = Some True))"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
or all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>𝒱</span></span>›</span></span></span></span> where <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>s</span></span> <span class=main><span class=main>≡</span></span> <span class=free><span class=free>τ</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span> .
\footnote{It is helpful to remember at this point, that the trace elements of a solution contain
the states reached by plan prefix execution (lemma \ref{isathm:trace-elements-and-plan-prefixes}).}

Similarly to <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜<span class=hidden>⇩</span><sub>V</sub></span></span>›</span></span></span></span>, we obtain an operator valuation <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜<span class=hidden>⇩</span><sub>O</sub></span></span>›</span></span></span></span> by defining
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"𝒜(Operator k (index ops op) := True)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
for all operators <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>𝒪</span></span>›</span></span></span></span> s.t. <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span> <span class=main><span class=main>∈</span></span> set <span class=main><span class=main>(</span></span><span class=free><span class=free>π</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=free><span class=free>τ</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span>.

The overall valuation for the plan execution <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> can now be constructed by combining the
state variable valuation <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜<span class=hidden>⇩</span><sub>V</sub></span></span>›</span></span></span></span> and operator valuation <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜<span class=hidden>⇩</span><sub>O</sub></span></span>›</span></span></span></span>. ›</span></span>

<span class=keyword1><span class=command>definition</span></span>  <span class=entity>valuation_for_plan</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator list list
    <span class=main>⇒</span> sat_plan_variable valuation"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>valuation_for_plan</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>π</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>vs</span> <span class=main>=</span> variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>τ</span> <span class=main>=</span> trace_parallel_plan_strips <span class=main>(</span>initial_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>π</span></span></span>
      <span class=main>;</span> <span class=bound>t</span> <span class=main>=</span> length <span class=free><span class=bound><span class=entity>π</span></span></span>
      <span class=main>;</span> <span class=bound>t'</span> <span class=main>=</span> length <span class=bound>τ</span>
      <span class=main>;</span> <span class=bound>𝒜<span class=hidden>⇩</span><sub>V</sub></span> <span class=main>=</span> valuation_for_state_variables <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>π</span></span></span> <span class=bound>τ</span>
      <span class=main>;</span> <span class=bound>𝒜<span class=hidden>⇩</span><sub>O</sub></span> <span class=main>=</span> valuation_for_operator_variables <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>π</span></span></span> <span class=bound>τ</span>
      <span class=main>;</span> <span class=bound>V</span> <span class=main>=</span> <span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=bound>vs</span> <span class=bound>v</span><span class=main>)</span>
        <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>t</span> <span class=main>+</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=bound>vs</span> <span class=main>}</span>
      <span class=main>;</span> <span class=bound>Op</span> <span class=main>=</span> <span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=bound>ops</span> <span class=bound>op</span><span class=main>)</span>
        <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>t</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span> <span class=main>}</span>
    <span class=keyword1>in</span> override_on <span class=main>(</span>override_on <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=bound>𝒜<span class=hidden>⇩</span><sub>V</sub></span> <span class=bound>V</span><span class=main>)</span> <span class=bound>𝒜<span class=hidden>⇩</span><sub>O</sub></span> <span class=bound>Op</span>"</span></span>


<span class=comment1>― ‹ Show that in case of an encoding with makespan zero, it suffices to show that a given
model satisfies the initial state and goal state encodings. ›</span>
<span class=comment1>(* TODO refactor. *)</span>
<span class=keyword1 id=SAT_Plan_Base-model_of_encode_problem_makespan_zero_iff><span class=command>lemma</span></span> model_of_encode_problem_makespan_zero_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span> <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"encode_operators <span class=free>Π</span> <span class=main>0</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span> <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_operators_def encode_all_operator_effects_def
      encode_all_operator_preconditions_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"encode_all_frame_axioms <span class=free>Π</span> <span class=main>0</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_all_frame_axioms_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def SAT_Plan_Base.encode_problem_def encode_initial_state_def
      encode_goal_state_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor. *)</span>
<span class=keyword1 id=SAT_Plan_Base-empty_valution_is_False><span class=command>lemma</span></span> empty_valution_is_False<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=free>v</span> <span class=main>=</span> False"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> empty_valuation_def<span class=keyword1><span class=command>..</span></span>

<span class=keyword1 id=SAT_Plan_Base-model_initial_state_set_valuations><span class=command>lemma</span></span>  model_initial_state_set_valuations<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=keyword1>case</span> <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=bound>v</span> <span class=keyword1>of</span> Some <span class=bound>b</span>
          <span class=main>⇒</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span><span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>:=</span> <span class=bound>b</span><span class=main>)</span>
        <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span><span class=main>)</span>
      <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>{</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span><span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span> <span class=main>:=</span> the <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
      <span class=main>|</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=keyword1>case</span> <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=bound>v</span> <span class=keyword1>of</span> Some <span class=bound>b</span>
    <span class=main>⇒</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span><span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>:=</span> <span class=bound>b</span><span class=main>)</span> <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?g</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>v</span><span class=main>.</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span><span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>:=</span> the <span class=main>(</span><span class=var>?I</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜s</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=var>?f</span> <span class=var>?vs</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=var>?I</span> <span class=main>=</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?I</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?g</span> <span class=skolem>v</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=main>`</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>=</span> <span class=var>?g</span> <span class=main>`</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?𝒜s</span> <span class=main>=</span> <span class=var>?g</span> <span class=main>`</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> set_map
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor *)</span>
<span class=keyword1 id=SAT_Plan_Base-valuation_of_state_variable_implies_lit_semantics_if><span class=command>lemma</span></span> valuation_of_state_variable_implies_lit_semantics_if<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> dom <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=free>vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> the <span class=main>(</span><span class=free>S</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=main>(</span>literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=free>k</span> <span class=main>(</span>index <span class=free>vs</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span><span class=free>S</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?L</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=free>k</span> <span class=main>(</span>index <span class=free>vs</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span><span class=free>S</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>True<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
    <span class=main>|</span> <span class=main>(</span>False<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>v</span> <span class=main>=</span> Some False"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor ‹Fun_Supplement›? *)</span>
<span class=keyword1 id=SAT_Plan_Base-foldr_fun_upd><span class=command>lemma</span></span> foldr_fun_upd<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"inj_on <span class=free>f</span> <span class=main>(</span>set <span class=free>xs</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span> <span class=free>𝒜</span> <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>g</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>xs</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=free>x</span>"</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>from</span></span> False
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=skolem>xs</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on <span class=free>f</span> <span class=main>(</span>set <span class=skolem>xs</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>1<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span> <span class=free>𝒜</span><span class=main>)</span> <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>g</span> <span class=free>x</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.IH
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=comment1>― ‹ Follows from modus tollens on the definition of <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"inj_on"</span><span class=antiquote>}</span></span>. ›</span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=free>f</span> <span class=free>x</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> Cons.prems False
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=free>𝒜</span>
              <span class=main>=</span> <span class=main>(</span>foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span> <span class=free>𝒜</span><span class=main>)</span><span class=main>(</span><span class=free>f</span> <span class=skolem>a</span> <span class=main>:=</span> <span class=free>g</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=free>𝒜</span> <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span>
              <span class=main>=</span> <span class=main>(</span>foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span> <span class=free>𝒜</span><span class=main>)</span> <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>unfolding</span></span> fun_upd_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
          <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
       <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SAT_Plan_Base-foldr_fun_no_upd><span class=command>lemma</span></span> foldr_fun_no_upd<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"inj_on <span class=free>f</span> <span class=main>(</span>set <span class=free>xs</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>∉</span> <span class=free>f</span> <span class=main>`</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span> <span class=free>𝒜</span> <span class=free>y</span> <span class=main>=</span> <span class=free>𝒜</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>xs</span><span class=main>)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on <span class=free>f</span> <span class=main>(</span>set <span class=skolem>xs</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>∉</span> <span class=free>f</span> <span class=main>`</span> set <span class=skolem>xs</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.prems
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span> <span class=free>𝒜</span> <span class=free>y</span> <span class=main>=</span> <span class=free>𝒜</span> <span class=free>y</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.IH
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=free>y</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Cons.prems<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=free>𝒜</span>
      <span class=main>=</span> <span class=main>(</span>foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span> <span class=free>𝒜</span><span class=main>)</span><span class=main>(</span><span class=free>f</span> <span class=skolem>a</span> <span class=main>:=</span> <span class=free>g</span> <span class=skolem>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=free>𝒜</span> <span class=free>y</span>
      <span class=main>=</span> <span class=main>(</span>foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=main>:=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=skolem>xs</span> <span class=free>𝒜</span><span class=main>)</span> <span class=free>y</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> fun_upd_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=comment1>― ‹ We only use the part of the characterization of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span> which pertains to the state
variables here. ›</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_i><span class=command>lemma</span></span> encode_problem_parallel_complete_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
     <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>⟶</span>  <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>
        <span class=main>∧</span> <span class=main>(</span><span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span><span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>≠</span> Some True<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> v_in_set_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_encode_initial_state_set_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=var>?τ</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_not_nil
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=main>0</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span><span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=main>0</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>≠</span> Some True<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>presburger</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?L</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=main>0</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>(</span><span class=var>?I</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> τ_0_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=var>?I</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_head_is_initial_state
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>have</span></span> v_in_dom_I<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> dom <span class=var>?I</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> is_valid_problem_strips_initial_of_dom assms<span class=main>(</span>1<span class=main>)</span> v_in_set_vs
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>I_v_is_Some_True<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=main>|</span> <span class=main>(</span>I_v_is_Some_False<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?I</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=free>𝒜</span> <span class=var>?L</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> encode_state_variable_def
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> τ_0_is nb
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def C_is
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> is_cnf_encode_initial_state<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> is_nnf_cnf cnf_semantics
    <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ Plans may terminate early (i.e. by reaching a state satisfying the goal state before
reaching the time point corresponding to the plan length). We therefore have to show the goal by
splitting cases on whether the plan successfully terminated early.
If not, we can just derive the goal from the assumptions pertaining to <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span> Otherwise, we
have to first show that the goal was reached (albeit early) and that our valuation <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span>
reflects the termination of plan execution after the time point at which the goal was reached. ›</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_ii><span class=command>lemma</span></span> encode_problem_parallel_complete_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>⟶</span> <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>l</span><span class=main>.</span> <span class=bound>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>l</span> <span class=main>&lt;</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>
          <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span><span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>I</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> G_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=var>?τ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> execute_parallel_plan_reaches_goal_iff_goal_is_last_element_of_trace assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=var>?τ</span> <span class=main>!</span> <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> last_conv_nth<span class=main>[</span><span class=operator>OF</span> trace_parallel_plan_strips_not_nil<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?τ</span> <span class=main>!</span> <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> <span class=var>?G</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> G_of_v_is_not_None
      <span class=keyword1><span class=command>unfolding</span></span> map_le_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=comment1>(* TODO refactor. *)</span>
  <span class=comment1>― ‹ Discriminate on whether the trace has full length or not and show that the model
  valuation of the state variables always correspond to the (defined) goal state values. ›</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> G_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=var>?t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> <span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>=</span> <span class=var>?t</span> <span class=main>+</span> <span class=main>1</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t</span> <span class=main>&lt;</span> <span class=var>?t'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> calculation
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=var>?t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=var>?t</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> calculation<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>[</span><span class=operator>OF</span> G_of_v_is_not_None<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>&lt;</span> <span class=var>?t</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one False
              le_neq_implies_less
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=var>?t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> calculation
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=var>?t'</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_not_nil length_greater_0_conv<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?τ</span></span></span><span class=main>]</span>
              less_diff_conv2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>1</span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> calculation<span class=main>(</span>3<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=var>?t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>[</span><span class=operator>OF</span> G_of_v_is_not_None<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> C_in_cnf_of_Φ<span class=hidden>⇩</span><sub>G</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>G</sub></span>"</span></span>

    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> G_of_v_is_not_None<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>≠</span> None"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> literal_formula_to_literal <span class=main>(</span>encode_state_variable <span class=var>?t</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span>
        <span class=main>(</span><span class=var>?G</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_encode_goal_state_set_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>G_of_v_is_Some_True<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
      <span class=main>|</span> <span class=main>(</span>G_of_v_is_Some_False<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
      <span class=keyword1><span class=command>using</span></span> G_of_v_is_not_None
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>2</sub> C_is
      <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def encode_state_variable_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_semantics<span class=main>[</span><span class=operator>OF</span> is_nnf_cnf<span class=main><span class=main>[</span></span><span class=operator>OF</span> encode_goal_state_is_cnf<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ We are not using the full characterization of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span> here since it's not needed. ›</span>
<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_iii_a><span class=command>lemma</span></span> encode_problem_parallel_complete_iii_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> cnf <span class=main>(</span>encode_all_operator_preconditions <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>∧</span> <span class=bound>l</span> <span class=main>&lt;</span> length <span class=free>π</span>
      <span class=main>⟶</span> <span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>⟶</span>  <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=comment1>(* TODO slow. *)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>op</span></span>
    <span class=keyword2><span class=keyword>where</span></span> k_and_op_are<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
        <span class=main>,</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_operator_preconditions_structure assms<span class=main>(</span>3<span class=main>)</span>
      UN_E<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>C</span></span> <span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span>
    <span class=keyword2><span class=keyword>where</span></span> v_in_preconditions_of_op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>precondition_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> k_lt_length_τ_minus_one<span class=main>:</span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions k_lt_length_τ_minus_one
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
              <span class=keyword1><span class=command>using</span></span> are_all_operators_applicable_set v_in_preconditions_of_op True
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>6<span class=main>)</span> k_lt_length_τ_minus_one
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> k_lt_length_τ_minus_one
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≥</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> k_and_op_are
        <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>force</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>5<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
        <span class=keyword1><span class=command>using</span></span> C_is
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ We are not using the full characterization of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>𝒜›</span></span> here since it's not needed. ›</span>
<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_iii_b><span class=command>lemma</span></span> encode_problem_parallel_complete_iii_b<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> cnf <span class=main>(</span>encode_all_operator_effects <span class=free>Π</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>∧</span> <span class=bound>l</span> <span class=main>&lt;</span> length <span class=free>π</span>
      <span class=main>⟶</span> <span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>⟶</span>  <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>.</span>
    <span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span><span class=main>.</span>
      <span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>.</span>
         <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>C_in_A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span>
    <span class=main>|</span> <span class=main>(</span>C_in_B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=var>?B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Un_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>C</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span><span class=main>]</span> cnf_of_encode_all_operator_effects_structure assms<span class=main>(</span>3<span class=main>)</span>
     <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> C_in_A C_in_B<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> C_in_A
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>op</span></span>
        <span class=keyword2><span class=keyword>where</span></span> k_and_op_are<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set<span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span>
            <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=keyword2><span class=keyword>where</span></span> v_in_add_effects_of_op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> k_lt_length_τ_minus_one<span class=main>:</span> True
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> True
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions k_lt_length_τ_minus_one
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
                  <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_positive_effect_if<span class=main>[</span>
                    <span class=operator>OF</span> _ _ True v_in_add_effects_of_op<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span>"</span></span><span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> τ_Suc_k_is_Some_True<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
                <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_step_effect_is<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>6<span class=main>)</span> k_lt_length_τ_minus_one τ_Suc_k_is_Some_True
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> C_is
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> False
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> k_lt_length_τ_minus_one
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> C_is
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≥</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> k_and_op_are
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>5<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=comment1>― ‹ This case is completely symmetrical to the one above. ›</span>
      <span class=keyword3><span class=command>case</span></span> C_in_B
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>op</span></span>
        <span class=keyword2><span class=keyword>where</span></span> k_and_op_are<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span><span class=main>.</span>
            <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=keyword2><span class=keyword>where</span></span> v_in_delete_effects_of_op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> k_lt_length_τ_minus_one<span class=main>:</span> True
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> True
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions k_lt_length_τ_minus_one
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
                  <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_negative_effect_if<span class=main>[</span>
                    <span class=operator>OF</span> _ _ True v_in_delete_effects_of_op<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span>"</span></span><span class=main>]</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> τ_Suc_k_is_Some_True<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some False"</span></span>
                <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_step_effect_is<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>6<span class=main>)</span> k_lt_length_τ_minus_one τ_Suc_k_is_Some_True
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> C_is
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> False
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> k_lt_length_τ_minus_one
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> C_is
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≥</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> k_and_op_are
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>5<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_iii><span class=command>lemma</span></span> encode_problem_parallel_complete_iii<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>∧</span> <span class=bound>l</span> <span class=main>&lt;</span> length <span class=free>π</span>
      <span class=main>⟶</span> <span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>⟶</span>  <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> encode_operators <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>O</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_operators <span class=free>Π</span> <span class=var>?t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_preconditions <span class=free>Π</span> <span class=var>?ops</span><span class=var>?t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_operator_effects <span class=free>Π</span> <span class=var>?ops</span> <span class=var>?t</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>O</sub></span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>C_in_precondition_encoding<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>P</sub></span>"</span></span>
      <span class=main>|</span> <span class=main>(</span>C_in_effect_encoding<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>E</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_operator_encoding_structure
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> C_in_precondition_encoding
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_iii_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> _ assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> C_in_effect_encoding
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_iii_b<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> _ assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> encode_operators_is_cnf<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> is_nnf_cnf cnf_semantics
    <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_iv_a><span class=command>lemma</span></span> encode_problem_parallel_complete_iv_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>⟶</span>  <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>l</span><span class=main>.</span> <span class=bound>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>l</span> <span class=main>&lt;</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State
          <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>
          <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=main>⋃</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free>π</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
          <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
          <span class=main>|</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>.</span>
    <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=comment1>(* TODO refactor *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=comment1>(* TODO slow *)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C_in_C'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=skolem>C'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Union_iff assms<span class=main>(</span>5<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>∈</span> <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> UN_E
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span> <span class=bound>v</span><span class=main>.</span>
      <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span>
      <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span>
      <span class=main>∧</span> <span class=free>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> C_in_C'
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>v</span></span>
    <span class=keyword2><span class=keyword>where</span></span> k_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> v_in_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> k_lt_length_τ_minus_one<span class=main>:</span> True
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> k_lt_t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> k_in
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>have</span></span> all_operators_applicable<span class=main>:</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> all_operator_effects_consistent<span class=main>:</span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
        <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
        <span class=main>|</span> <span class=main>(</span>C<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> A
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
            <span class=keyword2><span class=keyword>where</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> v_is_add_effect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> A
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> k_lt_t
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> v_is_add_effect
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>∈</span> <span class=free>C</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> k_lt_length_τ_minus_one op_in_π<span class=hidden>⇩</span><sub>k</sub>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> B
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
            <span class=keyword2><span class=keyword>where</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> v_is_delete_effect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span><span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> all_operator_effects_consistent are_all_operator_effects_consistent_set
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span>
             <span class=main>=</span> Some False"</span></span>
            <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_negative_effect_if<span class=main>[</span><span class=operator>OF</span> all_operators_applicable
                all_operator_effects_consistent op_in_π<span class=hidden>⇩</span><sub>k</sub> v_is_delete_effect<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_step_effect_is<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> k_lt_length_τ_minus_one
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> C
          <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> True
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> k_lt_length_τ_minus_one
                <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> C_is
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> False
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_step_effect_is<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_no_effect_if C
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>≠</span> Some True"</span></span>
                  <span class=keyword1><span class=command>using</span></span> False
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> k_lt_length_τ_minus_one
                <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> C_is
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> k_gte_length_τ_minus_one<span class=main>:</span> False
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
                <span class=keyword3><span class=command>case</span></span> False
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> k_gte_length_τ_minus_one k_in
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
                <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>qed</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> True
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> Suc <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> k_gte_length_τ_minus_one k_in
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> False
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_iv_b><span class=command>lemma</span></span> encode_problem_parallel_complete_iv_b<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>⟶</span>  <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>l</span><span class=main>.</span> <span class=bound>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>l</span> <span class=main>&lt;</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State
          <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>
          <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=main>⋃</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free>π</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
          <span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
          <span class=main>|</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span>initial_of <span class=free>Π</span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span><span class=main>.</span>
    <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
        <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=comment1>(* TODO refactor *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=comment1>(* TODO slow *)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C_in_C'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> <span class=skolem>C'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Union_iff assms<span class=main>(</span>5<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=comment1>(* TODO slow *)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>v</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?vs</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>∈</span> <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>|</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> UN_E
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span> <span class=bound>v</span><span class=main>.</span>
      <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span>
      <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span>
      <span class=main>∧</span> <span class=free>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
          <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> C_in_C'
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>v</span></span>
    <span class=keyword2><span class=keyword>where</span></span> k_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> v_in_vs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
          <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> k_lt_length_τ_minus_one<span class=main>:</span> True
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> k_lt_t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> k_in
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>have</span></span> all_operators_applicable<span class=main>:</span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> all_operator_effects_consistent<span class=main>:</span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
        <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
        <span class=main>|</span> <span class=main>(</span>C<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∉</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> A
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
            <span class=keyword2><span class=keyword>where</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> v_is_delete_effect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> A
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> k_lt_t
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
            <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
              <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>∧</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> v_is_delete_effect
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>∈</span> <span class=free>C</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> k_lt_length_τ_minus_one op_in_π<span class=hidden>⇩</span><sub>k</sub>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> B
          <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span>
            <span class=keyword2><span class=keyword>where</span></span> op_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> v_is_add_effect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=skolem>op</span><span class=main>)</span>"</span></span><span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>.</span> <span class=skolem>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> all_operator_effects_consistent are_all_operator_effects_consistent_set
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
            <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_positive_effect_if<span class=main>[</span><span class=operator>OF</span> all_operators_applicable
                all_operator_effects_consistent op_in_π<span class=hidden>⇩</span><sub>k</sub> v_is_add_effect<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_step_effect_is<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> k_lt_length_τ_minus_one
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> C
          <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=comment1>― ‹ We split on cases for <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"(?τ ! k) v = Some True"</span><span class=antiquote>}</span></span> here to avoid having to
              proof <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"(?τ ! k) v ≠ None"</span><span class=antiquote>}</span></span>. ›</span>
            <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span><span class=main>)</span>
              <span class=keyword3><span class=command>case</span></span> True
              <span class=keyword1><span class=command>{</span></span>
                <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>=</span> execute_parallel_operator <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_step_effect_is<span class=main>[</span><span class=operator>OF</span> k_lt_length_τ_minus_one<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> execute_parallel_operator_no_effect_if C
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> Suc <span class=skolem>k</span><span class=main>)</span> <span class=skolem>v</span> <span class=main>=</span> Some True"</span></span>
                  <span class=keyword1><span class=command>using</span></span> True
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
                <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> k_lt_length_τ_minus_one
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>}</span></span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> C_is
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>next</span></span>
              <span class=keyword3><span class=command>case</span></span> False
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> k_lt_length_τ_minus_one
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
              <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                <span class=keyword1><span class=command>using</span></span> C_is
                <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> k_gte_length_τ_minus_one<span class=main>:</span> False
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> Suc <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Suc <span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> k_gte_length_τ_minus_one k_in
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> True
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=main>(</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
                <span class=keyword3><span class=command>case</span></span> False
                <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=var>?t</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
                  <span class=keyword1><span class=command>using</span></span> k_gte_length_τ_minus_one k_in
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
                <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
                  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
                  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>qed</span></span> <span class=operator>blast</span>
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> False
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> C_is
            <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_iv><span class=command>lemma</span></span> encode_problem_parallel_complete_iv<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>⟶</span>  <span class=main>(</span><span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
          <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>v</span> <span class=bound>l</span><span class=main>.</span> <span class=bound>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>l</span> <span class=main>&lt;</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>
      <span class=main>⟶</span> <span class=free>𝒜</span> <span class=main>(</span>State <span class=bound>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>
        <span class=main>=</span> <span class=free>𝒜</span> <span class=main>(</span>State
          <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>
          <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> encode_all_frame_axioms <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_all_frame_axioms <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>.</span>
    <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>
      <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
        <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>add_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>State <span class=main>(</span>Suc <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span> <span class=main>}</span>
        <span class=main>∪</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span>
          <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span>delete_effects_of <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=comment1>(* TODO slow (and why can only metis do this?). *)</span>
  <span class=keyword1><span class=command>have</span></span> cnf_Φ<span class=hidden>⇩</span><sub>F</sub>_is_A_union_B<span class=main>:</span> <span class=quoted><span class=quoted>"cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span> <span class=main>=</span> <span class=var>?A</span> <span class=main>∪</span> <span class=var>?B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_of_encode_all_frame_axioms_structure
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cnf_of_encode_all_frame_axioms_structure<span class=main>)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>F</sub></span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>C_in_A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span>
      <span class=main>|</span> <span class=main>(</span>C_in_B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> <span class=var>?B</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Un_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>C</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span><span class=main>]</span> cnf_Φ<span class=hidden>⇩</span><sub>F</sub>_is_A_union_B
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> C_in_A
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_iv_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span> C_in_A<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> C_in_B
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_iv_b<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>,</span></span> 4<span class=main><span class=main>,</span></span> 5<span class=main><span class=main>)</span></span> C_in_B<span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> encode_frame_axioms_is_cnf is_nnf_cnf cnf_semantics
    <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor. *)</span>
<span class=keyword1 id=SAT_Plan_Base-valuation_for_operator_variables_is><span class=command>lemma</span></span> valuation_for_operator_variables_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"valuation_for_operator_variables <span class=free>Π</span> <span class=free>π</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>
      <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?v</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Op</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span>
      <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?l</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> map <span class=main>(</span>Pair <span class=bound>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> Operator <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=comment1>― ‹ show that our operator construction function is injective on
    <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"set (concat (map (λk. map (Pair k) (π ! k)) [0..&lt;length ?τ - 1]))"</span><span class=antiquote>}</span></span>. ›</span>
  <span class=keyword1><span class=command>have</span></span> k_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=comment1>(* TODO refactor. *)</span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span> <span class=skolem>k'</span> <span class=skolem>op</span> <span class=skolem>op'</span>
      <span class=keyword3><span class=command>assume</span></span> k_op_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> k'_op'_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k'</span><span class=main>,</span> <span class=skolem>op'</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>=</span> Operator <span class=skolem>k'</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op'</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k'</span><span class=main>,</span> <span class=skolem>op'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
          <span class=keyword3><span class=command>assume</span></span> index_op_is_index_op'<span class=main>:</span> <span class=quoted><span class=quoted>"Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>=</span> Operator <span class=skolem>k'</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> k_is_k'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> <span class=skolem>k'</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
            <span class=keyword1><span class=command>have</span></span> k'_lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> k'_op'_in
              <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
            <span class=comment1>(* TODO slow *)</span>
            <span class=keyword1><span class=command>have</span></span> op_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> k_op_in
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
            <span class=comment1>(* TODO slow *)</span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> op'_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> k'_op'_in k_is_k'
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
            <span class=keyword1><span class=command>{</span></span>
              <span class=keyword1><span class=command>have</span></span> length_τ_gt_1<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>&gt;</span> <span class=main>1</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
              <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>≤</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one
                <span class=keyword1><span class=command>using</span></span> diff_le_mono
                <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> length <span class=free>π</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
              <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>&lt;</span> length <span class=free>π</span>"</span></span>
                <span class=keyword1><span class=command>using</span></span> length_τ_gt_1 k'_lt
                <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
              <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>π</span> <span class=main>!</span> <span class=skolem>k'</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
            <span class=keyword1><span class=command>}</span></span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op'</span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> op_in op'_in k_is_k'
                calculation
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>=</span> <span class=skolem>op'</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> index_op_is_index_op'
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>}</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=skolem>op</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k'</span><span class=main>,</span> <span class=skolem>op'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>qed</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=comment1>(* TODO slow *)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"inj_on <span class=var>?f</span> <span class=main>(</span>set <span class=var>?l</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> inj_on_def fst_def snd_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> inj_on_f_set_l <span class=main>=</span> this
  <span class=comment1>(* TODO refactor. *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>⋃</span> <span class=main>(</span>set <span class=main>`</span> set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> map <span class=main>(</span>Pair <span class=bound>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> set_concat
      <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span> <span class=main>(</span>set <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> map <span class=main>(</span>Pair <span class=bound>k</span><span class=main>)</span> <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span> <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=main>(</span>Pair <span class=bound>k</span><span class=main>)</span> <span class=main>`</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=main>}</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>}</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow. *)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?l</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>}</span><span class=main>)</span>
      <span class=main>`</span> <span class=main>{</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> <span class=main>{</span> <span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=main>}</span>"</span></span> <span class=main>_</span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> set_l_is <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Op</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> k_in
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow *)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"valuation_for_operator_variables <span class=free>Π</span> <span class=free>π</span> <span class=var>?τ</span> <span class=var>?v</span>
      <span class=main>=</span> foldr <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>:=</span> True<span class=main>)</span><span class=main>)</span> <span class=var>?l</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=var>?v</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> valuation_for_operator_variables_def override_on_def Let_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> k_op_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> set_l_is k_in calculation
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=comment1>― ‹ There is some problem with the pattern match in the lambda in fact \isaname{nb}, sow
        we have to do some extra work to convince Isabelle of the truth of the statement. ›</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?g</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> True"</span></span>
        <span class=keyword1><span class=command>thm</span></span> foldr_fun_upd<span class=main>[</span><span class=operator>OF</span> inj_on_f_set_l k_op_in<span class=main>]</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>=</span> Operator <span class=main>(</span>fst <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>:=</span> True<span class=main>)</span><span class=main>)</span>
          <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span>Operator <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?ops</span>  <span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>:=</span> True<span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span>Operator <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?ops</span>  <span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>:=</span> <span class=var>?g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>
          <span class=var>?l</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=main>(</span>Operator <span class=main>(</span>fst <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> foldr_fun_upd<span class=main>[</span><span class=operator>OF</span> inj_on_f_set_l k_op_in<span class=main>]</span><span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"valuation_for_operator_variables <span class=free>Π</span> <span class=free>π</span> <span class=var>?τ</span> <span class=var>?v</span> <span class=main>=</span> True"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb
          <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> True
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span> <span class=main>∉</span> set <span class=var>?l</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> False set_l_is
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k'</span> <span class=skolem>op'</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k'</span><span class=main>,</span> <span class=skolem>op'</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?l</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=main>(</span><span class=skolem>k'</span><span class=main>,</span> <span class=skolem>op'</span><span class=main>)</span> <span class=main>=</span> <span class=var>?f</span> <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span>"</span></span>
          <span class=comment1>(* TODO slow. *)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k'</span><span class=main>,</span> <span class=skolem>op'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>op</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> inj_on_f_set_l assms<span class=main>(</span>3<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span> <span class=main>∉</span> <span class=var>?f</span> <span class=main>`</span> set <span class=var>?l</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> image_iff
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> operator_not_in_f_image_set_l <span class=main>=</span> this
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> False"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>:=</span> True<span class=main>)</span><span class=main>)</span>
          <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span>Operator <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>:=</span> True<span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>:=</span> True<span class=main>)</span><span class=main>)</span> <span class=var>?l</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=var>?v</span> <span class=main>=</span> False"</span></span>
          <span class=keyword1><span class=command>using</span></span> foldr_fun_no_upd<span class=main>[</span><span class=operator>OF</span> inj_on_f_set_l operator_not_in_f_image_set_l<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> True"</span></span> <span class=quoted><span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> nb False
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor (also used in proof of completeness for ∀-step 1 encoding)
  TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_vi_a><span class=command>lemma</span></span> encode_problem_parallel_complete_vi_a<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>O</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_operator_variables <span class=free>Π</span> <span class=free>π</span> <span class=var>?τ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Op</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?V</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span> <span class=main>+</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?v</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>≤</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> length_trace_parallel_plan_strips_lte_length_plan_plus_one<span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> length <span class=free>π</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=var>?t</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> k_lt_length_π <span class=main>=</span> this
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∈</span> <span class=var>?Op</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> k_lt_length_π True
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=var>?𝒜<span class=hidden>⇩</span><sub>O</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> valuation_for_plan_def override_on_def Let_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> valuation_for_operator_variables_is<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span> True<span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=comment1>(* TODO refactor (used in the lemma below as well). *)</span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=comment1>― ‹ We have <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"¬index ?ops op &lt; length ?ops"</span><span class=antiquote>}</span></span> due to the assumption that
            <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"¬op ∈ set ?ops"</span><span class=antiquote>}</span></span>. Hence <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"¬k ∈ {0..&lt;?t"</span><span class=antiquote>}</span></span> and therefore
            <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"?v ∉ ?Op"</span><span class=antiquote>}</span></span>. ›</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Op</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>index <span class=var>?ops</span> <span class=free>op</span> <span class=main>&lt;</span> length <span class=var>?ops</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> False
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?Op</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?V</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> valuation_for_plan_def override_on_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> empty_valuation_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>π</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> k_lt_length_π
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∉</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> False
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_vi_b><span class=command>lemma</span></span> encode_problem_parallel_complete_vi_b<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>&lt;</span> length <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>valuation_for_plan <span class=free>Π</span> <span class=free>π</span> <span class=main>(</span>Operator <span class=free>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=comment1>(* TODO prune variables *)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>O</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_operator_variables <span class=free>Π</span> <span class=free>π</span> <span class=var>?τ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Op</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Op'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=var>?ops</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?V</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span> <span class=main>+</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=var>?vs</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?v</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Operator <span class=free>l</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∈</span> <span class=var>?Op</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> True
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=comment1>(* TODO slow. *)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=var>?𝒜<span class=hidden>⇩</span><sub>O</sub></span> <span class=var>?v</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> valuation_for_plan_def override_on_def Let_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∉</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?Op'</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>O</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=var>?v</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> valuation_for_operator_variables_def override_on_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> empty_valuation_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=comment1>(* TODO refactor (used in the lemma above as well). *)</span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=comment1>― ‹ We have <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"¬index ?ops op &lt; length ?ops"</span><span class=antiquote>}</span></span> due to the assumption that
            <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"¬op ∈ set ?ops"</span><span class=antiquote>}</span></span>. Hence <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"¬k ∈ {0..&lt;?t"</span><span class=antiquote>}</span></span> and therefore
            <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>"?v ∉ ?Op"</span><span class=antiquote>}</span></span>. ›</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Op</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>op</span><span class=main>)</span><span class=main>.</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>(</span><span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>×</span> set <span class=var>?ops</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>index <span class=var>?ops</span> <span class=free>op</span> <span class=main>&lt;</span> length <span class=var>?ops</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> False
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?Op</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?V</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=comment1>(* TODO slow. *)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> valuation_for_plan_def override_on_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> empty_valuation_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ As a corollary from lemmas \isaname{encode_problem_parallel_complete_vi_a} and
\isaname{encode_problem_parallel_complete_vi_b} we obtain the result that the constructed
valuation <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>𝒜</span> <span class=main>≡</span> valuation_for_plan <span class=free>Π</span> <span class=free>π</span>›</span></span> valuates SATPlan operator variables as false if
they are not contained in any operator set <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>π</span> <span class=main>!</span> <span class=free>k</span>›</span></span> for any time point <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>k</span> <span class=main>&lt;</span> length <span class=free>π</span>›</span></span>. ›</span>
<span class=keyword1><span class=command>corollary</span></span> encode_problem_parallel_complete_vi_d<span class=main>:</span>
  <span class=comment1>(* TODO why is this necessary? *)</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∉</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>valuation_for_plan <span class=free>Π</span> <span class=free>π</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_vi_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>3<span class=main>)</span>
    encode_problem_parallel_complete_vi_b<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> _ assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> assms<span class=main>(</span>3<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>fastforce</span><span class=main>)</span>

<span class=comment1>(* TODO refactor List_Supplement OR rm (unused) *)</span>
<span class=keyword1 id=SAT_Plan_Base-list_product_is_nil_iff><span class=command>lemma</span></span> list_product_is_nil_iff<span class=main>:</span> <span class=quoted><span class=quoted>"List.product <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>⟷</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> product_xs_ys_is_Nil<span class=main>:</span> <span class=quoted><span class=quoted>"List.product <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ys</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>xs'</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>ys'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ys</span> <span class=main>=</span> <span class=skolem>y</span> <span class=main>#</span> <span class=skolem>ys'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> list.exhaust
        <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"List.product <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>#</span> map <span class=main>(</span>Pair <span class=skolem>x</span><span class=main>)</span> <span class=skolem>ys'</span> <span class=main>@</span> List.product <span class=skolem>xs'</span> <span class=main>(</span><span class=skolem>y</span> <span class=main>#</span> <span class=skolem>ys'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
        <span class=keyword1><span class=command>using</span></span> product_xs_ys_is_Nil
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"List.product <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=comment1>― ‹ First cases in the next two proof blocks follow from definition of List.product. ›</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> disjE<span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> ys_is_Nil<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"List.product <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>x</span> <span class=skolem>xs</span><span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"List.product <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>=</span> map <span class=main>(</span>Pair <span class=skolem>x</span><span class=main>)</span> <span class=free>ys</span> <span class=main>@</span> List.product <span class=skolem>xs</span> <span class=free>ys</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>@</span> List.product <span class=skolem>xs</span> <span class=free>ys</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Nil_is_map_conv ys_is_Nil
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
          <span class=keyword1><span class=command>using</span></span> Cons.IH
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>― ‹ We keep the state abstract by requiring a function <span class=antiquoted><span class=raw_text><span class=operator>‹</span>s›</span></span> which takes the index
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>k›</span></span> and returns state. This makes the lemma cover both cases, i.e. dynamic (e.g. the <span class=antiquoted><span class=raw_text><span class=operator>‹</span>k›</span></span>-th
trace state) as well as static state (e.g. final trace state). ›</span>
<span class=keyword1 id=SAT_Plan_Base-valuation_for_state_variables_is><span class=command>lemma</span></span> valuation_for_state_variables_is<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>∈</span> set <span class=free>ks</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=free>vs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> valuation_for_state <span class=free>vs</span> <span class=main>(</span><span class=free>s</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>k</span> <span class=bound>v</span> <span class=bound>𝒜</span><span class=main>)</span> <span class=main>(</span>List.product <span class=free>ks</span> <span class=free>vs</span><span class=main>)</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>
      <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=free>vs</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟷</span> <span class=main>(</span><span class=free>s</span> <span class=free>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?v</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"State <span class=free>k</span> <span class=main>(</span>index <span class=free>vs</span> <span class=free>v</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ps</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"List.product <span class=free>ks</span> <span class=free>vs</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> valuation_for_state <span class=free>vs</span> <span class=main>(</span><span class=free>s</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>k</span> <span class=bound>v</span> <span class=bound>𝒜</span><span class=main>)</span> <span class=var>?ps</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> State <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>index <span class=free>vs</span> <span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?g</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=free>s</span> <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> Some True"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=var>?ps</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> set_product
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=comment1>(* TODO refactor (State construction is injective on List.product ks vs). *)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>{</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
      <span class=keyword3><span class=command>assume</span></span> x_in_ps<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> set <span class=var>?ps</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> y_in_ps<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>∈</span> set <span class=var>?ps</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=var>?f</span> <span class=skolem>x</span> <span class=main>=</span> <span class=var>?f</span> <span class=skolem>y</span> <span class=main>⟶</span> <span class=skolem>x</span> <span class=main>=</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> f_x_is_f_y<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=skolem>x</span> <span class=main>=</span> <span class=var>?f</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> x_is_not_y<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>≠</span> <span class=skolem>y</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=skolem><span class=skolem>k''</span></span> <span class=skolem><span class=skolem>v'</span></span> <span class=skolem><span class=skolem>v''</span></span>
        <span class=keyword2><span class=keyword>where</span></span> x_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k'</span><span class=main>,</span> <span class=skolem>v'</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> y_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k''</span><span class=main>,</span> <span class=skolem>v''</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>≠</span> <span class=skolem>k''</span>"</span></span>
        <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>≠</span> <span class=skolem>v''</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> x_is_not_y
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted>False</span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> A
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=skolem>x</span> <span class=main>≠</span> <span class=var>?f</span> <span class=skolem>y</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> x_is y_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> f_x_is_f_y
            <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> B
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>∈</span> set <span class=free>vs</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v''</span> <span class=main>∈</span> set <span class=free>vs</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> x_in_ps x_is y_in_ps y_is set_product
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"index <span class=free>vs</span> <span class=skolem>v'</span> <span class=main>≠</span> index <span class=free>vs</span> <span class=skolem>v''</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> B
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=skolem>x</span> <span class=main>≠</span> <span class=var>?f</span> <span class=skolem>y</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> x_is y_is
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
            <span class=keyword1><span class=command>using</span></span> f_x_is_f_y
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"inj_on <span class=var>?f</span> <span class=main>(</span>set <span class=var>?ps</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inj_on_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> valuation_for_state <span class=free>vs</span> <span class=main>(</span><span class=free>s</span> <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span><span class=main>)</span>
     <span class=main>(</span>List.product <span class=free>ks</span> <span class=free>vs</span><span class=main>)</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span> <span class=main>(</span>State <span class=main>(</span>fst <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>index <span class=free>vs</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=free>s</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> foldr_fun_upd<span class=main>[</span><span class=operator>OF</span> nb<span class=hidden>⇩</span><sub>2</sub> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> <span class=operator>of</span> <span class=var><span class=quoted><span class=var>?g</span></span></span> <span class=quoted><span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> valuation_for_state <span class=free>vs</span> <span class=main>(</span><span class=free>s</span> <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span><span class=main>.</span> valuation_for_state <span class=free>vs</span> <span class=main>(</span><span class=free>s</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜</span> <span class=main>(</span><span class=var>?f</span> <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=var>?g</span> <span class=main>(</span><span class=free>k</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_vi_c><span class=command>lemma</span></span> encode_problem_parallel_complete_vi_c<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span> <span class=main>(</span>State <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟷</span> <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=comment1>(* TODO prune variables *)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>V</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_state_variables <span class=free>Π</span> <span class=free>π</span> <span class=var>?τ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>O</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_state_variables <span class=free>Π</span> <span class=free>π</span> <span class=var>?τ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"foldr
      <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> valuation_for_state <span class=var>?vs</span> <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=bound>k</span> <span class=bound>v</span> <span class=bound>𝒜</span><span class=main>)</span>
      <span class=main>(</span>List.product <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t'</span><span class=main>]</span> <span class=var>?vs</span><span class=main>)</span> <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Op</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Op'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?V</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span> <span class=main>+</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?V<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t'</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?V<span class=hidden>⇩</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=var>?t'</span><span class=main>..</span><span class=main>(</span><span class=var>?t</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?v</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"State <span class=free>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> v_notin_Op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?Op</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> k_lte_length_π_plus_one<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> less_le_trans length_trace_parallel_plan_strips_lte_length_plan_plus_one assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>{</span></span>
        <span class=comment1>(* TODO refactor. *)</span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∈</span> <span class=var>?V</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?Op</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> k_lte_length_π_plus_one True
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=var>?𝒜<span class=hidden>⇩</span><sub>V</sub></span> <span class=var>?v</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> valuation_for_plan_def override_on_def Let_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∈</span> <span class=var>?V<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?V<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> True
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>V</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=var>?𝒜<span class=hidden>⇩</span><sub>1</sub></span> <span class=var>?v</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> valuation_for_state_variables_def override_on_def Let_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=var>?𝒜<span class=hidden>⇩</span><sub>1</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>∈</span> set <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t'</span><span class=main>]</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> True
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=comment1>(* TODO slow *)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> valuation_for_state_variables_is<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t'</span><span class=main>]</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> index <span class=var>?vs</span> <span class=free>v</span> <span class=main>&lt;</span> length <span class=var>?vs</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> False index_less_size_conv
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?V</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> v_notin_Op
          <span class=keyword1><span class=command>unfolding</span></span> valuation_for_plan_def override_on_def empty_valuation_def Let_def
             variables_of_def operators_of_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_none_if<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>π</span></span> <span class=quoted><span class=free>k</span></span> <span class=quoted><span class=free>v</span></span><span class=main>]</span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>,</span> 3<span class=main>)</span> False
        <span class=keyword1><span class=command>unfolding</span></span> initial_of_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO make private *)</span>
<span class=keyword1 id=SAT_Plan_Base-encode_problem_parallel_complete_vi_f><span class=command>lemma</span></span> encode_problem_parallel_complete_vi_f<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>≥</span> length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>&lt;</span> length <span class=free>π</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span> <span class=main>(</span>State <span class=free>l</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> valuation_for_plan <span class=free>Π</span> <span class=free>π</span>
      <span class=main>(</span>State <span class=main>(</span>length <span class=main>(</span>trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>
      <span class=main>(</span>index <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=comment1>(* TODO prune variables *)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?vs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.variables_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=var>?τ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ<span class=hidden>⇩</span><sub>Ω</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?τ</span> <span class=main>!</span> <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>V</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_state_variables <span class=free>Π</span> <span class=free>π</span> <span class=var>?τ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>O</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_state_variables <span class=free>Π</span> <span class=free>π</span> <span class=var>?τ</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜<span class=hidden>⇩</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"foldr
    <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>k</span><span class=main>,</span> <span class=bound>v</span><span class=main>)</span> <span class=bound>𝒜</span><span class=main>.</span> valuation_for_state <span class=main>(</span>strips_problem.variables_of <span class=free>Π</span><span class=main>)</span> <span class=var>?τ<span class=hidden>⇩</span><sub>Ω</sub></span> <span class=bound>k</span> <span class=bound>v</span> <span class=bound>𝒜</span><span class=main>)</span>
    <span class=main>(</span>List.product <span class=main>[</span><span class=var>?t'</span><span class=main>..&lt;</span>length <span class=free>π</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>]</span> <span class=var>?vs</span><span class=main>)</span>
    <span class=keyword1>𝒜<span class=hidden>⇩</span><sub>0</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Op</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Op'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒪</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?V</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t</span> <span class=main>+</span> <span class=main>1</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?V<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=var>?t'</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?V<span class=hidden>⇩</span><sub>2</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> State <span class=bound>k</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> <span class=bound>k</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=var>?t'</span><span class=main>..</span><span class=main>(</span><span class=var>?t</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?v</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"State <span class=free>l</span> <span class=main>(</span>index <span class=var>?vs</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> v_notin_Op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?Op</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>𝒱</sub></span><span class=main>)</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>{</span></span>
        <span class=comment1>(* TODO refactor. *)</span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∈</span> <span class=var>?V</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?Op</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span> True
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
          <span class=comment1>(* TODO slow. *)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=var>?𝒜<span class=hidden>⇩</span><sub>V</sub></span> <span class=var>?v</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> valuation_for_plan_def override_on_def Let_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?V<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∈</span> <span class=var>?V<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>,</span> 4<span class=main>)</span> True
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
          <span class=comment1>(* TODO slow. *)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>V</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=var>?𝒜<span class=hidden>⇩</span><sub>2</sub></span> <span class=var>?v</span>"</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> valuation_for_state_variables_def override_on_def Let_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>=</span> <span class=var>?𝒜<span class=hidden>⇩</span><sub>2</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> set <span class=main>[</span><span class=var>?t'</span><span class=main>..&lt;</span><span class=var>?t</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>]</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>,</span> 4<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=comment1>(* TODO slow *)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>2</sub></span> <span class=var>?v</span> <span class=main>⟷</span> <span class=var>?τ<span class=hidden>⇩</span><sub>Ω</sub></span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
          <span class=keyword1><span class=command>using</span></span> valuation_for_state_variables_is<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=var>?t'</span><span class=main>..&lt;</span><span class=var>?t</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>]</span>"</span></span><span class=main>]</span> True nb
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span> <span class=main>⟷</span> <span class=var>?τ<span class=hidden>⇩</span><sub>Ω</sub></span> <span class=free>v</span> <span class=main>=</span> Some True"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=var>?t'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_not_nil
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=var>?t'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> diff_less
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_vi_c<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> index <span class=var>?vs</span> <span class=free>v</span> <span class=main>&lt;</span> length <span class=var>?vs</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> False index_less_size_conv
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∉</span> <span class=var>?V</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜<span class=hidden>⇩</span><sub>π</sub></span> <span class=var>?v</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> v_notin_Op
          <span class=keyword1><span class=command>unfolding</span></span> valuation_for_plan_def override_on_def empty_valuation_def Let_def
            variables_of_def operators_of_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=var>?t'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_not_nil
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=var>?t'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span>  <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=main>(</span><span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span> <span class=main>=</span> Some True<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_none_if<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=free>v</span></span><span class=main>,</span> <span class=operator>OF</span> _ assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> calculation<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
          assms<span class=main>(</span>1<span class=main>)</span> False
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_vi_c<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=var>?t'</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Let now <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span> <span class=main><span class=main>≡</span></span> trace_parallel_plan_strips <span class=free><span class=free>I</span></span> <span class=free><span class=free>π</span></span>›</span></span></span></span> be the trace of the plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span>, <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>t</span></span> <span class=main><span class=main>≡</span></span> length <span class=free><span class=free>π</span></span>›</span></span></span></span>, and
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>t'</span></span> <span class=main><span class=main>≡</span></span> length <span class=free><span class=free>τ</span></span>›</span></span></span></span>.

Any model of the SATPlan encoding <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> must satisfy the following properties:
\footnote{Cf. \cite[Theorem 3.1, p. 1044]{DBLP:journals/ai/RintanenHN06} for the construction
of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span>.}

  \begin{enumerate}
    \item for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> and for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span>›</span></span></span></span> with <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t'</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span>

      <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"𝒜 (Operator k (index (operators_of Π) op)) = op ∈ set (π ! k)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
    \item for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>l</span></span>›</span></span></span></span> and for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op</span></span>›</span></span></span></span> with <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>l</span></span> <span class=main><span class=main>≥</span></span> <span class=free><span class=free>t'</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span> and
      <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>l</span></span> <span class=main><span class=main>&lt;</span></span> length <span class=free><span class=free>π</span></span>›</span></span></span></span> we require

      <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"𝒜 (Operator l (index (operators_of Π) op))"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
    \item for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span>›</span></span></span></span> and for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> with <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t'</span></span>›</span></span></span></span> we require

      <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"𝒜 (State k (index (variables_of Π) v)) ⟶ ((τ ! k) v = Some True)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
    \item and finally for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span>›</span></span></span></span> and for all <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>l</span></span>›</span></span></span></span> with <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>l</span></span> <span class=main><span class=main>≥</span></span> <span class=free><span class=free>t'</span></span>›</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>l</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t</span></span> <span class=main><span class=main>+</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span> we require

      <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"𝒜 (State l (index (variables_of Π) v))
        = 𝒜 (State (t' - 1) (index (variables_of Π) v))"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
  \end{enumerate}

Condition ``1.'' states that the model must reflect operator activation for all operators in the
parallel operator lists <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span> of the plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> for each time step <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t'</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span> s.t. there is a
successor state in the trace. Moreover ``3.''
requires that the model is consistent with the states reached during plan execution (i.e. the
elements <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span> for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t'</span></span>›</span></span></span></span> of the trace <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span>›</span></span></span></span>). Meaning that
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span> <span class=main><span class=main>(</span></span>State <span class=free><span class=free>k</span></span> <span class=main><span class=main>(</span></span>index <span class=main><span class=main>(</span></span>strips_problem.variables_of <span class=free><span class=free>Π</span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>v</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> for the SAT plan variable of
every state variable <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>v</span></span>›</span></span></span></span> at time point <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> if and only if <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=free><span class=free>τ</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>v</span></span> <span class=main><span class=main>=</span></span> Some True›</span></span></span></span>
for the corresponding state <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>τ</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span> at time <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> (and
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>¬</span></span><span class=free><span class=free>𝒜</span></span> <span class=main><span class=main>(</span></span>State <span class=free><span class=free>k</span></span> <span class=main><span class=main>(</span></span>index <span class=main><span class=main>(</span></span>strips_problem.variables_of <span class=free><span class=free>Π</span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>v</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> otherwise).

The second respectively fourth condition cover early plan termination by negating operator
activation and propagating the last reached state. Note that in the state propagation constraint,
the index is incremented by one compared to the similar constraint for operators, since operator
activations are always followed by at least one successor state.
Hence the last state in the trace has index
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹length <span class=main><span class=main>(</span></span>trace_parallel_plan_strips <span class=main><span class=main>(</span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>Π</span></span><span class=main><span class=main>::</span></span><span class=tfree><span class=tfree>'variable</span></span> strips_problem<span class=main><span class=main>)</span></span><span class=keyword1><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>π</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span> and the remaining states
take up the indexes to <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹length <span class=free><span class=free>π</span></span> <span class=main><span class=main>+</span></span> <span class=main><span class=main>1</span></span>›</span></span></span></span>.

% TODO Comments on how the partial encoding modeling follows from the construction (lemmas ...). ›</span></span>

<span class=keyword1><span class=command>value</span></span>  <span class=quoted><span class=quoted>"<span class=free>stop</span>"</span></span> <span class=comment1>(* Tell document preparation to stop collecting for the last tag *)</span>

<span class=comment1>― ‹ To show completeness—i.e. every valid parallel plan <span class=antiquoted><span class=raw_text><span class=operator>‹</span>π›</span></span> corresponds to a model
for the SATPlan encoding <span class=antiquoted><span class=raw_text><span class=operator>‹</span>Φ Π (length π)›</span></span>—, we simply split the
conjunction defined by the encoding into partial encodings and show that the model satisfies each
of them. ›</span>
<span class=keyword1><span class=command>theorem</span></span>
  encode_problem_parallel_complete<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span> <span class=main>⊨</span> <span class=keyword1>Φ</span> <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?𝒜</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?I</span> <span class=free>π</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> nb<span class=main>]</span>
      encode_problem_parallel_complete_vi_c<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜</span> <span class=main>⊨</span> <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=var>?t</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> nb<span class=main>]</span>
      encode_problem_parallel_complete_vi_c<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
      encode_problem_parallel_complete_vi_f<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜</span> <span class=main>⊨</span> encode_operators <span class=free>Π</span> <span class=var>?t</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_iii<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> nb<span class=main>]</span>
      encode_problem_parallel_complete_vi_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
      encode_problem_parallel_complete_vi_b<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
      encode_problem_parallel_complete_vi_c<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜</span> <span class=main>⊨</span> encode_all_frame_axioms <span class=free>Π</span> <span class=var>?t</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_iv<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
      encode_problem_parallel_complete_vi_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
      encode_problem_parallel_complete_vi_c<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
      encode_problem_parallel_complete_vi_f<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def SAT_Plan_Base.encode_problem_def
      encode_initial_state_def encode_goal_state_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=SAT_Plan_Extensions><div class=head><h1>Theory SAT_Plan_Extensions</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> SAT_Plan_Extensions
  <span class=keyword2><span class=keyword>imports</span></span> <a href=SAT_Plan_Base.html>SAT_Plan_Base</a>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Serializable SATPlan Encodings"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ A SATPlan encoding with exclusion of operator interference (see definition
\ref{def:sat-plan-encoding-with-interference-exclusion}) can be defined by extending the basic
SATPlan encoding with clauses

  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"
    <span class=hidden>❙</span><b>¬</b>(Atom (Operator k (index ops op<span class=hidden>⇩</span><sub>1</sub>))
    <span class=hidden>❙</span><b>∨</b> <span class=hidden>❙</span><b>¬</b>(Atom (Operator k (index ops op<span class=hidden>⇩</span><sub>2</sub>))"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

for all pairs of distinct interfering operators <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>1</sub></span></span>›</span></span></span></span>, <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>2</sub></span></span>›</span></span></span></span> for all time points
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span> for a given estimated plan length <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>t</span></span>›</span></span></span></span>. Definitions
\ref{isadef:interfering-operator-pair-exclusion-encoding} and
\ref{isadef:interfering-operator-exclusion-encoding} implement the encoding for operator pairs
resp. for all interfering operator pairs and all time points. ›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>encode_interfering_operator_pair_exclusion</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem
    <span class=main>⇒</span> nat
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator
    <span class=main>⇒</span> <span class=tfree>'variable</span> strips_operator
    <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_interfering_operator_pair_exclusion</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>2</sub></span></span></span>
    <span class=main>≡</span> <span class=keyword1>let</span> <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=keyword1>in</span>
      <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>(</span>index <span class=bound>ops</span> <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>1</sub></span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
      <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>(</span>index <span class=bound>ops</span> <span class=free><span class=bound><span class=entity>op<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>encode_interfering_operator_exclusion</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem <span class=main>⇒</span> nat <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_interfering_operator_exclusion</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> <span class=keyword1>let</span>
      <span class=bound>ops</span> <span class=main>=</span> operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main>;</span> <span class=bound>interfering</span> <span class=main>=</span> filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=bound>ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=bound>ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
        <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span>List.product <span class=bound>ops</span> <span class=bound>ops</span><span class=main>)</span>
    <span class=keyword1>in</span> foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=main>[</span>encode_interfering_operator_pair_exclusion <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span>
      <span class=main>(</span>op<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> op<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span> <span class=main>←</span> <span class=bound>interfering</span><span class=main>,</span> k <span class=main>←</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>]</span><span class=main>]</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ A SATPlan encoding with interfering operator pair exclusion can now be defined by
simplying adding the conjunct <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹encode_interfering_operator_exclusion <span class=free><span class=free>Π</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span> to the basic
SATPlan encoding. ›</span></span>

<span class=comment1>― ‹ NOTE This is the quadratic size encoding for the $\forall$-step semantics as defined in <span class=antiquoted><span class=antiquote>@{</span><span class=operator>cite</span>
‹3.2.1, p.1045› "DBLP:journals/ai/RintanenHN06"<span class=antiquote>}</span></span>. This encoding ensures that decoded plans are
sequentializable by simply excluding the simultaneous execution of operators with potential
interference at any timepoint. Note that this yields a $\forall$-step plan for which parallel
operator execution at any time step may be sequentialised in any order (due to non-interference). ›</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>encode_problem_with_operator_interference_exclusion</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem <span class=main>⇒</span> nat <span class=main>⇒</span> sat_plan_variable formula"</span></span>
  <span class=main>(</span><span class=quoted>"<span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> _ _"</span> 52<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>encode_problem_with_operator_interference_exclusion</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
    <span class=main>≡</span> encode_initial_state <span class=free><span class=bound><span class=entity>Π</span></span></span>
      <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span>encode_operators <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
      <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span>encode_all_frame_axioms <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
      <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span>encode_interfering_operator_exclusion <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span>
      <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=main>(</span>encode_goal_state <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>


<span class=comment1>― ‹ Immediately proof the sublocale proposition for strips in order to gain access to definitions
and lemmas. ›</span>


<span class=keyword1 id=SAT_Plan_Extensions-cnf_of_encode_interfering_operator_pair_exclusion_is_i><span class=command>lemma</span></span> cnf_of_encode_interfering_operator_pair_exclusion_is_i<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=free>k</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span>
    <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=free>k</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
    <span class=main>=</span> cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_interfering_operator_pair_exclusion_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>{</span> <span class=bound>C</span> <span class=main>∪</span> <span class=bound>D</span> <span class=main>|</span> <span class=bound>C</span> <span class=bound>D</span><span class=main>.</span>
    <span class=bound>C</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>∧</span> <span class=bound>D</span> <span class=main>∈</span> cnf <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Extensions-cnf_of_encode_interfering_operator_exclusion_is_ii><span class=command>lemma</span></span> cnf_of_encode_interfering_operator_exclusion_is_ii<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>[</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span>
      <span class=main>(</span>op<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> op<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span> <span class=main>←</span> filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
          index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
          <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
        <span class=main>(</span>List.product <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span>
        <span class=main>,</span> k <span class=main>←</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span><span class=main>]</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
        <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main>,</span> <span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span><span class=main>.</span>
          index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
          <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span><span class=main>.</span>
      <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?interfering</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span>List.product <span class=var>?ops</span> <span class=var>?ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span>
    <span class=main>(</span>op<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> op<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span> <span class=main>←</span> <span class=var>?interfering</span><span class=main>,</span> k <span class=main>←</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?fs</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>set
    <span class=main>`</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span><span class=main>)</span>
    <span class=main>`</span> <span class=main>(</span>set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
      <span class=main>(</span>List.product <span class=var>?ops</span> <span class=var>?ops</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> set_concat set_map
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=comment1>― ‹ TODO slow. ›</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
      set <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>
    <span class=main>`</span> <span class=main>(</span>set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
      <span class=main>(</span>List.product <span class=var>?ops</span> <span class=var>?ops</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> image_comp<span class=main>[</span><span class=operator>of</span>
        <span class=quoted>set</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span>"</span></span><span class=main>]</span>
      comp_apply
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
      <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>
    <span class=main>`</span> <span class=main>(</span>set <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
      <span class=main>(</span>List.product <span class=var>?ops</span> <span class=var>?ops</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> set_map<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span>"</span></span><span class=main>]</span> atLeastLessThan_upt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
      <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>
    <span class=main>`</span> <span class=main>(</span>Set.filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
      <span class=main>(</span>set <span class=main>(</span>List.product <span class=var>?ops</span> <span class=var>?ops</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> set_filter<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> <span class=quoted><span class=quoted>"List.product <span class=var>?ops</span> <span class=var>?ops</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=comment1>― ‹ TODO slow.›</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> operators_of_def set_product<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO refactor using above lemma *)</span>
<span class=keyword1 id=SAT_Plan_Extensions-cnf_of_encode_interfering_operator_exclusion_is_iii><span class=command>lemma</span></span> cnf_of_encode_interfering_operator_exclusion_is_iii<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=comment1>(* TODO why is this necessary? *)</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=main>[</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span>
      <span class=main>(</span>op<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> op<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span> <span class=main>←</span> filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
          index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
          <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
        <span class=main>(</span>List.product <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span>
      <span class=main>,</span> k <span class=main>←</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span><span class=main>]</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
        <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main>,</span> <span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span><span class=main>.</span>
          index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
          <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span><span class=main>.</span>
      <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
        <span class=main>,</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span> <span class=main>|</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?interfering</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span>List.product <span class=var>?ops</span> <span class=var>?ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span>
    <span class=main>(</span>op<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> op<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span> <span class=main>←</span> <span class=var>?interfering</span><span class=main>,</span> k <span class=main>←</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>`</span> set <span class=var>?fs</span> <span class=main>=</span> cnf <span class=main>`</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
    <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>∧</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
      <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span><span class=main>.</span>
    <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_of_encode_interfering_operator_exclusion_is_ii
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
    <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>∧</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
      <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span><span class=main>.</span>
    <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> cnf <span class=main>(</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> image_Un image_comp comp_apply
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
    <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>∧</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
      <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span><span class=main>.</span>
    <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span>
    <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>∧</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
        <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span><span class=main>.</span>
      <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span><span class=main>)</span>
        <span class=main>`</span> <span class=main>{</span> <span class=bound>k</span> <span class=main>|</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=comment1>― ‹ TODO slow.›</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> operators_of_def setcompr_eq_image<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Extensions-cnf_of_encode_interfering_operator_exclusion_is><span class=command>lemma</span></span> cnf_of_encode_interfering_operator_exclusion_is<span class=main>:</span>
  <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_interfering_operator_exclusion <span class=free>Π</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
      <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main>,</span> <span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span><span class=main>.</span>
        index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
          <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span><span class=main>.</span>
    <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span> <span class=main>|</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?interfering</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span>List.product <span class=var>?ops</span> <span class=var>?ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span>
    <span class=main>(</span>op<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> op<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span> <span class=main>←</span> <span class=var>?interfering</span><span class=main>,</span> k <span class=main>←</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_interfering_operator_exclusion <span class=free>Π</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> cnf <span class=main>(</span>foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=var>?fs</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>⊥</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_interfering_operator_exclusion_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>cnf <span class=main>`</span> set <span class=var>?fs</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_foldr_and<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span><span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_of_encode_interfering_operator_exclusion_is_iii<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=free>t</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Extensions-cnf_of_encode_interfering_operator_exclusion_contains_clause_if><span class=command>lemma</span></span> cnf_of_encode_interfering_operator_exclusion_contains_clause_if<span class=main>:</span>
  <span class=comment1>(* TODO why do we need to fix the problem type? *)</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_operators_interfering <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span>
      <span class=main>,</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span>
    <span class=main>∈</span> cnf <span class=main>(</span>encode_interfering_operator_exclusion <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_interfering_operator_exclusion <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main>,</span> <span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span><span class=main>.</span>
        index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span>
      <span class=main>|</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Ops</span><span class=main>.</span> <span class=var>?f</span> <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?A</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?Ops</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 3<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> operators_of_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?C</span> <span class=main>}</span> <span class=main>∈</span> <span class=var>?f</span> <span class=main>(</span><span class=free>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=var>?C</span> <span class=main>}</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> UN_iff<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>_</span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span><span class=main>]</span> calculation<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=comment1>(* TODO slow *)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>X</span> <span class=main>∈</span> <span class=var>?A</span><span class=main>.</span> <span class=var>?C</span> <span class=main>∈</span> <span class=bound>X</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=comment1>(* TODO slow *)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_of_encode_interfering_operator_exclusion_is
    <span class=keyword1><span class=command>using</span></span> Union_iff<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Extensions-is_cnf_encode_interfering_operator_exclusion><span class=command>lemma</span></span> is_cnf_encode_interfering_operator_exclusion<span class=main>:</span>
  <span class=comment1>(* TODO why is this necessary? *)</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span>encode_interfering_operator_exclusion <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?interfering</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"filter <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span>List.product <span class=var>?ops</span> <span class=var>?ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span>encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span>
    <span class=main>(</span>op<span class=hidden>⇩</span><sub>1</sub><span class=main>,</span> op<span class=hidden>⇩</span><sub>2</sub><span class=main>)</span> <span class=main>←</span> <span class=var>?interfering</span><span class=main>,</span> k <span class=main>←</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>]</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Fs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
        <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main>,</span> <span class=bound><span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span><span class=main>.</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span><span class=main>.</span>
      <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>f</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∈</span> set <span class=var>?fs</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∈</span> <span class=var>?Fs</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cnf_of_encode_interfering_operator_exclusion_is_ii
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_operators_interfering <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∈</span> <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=bound>k</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>=</span> encode_interfering_operator_pair_exclusion <span class=free>Π</span> <span class=skolem>k</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>=</span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> encode_interfering_operator_pair_exclusion_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=skolem>f</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_interfering_operator_exclusion_def
    <span class=keyword1><span class=command>using</span></span> is_cnf_foldr_and_if<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?fs</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Plan_Extensions-is_cnf_encode_problem_with_operator_interference_exclusion><span class=command>lemma</span></span> is_cnf_encode_problem_with_operator_interference_exclusion<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_cnf_encode_problem is_cnf_encode_interfering_operator_exclusion assms
  <span class=keyword1><span class=command>unfolding</span></span> encode_problem_with_operator_interference_exclusion_def SAT_Plan_Base.encode_problem_def
    is_cnf.simps<span class=main>(</span>1<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SAT_Plan_Extensions-cnf_of_encode_problem_with_operator_interference_exclusion_structure><span class=command>lemma</span></span> cnf_of_encode_problem_with_operator_interference_exclusion_structure<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>I</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=main>⊆</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>G</sub></span> <span class=free>Π</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>⊆</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_operators <span class=free>Π</span> <span class=free>t</span><span class=main>)</span> <span class=main>⊆</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span><span class=main>)</span> <span class=main>⊆</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnf <span class=main>(</span>encode_interfering_operator_exclusion <span class=free>Π</span> <span class=free>t</span><span class=main>)</span> <span class=main>⊆</span> cnf <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_problem_with_operator_interference_exclusion_def encode_problem_def SAT_Plan_Base.encode_problem_def
    encode_initial_state_def
    encode_goal_state_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>

<span class=comment1>(* TODO remove (unused)? *)</span>
<span class=keyword1 id=SAT_Plan_Extensions-encode_problem_with_operator_interference_exclusion_has_model_then_also_partial_encodings><span class=command>lemma</span></span> encode_problem_with_operator_interference_exclusion_has_model_then_also_partial_encodings<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_initial_state <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_operators <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> encode_interfering_operator_exclusion <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_goal_state <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> encode_problem_with_operator_interference_exclusion_def encode_problem_def SAT_Plan_Base.encode_problem_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>



<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Just as for the basic SATPlan encoding we defined local context for the SATPlan encoding
with interfering operator exclusion. We omit this here since it is basically identical to the one
shown in the basic SATPlan theory replacing only the definitions of \isaname{encode_transitions}
and \isaname{encode_problem}. The sublocale proof is shown below. It confirms that the new
encoding again a CNF as required by locale \isaname{sat_encode_strips}. ›</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Soundness"</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ The Proof of soundness for the SATPlan encoding with interfering operator exclusion follows
directly from the proof of soundness of the basic SATPlan encoding. By looking at the structure of
the new encoding which simply extends the basic SATPlan encoding with a conjunct, any model for
encoding with exclusion of operator interference also models the basic SATPlan encoding and the
soundness of the new encoding therefore follows from theorem
\ref{isathm:soundness-satplan-encoding}.

Moreover, since we additionally added interfering operator exclusion clauses at every timestep, the
decoded parallel plan cannot contain any interfering operators in any parallel operator (making it
serializable). ›</span></span>

<span class=comment1>― ‹ NOTE We use the <span class=antiquoted><span class=raw_text><span class=operator>‹</span>subseq›</span></span> formulation in the fourth assumption to be able to instantiate the
induction hypothesis on the subseq <span class=antiquoted><span class=raw_text><span class=operator>‹</span>ops›</span></span> given the induction premise
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>op # ops ∈ set (subseqs (Φ¯ Π 𝒜 t ! k))›</span></span>. We do not use subsets in the
assumption since we would otherwise lose the distinctness property which can be infered from
<span class=antiquoted><span class=raw_text><span class=operator>‹</span>ops ∈ set (subseqs (Φ¯ Π 𝒜 t ! k))›</span></span> using lemma <span class=antiquoted><span class=raw_text><span class=operator>‹</span>subseqs_distinctD›</span></span>. ›</span>
<span class=keyword1 id=SAT_Plan_Extensions-encode_problem_serializable_sound_i><span class=command>lemma</span></span> encode_problem_serializable_sound_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ops</span> <span class=main>∈</span> set <span class=main>(</span>subseqs <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=free>ops</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_interfering_operator_exclusion <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=free>k</span>"</span></span>
  <span class=comment1>(* TODO refactor *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> C_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=free>𝒜</span> <span class=main>(</span>cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_semantics_monotonous_in_cnf_subsets_if<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span>
        is_cnf_encode_problem_with_operator_interference_exclusion<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span>
        cnf_of_encode_problem_with_operator_interference_exclusion_structure<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=free>𝒜</span> <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def
      <span class=keyword1><span class=command>using</span></span> C_in
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>1</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> index_op<span class=hidden>⇩</span><sub>1</sub>_is_not_index_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 𝒜_models_op<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 𝒜_models_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>3<span class=main><span class=main><span class=main>)</span></span></span><span class=main>]</span> calculation
      <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>Operator <span class=free>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>"</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"are_operators_interfering <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> cnf_of_encode_interfering_operator_exclusion_contains_clause_if<span class=main>[</span><span class=operator>OF</span>
            assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in op<span class=hidden>⇩</span><sub>2</sub>_in index_op<span class=hidden>⇩</span><sub>1</sub>_is_not_index_op<span class=hidden>⇩</span><sub>2</sub><span class=main>]</span> calculation
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>clause_semantics <span class=free>𝒜</span> <span class=var>?C</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> 𝒜_models_op<span class=hidden>⇩</span><sub>1</sub> 𝒜_models_op<span class=hidden>⇩</span><sub>2</sub>
        <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span>
        <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>1</sub>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>}</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operators_interfering <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>3</sub> <span class=main>=</span> this
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>ops</span><span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Cons.IH<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>,</span></span> 3<span class=main><span class=main>)</span></span> Cons_in_subseqsD<span class=main><span class=main>[</span></span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
        <span class=keyword3><span class=command>assume</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_ops<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=skolem>ops</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> op<span class=hidden>⇩</span><sub>1</sub>_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_π<span class=hidden>⇩</span><sub>k</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=var>?π<span class=hidden>⇩</span><sub>k</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> element_of_subseqs_then_subset<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>]</span> calculation<span class=main>(</span>1<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>#</span> <span class=skolem>ops</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> subseqs_distinctD<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>]</span>
              decode_plan_step_distinct<span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=var>?ops</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> Cons.prems<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span> op<span class=hidden>⇩</span><sub>1</sub>_in_π<span class=hidden>⇩</span><sub>k</sub> op<span class=hidden>⇩</span><sub>2</sub>_in_π<span class=hidden>⇩</span><sub>k</sub>
            <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def
            <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> op<span class=hidden>⇩</span><sub>2</sub>_in_ops calculation<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> index_eq_index_conv
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span>are_operators_interfering <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
        <span class=keyword1><span class=command>using</span></span> list_all_iff
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>theorem</span></span> encode_problem_serializable_sound<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>k</span></span> <span class=main>&lt;</span> length <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>.</span> are_all_operators_non_interfering <span class=main>(</span><span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_initial_state <span class=free>Π</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_operators <span class=free>Π</span> <span class=free>t</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_all_frame_axioms <span class=free>Π</span> <span class=free>t</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_goal_state <span class=free>Π</span> <span class=free>t</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> encode_problem_with_operator_interference_exclusion_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_problem <span class=free>Π</span> <span class=free>t</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> SAT_Plan_Base.encode_problem_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_sound assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span> <span class=main>∈</span> set <span class=main>(</span>subseqs <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> subseqs_refl
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> encode_problem_serializable_sound_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> SAT_Plan_Base.decode_plan_def decode_plan_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?π</span> <span class=main>=</span> <span class=free>t</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> SAT_Plan_Base.decode_plan_def decode_plan_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>k</span></span> <span class=main>&lt;</span> length <span class=var>?π</span><span class=main>.</span> are_all_operators_non_interfering <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Completeness"</span></span>


<span class=keyword1 id=SAT_Plan_Extensions-encode_problem_with_operator_interference_exclusion_complete_i><span class=command>lemma</span></span> encode_problem_with_operator_interference_exclusion_complete_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>k</span></span> <span class=main>&lt;</span> length <span class=free>π</span><span class=main>.</span> are_all_operators_non_interfering <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span> <span class=main>⊨</span> encode_interfering_operator_exclusion <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_interfering_operator_exclusion <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"strips_problem.operators_of <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span>
    <span class=main>∧</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=main>∧</span> are_operators_interfering <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=main>{</span><span class=main>{</span><span class=main>{</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=bound>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span><span class=main>}</span>
      <span class=main>|</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free>π</span><span class=main>}</span> <span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=main>(</span><span class=var>?f</span> <span class=main>`</span> <span class=var>?Ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=var>?A</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=hidden>⇩</span><sub>1</sub><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ops</span> <span class=main>∈</span> set <span class=free>π</span><span class=main>.</span> <span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=bound>ops</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_parallel_solution_for_problem_operator_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> operators_of_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=comment1>(* TODO refactor (characterization of 𝒜) *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=free>π</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"lit_semantics <span class=var>?𝒜</span> <span class=main>(</span><span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_vi_a<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
        encode_problem_parallel_complete_vi_b<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> initial_of_def
      <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>2</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=free>π</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_operators_interfering <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> calculation<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∉</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> are_all_operators_non_interfering_set_contains_no_distinct_interfering_operator_pairs
        assms<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb<span class=hidden>⇩</span><sub>3</sub> <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>C</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> <span class=var>?B</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> cnf_of_encode_interfering_operator_exclusion_is<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>Π</span></span> <span class=quoted><span class=quoted>"length <span class=free>π</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>argo</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>C'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> C_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>∈</span> <span class=skolem>C'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Union_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>C</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span> <span class=main>×</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> index_op<span class=hidden>⇩</span><sub>1</sub>_is_not_index_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> are_operators_interfering_op<span class=hidden>⇩</span><sub>1</sub>_op<span class=hidden>⇩</span><sub>2</sub><span class=main>:</span> <span class=quoted><span class=quoted>"are_operators_interfering <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C'_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C'</span> <span class=main>∈</span> <span class=main>{</span><span class=main>{</span><span class=main>{</span><span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>Operator <span class=bound>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>}</span><span class=main>}</span>
        <span class=main>|</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free>π</span><span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> UN_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>C'</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=var><span class=quoted><span class=var>?Ops</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>∈</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free>π</span><span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> C_is<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span><span class=main>,</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>¯</span> <span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> C_in C'_in
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> k_lt_length_π<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=free>π</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>consider</span></span> <span class=main>(</span>A<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
     <span class=main>|</span> <span class=main>(</span>B<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
     <span class=main>|</span> <span class=main>(</span>C<span class=main>)</span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>∨</span> <span class=main>¬</span><span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=var>?𝒜</span> <span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> A
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∉</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub> k_lt_length_π calculation index_op<span class=hidden>⇩</span><sub>1</sub>_is_not_index_op<span class=hidden>⇩</span><sub>2</sub> are_operators_interfering_op<span class=hidden>⇩</span><sub>1</sub>_op<span class=hidden>⇩</span><sub>2</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_vi_d<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> k_lt_length_π<span class=main>]</span>
            calculation<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> C_is
          <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> B
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∉</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> nb<span class=hidden>⇩</span><sub>3</sub> k_lt_length_π calculation index_op<span class=hidden>⇩</span><sub>1</sub>_is_not_index_op<span class=hidden>⇩</span><sub>2</sub> are_operators_interfering_op<span class=hidden>⇩</span><sub>1</sub>_op<span class=hidden>⇩</span><sub>2</sub>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_vi_d<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> k_lt_length_π<span class=main>]</span>
            calculation<span class=main>(</span>2<span class=main>)</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> C_is
          <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> C
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> disjE<span class=main>)</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∉</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_vi_d<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> k_lt_length_π<span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=main>(</span>valuation_for_plan <span class=free>Π</span> <span class=free>π</span><span class=main>)</span> <span class=skolem>C</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> C_is
              <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∉</span> set <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=var>?𝒜</span> <span class=main>(</span>Operator <span class=skolem>k</span> <span class=main>(</span>index <span class=var>?ops</span> <span class=skolem>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_complete_vi_d<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> k_lt_length_π<span class=main>]</span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"clause_semantics <span class=main>(</span>valuation_for_plan <span class=free>Π</span> <span class=free>π</span><span class=main>)</span> <span class=skolem>C</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> C_is
              <span class=keyword1><span class=command>unfolding</span></span> clause_semantics_def
              <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
          <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnf_semantics <span class=var>?𝒜</span> <span class=main>(</span>cnf <span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cnf_semantics_def<span class=keyword1><span class=command>..</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_semantics<span class=main>[</span><span class=operator>OF</span> is_nnf_cnf<span class=main><span class=main>[</span></span><span class=operator>OF</span> is_cnf_encode_interfering_operator_exclusion<span class=main><span class=main>]</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Similar to the soundness proof, we may reuse the previously established
facts about the valuation for the completeness proof of the basic SATPlan encoding
(\ref{isathm:completeness-satplan-encoding}).
To make it clearer why this is true we have a look at the form of the clauses for interfering operator
pairs <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>1</sub></span></span>›</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>2</sub></span></span>›</span></span></span></span> at the same time index <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span> which have the form shown below:
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"{ (Operator k (index ops op<span class=hidden>⇩</span><sub>1</sub>))¯, (Operator k (index ops op<span class=hidden>⇩</span><sub>2</sub>))¯ }"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
where <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ops</span></span> <span class=main><span class=main>≡</span></span> strips_problem.operators_of <span class=free><span class=free>Π</span></span>›</span></span></span></span>.
Now, consider an operator <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>1</sub></span></span>›</span></span></span></span> that is contained in the <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span>-th plan step <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span>
(symmetrically for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>2</sub></span></span>›</span></span></span></span>). Since <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> is a serializable solution, there can be no
interference between <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>1</sub></span></span>›</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>2</sub></span></span>›</span></span></span></span> at time <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>k</span></span>›</span></span></span></span>. Hence <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>op<span class=hidden>⇩</span><sub>2</sub></span></span>›</span></span></span></span> cannot be in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span> <span class=main><span class=main>!</span></span> <span class=free><span class=free>k</span></span>›</span></span></span></span>
This entails that for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span> <span class=main><span class=main>≡</span></span> valuation_for_plan <span class=free><span class=free>Π</span></span> <span class=free><span class=free>π</span></span>›</span></span></span></span> it holds that
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"𝒜 ⊨ <span class=hidden>❙</span><b>¬</b> Atom (Operator k (index ops op<span class=hidden>⇩</span><sub>2</sub>))"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
and <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> therefore models the clause.

Furthermore, if neither is present, than <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> will evaluate both atoms to false and the clause
therefore evaluates to true as well.

It follows from this that each clause in the extension of the SATPlan encoding evaluates to true
for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span>. The other parts of the encoding evaluate to true as per the completeness of the
basic SATPlan encoding (theorem \ref{isathm:completeness-satplan-encoding}).›</span></span>

<span class=keyword1><span class=command>theorem</span></span> encode_problem_serializable_complete<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_parallel_solution_for_problem <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>k</span></span> <span class=main>&lt;</span> length <span class=free>π</span><span class=main>.</span> are_all_operators_non_interfering <span class=main>(</span><span class=free>π</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=free>Π</span> <span class=free>π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"encode_interfering_operator_exclusion <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_problem <span class=free>Π</span> <span class=main>(</span>length <span class=free>π</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> encode_problem_parallel_complete
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?𝒜</span> <span class=main>⊨</span> <span class=var>?Φ<span class=hidden>⇩</span><sub>X</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> encode_problem_with_operator_interference_exclusion_complete_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span><span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> encode_problem_with_operator_interference_exclusion_def encode_problem_def
      SAT_Plan_Base.encode_problem_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>value</span></span>  <span class=quoted><span class=quoted>"<span class=free>stop</span>"</span></span> <span class=comment1>(* Tell document preparation to stop collecting for the last tag *)</span>

<span class=comment1>(* TODO rename encode_problem_with_operator_interference_exclusion_decoded_plan_is_serializable_i *)</span>
<span class=keyword1 id=SAT_Plan_Extensions-encode_problem_forall_step_decoded_plan_is_serializable_i><span class=command>lemma</span></span> encode_problem_forall_step_decoded_plan_is_serializable_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan <span class=main>(</span><span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span><span class=main>)</span> <span class=main>(</span>concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?G</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>G</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?I</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Π</span><span class=main>)</span><span class=keyword1><span class=hidden>⇩</span><sub>I</sub></span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?τ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?σ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"map <span class=main>(</span>decode_state_at <span class=free>Π</span> <span class=free>𝒜</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=main>(</span>length <span class=var>?π</span><span class=main>)</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
    <span class=keyword3><span class=command>assume</span></span> k_lt_length_π<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?π</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> SAT_Plan_Base.encode_problem <span class=free>Π</span> <span class=free>t</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> encode_problem_with_operator_interference_exclusion_def
        encode_problem_def SAT_Plan_Base.encode_problem_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=var>?σ</span> <span class=main>=</span> length <span class=var>?τ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> encode_problem_parallel_correct_vii assms<span class=main>(</span>1<span class=main>)</span> calculation
      <span class=keyword1><span class=command>unfolding</span></span> decode_state_at_def decode_plan_def initial_of_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def SAT_Plan_Base.decode_plan_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_parallel_plan <span class=var>?I</span> <span class=var>?π</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> encode_problem_serializable_sound assms
      <span class=keyword1><span class=command>unfolding</span></span> is_parallel_solution_for_problem_def decode_plan_def
        goal_of_def initial_of_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?G</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> last <span class=main>(</span>trace_parallel_plan_strips <span class=var>?I</span> <span class=var>?π</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> execute_parallel_plan_reaches_goal_iff_goal_is_last_element_of_trace
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
    <span class=keyword3><span class=command>assume</span></span> k_lt_length_π<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?π</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?τ</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb calculation
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> trace_parallel_plan_strips_operator_preconditions calculation<span class=main>(</span>2<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> encode_problem_serializable_sound<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span> 2<span class=main><span class=main>)</span></span><span class=main>]</span> k_lt_length_π
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_applicable <span class=main>(</span><span class=var>?τ</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operator_effects_consistent <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> execute_parallel_plan_is_execute_sequential_plan_if assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* TODO rename encode_problem_with_operator_interference_exclusion_decoded_plan_is_serializable_ii *)</span>
<span class=keyword1 id=SAT_Plan_Extensions-encode_problem_forall_step_decoded_plan_is_serializable_ii><span class=command>lemma</span></span> encode_problem_forall_step_decoded_plan_is_serializable_ii<span class=main>:</span>
  <span class=comment1>(* TODO why is the fixed type necessary? *)</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Π</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'variable</span> strips_problem"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> ListMem <span class=bound>op</span> <span class=main>(</span>strips_problem.operators_of <span class=free>Π</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=var>?π</span>"</span></span>
  <span class=comment1>(* TODO refactor *)</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?π'</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span>set <span class=main>`</span>  <span class=main>(</span><span class=main>⋃</span><span class=bound>k</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>.</span> <span class=main>{</span> decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=bound>k</span> <span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def decode_plan_set_is set_concat
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>⋃</span><span class=main>(</span><span class=main>⋃</span><span class=bound>k</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>.</span> <span class=main>{</span> set <span class=main>(</span>decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=bound>k</span><span class=main>)</span> <span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=var>?π'</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>k</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>.</span> set <span class=main>(</span>decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> nb <span class=main>=</span> this
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>op</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=var>?π'</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span>decode_plan' <span class=free>Π</span> <span class=free>𝒜</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> nb
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span>decode_plan <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation
      <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def SAT_Plan_Base.decode_plan_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=free>Π</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> decode_plan_step_element_then<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> operators_of_def decode_plan_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> list_all_iff ListMem_iff operators_of_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ Given the soundness and completeness of the SATPlan encoding with interfering operator
exclusion <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span></span> <span class=free><span class=free>Π</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span>, we can
now conclude this part with showing that for a parallel plan <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span> <span class=main><span class=main>≡</span></span> <span class=keyword1><span class=keyword1>Φ¯</span></span> <span class=free><span class=free>Π</span></span> <span class=free><span class=free>𝒜</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span>
that was decoded from a model <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span></span> <span class=free><span class=free>Π</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span> the serialized plan
<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π'</span></span> <span class=main><span class=main>≡</span></span> concat <span class=free><span class=free>π</span></span>›</span></span></span></span> is a serial solution for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Π</span></span>›</span></span></span></span>. To this end, we have to show that
\begin{itemize}
  \item the state reached by serial execution of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π'</span></span>›</span></span></span></span> subsumes <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G</span></span>›</span></span></span></span>, and
  \item all operators in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π'</span></span>›</span></span></span></span> are operators contained in <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒪</span></span>›</span></span></span></span>.
\end{itemize}
While the proof of the latter step is rather straight forward, the proof for the
former requires a bit more work. We use the previously established theorem on serial and parallel
STRIPS equivalence (theorem \ref{isathm:equivalence-parallel-serial-strips-plans}) to show the
serializability of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> and therefore have to show that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>G</span></span>›</span></span></span></span> is subsumed by the last state
of the trace of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π'</span></span>›</span></span></span></span>
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"G ⊆<span class=hidden>⇩</span><sub>m</sub> last (trace_sequential_plan_strips I π')"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
and moreover that at every step of the parallel plan execution, the parallel operator execution
condition as well as non interference are met
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"∀k &lt; length π. are_all_operators_non_interfering (π ! k)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.
\footnote{These propositions are shown in lemmas \texttt{encode\_problem\_forall\_step\_decoded\_plan\_is\_serializable\_ii} and
\texttt{encode\_problem\_forall\_step\_decoded\_plan\_is\_serializable\_i} which have been omitted for
brevity.}
Note that the parallel operator execution condition is implicit in the existence of the parallel
trace for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>π</span></span>›</span></span></span></span> with
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display, indent=4] <span class=raw_text><span class=raw_text>"G ⊆<span class=hidden>⇩</span><sub>m</sub> last (trace_parallel_plan_strips I π)"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
warranted by the soundness of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span></span> <span class=free><span class=free>Π</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span>. ›</span></span>

<span class=comment1>(* TODO rename encode_problem_with_operator_interference_exclusion_decoded_plan_is_serializable *)</span>
<span class=keyword1><span class=command>theorem</span></span> serializable_encoding_decoded_plan_is_serializable<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=free>Π</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=free>Π</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Π</span> <span class=main>(</span>concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=free>Π</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> encode_problem_forall_step_decoded_plan_is_serializable_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    encode_problem_forall_step_decoded_plan_is_serializable_ii
  <span class=keyword1><span class=command>unfolding</span></span> is_serial_solution_for_problem_def goal_of_def
    initial_of_def decode_plan_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=SAT_Solve_SAS_Plus><div class=head><h1>Theory SAT_Solve_SAS_Plus</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz, Fred Kurz
*)</span>
<span class=keyword1><span class=command>theory</span></span> SAT_Solve_SAS_Plus
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=SAS_Plus_STRIPS.html>SAS_Plus_STRIPS</a>"</span> 
    <span class=quoted>"<a href=SAT_Plan_Extensions.html>SAT_Plan_Extensions</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"SAT-Solving of SAS+ Problems"</span></span>


<span class=keyword1 id=SAT_Solve_SAS_Plus-sas_plus_problem_has_serial_solution_iff_i><span class=command>lemma</span></span> sas_plus_problem_has_serial_solution_iff_i<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Ψ</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ψ</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=var>?π'</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=var>?Π</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> is_valid_problem_sas_plus_then_strips_transformation_too<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span><span class=keyword1><span class=command>.</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_serial_solution_for_problem <span class=var>?Π</span> <span class=var>?π'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> calculation serializable_encoding_decoded_plan_is_serializable<span class=main>[</span><span class=operator>OF</span> 
          _ assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> 
      <span class=keyword1><span class=command>unfolding</span></span> decode_plan_def 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> <span class=var>?ψ</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> serial_strips_equivalent_to_serial_sas_plus 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> serial_strips_equivalent_to_serial_sas_plus<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SAT_Solve_SAS_Plus-sas_plus_problem_has_serial_solution_iff_ii><span class=command>lemma</span></span> sas_plus_problem_has_serial_solution_iff_ii<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>h</span> <span class=main>=</span> length <span class=free>ψ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>𝒜</span><span class=main>.</span> <span class=main>(</span><span class=bound>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=free>h</span><span class=main>)</span>"</span></span> 
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ</span> <span class=free>Ψ</span>"</span></span> 
    <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?π</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>φ<span class=hidden>⇩</span><sub>P</sub></span> <span class=free>Ψ</span> <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?𝒜</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"valuation_for_plan <span class=var>?Π</span> <span class=var>?π</span>"</span></span> 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"length <span class=free>ψ</span>"</span></span> 
  <span class=comment1>(* TODO refactor *)</span>
  <span class=keyword1><span class=command>have</span></span> nb<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>ψ</span> <span class=main>=</span> length <span class=var>?π</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def 
      sasp_op_to_strips_def 
      sas_plus_parallel_plan_to_strips_parallel_plan_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ψ</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_valid_problem_strips <span class=var>?Π</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> is_valid_problem_sas_plus_then_strips_transformation_too 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"STRIPS_Semantics.is_parallel_solution_for_problem <span class=var>?Π</span> <span class=var>?π</span>"</span></span> 
    <span class=keyword1><span class=command>using</span></span> execute_serial_plan_sas_plus_is_execute_parallel_plan_sas_plus<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>,</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span> 
      strips_equivalent_to_sas_plus<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> length <span class=var>?π</span>"</span></span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops'</span> <span class=main>=</span> <span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops'</span> <span class=main>∈</span> set <span class=var>?π</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation nth_mem 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?π</span> <span class=main>=</span> <span class=main>[</span><span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=bound>ops</span><span class=main>]</span><span class=main>.</span> ops <span class=main>←</span> embed <span class=free>ψ</span><span class=main>]</span>"</span></span> 
      <span class=keyword1><span class=command>unfolding</span></span> SAS_Plus_STRIPS.sas_plus_parallel_plan_to_strips_parallel_plan_def 
        sasp_op_to_strips_def 
        sas_plus_parallel_plan_to_strips_parallel_plan_def
      <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ops</span></span> 
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops'</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub></span> <span class=free>Ψ</span> <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> <span class=skolem>ops</span><span class=main>]</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> set <span class=main>(</span>embed <span class=free>ψ</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>3<span class=main>,</span> 4<span class=main>)</span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>∈</span> <span class=main>{</span> <span class=main>[</span><span class=bound>op</span><span class=main>]</span> <span class=main>|</span> <span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=free>ψ</span> <span class=main>}</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>6<span class=main>)</span> set_of_embed_is
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span> 
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>op</span></span> 
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ops</span> <span class=main>=</span> <span class=main>[</span><span class=skolem>op</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>op</span> <span class=main>∈</span> set <span class=free>ψ</span>"</span></span> 
      <span class=keyword1><span class=command>using</span></span> calculation<span class=main>(</span>7<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"are_all_operators_non_interfering <span class=main>(</span><span class=var>?π</span> <span class=main>!</span> <span class=skolem>k</span><span class=main>)</span>"</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
    <span class=keyword1><span class=command>using</span></span> encode_problem_serializable_complete nb
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ To wrap-up our documentation of the Isabelle formalization, we take a look at the central 
theorem which combines all the previous theorem to show that SAS+ problems <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span> can be solved 
using the planning as satisfiability framework.

A solution <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>ψ</span></span>›</span></span></span></span> for the SAS+ problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>Ψ</span></span>›</span></span></span></span> exists if and only if a model <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>𝒜</span></span>›</span></span></span></span> and a 
hypothesized plan length <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>t</span></span>›</span></span></span></span> exist s.t. 
<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span>[display,indent=4] <span class=raw_text><span class=raw_text>"𝒜 ⊨ Φ<span class=hidden>⇩</span><sub>∀</sub> (φ Ψ) t"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> 
for the serializable SATPlan encoding of the corresponding STRIPS problem <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span></span> <span class=main><span class=main>(</span></span><span class=keyword1><span class=keyword1>φ</span></span> <span class=free><span class=free>Ψ</span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>t</span></span>›</span></span></span></span> exist. ›</span></span>
<span class=keyword1><span class=command>theorem</span></span>  sas_plus_problem_has_serial_solution_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>ψ</span><span class=main>.</span> is_serial_solution_for_problem <span class=free>Ψ</span> <span class=bound>ψ</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span><span class=bound>𝒜</span> <span class=bound>t</span><span class=main>.</span> <span class=bound>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=free>Ψ</span><span class=main>)</span> <span class=bound>t</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> sas_plus_problem_has_serial_solution_iff_i<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    sas_plus_problem_has_serial_solution_iff_ii<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> 
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Adding Noop actions to the SAS+ problem›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Here we add noop actions to the SAS+ problem to enable the SAT formula to be satisfiable if
      there are plans that are shorter than the given horizons.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>empty_sasp_action</span> <span class=main>≡</span> <span class=main>⦇</span>SAS_Plus_Representation.sas_plus_operator.precondition_of <span class=main>=</span> <span class=main>[]</span><span class=main>,</span>
                                SAS_Plus_Representation.sas_plus_operator.effect_of <span class=main>=</span> <span class=main>[]</span><span class=main>⦈</span>"</span></span>

<span class=keyword1 id=SAT_Solve_SAS_Plus-sasp_exec_noops><span class=command>lemma</span></span> sasp_exec_noops<span class=main>:</span> <span class=quoted><span class=quoted>"execute_serial_plan_sas_plus <span class=free>s</span> <span class=main>(</span>replicate <span class=free>n</span> empty_sasp_action<span class=main>)</span> <span class=main>=</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=main>)</span>
     <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> empty_sasp_action_def STRIPS_Representation.is_operator_applicable_in_def
                 execute_operator_def<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>"<span class=free>prob_with_noop</span> <span class=free><span class=bound><span class=entity>Π</span></span></span> <span class=main>≡</span>
     <span class=main>⦇</span>SAS_Plus_Representation.sas_plus_problem.variables_of <span class=main>=</span> SAS_Plus_Representation.sas_plus_problem.variables_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>,</span>
      SAS_Plus_Representation.sas_plus_problem.operators_of <span class=main>=</span> empty_sasp_action <span class=main>#</span> SAS_Plus_Representation.sas_plus_problem.operators_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>,</span> 
      SAS_Plus_Representation.sas_plus_problem.initial_of <span class=main>=</span> SAS_Plus_Representation.sas_plus_problem.initial_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>,</span>
      SAS_Plus_Representation.sas_plus_problem.goal_of <span class=main>=</span> SAS_Plus_Representation.sas_plus_problem.goal_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>,</span>
      SAS_Plus_Representation.sas_plus_problem.range_of <span class=main>=</span> SAS_Plus_Representation.sas_plus_problem.range_of <span class=free><span class=bound><span class=entity>Π</span></span></span><span class=main>⦈</span>"</span></span>

<span class=keyword1 id=SAT_Solve_SAS_Plus-sasp_noops_in_noop_problem><span class=command>lemma</span></span> sasp_noops_in_noop_problem<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>replicate <span class=free>n</span> empty_sasp_action<span class=main>)</span> <span class=main>⊆</span> set <span class=main>(</span>SAS_Plus_Representation.sas_plus_problem.operators_of <span class=main>(</span>prob_with_noop <span class=free>Π</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prob_with_noop_def<span class=main>)</span>

<span class=keyword1 id=SAT_Solve_SAS_Plus-noops_complete><span class=command>lemma</span></span> noops_complete<span class=main>:</span>
  <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> <span class=free>π</span> <span class=main>⟹</span>
     SAS_Plus_Semantics.is_serial_solution_for_problem <span class=main>(</span>prob_with_noop <span class=free>Ψ</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>replicate <span class=free>n</span> empty_sasp_action<span class=main>)</span> <span class=main>@</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> SAS_Plus_Semantics.is_serial_solution_for_problem_def insert list.pred_set
                    sasp_exec_noops prob_with_noop_def Let_def empty_sasp_action_def elem<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>rem_noops</span> <span class=main>≡</span> filter <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>≠</span> empty_sasp_action<span class=main>)</span>"</span></span>

<span class=keyword1 id=SAT_Solve_SAS_Plus-sasp_filter_empty_action><span class=command>lemma</span></span> sasp_filter_empty_action<span class=main>:</span>
  <span class=quoted><span class=quoted>"execute_serial_plan_sas_plus <span class=free>s</span> <span class=main>(</span>rem_noops <span class=free>πs</span><span class=main>)</span> <span class=main>=</span> execute_serial_plan_sas_plus <span class=free>s</span> <span class=free>πs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>πs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> empty_sasp_action_def rem_noops_def<span class=main>)</span>

<span class=keyword1 id=SAT_Solve_SAS_Plus-noops_sound><span class=command>lemma</span></span> noops_sound<span class=main>:</span>
  <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=main>(</span>prob_with_noop <span class=free>Ψ</span><span class=main>)</span> <span class=free>πs</span> <span class=main>⟹</span>
     SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> <span class=main>(</span>rem_noops <span class=free>πs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>πs</span></span><span class=main>)</span>
    <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> SAS_Plus_Semantics.is_serial_solution_for_problem_def insert list.pred_set
                     prob_with_noop_def ListMem_iff rem_noops_def
                     sasp_filter_empty_action<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> empty_sasp_action_def rem_noops_def<span class=main><span class=main>]</span></span>
                     empty_sasp_action_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SAT_Solve_SAS_Plus-noops_valid><span class=command>lemma</span></span> noops_valid<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span> <span class=main>⟹</span> is_valid_problem_sas_plus <span class=main>(</span>prob_with_noop <span class=free>Ψ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_valid_problem_sas_plus_def prob_with_noop_def Let_def
                 empty_sasp_action_def is_valid_operator_sas_plus_def list.pred_set<span class=main>)</span>

<span class=keyword1 id="SAT_Solve_SAS_Plus-sas_plus_problem_has_serial_solution_iff_i'"><span class=command>lemma</span></span> sas_plus_problem_has_serial_solution_iff_i'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span> <span class=free>t</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> 
           <span class=main>(</span>rem_noops
                   <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=main>(</span>prob_with_noop <span class=free>Ψ</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span>
                        <span class=main>(</span>concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms noops_valid 
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> noops_sound sas_plus_problem_has_serial_solution_iff_i<span class=main>)</span>

<span class=keyword1 id="SAT_Solve_SAS_Plus-sas_plus_problem_has_serial_solution_iff_ii'"><span class=command>lemma</span></span> sas_plus_problem_has_serial_solution_iff_ii'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus <span class=free>Ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"SAS_Plus_Semantics.is_serial_solution_for_problem <span class=free>Ψ</span> <span class=free>ψ</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"length <span class=free>ψ</span> <span class=main>≤</span> <span class=free>h</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>𝒜</span><span class=main>.</span> <span class=main>(</span><span class=bound>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop <span class=free>Ψ</span><span class=main>)</span><span class=main>)</span> <span class=free>h</span><span class=main>)</span>"</span></span> 
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>fastforce</span> 
       <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> assms noops_valid noops_complete
               sas_plus_problem_has_serial_solution_iff_ii
                 <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> ψ <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>replicate <span class=main>(</span><span class=free>h</span> <span class=main>-</span> length <span class=free>ψ</span><span class=main>)</span> empty_sasp_action<span class=main>)</span> <span class=main>@</span> <span class=free>ψ</span>"</span></span><span class=main><span class=main>]</span></span> <span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>


</pre></div><div id=AST_SAS_Plus_Equivalence><div class=head><h1>Theory AST_SAS_Plus_Equivalence</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz
*)</span>
<span class=keyword1><span class=command>theory</span></span> AST_SAS_Plus_Equivalence
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../AI_Planning_Languages_Semantics/SASP_Semantics.html>AI_Planning_Languages_Semantics.SASP_Semantics</a>"</span> <span class=quoted>"<a href=SAS_Plus_Semantics.html>SAS_Plus_Semantics</a>"</span> <span class=quoted>"<a href=../List-Index/List_Index.html>List-Index.List_Index</a>"</span> 
<span class=keyword2><span class=keyword>begin</span></span>                                                               

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Proving Equivalence of SAS+ representation and Fast-Downward's Multi-Valued Problem
         Representation›</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Translating Fast-Downward's represnetation to SAS+›</span></span>


<span class=keyword1><span class=command>type_synonym</span></span> nat_sas_plus_problem <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat<span class=main>,</span> nat<span class=main>)</span> sas_plus_problem"</span></span> 
<span class=keyword1><span class=command>type_synonym</span></span> nat_sas_plus_operator <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat<span class=main>,</span> nat<span class=main>)</span> sas_plus_operator"</span></span> 
<span class=keyword1><span class=command>type_synonym</span></span> nat_sas_plus_plan <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat<span class=main>,</span> nat<span class=main>)</span> sas_plus_plan"</span></span> 
<span class=keyword1><span class=command>type_synonym</span></span> nat_sas_plus_state <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat<span class=main>,</span> nat<span class=main>)</span> state"</span></span> 


<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_standard_effect</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ast_effect <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_standard_effect</span> <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=bound>pre</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=bound>pre</span> <span class=main>=</span> <span class=main>[]</span>"</span></span> 

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_standard_operator</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ast_operator <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_standard_operator</span> <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>effects</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> list_all is_standard_effect <span class=bound>effects</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>rem_effect_implicit_pres</span><span class=main>::</span> <span class=quoted><span class=quoted>"ast_effect <span class=main>⇒</span> ast_effect"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rem_effect_implicit_pres</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>preconds</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>implicit_pre</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>eff</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>preconds</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>,</span> None<span class=main>,</span> <span class=free><span class=bound><span class=entity>eff</span></span></span><span class=main>)</span>"</span></span> 

<span class=keyword1><span class=command>fun</span></span> <span class=entity>rem_implicit_pres</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ast_operator <span class=main>⇒</span> ast_operator"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rem_implicit_pres</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>name</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>preconds</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>effects</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>cost</span></span></span><span class=main>)</span> <span class=main>=</span>
     <span class=main>(</span><span class=free><span class=bound><span class=entity>name</span></span></span><span class=main>,</span> <span class=main>(</span>implicit_pres <span class=free><span class=bound><span class=entity>effects</span></span></span><span class=main>)</span> <span class=main>@</span> <span class=free><span class=bound><span class=entity>preconds</span></span></span><span class=main>,</span> map rem_effect_implicit_pres <span class=free><span class=bound><span class=entity>effects</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>cost</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>rem_implicit_pres_ops</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ast_problem <span class=main>⇒</span> ast_problem"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rem_implicit_pres_ops</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>vars</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>init</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>goal</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>vars</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>init</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>goal</span></span></span><span class=main>,</span> map rem_implicit_pres <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>consistent_map_lists</span> <span class=free><span class=bound><span class=entity>xs1</span></span></span> <span class=free><span class=bound><span class=entity>xs2</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>∀</span><span class=main>(</span><span class=bound>x1</span><span class=main>,</span><span class=bound>x2</span><span class=main>)</span> <span class=main>∈</span> set <span class=free><span class=bound><span class=entity>xs1</span></span></span><span class=main>.</span> <span class=main>∀</span><span class=main>(</span><span class=bound>y1</span><span class=main>,</span><span class=bound>y2</span><span class=main>)</span><span class=main>∈</span> set <span class=free><span class=bound><span class=entity>xs2</span></span></span><span class=main>.</span> <span class=bound>x1</span> <span class=main>=</span> <span class=bound>y1</span> <span class=main>⟶</span> <span class=bound>x1</span> <span class=main>=</span> <span class=bound>y2</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-map_add_comm><span class=command>lemma</span></span> map_add_comm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> dom <span class=free>m1</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> dom <span class=free>m2</span> <span class=main>⟹</span> <span class=free>m1</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>m2</span> <span class=bound>x</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>m1</span> <span class=main>++</span> <span class=free>m2</span> <span class=main>=</span> <span class=free>m2</span> <span class=main>++</span> <span class=free>m1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_add_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-first_map_add_submap><span class=command>lemma</span></span> first_map_add_submap<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> dom <span class=free>m1</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> dom <span class=free>m2</span> <span class=main>⟹</span> <span class=free>m1</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>m2</span> <span class=bound>x</span><span class=main>)</span> <span class=main>⟹</span>
        <span class=free>m1</span> <span class=main>++</span> <span class=free>m2</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>x</span> <span class=main>⟹</span> <span class=free>m1</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> map_add_le_mapE map_add_comm
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-subsuming_states_map_add><span class=command>lemma</span></span> subsuming_states_map_add<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> dom <span class=free>m1</span> <span class=main>∩</span> dom <span class=free>m2</span> <span class=main>⟹</span> <span class=free>m1</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>m2</span> <span class=bound>x</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=free>m1</span> <span class=main>++</span> <span class=free>m2</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span> <span class=main>⟷</span> <span class=main>(</span><span class=free>m1</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span> <span class=main>∧</span> <span class=free>m2</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_add_le_mapI <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> first_map_add_submap map_add_le_mapE<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-consistent_map_lists><span class=command>lemma</span></span> consistent_map_lists<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>distinct <span class=main>(</span>map fst <span class=main>(</span><span class=free>xs1</span> <span class=main>@</span> <span class=free>xs2</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> dom <span class=main>(</span>map_of <span class=free>xs1</span><span class=main>)</span> <span class=main>∩</span> dom <span class=main>(</span>map_of <span class=free>xs2</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> 
     <span class=main>(</span>map_of <span class=free>xs1</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>map_of <span class=free>xs2</span><span class=main>)</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs1</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> consistent_map_lists_def image_def<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> map_of_SomeD
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-subsuming_states_append><span class=command>lemma</span></span> subsuming_states_append<span class=main>:</span> 
  <span class=quoted><span class=quoted>"distinct <span class=main>(</span>map fst <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> 
     <span class=main>(</span>map_of <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>(</span>map_of <span class=free>ys</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span> <span class=main>∧</span> <span class=main>(</span>map_of <span class=free>xs</span><span class=main>)</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> map_of_append
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>intro</span> subsuming_states_map_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_def<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> IntI empty_iff fst_conv mem_Collect_eq<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>consistent_pres_op</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>consistent_pres_op</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=keyword1>of</span> <span class=main>(</span><span class=bound>name</span><span class=main>,</span> <span class=bound>pres</span><span class=main>,</span> <span class=bound>effs</span><span class=main>,</span> <span class=bound>cost</span><span class=main>)</span> <span class=main>⇒</span> 
                               distinct <span class=main>(</span>map fst <span class=main>(</span><span class=bound>pres</span> <span class=main>@</span> <span class=main>(</span>implicit_pres <span class=bound>effs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                               <span class=main>∧</span> consistent_map_lists <span class=bound>pres</span> <span class=main>(</span>implicit_pres <span class=bound>effs</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>consistent_pres_op'</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>consistent_pres_op'</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=keyword1>of</span> <span class=main>(</span><span class=bound>name</span><span class=main>,</span> <span class=bound>pres</span><span class=main>,</span> <span class=bound>effs</span><span class=main>,</span> <span class=bound>cost</span><span class=main>)</span> <span class=main>⇒</span> 
                               consistent_map_lists <span class=bound>pres</span> <span class=main>(</span>implicit_pres <span class=bound>effs</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-consistent_pres_op_then'"><span class=command>lemma</span></span> consistent_pres_op_then'<span class=main>:</span> <span class=quoted><span class=quoted>"consistent_pres_op <span class=free>op</span> <span class=main>⟹</span> consistent_pres_op' <span class=free>op</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> consistent_pres_op'_def consistent_pres_op_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_valid_states><span class=command>lemma</span></span> rem_implicit_pres_ops_valid_states<span class=main>:</span>
   <span class=quoted><span class=quoted>"ast_problem.valid_states <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=main>=</span> ast_problem.valid_states <span class=free>prob</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.valid_states_def ast_problem.Dom_def 
                       ast_problem.numVars_def ast_problem.astDom_def
                       ast_problem.range_of_var_def ast_problem.numVals_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_None><span class=command>lemma</span></span> rem_implicit_pres_ops_lookup_op_None<span class=main>:</span>
  <span class=quoted><span class=quoted>"ast_problem.lookup_operator <span class=main>(</span><span class=free>vars</span><span class=main>,</span> <span class=free>init</span><span class=main>,</span> <span class=free>goal</span><span class=main>,</span> <span class=free>ops</span><span class=main>)</span> <span class=free>name</span> <span class=main>=</span> None <span class=main>⟷</span> 
   ast_problem.lookup_operator <span class=main>(</span>rem_implicit_pres_ops <span class=main>(</span><span class=free>vars</span><span class=main>,</span> <span class=free>init</span><span class=main>,</span> <span class=free>goal</span><span class=main>,</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span> <span class=free>name</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.lookup_operator_def ast_problem.astδ_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_Some_1><span class=command>lemma</span></span> rem_implicit_pres_ops_lookup_op_Some_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"ast_problem.lookup_operator <span class=main>(</span><span class=free>vars</span><span class=main>,</span> <span class=free>init</span><span class=main>,</span> <span class=free>goal</span><span class=main>,</span> <span class=free>ops</span><span class=main>)</span> <span class=free>name</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>vp</span><span class=main>,</span><span class=free>e</span><span class=main>)</span> <span class=main>⟹</span>
   ast_problem.lookup_operator <span class=main>(</span>rem_implicit_pres_ops <span class=main>(</span><span class=free>vars</span><span class=main>,</span> <span class=free>init</span><span class=main>,</span> <span class=free>goal</span><span class=main>,</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span> <span class=free>name</span> <span class=main>=</span>
     Some <span class=main>(</span>rem_implicit_pres <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>vp</span><span class=main>,</span><span class=free>e</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.lookup_operator_def ast_problem.astδ_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_Some_1'"><span class=command>lemma</span></span> rem_implicit_pres_ops_lookup_op_Some_1'<span class=main>:</span>
  <span class=quoted><span class=quoted>"ast_problem.lookup_operator <span class=free>prob</span> <span class=free>name</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>vp</span><span class=main>,</span><span class=free>e</span><span class=main>)</span> <span class=main>⟹</span>
   ast_problem.lookup_operator <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>name</span> <span class=main>=</span>
     Some <span class=main>(</span>rem_implicit_pres <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>vp</span><span class=main>,</span><span class=free>e</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> rem_implicit_pres_ops_lookup_op_Some_1
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-implicit_pres_empty><span class=command>lemma</span></span> implicit_pres_empty<span class=main>:</span> <span class=quoted><span class=quoted>"implicit_pres <span class=main>(</span>map rem_effect_implicit_pres <span class=free>effs</span><span class=main>)</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>effs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> implicit_pres_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_Some_2><span class=command>lemma</span></span> rem_implicit_pres_ops_lookup_op_Some_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"ast_problem.lookup_operator <span class=main>(</span>rem_implicit_pres_ops <span class=main>(</span><span class=free>vars</span><span class=main>,</span> <span class=free>init</span><span class=main>,</span> <span class=free>goal</span><span class=main>,</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span> <span class=free>name</span> <span class=main>=</span> Some <span class=free>op</span>
     <span class=main>⟹</span> <span class=main>∃</span><span class=bound>op'</span><span class=main>.</span> ast_problem.lookup_operator <span class=main>(</span><span class=free>vars</span><span class=main>,</span> <span class=free>init</span><span class=main>,</span> <span class=free>goal</span><span class=main>,</span> <span class=free>ops</span><span class=main>)</span> <span class=free>name</span> <span class=main>=</span> Some <span class=bound>op'</span> <span class=main>∧</span>
               <span class=main>(</span><span class=free>op</span> <span class=main>=</span> rem_implicit_pres <span class=bound>op'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.lookup_operator_def ast_problem.astδ_def implicit_pres_empty image_def<span class=main>)</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_lookup_op_Some_2'"><span class=command>lemma</span></span> rem_implicit_pres_ops_lookup_op_Some_2'<span class=main>:</span>
  <span class=quoted><span class=quoted>"ast_problem.lookup_operator <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>name</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>e</span><span class=main>,</span><span class=free>c</span><span class=main>)</span>
     <span class=main>⟹</span> <span class=main>∃</span><span class=bound>op'</span><span class=main>.</span> ast_problem.lookup_operator <span class=free>prob</span> <span class=free>name</span> <span class=main>=</span> Some <span class=bound>op'</span> <span class=main>∧</span>
               <span class=main>(</span><span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>e</span><span class=main>,</span><span class=free>c</span><span class=main>)</span> <span class=main>=</span> rem_implicit_pres <span class=bound>op'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> rem_implicit_pres_ops_lookup_op_Some_2
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-subsuming_states_def'"><span class=command>lemma</span></span> subsuming_states_def'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> ast_problem.subsuming_states <span class=free>prob</span> <span class=free>ps</span> <span class=main>=</span> <span class=main>(</span><span class=free>s</span> <span class=main>∈</span> <span class=main>(</span>ast_problem.valid_states <span class=free>prob</span><span class=main>)</span> <span class=main>∧</span> <span class=free>ps</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.subsuming_states_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_enabled_1><span class=command>lemma</span></span> rem_implicit_pres_ops_enabled_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span><span class=main>;</span>
        ast_problem.enabled <span class=free>prob</span> <span class=free>name</span> <span class=free>s</span><span class=main>⟧</span> <span class=main>⟹</span>
     ast_problem.enabled <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>name</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.enabled_def rem_implicit_pres_ops_valid_states subsuming_states_def'
                      implicit_pres_empty
                 <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> map_add_le_mapI
                 <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_lookup_op_Some_1'
                 <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-lookup_Some_inδ><span class=command>lemma</span></span> lookup_Some_inδ<span class=main>:</span> <span class=quoted><span class=quoted>"lookup_operator <span class=free>π</span> <span class=main>=</span> Some <span class=free>op</span> <span class=main>⟹</span> <span class=free>op</span><span class=main>∈</span>set astδ"</span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> find_Some_iff in_set_conv_nth lookup_operator_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_enabled_2><span class=command>lemma</span></span> rem_implicit_pres_ops_enabled_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ast_problem.enabled <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>name</span> <span class=free>s</span> <span class=main>⟹</span> 
           ast_problem.enabled <span class=free>prob</span> <span class=free>name</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>[</span><span class=operator>OF</span> ast_problem.lookup_Some_inδ<span class=main>,</span> <span class=operator>unfolded</span> consistent_pres_op_def<span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> subsuming_states_append rem_implicit_pres_ops_valid_states subsuming_states_def'
                   ast_problem.enabled_def
             <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_lookup_op_Some_2'
             <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> subsuming_states_map_add consistent_map_lists
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> Map.map_add_comm dom_map_of_conv_image_fst map_add_le_mapE<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> map_add_le_mapE <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_enabled><span class=command>lemma</span></span> rem_implicit_pres_ops_enabled<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span> <span class=main>⟹</span>
        ast_problem.enabled <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>name</span> <span class=free>s</span> <span class=main>=</span> ast_problem.enabled <span class=free>prob</span> <span class=free>name</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> rem_implicit_pres_ops_enabled_1 rem_implicit_pres_ops_enabled_2
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-std_eff_enabled><span class=command>lemma</span></span> std_eff_enabled<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"is_standard_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>s</span> <span class=main>∈</span> valid_states <span class=main>⟹</span> <span class=main>(</span>filter <span class=main>(</span>eff_enabled <span class=free>s</span><span class=main>)</span> <span class=free>effs</span><span class=main>)</span> <span class=main>=</span> <span class=free>effs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>effs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_standard_operator_def is_standard_effect_def eff_enabled_def subsuming_states_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_standard_operator_rem_implicit><span class=command>lemma</span></span> is_standard_operator_rem_implicit<span class=main>:</span> <span class=quoted><span class=quoted>"is_standard_operator <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>vp</span><span class=main>,</span><span class=free>v</span><span class=main>)</span> <span class=main>⟹</span> 
         is_standard_operator <span class=main>(</span>rem_implicit_pres <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>vp</span><span class=main>,</span><span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>vp</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_standard_operator_def is_standard_effect_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_standard_operator_rem_implicit_pres_ops><span class=command>lemma</span></span> is_standard_operator_rem_implicit_pres_ops<span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=main>(</span><span class=free>a</span><span class=main>,</span><span class=free>b</span><span class=main>,</span><span class=free>c</span><span class=main>,</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator <span class=bound>op</span><span class=main>)</span><span class=main>;</span>
       <span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=main>(</span>rem_implicit_pres_ops <span class=main>(</span><span class=free>a</span><span class=main>,</span><span class=free>b</span><span class=main>,</span><span class=free>c</span><span class=main>,</span><span class=free>d</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>⟧</span>
       <span class=main>⟹</span> is_standard_operator <span class=free>op</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>d</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.astδ_def image_def <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_standard_operator_rem_implicit<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-is_standard_operator_rem_implicit_pres_ops'"><span class=command>lemma</span></span> is_standard_operator_rem_implicit_pres_ops'<span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
    <span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator <span class=bound>op</span><span class=main>)</span><span class=main>⟧</span>
      <span class=main>⟹</span> is_standard_operator <span class=free>op</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> is_standard_operator_rem_implicit_pres_ops
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-in_rem_implicit_pres_δ><span class=command>lemma</span></span> in_rem_implicit_pres_δ<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span>
     rem_implicit_pres <span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.astδ_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_execute><span class=command>lemma</span></span> rem_implicit_pres_ops_execute<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator <span class=bound>op</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> ast_problem.valid_states <span class=free>prob</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ast_problem.execute <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>name</span> <span class=free>s</span> <span class=main>=</span> ast_problem.execute <span class=free>prob</span> <span class=free>name</span> <span class=free>s</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>n</span><span class=main>,</span><span class=skolem>ps</span><span class=main>,</span><span class=skolem>es</span><span class=main>,</span><span class=skolem>c</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span>
       <span class=main>(</span>filter <span class=main>(</span>ast_problem.eff_enabled <span class=free>prob</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>es</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>es</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>n</span> <span class=skolem>ps</span> <span class=skolem>es</span> <span class=skolem>c</span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.std_eff_enabled <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>n</span><span class=main>,</span><span class=skolem>ps</span><span class=main>,</span><span class=skolem>es</span><span class=main>,</span><span class=skolem>c</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span>
       <span class=main>(</span>filter <span class=main>(</span>ast_problem.eff_enabled <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>s</span><span class=main>)</span> <span class=main>(</span>map rem_effect_implicit_pres <span class=skolem>es</span><span class=main>)</span><span class=main>)</span>
            <span class=main>=</span> map rem_effect_implicit_pres <span class=skolem>es</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>n</span> <span class=skolem>ps</span> <span class=skolem>es</span> <span class=skolem>c</span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.std_eff_enabled rem_implicit_pres_ops_valid_states
        <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_standard_operator_rem_implicit_pres_ops'
        <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> in_rem_implicit_pres_δ<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_of <span class=main>(</span>map <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span><span class=bound>x</span><span class=main>,</span><span class=main><span class=bound>_</span></span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>o</span> rem_effect_implicit_pres<span class=main>)</span> <span class=skolem>effs</span><span class=main>)</span> <span class=main>=</span>
                    map_of <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span><span class=bound>x</span><span class=main>,</span><span class=main><span class=bound>_</span></span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=skolem>effs</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>effs</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>effs</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.execute_def rem_implicit_pres_ops_lookup_op_Some_1'
        <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits
        <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_lookup_op_Some_2' ast_problem.lookup_Some_inδ<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_path_to><span class=command>lemma</span></span> rem_implicit_pres_ops_path_to<span class=main>:</span>
   <span class=quoted><span class=quoted>"wf_ast_problem <span class=free>prob</span> <span class=main>⟹</span>
       <span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span> <span class=main>⟹</span>
       <span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator <span class=bound>op</span><span class=main>)</span> <span class=main>⟹</span>
       <span class=free>s</span> <span class=main>∈</span> ast_problem.valid_states <span class=free>prob</span> <span class=main>⟹</span>
       ast_problem.path_to <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>s</span> <span class=free>πs</span> <span class=free>s'</span> <span class=main>=</span> ast_problem.path_to <span class=free>prob</span> <span class=free>s</span> <span class=free>πs</span> <span class=free>s'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>πs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_execute rem_implicit_pres_ops_enabled
                 ast_problem.path_to.simps wf_ast_problem.execute_preserves_valid<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_astG><span class=command>lemma</span></span> rem_implicit_pres_ops_astG<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"ast_problem.astG <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=main>=</span>
           ast_problem.astG <span class=free>prob</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.astG_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_goal><span class=command>lemma</span></span> rem_implicit_pres_ops_goal<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"ast_problem.G <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=main>=</span> ast_problem.G <span class=free>prob</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> rem_implicit_pres_ops_valid_states
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.G_def ast_problem.astG_def subsuming_states_def'<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_astI><span class=command>lemma</span></span> rem_implicit_pres_ops_astI<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
   <span class=quoted><span class=quoted>"ast_problem.astI <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=main>=</span> ast_problem.astI <span class=free>prob</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.I_def ast_problem.astI_def subsuming_states_def'<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_init><span class=command>lemma</span></span> rem_implicit_pres_ops_init<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"ast_problem.I <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=main>=</span> ast_problem.I <span class=free>prob</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.I_def ast_problem.astI_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_valid_plan><span class=command>lemma</span></span> rem_implicit_pres_ops_valid_plan<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_ast_problem <span class=free>prob</span>"</span></span>
       <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span>"</span></span>
       <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator <span class=bound>op</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ast_problem.valid_plan <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>πs</span> <span class=main>=</span> ast_problem.valid_plan <span class=free>prob</span> <span class=free>πs</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> wf_ast_problem.I_valid<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> rem_implicit_pres_ops_path_to<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.valid_plan_def rem_implicit_pres_ops_goal rem_implicit_pres_ops_init<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_numVars><span class=command>lemma</span></span> rem_implicit_pres_ops_numVars<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"ast_problem.numVars <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=main>=</span> ast_problem.numVars <span class=free>prob</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.numVars_def ast_problem.astDom_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_numVals><span class=command>lemma</span></span> rem_implicit_pres_ops_numVals<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"ast_problem.numVals <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> ast_problem.numVals <span class=free>prob</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.numVals_def ast_problem.astDom_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-in_implicit_pres><span class=command>lemma</span></span> in_implicit_pres<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>implicit_pres <span class=free>effs</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>epres</span> <span class=bound>v</span> <span class=bound>vp</span><span class=main>.</span> <span class=main>(</span><span class=bound>epres</span><span class=main>,</span><span class=free>x</span><span class=main>,</span><span class=bound>vp</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>∈</span> set <span class=free>effs</span> <span class=main>∧</span> <span class=bound>vp</span> <span class=main>=</span> Some <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>effs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> implicit_pres_def image_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-pair4_eqD><span class=command>lemma</span></span> pair4_eqD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a1</span><span class=main>,</span><span class=free>a2</span><span class=main>,</span><span class=free>a3</span><span class=main>,</span><span class=free>a4</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b1</span><span class=main>,</span><span class=free>b2</span><span class=main>,</span><span class=free>b3</span><span class=main>,</span><span class=free>b4</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>a3</span> <span class=main>=</span> <span class=free>b3</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>  

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_wf_partial_state><span class=command>lemma</span></span> rem_implicit_pres_ops_wf_partial_state<span class=main>:</span>
   <span class=quoted><span class=quoted>"ast_problem.wf_partial_state <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=free>s</span> <span class=main>=</span>
         ast_problem.wf_partial_state <span class=free>prob</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.wf_partial_state_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_wf_operator><span class=command>lemma</span></span> rem_implicit_pres_wf_operator<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"consistent_pres_op <span class=free>op</span>"</span></span>
    <span class=quoted><span class=quoted>"ast_problem.wf_operator <span class=free>prob</span> <span class=free>op</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>
    <span class=quoted><span class=quoted>"ast_problem.wf_operator <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=main>(</span>rem_implicit_pres <span class=free>op</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>name</span></span> <span class=skolem><span class=skolem>pres</span></span> <span class=skolem><span class=skolem>effs</span></span> <span class=skolem><span class=skolem>cost</span></span> <span class=keyword2><span class=keyword>where</span></span> op<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>name</span><span class=main>,</span> <span class=skolem>pres</span><span class=main>,</span> <span class=skolem>effs</span><span class=main>,</span> <span class=skolem>cost</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>op</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> asses<span class=main>:</span> <span class=quoted><span class=quoted>"consistent_pres_op <span class=main>(</span><span class=skolem>name</span><span class=main>,</span> <span class=skolem>pres</span><span class=main>,</span> <span class=skolem>effs</span><span class=main>,</span> <span class=skolem>cost</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"ast_problem.wf_operator <span class=free>prob</span> <span class=main>(</span><span class=skolem>name</span><span class=main>,</span> <span class=skolem>pres</span><span class=main>,</span> <span class=skolem>effs</span><span class=main>,</span> <span class=skolem>cost</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span>map fst <span class=main>(</span><span class=main>(</span>implicit_pres <span class=skolem>effs</span><span class=main>)</span> <span class=main>@</span> <span class=skolem>pres</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> consistent_pres_op_def<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>&lt;</span> ast_problem.numVars <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>&lt;</span> ast_problem.numVals <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=skolem>x</span>"</span></span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span><span class=main>,</span><span class=skolem>v</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span>implicit_pres <span class=skolem>effs</span><span class=main>)</span> <span class=main>@</span> <span class=skolem>pres</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>x</span> <span class=skolem>v</span>
    <span class=keyword1><span class=command>using</span></span> that asses
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> in_implicit_pres <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.wf_partial_state_def ast_problem.wf_operator_def<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ast_problem.wf_partial_state <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>implicit_pres <span class=skolem>effs</span><span class=main>)</span> <span class=main>@</span> <span class=skolem>pres</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> ast_problem.wf_partial_state_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span><span class=main>)</span> <span class=skolem>effs</span><span class=main>)</span> <span class=main>=</span> 
                        <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>map rem_effect_implicit_pres <span class=skolem>effs</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span><span class=main>)</span> <span class=main>(</span>map rem_effect_implicit_pres <span class=skolem>effs</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> op ast_problem.wf_operator_def rem_implicit_pres.simps <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> pair4_eqD<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>vp</span><span class=main>.</span> <span class=main>(</span><span class=skolem>epres</span><span class=main>,</span><span class=skolem>x</span><span class=main>,</span><span class=bound>vp</span><span class=main>,</span><span class=skolem>v</span><span class=main>)</span><span class=main>∈</span>set <span class=skolem>effs</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=skolem>epres</span><span class=main>,</span><span class=skolem>x</span><span class=main>,</span>None<span class=main>,</span><span class=skolem>v</span><span class=main>)</span><span class=main>∈</span>set <span class=main>(</span>map rem_effect_implicit_pres <span class=skolem>effs</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>epres</span> <span class=skolem>x</span> <span class=skolem>v</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> op ast_problem.wf_operator_def rem_implicit_pres_ops_wf_partial_state 
             <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>      
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_inδD><span class=command>lemma</span></span> rem_implicit_pres_ops_inδD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span><span class=main>)</span>
        <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>op'</span><span class=main>.</span> <span class=bound>op'</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>∧</span> <span class=free>op</span> <span class=main>=</span> rem_implicit_pres <span class=bound>op'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.astδ_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_well_formed><span class=command>lemma</span></span> rem_implicit_pres_ops_well_formed<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span>"</span></span>
        <span class=quoted><span class=quoted>"ast_problem.well_formed <span class=free>prob</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ast_problem.well_formed <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map fst <span class=main>(</span>ast_problem.astδ <span class=main>(</span>rem_implicit_pres_ops <span class=free>prob</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> map fst <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>prob</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.astδ_def<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
   <span class=keyword1><span class=command>using</span></span> assms
   <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ast_problem.well_formed_def rem_implicit_pres_ops_wf_partial_state
           <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> rem_implicit_pres.simps
           <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_inδD
           <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rem_implicit_pres_wf_operator<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_standard_effect'</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"ast_effect <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_standard_effect'</span> <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=bound>pre</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>vpre</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=bound>pre</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∧</span> <span class=bound>vpre</span> <span class=main>=</span> None"</span></span> 

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_standard_operator'</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"ast_operator <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_standard_operator'</span> <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>effects</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> list_all is_standard_effect' <span class=bound>effects</span>"</span></span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-rem_implicit_pres_is_standard_operator'"><span class=command>lemma</span></span> rem_implicit_pres_is_standard_operator'<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_standard_operator <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>es</span><span class=main>,</span><span class=free>c</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator' <span class=main>(</span>rem_implicit_pres <span class=main>(</span><span class=free>n</span><span class=main>,</span><span class=free>p</span><span class=main>,</span><span class=free>es</span><span class=main>,</span><span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>es</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_standard_operator'_def is_standard_operator_def is_standard_effect_def
                                is_standard_effect'_def<span class=main>)</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-rem_implicit_pres_ops_is_standard_operator'"><span class=command>lemma</span></span> rem_implicit_pres_ops_is_standard_operator'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=main>(</span><span class=free>vs</span><span class=main>,</span> <span class=free>I</span><span class=main>,</span> <span class=free>G</span><span class=main>,</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator <span class=bound>op</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=free>π</span><span class=main>∈</span>set <span class=main>(</span>ast_problem.astδ <span class=main>(</span>rem_implicit_pres_ops <span class=main>(</span><span class=free>vs</span><span class=main>,</span> <span class=free>I</span><span class=main>,</span> <span class=free>G</span><span class=main>,</span> <span class=free>ops</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator' <span class=free>π</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>ops</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ast_problem.astδ_def <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rem_implicit_pres_is_standard_operator'<span class=main>)</span>

<span class=keyword1><span class=command>locale</span></span> abs_ast_prob <span class=main>=</span> wf_ast_problem <span class=main>+</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> no_cond_effs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>π</span><span class=main>∈</span>set astδ<span class=main>.</span> is_standard_operator' <span class=bound>π</span>"</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>abs_ast_variable_section</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=main>(</span>length astDom<span class=main>)</span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>abs_range_map</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat <span class=main>⇀</span> nat list<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>abs_range_map</span> <span class=main>≡</span> 
        map_of <span class=main>(</span>zip abs_ast_variable_section 
                    <span class=main>(</span>map <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>vals</span><span class=main>.</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=bound>vals</span><span class=main>]</span><span class=main>)</span> <span class=keyword1>o</span> snd <span class=keyword1>o</span> snd<span class=main>)</span>
                         astDom<span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>
      
<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_valid_vars_1><span class=command>lemma</span></span> is_valid_vars_1<span class=main>:</span> <span class=quoted><span class=quoted>"astDom <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> abs_ast_variable_section <span class=main>≠</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_variable_section_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-upt_eq_Nil_conv'"><span class=command>lemma</span></span> upt_eq_Nil_conv'<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>[]</span> <span class=main>=</span> <span class=main>[</span><span class=free>i</span><span class=main>..&lt;</span><span class=free>j</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>j</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>j</span> <span class=main>≤</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>j</span></span><span class=main>)</span><span class=operator>simp_all</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-map_of_zip_map_Some><span class=command>lemma</span></span> map_of_zip_map_Some<span class=main>:</span> 
     <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>&lt;</span> length <span class=free>xs</span>
        <span class=main>⟹</span> <span class=main>(</span>map_of <span class=main>(</span>zip <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free>xs</span><span class=main>]</span> <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append map_add_Some_iff<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-map_of_zip_Some><span class=command>lemma</span></span> map_of_zip_Some<span class=main>:</span>
     <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>&lt;</span> length <span class=free>xs</span>
        <span class=main>⟹</span> <span class=main>(</span>map_of <span class=main>(</span>zip <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free>xs</span><span class=main>]</span> <span class=free>xs</span><span class=main>)</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append map_add_Some_iff<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-in_set_zip_lengthE><span class=command>lemma</span></span> in_set_zip_lengthE<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>,</span><span class=free>y</span><span class=main>)</span> <span class=main>∈</span> set<span class=main>(</span>zip <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=free>xs</span><span class=main>]</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>;</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>x</span> <span class=main>=</span><span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>R</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>R</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append map_add_Some_iff<span class=main>)</span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_valid_vars_2><span class=command>lemma</span></span> is_valid_vars_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> abs_range_map <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> abs_ast_variable_section"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_range_map_def abs_ast_variable_section_def list.pred_set<span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>abs_ast_initial_state</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"nat_sas_plus_state"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>abs_ast_initial_state</span> <span class=main>≡</span> map_of <span class=main>(</span>zip <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length astI<span class=main>]</span> astI<span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-valid_abs_init_1><span class=command>lemma</span></span> valid_abs_init_1<span class=main>:</span> <span class=quoted><span class=quoted>"abs_ast_initial_state <span class=free>v</span> <span class=main>≠</span> None <span class=main>⟷</span> <span class=free>v</span> <span class=main>∈</span> set abs_ast_variable_section"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_variable_section_def numVars_def wf_initial<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> abs_ast_initial_state_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_range_map_Some><span class=command>lemma</span></span> abs_range_map_Some<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set abs_ast_variable_section <span class=main>⟹</span>
            <span class=main>(</span>abs_range_map <span class=free>v</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>length <span class=main>(</span>snd <span class=main>(</span>snd <span class=main>(</span>astDom <span class=main>!</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numVars_def abs_range_map_def o_def abs_ast_variable_section_def map_of_zip_map_Some<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-in_abs_v_sec_length><span class=command>lemma</span></span> in_abs_v_sec_length<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set abs_ast_variable_section <span class=main>⟷</span> <span class=free>v</span> <span class=main>&lt;</span> length astDom"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_variable_section_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>&lt;</span> length astDom <span class=main>⟹</span> <span class=main>(</span>abs_ast_initial_state <span class=free>v</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span>astI <span class=main>!</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> wf_initial<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>simplified</span> numVars_def<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_of_zip_Some abs_ast_initial_state_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>&lt;</span> length astDom <span class=main>⟹</span> astI <span class=main>!</span> <span class=free>v</span> <span class=main>&lt;</span> length <span class=main>(</span>snd <span class=main>(</span>snd <span class=main>(</span>astDom <span class=main>!</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> wf_initial<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>simplified</span> numVars_def<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> wf_initial
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numVals_def abs_ast_initial_state_def
              <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> set abs_ast_variable_section <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> length <span class=main>(</span>snd <span class=main>(</span>snd <span class=main>(</span>astDom <span class=main>!</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
                 <span class=free>x</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>abs_range_map <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> abs_range_map_Some
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>&lt;</span>length astDom <span class=main>⟹</span> astI <span class=main>!</span> <span class=free>x</span> <span class=main>&lt;</span> length <span class=main>(</span>snd <span class=main>(</span>snd <span class=main>(</span>astDom <span class=main>!</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> wf_initial<span class=main>[</span><span class=operator>unfolded</span> numVars_def numVals_def<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"abs_ast_initial_state <span class=free>v</span> <span class=main>=</span> Some <span class=free>a</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> length <span class=main>(</span>snd <span class=main>(</span>snd <span class=main>(</span>astDom <span class=main>!</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_initial_state_def
                    wf_initial<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>[</span></span><span class=operator>unfolded</span> numVars_def numVals_def<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span>
          <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> in_set_zip_lengthE<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-valid_abs_init_2><span class=command>lemma</span></span> valid_abs_init_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"abs_ast_initial_state <span class=free>v</span> <span class=main>≠</span> None <span class=main>⟹</span> <span class=main>(</span>the <span class=main>(</span>abs_ast_initial_state <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>abs_range_map <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> valid_abs_init_1
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>abs_ast_goal</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"nat_sas_plus_state"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>abs_ast_goal</span> <span class=main>≡</span> map_of astG"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"wf_partial_state <span class=free>s</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>s</span> <span class=main>⟹</span> <span class=free>v</span> <span class=main>∈</span> set abs_ast_variable_section"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_partial_state_def abs_ast_variable_section_def numVars_def
           <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-valid_abs_goal_1><span class=command>lemma</span></span> valid_abs_goal_1<span class=main>:</span> <span class=quoted><span class=quoted>"abs_ast_goal <span class=free>v</span> <span class=main>≠</span> None <span class=main>⟹</span> <span class=free>v</span> <span class=main>∈</span> set abs_ast_variable_section"</span></span>
  <span class=keyword1><span class=command>using</span></span> wf_goal
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_goal_def <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> map_of_SomeD<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-in_abs_rangeI><span class=command>lemma</span></span> in_abs_rangeI<span class=main>:</span> <span class=quoted><span class=quoted>"wf_partial_state <span class=free>s</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>s</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>abs_range_map <span class=free>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_range_map_Some wf_partial_state_def numVals_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-valid_abs_goal_2><span class=command>lemma</span></span> valid_abs_goal_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"abs_ast_goal <span class=free>v</span> <span class=main>≠</span> None <span class=main>⟹</span> <span class=main>(</span>the <span class=main>(</span>abs_ast_goal <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>the <span class=main>(</span>abs_range_map <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> wf_goal 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_of_SomeD weak_map_of_SomeI abs_ast_goal_def <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> in_abs_rangeI<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>abs_ast_operator</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"ast_operator <span class=main>⇒</span> nat_sas_plus_operator"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>abs_ast_operator</span> <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=bound>name</span><span class=main>,</span> <span class=bound>preconditions</span><span class=main>,</span> <span class=bound>effects</span><span class=main>,</span> <span class=bound>cost</span><span class=main>)</span><span class=main>.</span> 
       <span class=main>⦇</span> precondition_of <span class=main>=</span> <span class=bound>preconditions</span><span class=main>,</span> 
         effect_of <span class=main>=</span> <span class=main>[</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>x</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>_</span><span class=main>,</span> v<span class=main>,</span> <span class=main>_</span><span class=main>,</span> x<span class=main>)</span> <span class=main>←</span> <span class=bound>effects</span><span class=main>]</span> <span class=main>⦈</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_rangeI><span class=command>lemma</span></span> abs_rangeI<span class=main>:</span> <span class=quoted><span class=quoted>"wf_partial_state <span class=free>s</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>s</span> <span class=main>⟹</span> <span class=main>(</span>abs_range_map <span class=free>v</span> <span class=main>≠</span> None<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_partial_state_def abs_range_map_def abs_ast_variable_section_def list.pred_set
                     numVars_def
           <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_valid_operator_1><span class=command>lemma</span></span> abs_valid_operator_1<span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=free>op</span> <span class=main>⟹</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> ListMem <span class=bound>v</span> abs_ast_variable_section<span class=main>)</span>
   <span class=main>(</span>precondition_of <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>op</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_operator_def wf_operator_def list.pred_set ListMem_iff<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-wf_operator_preD><span class=command>lemma</span></span> wf_operator_preD<span class=main>:</span> <span class=quoted><span class=quoted>"wf_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>cost</span><span class=main>)</span> <span class=main>⟹</span> wf_partial_state <span class=free>pres</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_operator_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_valid_operator_2><span class=command>lemma</span></span> abs_valid_operator_2<span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=free>op</span> <span class=main>⟹</span> 
    list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>y</span><span class=main>.</span> abs_range_map <span class=bound>v</span> <span class=main>=</span> Some <span class=bound>y</span><span class=main>)</span> <span class=main>∧</span> ListMem <span class=bound>a</span> <span class=main>(</span>the <span class=main>(</span>abs_range_map <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
             <span class=main>(</span>precondition_of <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>op</span></span><span class=main><span class=keyword3>,</span></span> 
     <span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> wf_operator_preD <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list.pred_set ListMem_iff abs_ast_operator_def
          <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> abs_rangeI<span class=main><span class=main>[</span></span><span class=operator>simplified</span> not_None_eq<span class=main><span class=main>]</span></span> in_abs_rangeI<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-wf_operator_effE><span class=command>lemma</span></span> wf_operator_effE<span class=main>:</span> <span class=quoted><span class=quoted>"wf_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>cost</span><span class=main>)</span> <span class=main>⟹</span>
          <span class=main>(</span><span class=main>⟦</span>distinct <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span><span class=main>)</span> <span class=free>effs</span><span class=main>)</span><span class=main>;</span>
            <span class=main>⋀</span><span class=bound>epres</span> <span class=bound>x</span> <span class=bound>vp</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>epres</span><span class=main>,</span><span class=bound>x</span><span class=main>,</span><span class=bound>vp</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>∈</span>set <span class=free>effs</span> <span class=main>⟹</span> wf_partial_state <span class=bound>epres</span><span class=main>;</span> 
            <span class=main>⋀</span><span class=bound>epres</span> <span class=bound>x</span> <span class=bound>vp</span> <span class=bound>v</span><span class=main>.</span><span class=main>(</span><span class=bound>epres</span><span class=main>,</span><span class=bound>x</span><span class=main>,</span><span class=bound>vp</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>∈</span>set <span class=free>effs</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>&lt;</span> numVars<span class=main>;</span>
            <span class=main>⋀</span><span class=bound>epres</span> <span class=bound>x</span> <span class=bound>vp</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>epres</span><span class=main>,</span><span class=bound>x</span><span class=main>,</span><span class=bound>vp</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>∈</span>set <span class=free>effs</span> <span class=main>⟹</span> <span class=bound>v</span> <span class=main>&lt;</span> numVals <span class=bound>x</span><span class=main>;</span>
            <span class=main>⋀</span><span class=bound>epres</span> <span class=bound>x</span> <span class=bound>vp</span> <span class=bound>v</span><span class=main>.</span> <span class=main>(</span><span class=bound>epres</span><span class=main>,</span><span class=bound>x</span><span class=main>,</span><span class=bound>vp</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>∈</span>set <span class=free>effs</span> <span class=main>⟹</span> 
                    <span class=keyword1>case</span> <span class=bound>vp</span> <span class=keyword1>of</span> None <span class=main>⇒</span> True <span class=main>|</span> Some <span class=bound>v</span> <span class=main>⇒</span> <span class=bound>v</span><span class=main>&lt;</span>numVals <span class=bound>x</span><span class=main>⟧</span>
             <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span>
           <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> wf_operator_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>
  
<span class=keyword1 id="AST_SAS_Plus_Equivalence-abs_valid_operator_3'"><span class=command>lemma</span></span> abs_valid_operator_3'<span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pre</span><span class=main>,</span> <span class=free>eff</span><span class=main>,</span> <span class=free>cost</span><span class=main>)</span> <span class=main>⟹</span>
     list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> ListMem <span class=bound>v</span> abs_ast_variable_section<span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=free>eff</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list.pred_set ListMem_iff abs_ast_variable_section_def image_def numVars_def
                <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> wf_operator_effE <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_valid_operator_3><span class=command>lemma</span></span> abs_valid_operator_3<span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=free>op</span> <span class=main>⟹</span>
     list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> ListMem <span class=bound>v</span> abs_ast_variable_section<span class=main>)</span> <span class=main>(</span>effect_of <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>op</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_operator_def abs_valid_operator_3'<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-wf_abs_eff><span class=command>lemma</span></span> wf_abs_eff<span class=main>:</span> <span class=quoted><span class=quoted>"wf_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pre</span><span class=main>,</span> <span class=free>eff</span><span class=main>,</span> <span class=free>cost</span><span class=main>)</span> <span class=main>⟹</span> wf_partial_state <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=free>eff</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>elim</span> wf_operator_effE<span class=main><span class=keyword3>,</span></span> <span class=operator>induction</span> <span class=quoted><span class=free>eff</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> wf_partial_state_def image_def o_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  
<span class=keyword1 id="AST_SAS_Plus_Equivalence-abs_valid_operator_4'"><span class=command>lemma</span></span> abs_valid_operator_4'<span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pre</span><span class=main>,</span> <span class=free>eff</span><span class=main>,</span> <span class=free>cost</span><span class=main>)</span> <span class=main>⟹</span>
     list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>abs_range_map <span class=bound>v</span> <span class=main>≠</span> None<span class=main>)</span> <span class=main>∧</span> ListMem <span class=bound>a</span> <span class=main>(</span>the <span class=main>(</span>abs_range_map <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=free>eff</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subst</span> list.pred_set ListMem_iff<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>drule</span> wf_abs_eff<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> abs_rangeI case_prodI2 in_abs_rangeI<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_valid_operator_4><span class=command>lemma</span></span> abs_valid_operator_4<span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=free>op</span> <span class=main>⟹</span>
     list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>y</span><span class=main>.</span> abs_range_map <span class=bound>v</span> <span class=main>=</span> Some <span class=bound>y</span><span class=main>)</span> <span class=main>∧</span> ListMem <span class=bound>a</span> <span class=main>(</span>the <span class=main>(</span>abs_range_map <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
              <span class=main>(</span>effect_of <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> abs_valid_operator_4'
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>op</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_operator_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-consistent_list_set><span class=command>lemma</span></span> consistent_list_set<span class=main>:</span> <span class=quoted><span class=quoted>"wf_partial_state <span class=free>s</span> <span class=main>⟹</span>
   list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=free>s</span><span class=main>)</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list.pred_set wf_partial_state_def eq_key_imp_eq_value <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-abs_valid_operator_5'"><span class=command>lemma</span></span> abs_valid_operator_5'<span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pre</span><span class=main>,</span> <span class=free>eff</span><span class=main>,</span> <span class=free>cost</span><span class=main>)</span> <span class=main>⟹</span>
     list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=free>pre</span><span class=main>)</span> <span class=free>pre</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>drule</span> wf_operator_preD<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro</span> consistent_list_set<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_valid_operator_5><span class=command>lemma</span></span> abs_valid_operator_5<span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=free>op</span> <span class=main>⟹</span>
     list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>(</span>precondition_of <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
              <span class=main>(</span>precondition_of <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> abs_valid_operator_5'
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>op</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_operator_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-consistent_list_set_2><span class=command>lemma</span></span> consistent_list_set_2<span class=main>:</span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span>map fst <span class=free>s</span><span class=main>)</span> <span class=main>⟹</span>
   list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=free>s</span><span class=main>)</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list.pred_set wf_partial_state_def eq_key_imp_eq_value <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-abs_valid_operator_6'"><span class=command>lemma</span></span> abs_valid_operator_6'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pre</span><span class=main>,</span> <span class=free>eff</span><span class=main>,</span> <span class=free>cost</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=free>eff</span><span class=main>)</span><span class=main>)</span>
              <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=free>eff</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"map fst <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=free>eff</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span><span class=main><span class=bound>_</span></span><span class=main>,</span><span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span><span class=main>)</span> <span class=free>eff</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>eff</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>elim</span> wf_operator_effE<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>intro</span> consistent_list_set_2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_valid_operator_6><span class=command>lemma</span></span> abs_valid_operator_6<span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_operator <span class=free>op</span> <span class=main>⟹</span> 
     list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>.</span> list_all <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>a'</span><span class=main>)</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> <span class=bound>v'</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>a'</span><span class=main>)</span> <span class=main>(</span>effect_of <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
              <span class=main>(</span>effect_of <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> abs_valid_operator_6'
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>op</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_operator_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>abs_ast_operator_section</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"nat_sas_plus_operator list"</span></span> 
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>abs_ast_operator_section</span> <span class=main>≡</span> <span class=main>[</span>abs_ast_operator <span class=bound>op</span><span class=main>.</span> op <span class=main>←</span> astδ<span class=main>]</span>"</span></span> 

<span class=keyword1><span class=command>definition</span></span> <span class=entity>abs_prob</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat_sas_plus_problem"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>abs_prob</span> <span class=main>=</span> <span class=main>⦇</span> 
    variables_of <span class=main>=</span> abs_ast_variable_section<span class=main>,</span>
    operators_of <span class=main>=</span> abs_ast_operator_section<span class=main>,</span>
    initial_of <span class=main>=</span> abs_ast_initial_state<span class=main>,</span>
    goal_of <span class=main>=</span> abs_ast_goal<span class=main>,</span>
    range_of <span class=main>=</span> abs_range_map
  <span class=main>⦈</span>"</span></span> 

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>op</span> <span class=main>∈</span> set astδ <span class=main>⟹</span> <span class=main>(</span>is_valid_operator_sas_plus abs_prob<span class=main>)</span> <span class=main>(</span>abs_ast_operator <span class=free>op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>op</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subst</span> is_valid_operator_sas_plus_def Let_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>using</span></span> wf_operators<span class=main>(</span>2<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_prob_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_ast_operator_section_valid><span class=command>lemma</span></span> abs_ast_operator_section_valid<span class=main>:</span> 
   <span class=quoted><span class=quoted>"list_all <span class=main>(</span>is_valid_operator_sas_plus abs_prob<span class=main>)</span> abs_ast_operator_section"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> abs_ast_operator_section_def list.pred_set<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-abs_prob_valid><span class=command>lemma</span></span> abs_prob_valid<span class=main>:</span> <span class=quoted><span class=quoted>"is_valid_problem_sas_plus abs_prob"</span></span>
  <span class=keyword1><span class=command>using</span></span> valid_abs_goal_1 valid_abs_goal_2 valid_abs_init_1 is_valid_vars_2
        abs_ast_operator_section_valid<span class=main>[</span><span class=operator>unfolded</span> abs_prob_def<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_valid_problem_sas_plus_def Let_def ListMem_iff abs_prob_def<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>abs_ast_plan</span> 
  <span class=main>::</span> <span class=quoted><span class=quoted>" SASP_Semantics.plan <span class=main>⇒</span> nat_sas_plus_plan"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>abs_ast_plan</span> <span class=free><span class=bound><span class=entity>πs</span></span></span> 
    <span class=main>≡</span> map <span class=main>(</span>abs_ast_operator <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_operator<span class=main>)</span> <span class=free><span class=bound><span class=entity>πs</span></span></span>"</span></span> 

<span class=keyword1 id=AST_SAS_Plus_Equivalence-std_then_implici_effs><span class=command>lemma</span></span> std_then_implici_effs<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"is_standard_operator' <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>⟹</span> implicit_pres <span class=free>effs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>effs</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_standard_operator'_def implicit_pres_def is_standard_effect'_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"enabled <span class=free>π</span> <span class=free>s</span> <span class=main>⟹</span> lookup_operator <span class=free>π</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>⟹</span>
       is_standard_operator' <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>⟹</span>
       <span class=main>(</span>filter <span class=main>(</span>eff_enabled <span class=free>s</span><span class=main>)</span> <span class=free>effs</span><span class=main>)</span> <span class=main>=</span> <span class=free>effs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enabled_def is_standard_operator'_def eff_enabled_def is_standard_effect'_def filter_id_conv list.pred_set<span class=main>)</span>
  
<span class=keyword1 id=AST_SAS_Plus_Equivalence-effs_eq_abs_effs><span class=command>lemma</span></span> effs_eq_abs_effs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>effect_of <span class=main>(</span>abs_ast_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> 
                           <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span><span class=bound>x</span><span class=main>,</span><span class=main><span class=bound>_</span></span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span><span class=main>)</span> <span class=free>effs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_operator_def
           <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits prod.splits<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-exect_eq_abs_execute><span class=command>lemma</span></span> exect_eq_abs_execute<span class=main>:</span>
      <span class=quoted><span class=quoted>"<span class=main>⟦</span>enabled <span class=free>π</span> <span class=free>s</span><span class=main>;</span> lookup_operator <span class=free>π</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>preconds</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>;</span>
        is_standard_operator'<span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>preconds</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span>
       execute <span class=free>π</span> <span class=free>s</span> <span class=main>=</span> <span class=main>(</span>execute_operator_sas_plus <span class=free>s</span> <span class=main>(</span><span class=main>(</span>abs_ast_operator <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_operator<span class=main>)</span> <span class=free>π</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> effs_eq_abs_effs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> execute_def execute_operator_sas_plus_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-enabled_then_sas_applicable><span class=command>lemma</span></span> enabled_then_sas_applicable<span class=main>:</span>
  <span class=quoted><span class=quoted>"enabled <span class=free>π</span> <span class=free>s</span> <span class=main>⟹</span> SAS_Plus_Representation.is_operator_applicable_in <span class=free>s</span> <span class=main>(</span><span class=main>(</span>abs_ast_operator <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_operator<span class=main>)</span> <span class=free>π</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsuming_states_def enabled_def lookup_operator_def
                     SAS_Plus_Representation.is_operator_applicable_in_def abs_ast_operator_def                     
           <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits prod.splits<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-path_to_then_exec_serial><span class=command>lemma</span></span> path_to_then_exec_serial<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>π</span><span class=main>∈</span>set <span class=free>πs</span><span class=main>.</span> lookup_operator <span class=bound>π</span> <span class=main>≠</span> None <span class=main>⟹</span>
        path_to <span class=free>s</span> <span class=free>πs</span> <span class=free>s'</span> <span class=main>⟹</span>
        <span class=free>s'</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> execute_serial_plan_sas_plus <span class=free>s</span> <span class=main>(</span>abs_ast_plan <span class=free>πs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>πs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>πs</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> exect_eq_abs_execute abs_ast_plan_def lookup_Some_inδ no_cond_effs
              <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> enabled_then_sas_applicable<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> execute_serial_plan_sas_plus_def abs_ast_plan_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-map_of_eq_None_iff><span class=command>lemma</span></span> map_of_eq_None_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>None <span class=main>=</span> map_of <span class=free>xys</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>∉</span> fst <span class=main>`</span> <span class=main>(</span>set <span class=free>xys</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xys</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"I <span class=main>=</span> abs_ast_initial_state"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>intro</span> HOL.ext<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_of_eq_None_iff set_map<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> I_def abs_ast_initial_state_def map_of_zip_Some
           <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> map_of_SomeD<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>π</span> <span class=main>∈</span> set <span class=free>πs</span><span class=main>.</span> lookup_operator <span class=bound>π</span> <span class=main>≠</span> None <span class=main>⟹</span>
          <span class=free>op</span><span class=main>∈</span>set <span class=main>(</span>abs_ast_plan <span class=free>πs</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>op</span> <span class=main>∈</span> set abs_ast_operator_section"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>πs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> abs_ast_plan_def abs_ast_operator_section_def lookup_Some_inδ<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-path_to_then_lookup_Some><span class=command>lemma</span></span> path_to_then_lookup_Some<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>s'</span><span class=main>∈</span>G<span class=main>.</span> path_to <span class=free>s</span> <span class=free>πs</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>π</span> <span class=main>∈</span> set <span class=free>πs</span><span class=main>.</span> lookup_operator <span class=bound>π</span> <span class=main>≠</span> None<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>πs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enabled_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-valid_plan_then_lookup_Some><span class=command>lemma</span></span> valid_plan_then_lookup_Some<span class=main>:</span> <span class=quoted><span class=quoted>"valid_plan <span class=free>πs</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>π</span> <span class=main>∈</span> set <span class=free>πs</span><span class=main>.</span> lookup_operator <span class=bound>π</span> <span class=main>≠</span> None<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> path_to_then_lookup_Some
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> valid_plan_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>theorem</span></span> valid_plan_then_is_serial_sol<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"valid_plan <span class=free>πs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_serial_solution_for_problem abs_prob <span class=main>(</span>abs_ast_plan <span class=free>πs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> valid_plan_then_lookup_Some<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_serial_solution_for_problem_def valid_plan_def initial_of_def
                       abs_prob_def abs_ast_goal_def G_def subsuming_states_def list_all_iff
                       ListMem_iff map_le_trans path_to_then_exec_serial
           <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> sas_plus_problem.select_defs<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Translating SAS+ represnetation to Fast-Downward's›</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>lookup_action</span><span class=main>::</span> <span class=quoted><span class=quoted>"nat_sas_plus_operator <span class=main>⇒</span> ast_operator option"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>lookup_action</span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>≡</span>
    find <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>pres</span><span class=main>,</span> <span class=bound>effs</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> precondition_of <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>=</span> <span class=bound>pres</span> <span class=main>∧</span>
                               map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span><span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>[]</span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> None<span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>effect_of <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=bound>effs</span><span class=main>)</span>
         astδ"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-find_Some><span class=command>lemma</span></span> find_Some<span class=main>:</span> <span class=quoted><span class=quoted>"find <span class=free>P</span> <span class=free>xs</span> <span class=main>=</span> Some <span class=free>x</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> find_Some_iff<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-distinct_find><span class=command>lemma</span></span> distinct_find<span class=main>:</span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>⟹</span> find <span class=main>(</span><span class=main>λ</span><span class=bound>x'</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x'</span> <span class=main>=</span> <span class=free>f</span> <span class=free>x</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> Some <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> image_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-lookup_operator_find><span class=command>lemma</span></span> lookup_operator_find<span class=main>:</span> <span class=quoted><span class=quoted>"lookup_operator <span class=free>nme</span> <span class=main>=</span> find <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> fst <span class=bound>op</span> <span class=main>=</span> <span class=free>nme</span><span class=main>)</span> astδ"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> lookup_operator_def <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> find <span class=bound>x</span> astδ<span class=main>)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-lookup_operator_works_1><span class=command>lemma</span></span> lookup_operator_works_1<span class=main>:</span> <span class=quoted><span class=quoted>"lookup_action <span class=free>op</span> <span class=main>=</span> Some <span class=free>π'</span> <span class=main>⟹</span> lookup_operator <span class=main>(</span>fst <span class=free>π'</span><span class=main>)</span> <span class=main>=</span> Some <span class=free>π'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> wf_operators<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> lookup_operator_find lookup_action_def <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> find_Some <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> distinct_find<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-lookup_operator_works_2><span class=command>lemma</span></span> lookup_operator_works_2<span class=main>:</span> 
  <span class=quoted><span class=quoted>"lookup_action <span class=main>(</span>abs_ast_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>name'</span><span class=main>,</span> <span class=free>pres'</span><span class=main>,</span> <span class=free>effs'</span><span class=main>,</span> <span class=free>layer'</span><span class=main>)</span>
   <span class=main>⟹</span> <span class=free>pres</span> <span class=main>=</span> <span class=free>pres'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> lookup_action_def abs_ast_operator_def <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> find_Some<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"is_standard_operator' <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>⟹</span>
       map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>v</span><span class=main>,</span><span class=bound>a</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>[]</span><span class=main>,</span> <span class=bound>v</span><span class=main>,</span> None<span class=main>,</span> <span class=bound>a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>effect_of <span class=main>(</span>abs_ast_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>effs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>effs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_standard_operator'_def  abs_ast_operator_def is_standard_effect'_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-lookup_operator_works_3><span class=command>lemma</span></span> lookup_operator_works_3<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_standard_operator' <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>∈</span> set astδ <span class=main>⟹</span>
   lookup_action <span class=main>(</span>abs_ast_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>name'</span><span class=main>,</span> <span class=free>pres'</span><span class=main>,</span> <span class=free>effs'</span><span class=main>,</span> <span class=free>layer'</span><span class=main>)</span>
   <span class=main>⟹</span> <span class=free>effs</span> <span class=main>=</span> <span class=free>effs'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_standard_operator'_def lookup_action_def <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> find_Some<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-mem_find_Some><span class=command>lemma</span></span> mem_find_Some<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>x</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x'</span><span class=main>.</span> find <span class=free>P</span> <span class=free>xs</span> <span class=main>=</span> Some <span class=bound>x'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"precondition_of <span class=main>(</span>abs_ast_operator <span class=main>(</span><span class=free>x1</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>aa</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_ast_operator_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-std_lookup_action><span class=command>lemma</span></span> std_lookup_action<span class=main>:</span> <span class=quoted><span class=quoted>"is_standard_operator' <span class=free>ast_op</span> <span class=main>⟹</span> <span class=free>ast_op</span> <span class=main>∈</span> set astδ <span class=main>⟹</span> 
                          <span class=main>∃</span><span class=bound>ast_op'</span><span class=main>.</span> lookup_action <span class=main>(</span>abs_ast_operator <span class=free>ast_op</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>ast_op'</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> lookup_action_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>intro</span> mem_find_Some<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> o_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_applicable_then_enabled_1><span class=command>lemma</span></span> is_applicable_then_enabled_1<span class=main>:</span>
      <span class=quoted><span class=quoted>"<span class=free>ast_op</span> <span class=main>∈</span> set astδ <span class=main>⟹</span>
       <span class=main>∃</span><span class=bound>ast_op'</span><span class=main>.</span> lookup_operator <span class=main>(</span><span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action <span class=keyword1>o</span> abs_ast_operator<span class=main>)</span> <span class=free>ast_op</span><span class=main>)</span> <span class=main>=</span> Some <span class=bound>ast_op'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> lookup_operator_works_1 std_lookup_action no_cond_effs
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-lookup_action_Some_in_δ><span class=command>lemma</span></span> lookup_action_Some_in_δ<span class=main>:</span> <span class=quoted><span class=quoted>"lookup_action <span class=free>op</span> <span class=main>=</span> Some <span class=free>ast_op</span> <span class=main>⟹</span> <span class=free>ast_op</span> <span class=main>∈</span> set astδ"</span></span>
  <span class=keyword1><span class=command>using</span></span> lookup_operator_works_1 lookup_Some_inδ <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-lookup_operator_eq_name><span class=command>lemma</span></span> lookup_operator_eq_name<span class=main>:</span> <span class=quoted><span class=quoted>"lookup_operator <span class=free>name</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>name'</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>name</span> <span class=main>=</span> <span class=free>name'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> lookup_operator_wf<span class=main>(</span>2<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-eq_name_eq_pres><span class=command>lemma</span></span> eq_name_eq_pres<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>∈</span> set astδ <span class=main>⟹</span> <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres'</span><span class=main>,</span> <span class=free>effs'</span><span class=main>,</span> <span class=free>layer'</span><span class=main>)</span> <span class=main>∈</span> set astδ
  <span class=main>⟹</span> <span class=free>pres</span> <span class=main>=</span> <span class=free>pres'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span>  eq_key_imp_eq_value<span class=main>[</span><span class=operator>OF</span> wf_operators<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-eq_name_eq_effs><span class=command>lemma</span></span> eq_name_eq_effs<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>name</span> <span class=main>=</span> <span class=free>name'</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>∈</span> set astδ <span class=main>⟹</span> <span class=main>(</span><span class=free>name'</span><span class=main>,</span> <span class=free>pres'</span><span class=main>,</span> <span class=free>effs'</span><span class=main>,</span> <span class=free>layer'</span><span class=main>)</span> <span class=main>∈</span> set astδ
  <span class=main>⟹</span> <span class=free>effs</span> <span class=main>=</span> <span class=free>effs'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> eq_key_imp_eq_value<span class=main>[</span><span class=operator>OF</span> wf_operators<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_applicable_then_subsumes><span class=command>lemma</span></span> is_applicable_then_subsumes<span class=main>:</span>
      <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> valid_states <span class=main>⟹</span> 
       SAS_Plus_Representation.is_operator_applicable_in <span class=free>s</span> <span class=main>(</span>abs_ast_operator <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
       <span class=free>s</span> <span class=main>∈</span> subsuming_states <span class=main>(</span>map_of <span class=free>pres</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subsuming_states_def SAS_Plus_Representation.is_operator_applicable_in_def
                  abs_ast_operator_def<span class=main>)</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-eq_name_eq_pres'"><span class=command>lemma</span></span> eq_name_eq_pres'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>s</span> <span class=main>∈</span> valid_states <span class=main>;</span> is_standard_operator' <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>;</span> <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>∈</span> set astδ <span class=main>;</span>
    lookup_operator <span class=main>(</span><span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action <span class=keyword1>o</span> abs_ast_operator<span class=main>)</span> <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>name'</span><span class=main>,</span> <span class=free>pres'</span><span class=main>,</span> <span class=free>effs'</span><span class=main>,</span> <span class=free>layer'</span><span class=main>)</span><span class=main>⟧</span>
    <span class=main>⟹</span> <span class=free>pres</span> <span class=main>=</span> <span class=free>pres'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> lookup_operator_eq_name lookup_operator_works_2      
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> std_lookup_action
                <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> eq_name_eq_pres<span class=main><span class=main>[</span></span><span class=operator>OF</span> lookup_action_Some_in_δ lookup_Some_inδ<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_applicable_then_enabled_2><span class=command>lemma</span></span> is_applicable_then_enabled_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>s</span> <span class=main>∈</span> valid_states <span class=main>;</span> <span class=free>ast_op</span> <span class=main>∈</span> set astδ <span class=main>;</span>
    SAS_Plus_Representation.is_operator_applicable_in <span class=free>s</span> <span class=main>(</span>abs_ast_operator <span class=free>ast_op</span><span class=main>)</span><span class=main>;</span>
    lookup_operator <span class=main>(</span><span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action <span class=keyword1>o</span> abs_ast_operator<span class=main>)</span> <span class=free>ast_op</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>⟧</span>
    <span class=main>⟹</span> <span class=free>s</span><span class=main>∈</span>subsuming_states <span class=main>(</span>map_of <span class=free>pres</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>ast_op</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> eq_name_eq_pres' is_applicable_then_subsumes no_cond_effs
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  
<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_applicable_then_enabled_3><span class=command>lemma</span></span> is_applicable_then_enabled_3<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>s</span> <span class=main>∈</span> valid_states<span class=main>;</span>
    lookup_operator <span class=main>(</span><span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action <span class=keyword1>o</span> abs_ast_operator<span class=main>)</span> <span class=free>ast_op</span><span class=main>)</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>s</span><span class=main>∈</span>subsuming_states <span class=main>(</span>map_of <span class=main>(</span>implicit_pres <span class=free>effs</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>ast_op</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> no_cond_effs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> std_then_implici_effs std_lookup_action lookup_Some_inδ
           <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> subsuming_states_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_applicable_then_enabled><span class=command>lemma</span></span> is_applicable_then_enabled<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>s</span> <span class=main>∈</span> valid_states<span class=main>;</span> <span class=free>ast_op</span> <span class=main>∈</span> set astδ<span class=main>;</span>
   SAS_Plus_Representation.is_operator_applicable_in <span class=free>s</span> <span class=main>(</span>abs_ast_operator <span class=free>ast_op</span><span class=main>)</span><span class=main>⟧</span>
   <span class=main>⟹</span> enabled <span class=main>(</span><span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action <span class=keyword1>o</span> abs_ast_operator<span class=main>)</span> <span class=free>ast_op</span><span class=main>)</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_applicable_then_enabled_1 is_applicable_then_enabled_2 is_applicable_then_enabled_3
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enabled_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits<span class=main>)</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-eq_name_eq_effs'"><span class=command>lemma</span></span> eq_name_eq_effs'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"lookup_operator <span class=main>(</span><span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action <span class=keyword1>o</span> abs_ast_operator<span class=main>)</span> <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
             Some <span class=main>(</span><span class=free>name'</span><span class=main>,</span> <span class=free>pres'</span><span class=main>,</span> <span class=free>effs'</span><span class=main>,</span> <span class=free>layer'</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"is_standard_operator' <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>∈</span> set astδ"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> valid_states"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>effs</span> <span class=main>=</span> <span class=free>effs'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> std_lookup_action<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>,</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> lookup_operator_works_3<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>2<span class=main><span class=main><span class=main>,</span></span></span>3<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>]</span></span> 
                 eq_name_eq_effs<span class=main><span class=main>[</span></span><span class=operator>OF</span> lookup_operator_eq_name lookup_action_Some_in_δ lookup_Some_inδ<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-std_eff_enabled'"><span class=command>lemma</span></span> std_eff_enabled'<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"is_standard_operator' <span class=main>(</span><span class=free>name</span><span class=main>,</span> <span class=free>pres</span><span class=main>,</span> <span class=free>effs</span><span class=main>,</span> <span class=free>layer</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>s</span> <span class=main>∈</span> valid_states <span class=main>⟹</span> <span class=main>(</span>filter <span class=main>(</span>eff_enabled <span class=free>s</span><span class=main>)</span> <span class=free>effs</span><span class=main>)</span> <span class=main>=</span> <span class=free>effs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>effs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_standard_operator'_def is_standard_effect'_def eff_enabled_def subsuming_states_def<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-execute_abs><span class=command>lemma</span></span> execute_abs<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>s</span> <span class=main>∈</span> valid_states<span class=main>;</span> <span class=free>ast_op</span> <span class=main>∈</span> set astδ<span class=main>;</span>
    SAS_Plus_Representation.is_operator_applicable_in <span class=free>s</span> <span class=main>(</span>abs_ast_operator <span class=free>ast_op</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span>
    execute <span class=main>(</span><span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action <span class=keyword1>o</span> abs_ast_operator<span class=main>)</span> <span class=free>ast_op</span><span class=main>)</span> <span class=free>s</span> <span class=main>=</span>
      execute_operator_sas_plus <span class=free>s</span> <span class=main>(</span>abs_ast_operator <span class=free>ast_op</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> no_cond_effs
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>ast_op</span></span><span class=main>)</span>
    <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> execute_def execute_operator_sas_plus_def effs_eq_abs_effs
               <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> is_applicable_then_enabled_1 eq_name_eq_effs'<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> o_def<span class=main><span class=main>]</span></span>
               <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>sat_preconds_as</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sat_preconds_as</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> True"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>sat_preconds_as</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=main>=</span> 
     <span class=main>(</span>SAS_Plus_Representation.is_operator_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>∧</span>
      <span class=free>sat_preconds_as</span> <span class=main>(</span>execute_operator_sas_plus <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-exec_serial_then_path_to'"><span class=command>lemma</span></span> exec_serial_then_path_to'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>s</span> <span class=main>∈</span> valid_states<span class=main>;</span>
   <span class=main>∀</span><span class=bound>op</span><span class=main>∈</span>set <span class=free>ops</span><span class=main>.</span> <span class=main>∃</span><span class=bound>ast_op</span><span class=main>∈</span> set astδ<span class=main>.</span> <span class=bound>op</span> <span class=main>=</span> abs_ast_operator <span class=bound>ast_op</span><span class=main>;</span>
   <span class=main>(</span>sat_preconds_as <span class=free>s</span> <span class=free>ops</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span>
   path_to <span class=free>s</span> <span class=main>(</span>map <span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action<span class=main>)</span> <span class=free>ops</span><span class=main>)</span> <span class=main>(</span>execute_serial_plan_sas_plus <span class=free>s</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>a</span> <span class=skolem>ops</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>using</span></span> execute_abs is_applicable_then_enabled execute_preserves_valid
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>rem_condless_ops</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rem_condless_ops</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>rem_condless_ops</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span> <span class=main>=</span> 
     <span class=main>(</span><span class=keyword1>if</span> SAS_Plus_Representation.is_operator_applicable_in <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=keyword1>then</span>
      <span class=free><span class=bound><span class=entity>op</span></span></span> <span class=main>#</span> <span class=main>(</span><span class=free>rem_condless_ops</span> <span class=main>(</span>execute_operator_sas_plus <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>op</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ops</span></span></span><span class=main>)</span>
      <span class=keyword1>else</span> <span class=main>[]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-exec_rem_consdless><span class=command>lemma</span></span> exec_rem_consdless<span class=main>:</span> <span class=quoted><span class=quoted>"execute_serial_plan_sas_plus <span class=free>s</span> <span class=main>(</span>rem_condless_ops <span class=free>s</span> <span class=free>ops</span><span class=main>)</span> <span class=main>=</span> execute_serial_plan_sas_plus <span class=free>s</span> <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-rem_conless_sat><span class=command>lemma</span></span> rem_conless_sat<span class=main>:</span> <span class=quoted><span class=quoted>"sat_preconds_as <span class=free>s</span> <span class=main>(</span>rem_condless_ops <span class=free>s</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-set_rem_condlessD><span class=command>lemma</span></span> set_rem_condlessD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=main>(</span>rem_condless_ops <span class=free>s</span> <span class=free>ops</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> set <span class=free>ops</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ops</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-exec_serial_then_path_to><span class=command>lemma</span></span> exec_serial_then_path_to<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>s</span> <span class=main>∈</span> valid_states<span class=main>;</span>
   <span class=main>∀</span><span class=bound>op</span><span class=main>∈</span>set <span class=free>ops</span><span class=main>.</span> <span class=main>∃</span><span class=bound>ast_op</span><span class=main>∈</span> set astδ<span class=main>.</span> <span class=bound>op</span> <span class=main>=</span> abs_ast_operator <span class=bound>ast_op</span><span class=main>⟧</span> <span class=main>⟹</span>
   path_to <span class=free>s</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span>map <span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action<span class=main>)</span><span class=main>)</span> <span class=keyword1>o</span> rem_condless_ops <span class=free>s</span><span class=main>)</span> <span class=free>ops</span><span class=main>)</span>
             <span class=main>(</span>execute_serial_plan_sas_plus <span class=free>s</span> <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span>  rem_conless_sat
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> set_rem_condlessD
                <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> exec_serial_then_path_to'
                          <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> s <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=free>s</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> ops <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted>"rem_condless_ops <span class=free>s</span> <span class=free>ops</span>"</span></span><span class=main><span class=main>,</span></span>
                           <span class=operator>unfolded</span> exec_rem_consdless<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_serial_solution_then_abstracted><span class=command>lemma</span></span> is_serial_solution_then_abstracted<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_serial_solution_for_problem abs_prob <span class=free>ops</span>
   <span class=main>⟹</span> <span class=main>∀</span><span class=bound>op</span><span class=main>∈</span>set <span class=free>ops</span><span class=main>.</span> <span class=main>∃</span><span class=bound>ast_op</span><span class=main>∈</span> set astδ<span class=main>.</span> <span class=bound>op</span> <span class=main>=</span> abs_ast_operator <span class=bound>ast_op</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_serial_solution_for_problem_def abs_prob_def Let_def list.pred_set
                    ListMem_iff abs_ast_operator_section_def
          <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>

<span class=keyword1 id="AST_SAS_Plus_Equivalence-lookup_operator_works_1'"><span class=command>lemma</span></span> lookup_operator_works_1'<span class=main>:</span> <span class=quoted><span class=quoted>"lookup_action <span class=free>op</span> <span class=main>=</span> Some <span class=free>π'</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>op</span><span class=main>.</span> lookup_operator <span class=main>(</span>fst <span class=free>π'</span><span class=main>)</span> <span class=main>=</span> <span class=bound>op</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> lookup_operator_works_1 <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_serial_sol_then_valid_plan_1><span class=command>lemma</span></span> is_serial_sol_then_valid_plan_1<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_serial_solution_for_problem abs_prob <span class=free>ops</span><span class=main>;</span>
   <span class=free>π</span> <span class=main>∈</span> set <span class=main>(</span><span class=main>(</span>map <span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action<span class=main>)</span> <span class=keyword1>o</span> rem_condless_ops I<span class=main>)</span> <span class=free>ops</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span>
  lookup_operator <span class=free>π</span> <span class=main>≠</span> None"</span></span>
  <span class=keyword1><span class=command>using</span></span> std_lookup_action lookup_operator_works_1 no_cond_effs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> set_rem_condlessD is_serial_solution_then_abstracted
                <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> valid_plan_def list.pred_set ListMem_iff<span class=main>)</span>

<span class=keyword1 id=AST_SAS_Plus_Equivalence-is_serial_sol_then_valid_plan_2><span class=command>lemma</span></span> is_serial_sol_then_valid_plan_2<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_serial_solution_for_problem abs_prob <span class=free>ops</span><span class=main>⟧</span> <span class=main>⟹</span>
   <span class=main>(</span><span class=main>∃</span><span class=bound>s'</span><span class=main>∈</span>G<span class=main>.</span> path_to I <span class=main>(</span><span class=main>(</span>map <span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action<span class=main>)</span> <span class=keyword1>o</span> rem_condless_ops I<span class=main>)</span> <span class=free>ops</span><span class=main>)</span> <span class=bound>s'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> I_valid
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> path_to_pres_valid exec_serial_then_path_to
                <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> bexI<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted>"execute_serial_plan_sas_plus I <span class=free>ops</span>"</span></span><span class=main><span class=main>]</span></span>
                <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> is_serial_solution_then_abstracted
                <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list.pred_set ListMem_iff abs_ast_operator_section_def
                      G_def subsuming_states_def is_serial_solution_for_problem_def
                      abs_prob_def abs_ast_goal_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> ast_problem
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>decode_abs_plan</span> <span class=main>≡</span> <span class=main>(</span>map <span class=main>(</span>fst <span class=keyword1>o</span> the <span class=keyword1>o</span> lookup_action<span class=main>)</span> <span class=keyword1>o</span> rem_condless_ops I<span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>theorem</span></span> is_serial_sol_then_valid_plan<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_serial_solution_for_problem abs_prob <span class=free>ops</span><span class=main>⟧</span> <span class=main>⟹</span>
   valid_plan <span class=main>(</span>decode_abs_plan <span class=free>ops</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_serial_sol_then_valid_plan_1 is_serial_sol_then_valid_plan_2
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> valid_plan_def decode_abs_plan_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=Set2_Join_RBT><div class=head><h1>Theory Set2_Join_RBT</h1></div><pre class=source><span class=comment1>(*
  Author: Tobias Nipkow 
*)</span>

<span class=comment1>(*
  Author: Mohammad Abdulaziz, copied it from src/HOL/Data_Structures to extend the global interpretation
*)</span>
<span class=comment1>(*&lt;*)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Join-Based Implementation of Sets via RBTs"</span></span>

<span class=keyword1><span class=command>theory</span></span> Set2_Join_RBT
<span class=keyword2><span class=keyword>imports</span></span>
  <span class=quoted>"<a href=../../HOL/HOL-Data_Structures/Set2_Join.html>HOL-Data_Structures.Set2_Join</a>"</span>
  <span class=quoted>"<a href=../../HOL/HOL-Data_Structures/RBT_Set.html>HOL-Data_Structures.RBT_Set</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Code"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
Function <span class=antiquoted><span class=raw_text><span class=operator>‹</span>joinL›</span></span> joins two trees (and an element).
Precondition: <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>prop</span><span class=hidden>&gt;</span></span><span class=quoted>‹bheight <span class=free>l</span> <span class=main>≤</span> bheight <span class=free>r</span>›</span></span>.
Method:
Descend along the left spine of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>r›</span></span>
until you find a subtree with the same <span class=antiquoted><span class=raw_text><span class=operator>‹</span>bheight›</span></span> as <span class=antiquoted><span class=raw_text><span class=operator>‹</span>l›</span></span>,
then combine them into a new red node.
›</span></span>
<span class=keyword1><span class=command>fun</span></span> <span class=entity>joinL</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> rbt <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> rbt <span class=main>⇒</span> <span class=tfree>'a</span> rbt"</span></span> <span class=keyword2><span class=keyword>where</span></span>
<span class=quoted><span class=quoted>"<span class=free>joinL</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> bheight <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>≥</span> bheight <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=keyword1>then</span> R <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span>
   <span class=keyword1>else</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=keyword1>of</span>
     B <span class=bound>l'</span> <span class=bound>x'</span> <span class=bound>r'</span> <span class=main>⇒</span> baliL <span class=main>(</span><span class=free>joinL</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=bound>l'</span><span class=main>)</span> <span class=bound>x'</span> <span class=bound>r'</span> <span class=main>|</span>
     R <span class=bound>l'</span> <span class=bound>x'</span> <span class=bound>r'</span> <span class=main>⇒</span> R <span class=main>(</span><span class=free>joinL</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=bound>l'</span><span class=main>)</span> <span class=bound>x'</span> <span class=bound>r'</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>joinR</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> rbt <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> rbt <span class=main>⇒</span> <span class=tfree>'a</span> rbt"</span></span> <span class=keyword2><span class=keyword>where</span></span>
<span class=quoted><span class=quoted>"<span class=free>joinR</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> bheight <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>≤</span> bheight <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=keyword1>then</span> R <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span>
   <span class=keyword1>else</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>of</span>
     B <span class=bound>l'</span> <span class=bound>x'</span> <span class=bound>r'</span> <span class=main>⇒</span> baliR <span class=bound>l'</span> <span class=bound>x'</span> <span class=main>(</span><span class=free>joinR</span> <span class=bound>r'</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span> <span class=main>|</span>
     R <span class=bound>l'</span> <span class=bound>x'</span> <span class=bound>r'</span> <span class=main>⇒</span> R <span class=bound>l'</span> <span class=bound>x'</span> <span class=main>(</span><span class=free>joinR</span> <span class=bound>r'</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>join</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> rbt <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> rbt <span class=main>⇒</span> <span class=tfree>'a</span> rbt"</span></span> <span class=keyword2><span class=keyword>where</span></span>
<span class=quoted><span class=quoted>"<span class=free>join</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> bheight <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>&gt;</span> bheight <span class=free><span class=bound><span class=entity>r</span></span></span>
   <span class=keyword1>then</span> paint Black <span class=main>(</span>joinR <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span>
   <span class=keyword1>else</span> <span class=keyword1>if</span> bheight <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>&lt;</span> bheight <span class=free><span class=bound><span class=entity>r</span></span></span>
   <span class=keyword1>then</span> paint Black <span class=main>(</span>joinL <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span>
   <span class=keyword1>else</span> B <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>declare</span></span> joinL.simps<span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>]</span>
<span class=keyword1><span class=command>declare</span></span> joinR.simps<span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>]</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Properties"</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>"Color and height invariants"</span></span>

<span class=keyword1 id=Set2_Join_RBT-invc2_joinL><span class=command>lemma</span></span> invc2_joinL<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=main>⟦</span> invc <span class=free>l</span><span class=main>;</span> invc <span class=free>r</span><span class=main>;</span> bheight <span class=free>l</span> <span class=main>≤</span> bheight <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  invc2 <span class=main>(</span>joinL <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span>
  <span class=main>∧</span> <span class=main>(</span>bheight <span class=free>l</span> <span class=main>≠</span> bheight <span class=free>r</span> <span class=main>∧</span> color <span class=free>r</span> <span class=main>=</span> Black <span class=main>⟶</span> invc<span class=main>(</span>joinL <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinL.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> invc_baliL invc2I joinL.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits if_splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-invc2_joinR><span class=command>lemma</span></span> invc2_joinR<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> invc <span class=free>l</span><span class=main>;</span> invh <span class=free>l</span><span class=main>;</span> invc <span class=free>r</span><span class=main>;</span> invh <span class=free>r</span><span class=main>;</span> bheight <span class=free>l</span> <span class=main>≥</span> bheight <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  invc2 <span class=main>(</span>joinR <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span>
  <span class=main>∧</span> <span class=main>(</span>bheight <span class=free>l</span> <span class=main>≠</span> bheight <span class=free>r</span> <span class=main>∧</span> color <span class=free>l</span> <span class=main>=</span> Black <span class=main>⟶</span> invc<span class=main>(</span>joinR <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinR.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> invc_baliR invc2I joinR.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits if_splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-bheight_joinL><span class=command>lemma</span></span> bheight_joinL<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> invh <span class=free>l</span><span class=main>;</span> invh <span class=free>r</span><span class=main>;</span> bheight <span class=free>l</span> <span class=main>≤</span> bheight <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span> bheight <span class=main>(</span>joinL <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> bheight <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinL.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bheight_baliL joinL.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.split<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-invh_joinL><span class=command>lemma</span></span> invh_joinL<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> invh <span class=free>l</span><span class=main>;</span>  invh <span class=free>r</span><span class=main>;</span>  bheight <span class=free>l</span> <span class=main>≤</span> bheight <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span> invh <span class=main>(</span>joinL <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinL.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> invh_baliL bheight_joinL joinL.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.split color.split<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-bheight_baliR><span class=command>lemma</span></span> bheight_baliR<span class=main>:</span>
  <span class=quoted><span class=quoted>"bheight <span class=free>l</span> <span class=main>=</span> bheight <span class=free>r</span> <span class=main>⟹</span> bheight <span class=main>(</span>baliR <span class=free>l</span> <span class=free>a</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>bheight <span class=free>l</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>l</span><span class=main>,</span><span class=free>a</span><span class=main>,</span><span class=free>r</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> baliR.cases<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Set2_Join_RBT-bheight_joinR><span class=command>lemma</span></span> bheight_joinR<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> invh <span class=free>l</span><span class=main>;</span>  invh <span class=free>r</span><span class=main>;</span>  bheight <span class=free>l</span> <span class=main>≥</span> bheight <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span> bheight <span class=main>(</span>joinR <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> bheight <span class=free>l</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinR.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bheight_baliR joinR.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.split<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-invh_joinR><span class=command>lemma</span></span> invh_joinR<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> invh <span class=free>l</span><span class=main>;</span> invh <span class=free>r</span><span class=main>;</span> bheight <span class=free>l</span> <span class=main>≥</span> bheight <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span> invh <span class=main>(</span>joinR <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinR.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> invh_baliR bheight_joinR joinR.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span>
        <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.split color.split<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* unused *)</span>
<span class=keyword1 id=Set2_Join_RBT-rbt_join><span class=command>lemma</span></span> rbt_join<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> invc <span class=free>l</span><span class=main>;</span> invh <span class=free>l</span><span class=main>;</span> invc <span class=free>r</span><span class=main>;</span> invh <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span> rbt<span class=main>(</span>join <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> invc2_joinL invc2_joinR invh_joinL invh_joinR invh_paint rbt_def
    color_paint_Black join_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹To make sure the the black height is not increased unnecessarily:›</span></span>

<span class=keyword1 id=Set2_Join_RBT-bheight_paint_Black><span class=command>lemma</span></span> bheight_paint_Black<span class=main>:</span> <span class=quoted><span class=quoted>"bheight<span class=main>(</span>paint Black <span class=free>t</span><span class=main>)</span> <span class=main>≤</span> bheight <span class=free>t</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>t</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> rbt <span class=free>l</span><span class=main>;</span> rbt <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span> bheight<span class=main>(</span>join <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>≤</span> max <span class=main>(</span>bheight <span class=free>l</span><span class=main>)</span> <span class=main>(</span>bheight <span class=free>r</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> bheight_paint_Black<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"joinL <span class=free>l</span> <span class=free>x</span> <span class=free>r</span>"</span></span><span class=main>]</span> bheight_paint_Black<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"joinR <span class=free>l</span> <span class=free>x</span> <span class=free>r</span>"</span></span><span class=main>]</span>
  bheight_joinL<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>r</span></span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> bheight_joinR<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>r</span></span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> max_def rbt_def join_def<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>"Inorder properties"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"Currently unused. Instead <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>const</span><span class=hidden>&gt;</span></span>‹set_tree›</span> and <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>const</span><span class=hidden>&gt;</span></span>‹bst›</span> properties are proved directly."</span></span>

<span class=keyword1 id=Set2_Join_RBT-inorder_joinL><span class=command>lemma</span></span> inorder_joinL<span class=main>:</span> <span class=quoted><span class=quoted>"bheight <span class=free>l</span> <span class=main>≤</span> bheight <span class=free>r</span> <span class=main>⟹</span> inorder<span class=main>(</span>joinL <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> inorder <span class=free>l</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> inorder <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinL.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> inorder_baliL joinL.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits color.splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-inorder_joinR><span class=command>lemma</span></span> inorder_joinR<span class=main>:</span>
  <span class=quoted><span class=quoted>"inorder<span class=main>(</span>joinR <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> inorder <span class=free>l</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> inorder <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinR.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> inorder_baliR joinR.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits color.splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"inorder<span class=main>(</span>join <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> inorder <span class=free>l</span> <span class=main>@</span> <span class=free>x</span> <span class=main>#</span> inorder <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> inorder_joinL inorder_joinR inorder_paint join_def
      <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits color.splits if_splits
      <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted>inorder</span><span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>"Set and bst properties"</span></span>

<span class=keyword1 id=Set2_Join_RBT-set_baliL><span class=command>lemma</span></span> set_baliL<span class=main>:</span>
  <span class=quoted><span class=quoted>"set_tree<span class=main>(</span>baliL <span class=free>l</span> <span class=free>a</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> set_tree <span class=free>l</span> <span class=main>∪</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>∪</span> set_tree <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>l</span><span class=main>,</span><span class=free>a</span><span class=main>,</span><span class=free>r</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> baliL.cases<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Set2_Join_RBT-set_joinL><span class=command>lemma</span></span> set_joinL<span class=main>:</span>
  <span class=quoted><span class=quoted>"bheight <span class=free>l</span> <span class=main>≤</span> bheight <span class=free>r</span> <span class=main>⟹</span> set_tree <span class=main>(</span>joinL <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> set_tree <span class=free>l</span> <span class=main>∪</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span> <span class=main>∪</span> set_tree <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinL.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> set_baliL joinL.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits color.splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-set_baliR><span class=command>lemma</span></span> set_baliR<span class=main>:</span>
  <span class=quoted><span class=quoted>"set_tree<span class=main>(</span>baliR <span class=free>l</span> <span class=free>a</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> set_tree <span class=free>l</span> <span class=main>∪</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>∪</span> set_tree <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>l</span><span class=main>,</span><span class=free>a</span><span class=main>,</span><span class=free>r</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> baliR.cases<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Set2_Join_RBT-set_joinR><span class=command>lemma</span></span> set_joinR<span class=main>:</span>
  <span class=quoted><span class=quoted>"set_tree <span class=main>(</span>joinR <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> set_tree <span class=free>l</span> <span class=main>∪</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span> <span class=main>∪</span> set_tree <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinR.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>x</span> <span class=skolem>r</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> set_baliR joinR.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits color.splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-set_paint><span class=command>lemma</span></span> set_paint<span class=main>:</span> <span class=quoted><span class=quoted>"set_tree <span class=main>(</span>paint <span class=free>c</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> set_tree <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>t</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Set2_Join_RBT-set_join><span class=command>lemma</span></span> set_join<span class=main>:</span> <span class=quoted><span class=quoted>"set_tree <span class=main>(</span>join <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> set_tree <span class=free>l</span> <span class=main>∪</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span> <span class=main>∪</span> set_tree <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_joinL set_joinR set_paint join_def<span class=main>)</span>

<span class=keyword1 id=Set2_Join_RBT-bst_baliL><span class=command>lemma</span></span> bst_baliL<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>bst <span class=free>l</span><span class=main>;</span> bst <span class=free>r</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span>set_tree <span class=free>l</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>a</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span>set_tree <span class=free>r</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>⟧</span>
   <span class=main>⟹</span> bst <span class=main>(</span>baliL <span class=free>l</span> <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>l</span><span class=main>,</span><span class=free>a</span><span class=main>,</span><span class=free>r</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> baliL.cases<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ball_Un<span class=main>)</span>

<span class=keyword1 id=Set2_Join_RBT-bst_baliR><span class=command>lemma</span></span> bst_baliR<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>bst <span class=free>l</span><span class=main>;</span> bst <span class=free>r</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span>set_tree <span class=free>l</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>a</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span>set_tree <span class=free>r</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>⟧</span>
   <span class=main>⟹</span> bst <span class=main>(</span>baliR <span class=free>l</span> <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>l</span><span class=main>,</span><span class=free>a</span><span class=main>,</span><span class=free>r</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> baliR.cases<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ball_Un<span class=main>)</span>

<span class=keyword1 id=Set2_Join_RBT-bst_joinL><span class=command>lemma</span></span> bst_joinL<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>bst <span class=main>(</span>Node <span class=free>l</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>n</span><span class=main>)</span> <span class=free>r</span><span class=main>)</span><span class=main>;</span> bheight <span class=free>l</span> <span class=main>≤</span> bheight <span class=free>r</span><span class=main>⟧</span>
  <span class=main>⟹</span> bst <span class=main>(</span>joinL <span class=free>l</span> <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinL.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>a</span> <span class=skolem>r</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> set_baliL joinL.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> set_joinL ball_Un <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> bst_baliL
        <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits color.splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-bst_joinR><span class=command>lemma</span></span> bst_joinR<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>bst <span class=free>l</span><span class=main>;</span> bst <span class=free>r</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span>set_tree <span class=free>l</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>a</span><span class=main>;</span> <span class=main>∀</span><span class=bound>y</span><span class=main>∈</span>set_tree <span class=free>r</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>y</span> <span class=main>⟧</span>
  <span class=main>⟹</span> bst <span class=main>(</span>joinR <span class=free>l</span> <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>r</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> joinR.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>l</span> <span class=skolem>a</span> <span class=skolem>r</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> set_baliR joinR.simps<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>l</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>r</span></span><span class=main><span class=main>]</span></span> set_joinR ball_Un <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> bst_baliR
        <span class=quasi_keyword>split</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tree.splits color.splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Set2_Join_RBT-bst_paint><span class=command>lemma</span></span> bst_paint<span class=main>:</span> <span class=quoted><span class=quoted>"bst <span class=main>(</span>paint <span class=free>c</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> bst <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>t</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Set2_Join_RBT-bst_join><span class=command>lemma</span></span> bst_join<span class=main>:</span>
  <span class=quoted><span class=quoted>"bst <span class=main>(</span>Node <span class=free>l</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>n</span><span class=main>)</span> <span class=free>r</span><span class=main>)</span> <span class=main>⟹</span> bst <span class=main>(</span>join <span class=free>l</span> <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bst_paint bst_joinL bst_joinR join_def<span class=main>)</span>

<span class=keyword1 id=Set2_Join_RBT-inv_join><span class=command>lemma</span></span> inv_join<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> invc <span class=free>l</span><span class=main>;</span> invh <span class=free>l</span><span class=main>;</span> invc <span class=free>r</span><span class=main>;</span> invh <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span> invc<span class=main>(</span>join <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span> <span class=main>∧</span> invh<span class=main>(</span>join <span class=free>l</span> <span class=free>x</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> invc2_joinL invc2_joinR invh_joinL invh_joinR invh_paint join_def<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>"Interpretation of <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>locale</span><span class=hidden>&gt;</span></span>‹Set2_Join›</span> with Red-Black Tree"</span></span>

<span class=keyword1><span class=command>global_interpretation</span></span> RBT<span class=main>:</span> Set2_Join
<span class=keyword2><span class=keyword>where</span></span> join <span class=main>=</span> <span class=quoted>join</span> <span class=keyword2><span class=keyword>and</span></span> inv <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>t</span><span class=main>.</span> invc <span class=bound>t</span> <span class=main>∧</span> invh <span class=bound>t</span>"</span></span>
<span class=keyword2><span class=keyword>defines</span></span> insert_rbt <span class=main>=</span> <span class=quoted>RBT.insert</span> <span class=keyword2><span class=keyword>and</span></span> delete_rbt <span class=main>=</span> <span class=quoted>RBT.delete</span> <span class=keyword2><span class=keyword>and</span></span> split_rbt <span class=main>=</span> <span class=quoted>RBT.split</span>
<span class=keyword2><span class=keyword>and</span></span> join2_rbt <span class=main>=</span> <span class=quoted>RBT.join2</span> <span class=keyword2><span class=keyword>and</span></span> split_min_rbt <span class=main>=</span> <span class=quoted>RBT.split_min</span> <span class=keyword2><span class=keyword>and</span></span> inter_rbt <span class=main>=</span> <span class=quoted>RBT.inter</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>standard</span><span class=main><span class=keyword3>,</span></span> <span class=operator>goal_cases</span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 1 <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_join<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> 2 <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bst_join<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> 3 <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> 4 <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inv_join<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> 5 <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The invariant does not guarantee that the root node is black. This is not required
to guarantee that the height is logarithmic in the size --- Exercise.›</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=comment1>(*&gt;*)</span></pre></div><div id=Solve_SASP><div class=head><h1>Theory Solve_SASP</h1></div><pre class=source><span class=comment1>(*
  Author: Mohammad Abdulaziz
*)</span>

<span class=keyword1><span class=command>theory</span></span> Solve_SASP
  <span class=keyword2><span class=keyword>imports</span></span> <a href=AST_SAS_Plus_Equivalence.html>AST_SAS_Plus_Equivalence</a> <span class=quoted>"<a href=SAT_Solve_SAS_Plus.html>SAT_Solve_SAS_Plus</a>"</span> 
          <span class=quoted>"<a href=../../HOL/HOL-Data_Structures/RBT_Map.html>HOL-Data_Structures.RBT_Map</a>"</span> <span class=quoted>"<a href=../../HOL/HOL-Library/Code_Target_Nat.html>HOL-Library.Code_Target_Nat</a>"</span> <a href=../../HOL/HOL/String.html>HOL.String</a>
          <a href=../AI_Planning_Languages_Semantics/SASP_Checker.html>AI_Planning_Languages_Semantics.SASP_Checker</a> <a href=Set2_Join_RBT.html>Set2_Join_RBT</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹SAT encoding works for Fast-Downward's representation›</span></span>

<span class=keyword1><span class=command>context</span></span> abs_ast_prob
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>theorem</span></span> is_serial_sol_then_valid_plan_encoded<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span> <span class=main>⟹</span>
   valid_plan 
        <span class=main>(</span>decode_abs_plan
           <span class=main>(</span>rem_noops
                   <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span> <span class=bound>op</span><span class=main>)</span>
                        <span class=main>(</span>concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>𝒜</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_serial_sol_then_valid_plan abs_prob_valid
                        sas_plus_problem_has_serial_solution_iff_i'<span class=main>)</span>
  
<span class=keyword1 id=Solve_SASP-length_abs_ast_plan><span class=command>lemma</span></span> length_abs_ast_plan<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>πs</span> <span class=main>=</span> length <span class=main>(</span>abs_ast_plan <span class=free>πs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> abs_ast_plan_def<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> valid_plan_then_is_serial_sol_encoded<span class=main>:</span>
  <span class=quoted><span class=quoted>"valid_plan <span class=free>πs</span> <span class=main>⟹</span> length <span class=free>πs</span> <span class=main>≤</span>  <span class=free>h</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>𝒜</span><span class=main>.</span> <span class=bound>𝒜</span> <span class=main>⊨</span> <span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>h</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> length_abs_ast_plan<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> sas_plus_problem_has_serial_solution_iff_ii' abs_prob_valid
                        valid_plan_then_is_serial_sol<span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹DIMACS-like semantics for CNF formulae›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹We now push the SAT encoding towards a lower-level representation by replacing the atoms which
      have variable IDs and time steps into natural numbers.›</span></span>

<span class=keyword1 id=Solve_SASP-gtD><span class=command>lemma</span></span> gtD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>l</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=bound>m</span> <span class=main>∧</span> <span class=free>l</span> <span class=main>≤</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>locale</span></span> cnf_to_dimacs <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>h</span> <span class=main>::</span> <span class=quoted>nat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>n_ops</span> <span class=main>::</span> <span class=quoted>nat</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>var_to_dimacs</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>var_to_dimacs</span> <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>*</span> <span class=free>h</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>var_to_dimacs</span> <span class=main>(</span>State <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=free>n_ops</span> <span class=main>*</span> <span class=free>h</span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>*</span> <span class=main>(</span><span class=free>h</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>dimacs_to_var</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>dimacs_to_var</span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>≡</span>
     <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>&lt;</span> <span class=main>1</span> <span class=main>+</span> <span class=free>n_ops</span> <span class=main>*</span> <span class=free>h</span> <span class=keyword1>then</span>
       Operator <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>h</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>h</span><span class=main>)</span><span class=main>)</span>
     <span class=keyword1>else</span>
       <span class=main>(</span><span class=keyword1>let</span> <span class=bound>k</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=free>n_ops</span> <span class=main>*</span> <span class=free>h</span><span class=main>)</span> <span class=keyword1>in</span> 
          State <span class=main>(</span><span class=bound>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>h</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=bound>k</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>h</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>valid_state_var</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>valid_state_var</span> <span class=main>(</span>Operator <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span> <span class=main>⟷</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>&lt;</span> <span class=free>n_ops</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>valid_state_var</span> <span class=main>(</span>State <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span> <span class=main>⟷</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>&lt;</span> <span class=free>h</span>"</span></span>

<span class=keyword1 id=Solve_SASP-State_works><span class=command>lemma</span></span> State_works<span class=main>:</span>
<span class=quoted><span class=quoted>"valid_state_var <span class=main>(</span>State <span class=free>t</span> <span class=free>k</span><span class=main>)</span> <span class=main>⟹</span>
      dimacs_to_var <span class=main>(</span>var_to_dimacs <span class=main>(</span>State <span class=free>t</span> <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> 
         <span class=main>(</span>State <span class=free>t</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>k</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dimacs_to_var_def add.left_commute Let_def<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-Operator_works><span class=command>lemma</span></span> Operator_works<span class=main>:</span>
   <span class=quoted><span class=quoted>"valid_state_var <span class=main>(</span>Operator <span class=free>t</span> <span class=free>k</span><span class=main>)</span> <span class=main>⟹</span>
      dimacs_to_var <span class=main>(</span>var_to_dimacs <span class=main>(</span>Operator <span class=free>t</span> <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> 
         <span class=main>(</span>Operator <span class=free>t</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>k</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_simps</span></span> dimacs_to_var_def gr0_conv_Suc nat_le_iff_add <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> gtD<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-sat_plan_to_dimacs_works><span class=command>lemma</span></span> sat_plan_to_dimacs_works<span class=main>:</span>
  <span class=quoted><span class=quoted>"valid_state_var <span class=free>sv</span> <span class=main>⟹</span>
     dimacs_to_var <span class=main>(</span>var_to_dimacs <span class=free>sv</span><span class=main>)</span> <span class=main>=</span> <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>sv</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> State_works Operator_works
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=Solve_SASP-changing_atoms_works><span class=command>lemma</span></span> changing_atoms_works<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=keyword1>o</span> <span class=free>g</span><span class=main>)</span> <span class=bound>x</span> <span class=main>=</span> <span class=bound>x</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span>atoms <span class=free>phi</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>M</span> <span class=main>⊨</span> <span class=free>phi</span> <span class=main>⟷</span> <span class=free>M</span> <span class=keyword1>o</span> <span class=free>f</span> <span class=main>⊨</span> map_formula <span class=free>g</span> <span class=free>phi</span>"</span></span>  
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>phi</span></span><span class=main>)</span> <span class=operator>auto</span>  

<span class=keyword1 id="Solve_SASP-changing_atoms_works'"><span class=command>lemma</span></span> changing_atoms_works'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=keyword1>o</span> <span class=free>g</span> <span class=main>⊨</span> <span class=free>phi</span> <span class=main>⟷</span> <span class=free>M</span>  <span class=main>⊨</span> map_formula <span class=free>g</span> <span class=free>phi</span>"</span></span>  
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>phi</span></span><span class=main>)</span> <span class=operator>auto</span>  

<span class=keyword1><span class=command>context</span></span> cnf_to_dimacs
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Solve_SASP-sat_plan_to_dimacs><span class=command>lemma</span></span> sat_plan_to_dimacs<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>sv</span><span class=main>.</span> <span class=bound>sv</span><span class=main>∈</span>atoms <span class=free>sat_plan_formula</span> <span class=main>⟹</span> valid_state_var <span class=bound>sv</span><span class=main>)</span> <span class=main>⟹</span>
       <span class=free>M</span> <span class=main>⊨</span> <span class=free>sat_plan_formula</span>
         <span class=main>⟷</span> <span class=free>M</span> <span class=keyword1>o</span> dimacs_to_var <span class=main>⊨</span> map_formula var_to_dimacs <span class=free>sat_plan_formula</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> changing_atoms_works<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted>valid_state_var</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sat_plan_to_dimacs_works<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-dimacs_to_sat_plan><span class=command>lemma</span></span> dimacs_to_sat_plan<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=keyword1>o</span> var_to_dimacs <span class=main>⊨</span> <span class=free>sat_plan_formula</span>
     <span class=main>⟷</span> <span class=free>M</span> <span class=main>⊨</span> map_formula var_to_dimacs <span class=free>sat_plan_formula</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> changing_atoms_works' <span class=keyword1><span class=command>.</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>locale</span></span> sat_solve_sasp <span class=main>=</span> abs_ast_prob <span class=quoted><span class=quoted>"<span class=free>Π</span>"</span></span> <span class=main>+</span> cnf_to_dimacs <span class=quoted><span class=quoted>"Suc <span class=free>h</span>"</span></span> <span class=quoted><span class=quoted>"Suc <span class=main>(</span>length astδ<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>Π</span> <span class=free>h</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Solve_SASP-encode_initial_state_valid><span class=command>lemma</span></span> encode_initial_state_valid<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_initial_state <span class=free>Prob</span><span class=main>)</span> <span class=main>⟹</span> valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> encode_state_variable_def Let_def encode_initial_state_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> sat_plan_variable.splits bool.splits<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-length_operators><span class=command>lemma</span></span> length_operators<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>length astδ<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_prob_def abs_ast_operator_section_def sas_plus_problem_to_strips_problem_def prob_with_noop_def<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_operator_effect_valid_1><span class=command>lemma</span></span> encode_operator_effect_valid_1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>⟹</span> <span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> 
       <span class=free>sv</span> <span class=main>∈</span> atoms 
        <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> 
              <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
              <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=free>vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
            <span class=free>asses</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
       valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> length_operators
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>asses</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cnf_to_dimacs.valid_state_var.simps<span class=main>)</span>
  
  
<span class=keyword1 id=Solve_SASP-encode_operator_effect_valid_2><span class=command>lemma</span></span> encode_operator_effect_valid_2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>⟹</span> <span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
       <span class=free>sv</span> <span class=main>∈</span> atoms 
        <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span>
              <span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
               <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>(</span>index <span class=free>vs</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
            <span class=free>asses</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
       valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> length_operators
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>asses</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cnf_to_dimacs.valid_state_var.simps<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=Solve_SASP-atoms_And_append><span class=command>lemma</span></span> atoms_And_append<span class=main>:</span> <span class=quoted><span class=quoted>"atoms <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span> <span class=main>(</span><span class=free>as1</span> <span class=main>@</span> <span class=free>as2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> atoms <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span> <span class=free>as1</span><span class=main>)</span> <span class=main>∪</span>  atoms <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span> <span class=free>as2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>as1</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>context</span></span> sat_solve_sasp
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Solve_SASP-encode_operator_effect_valid><span class=command>lemma</span></span> encode_operator_effect_valid<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_operator_effect <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span> <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> 
    <span class=free>t</span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>⟹</span> <span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
    valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> encode_operator_effect_def Let_def atoms_And_append 
            <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> encode_operator_effect_valid_1 encode_operator_effect_valid_2<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=Solve_SASP-foldr_And><span class=command>lemma</span></span> foldr_And<span class=main>:</span> <span class=quoted><span class=quoted>"foldr <span class=main>(<span class=hidden>❙</span><b>∧</b>)</span> <span class=free>as</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>⊥</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span> <span class=free>as</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>as</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>context</span></span> sat_solve_sasp
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Solve_SASP-encode_all_operator_effects_valid><span class=command>lemma</span></span> encode_all_operator_effects_valid<span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> Suc <span class=free>h</span> <span class=main>⟹</span>
    <span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_all_operator_effects <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span> 
    valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_all_operator_effects_def foldr_And 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> encode_operator_effect_valid<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_operator_precondition_valid_1><span class=command>lemma</span></span> encode_operator_precondition_valid_1<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>⟹</span> <span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> 
       <span class=free>sv</span> <span class=main>∈</span> atoms 
        <span class=main>(</span><span class=main><span class=hidden>❙</span><b>⋀</b></span><span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>v</span><span class=main>.</span> 
        <span class=main><span class=hidden>❙</span><b>¬</b></span> <span class=main>(</span>Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> Atom <span class=main>(</span>State <span class=free>t</span> <span class=main>(</span><span class=free>f</span> <span class=bound>v</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> 
      <span class=free>asses</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
       valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> length_operators
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>asses</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cnf_to_dimacs.valid_state_var.simps<span class=main>)</span>
  
<span class=keyword1 id=Solve_SASP-encode_operator_precondition_valid><span class=command>lemma</span></span> encode_operator_precondition_valid<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_operator_precondition <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span> <span class=free>op</span><span class=main>)</span> <span class=main>⟹</span> 
    <span class=free>t</span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>⟹</span> <span class=free>op</span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
    valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> encode_operator_precondition_def Let_def 
            <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> encode_operator_precondition_valid_1<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_all_operator_preconditions_valid><span class=command>lemma</span></span> encode_all_operator_preconditions_valid<span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> Suc <span class=free>h</span> <span class=main>⟹</span>
    <span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_all_operator_preconditions <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span> 
    valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_all_operator_preconditions_def foldr_And 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> encode_operator_precondition_valid<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_operators_valid><span class=command>lemma</span></span> encode_operators_valid<span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_operators <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>&lt;</span> Suc <span class=free>h</span> <span class=main>⟹</span>
    valid_state_var <span class=free>sv</span>"</span></span> 
  <span class=keyword1><span class=command>unfolding</span></span> encode_operators_def Let_def 
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> encode_all_operator_preconditions_valid encode_all_operator_effects_valid<span class=main>)</span>

<span class=keyword1 id="Solve_SASP-encode_negative_transition_frame_axiom'"><span class=command>lemma</span></span> encode_negative_transition_frame_axiom'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>⟹</span>
   set <span class=free>deleting_operators</span> <span class=main>⊆</span> set <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=free>sv</span> <span class=main>∈</span> atoms 
       <span class=main>(</span><span class=main><span class=hidden>❙</span><b>¬</b></span><span class=main>(</span>Atom <span class=main>(</span>State <span class=free>t</span> <span class=free>v_idx</span><span class=main>)</span><span class=main>)</span> 
          <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main>(</span>Atom <span class=main>(</span>State <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=free>v_idx</span><span class=main>)</span>
          <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=main><span class=hidden>❙</span><b>⋁</b></span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> Atom <span class=main>(</span>Operator <span class=free>t</span> <span class=main>(</span>index <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
          <span class=free>deleting_operators</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> 
    valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>deleting_operators</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> length_operators<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> cnf_to_dimacs.valid_state_var.simps<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_negative_transition_frame_axiom_valid><span class=command>lemma</span></span> encode_negative_transition_frame_axiom_valid<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_negative_transition_frame_axiom <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span> <span class=free>v</span><span class=main>)</span> <span class=main>⟹</span>  <span class=free>t</span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>⟹</span> 
    valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_negative_transition_frame_axiom_def Let_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>intro</span> encode_negative_transition_frame_axiom'<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-encode_positive_transition_frame_axiom_valid><span class=command>lemma</span></span> encode_positive_transition_frame_axiom_valid<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_positive_transition_frame_axiom <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span> <span class=free>v</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=free>h</span> <span class=main>⟹</span> 
    valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_positive_transition_frame_axiom_def Let_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>intro</span> encode_negative_transition_frame_axiom'<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-encode_all_frame_axioms_valid><span class=command>lemma</span></span> encode_all_frame_axioms_valid<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_all_frame_axioms <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>&lt;</span> Suc <span class=free>h</span> <span class=main>⟹</span>
    valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_all_frame_axioms_def Let_def atoms_And_append
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> encode_negative_transition_frame_axiom_valid encode_positive_transition_frame_axiom_valid<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_goal_state_valid><span class=command>lemma</span></span> encode_goal_state_valid<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_goal_state <span class=free>Prob</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>&lt;</span> Suc <span class=free>h</span> <span class=main>⟹</span> valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> encode_state_variable_def Let_def encode_goal_state_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> sat_plan_variable.splits bool.splits<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_problem_valid><span class=command>lemma</span></span> encode_problem_valid<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_problem <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>h</span><span class=main>)</span> <span class=main>⟹</span> valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_problem_def
  <span class=keyword1><span class=command>using</span></span> encode_initial_state_valid encode_operators_valid encode_all_frame_axioms_valid encode_goal_state_valid
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Solve_SASP-encode_interfering_operator_pair_exclusion_valid><span class=command>lemma</span></span> encode_interfering_operator_pair_exclusion_valid<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_interfering_operator_pair_exclusion <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span> <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>&lt;</span> Suc <span class=free>h</span> <span class=main>⟹</span> 
       <span class=free>op<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>op<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> set <span class=main>(</span>operators_of <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>       
       valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> encode_interfering_operator_pair_exclusion_def Let_def length_operators<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> cnf_to_dimacs.valid_state_var.simps<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_interfering_operator_exclusion_valid><span class=command>lemma</span></span> encode_interfering_operator_exclusion_valid<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_interfering_operator_exclusion <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>&lt;</span> Suc <span class=free>h</span> <span class=main>⟹</span> 
      valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_interfering_operator_exclusion_def Let_def foldr_And
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> encode_interfering_operator_pair_exclusion_valid<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_problem_with_operator_interference_exclusion_valid><span class=command>lemma</span></span> encode_problem_with_operator_interference_exclusion_valid<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sv</span> <span class=main>∈</span> atoms <span class=main>(</span>encode_problem_with_operator_interference_exclusion <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>h</span><span class=main>)</span> <span class=main>⟹</span> valid_state_var <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_problem_with_operator_interference_exclusion_def
  <span class=keyword1><span class=command>using</span></span> encode_initial_state_valid encode_operators_valid encode_all_frame_axioms_valid encode_goal_state_valid
        encode_interfering_operator_exclusion_valid
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Solve_SASP-planning_by_cnf_dimacs_complete><span class=command>lemma</span></span> planning_by_cnf_dimacs_complete<span class=main>:</span>
  <span class=quoted><span class=quoted>"valid_plan <span class=free>πs</span> <span class=main>⟹</span> length <span class=free>πs</span> <span class=main>≤</span> <span class=free>h</span> <span class=main>⟹</span>
     <span class=main>∃</span><span class=bound>M</span><span class=main>.</span> <span class=bound>M</span> <span class=main>⊨</span> map_formula var_to_dimacs <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop  abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>h</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> valid_plan_then_is_serial_sol_encoded
        sat_plan_to_dimacs<span class=main>[</span><span class=operator>OF</span> encode_problem_with_operator_interference_exclusion_valid<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>

<span class=keyword1 id=Solve_SASP-planning_by_cnf_dimacs_sound><span class=command>lemma</span></span> planning_by_cnf_dimacs_sound<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>𝒜</span> <span class=main>⊨</span> map_formula var_to_dimacs <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span>
   valid_plan 
        <span class=main>(</span>decode_abs_plan
           <span class=main>(</span>rem_noops
             <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span> <span class=bound>op</span><span class=main>)</span> 
                <span class=main>(</span>concat <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>𝒜</span> <span class=keyword1>o</span> var_to_dimacs<span class=main>)</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> changing_atoms_works'
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_serial_sol_then_valid_plan_encoded<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Going from Formualae to DIMACS-like CNF›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹We now represent the CNF formulae into a very low-level representation that is reminiscent to
      the DIMACS representation, where a CNF formula is a list of list of integers.›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>disj_to_dimacs</span><span class=main>::</span><span class=quoted><span class=quoted>"nat formula <span class=main>⇒</span> int list"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>disj_to_dimacs</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>φ<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free><span class=bound><span class=entity>φ<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>disj_to_dimacs</span> <span class=free><span class=bound><span class=entity>φ<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>@</span> <span class=free>disj_to_dimacs</span> <span class=free><span class=bound><span class=entity>φ<span class=hidden>⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>disj_to_dimacs</span> <span class=main>⊥</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>disj_to_dimacs</span> <span class=main>(</span>Not <span class=main>⊥</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=main>-</span><span class=main>1</span><span class=main>::</span>int<span class=main>,</span><span class=main>1</span><span class=main>::</span>int<span class=main>]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>disj_to_dimacs</span> <span class=main>(</span>Atom <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span>int <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>disj_to_dimacs</span> <span class=main>(</span>Not <span class=main>(</span>Atom <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=main>-</span><span class=main>(</span>int <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>cnf_to_dimacs</span><span class=main>::</span><span class=quoted><span class=quoted>"nat formula <span class=main>⇒</span> int list list"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>cnf_to_dimacs</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>φ<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=free><span class=bound><span class=entity>φ<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>cnf_to_dimacs</span> <span class=free><span class=bound><span class=entity>φ<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>@</span> <span class=free>cnf_to_dimacs</span> <span class=free><span class=bound><span class=entity>φ<span class=hidden>⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>cnf_to_dimacs</span> <span class=free><span class=bound><span class=entity>d</span></span></span> <span class=main>=</span> <span class=main>[</span>disj_to_dimacs <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>dimacs_lit_to_var</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>≡</span> nat <span class=main>(</span>abs <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>find_max</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>::</span>nat list<span class=main>)</span><span class=main>≡</span> <span class=main>(</span>fold max <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>1</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Solve_SASP-find_max_works><span class=command>lemma</span></span> find_max_works<span class=main>:</span>
<span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> find_max <span class=free>xs</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=main>⟹</span> <span class=var>?Q</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>fold max <span class=free>xs</span> <span class=skolem>m</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>m</span>
    <span class=keyword1><span class=command>unfolding</span></span> max_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>m</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> nat_le_linear
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span>  le_trans <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=main>⟹</span> <span class=var>?Q</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> find_max_def max_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>formula_vars</span> <span class=keyword2><span class=keyword>where</span></span>
<span class=quoted><span class=quoted>"<span class=free>formula_vars</span> <span class=main>(</span><span class=main>⊥</span><span class=main>)</span> <span class=main>=</span> <span class=main>[]</span>"</span></span> <span class=main>|</span>
<span class=quoted><span class=quoted>"<span class=free>formula_vars</span> <span class=main>(</span>Atom <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>]</span>"</span></span> <span class=main>|</span>
<span class=quoted><span class=quoted>"<span class=free>formula_vars</span> <span class=main>(</span>Not <span class=free><span class=bound><span class=entity>F</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>formula_vars</span> <span class=free><span class=bound><span class=entity>F</span></span></span>"</span></span> <span class=main>|</span>
<span class=quoted><span class=quoted>"<span class=free>formula_vars</span> <span class=main>(</span>And <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=free><span class=bound><span class=entity>G</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>formula_vars</span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=main>@</span> <span class=free>formula_vars</span> <span class=free><span class=bound><span class=entity>G</span></span></span>"</span></span> <span class=main>|</span>
<span class=quoted><span class=quoted>"<span class=free>formula_vars</span> <span class=main>(</span>Imp <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=free><span class=bound><span class=entity>G</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>formula_vars</span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=main>@</span> <span class=free>formula_vars</span> <span class=free><span class=bound><span class=entity>G</span></span></span>"</span></span> <span class=main>|</span>
<span class=quoted><span class=quoted>"<span class=free>formula_vars</span> <span class=main>(</span>Or <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=free><span class=bound><span class=entity>G</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>formula_vars</span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=main>@</span> <span class=free>formula_vars</span> <span class=free><span class=bound><span class=entity>G</span></span></span>"</span></span>

<span class=keyword1 id=Solve_SASP-atoms_formula_vars><span class=command>lemma</span></span> atoms_formula_vars<span class=main>:</span> <span class=quoted><span class=quoted>"atoms <span class=free>f</span> <span class=main>=</span> set <span class=main>(</span>formula_vars <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-max_var><span class=command>lemma</span></span> max_var<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> atoms <span class=main>(</span><span class=free>f</span><span class=main>::</span>nat formula<span class=main>)</span> <span class=main>⟹</span> <span class=free>v</span> <span class=main>≤</span> find_max <span class=main>(</span>formula_vars <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> find_max_works
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atoms_formula_vars<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>dimacs_max_var</span> <span class=free><span class=bound><span class=entity>cs</span></span></span> <span class=main>≡</span> find_max <span class=main>(</span>map <span class=main>(</span>find_max <span class=keyword1>o</span> <span class=main>(</span>map <span class=main>(</span>nat <span class=keyword1>o</span> abs<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>cs</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Solve_SASP-fold_max_ge><span class=command>lemma</span></span> fold_max_ge<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> fold <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>m</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>m</span> <span class=main>≤</span> <span class=bound>x</span> <span class=keyword1>then</span> <span class=bound>x</span> <span class=keyword1>else</span> <span class=bound>m</span><span class=main>)</span> <span class=free>ys</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ys</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-find_max_append><span class=command>lemma</span></span> find_max_append<span class=main>:</span>  <span class=quoted><span class=quoted>"find_max <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> max <span class=main>(</span>find_max <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>find_max <span class=free>ys</span><span class=main>)</span> "</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Max.set_eq_fold<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> append_Cons<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> set_append find_max_def<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> List.finite_set Max.union Un_absorb Un_insert_left Un_insert_right list.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> list.simps<span class=main><span class=main>(</span></span>15<span class=main><span class=main>)</span></span> set_empty<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>dimacs_model</span><span class=main>::</span><span class=quoted><span class=quoted>"int list <span class=main>⇒</span> int list list <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>dimacs_model</span> <span class=free><span class=bound><span class=entity>ls</span></span></span> <span class=free><span class=bound><span class=entity>cs</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>∀</span><span class=bound>c</span><span class=main>∈</span>set <span class=free><span class=bound><span class=entity>cs</span></span></span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>l</span><span class=main>∈</span>set <span class=free><span class=bound><span class=entity>ls</span></span></span><span class=main>.</span> <span class=bound>l</span> <span class=main>∈</span> set <span class=bound>c</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span>
                              distinct <span class=main>(</span>map dimacs_lit_to_var <span class=free><span class=bound><span class=entity>ls</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>model_to_dimacs_model</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>model_to_dimacs_model</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>vs</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=keyword1>then</span> int <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=keyword1>else</span> <span class=main>-</span> <span class=main>(</span>int <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>#</span> <span class=main>(</span><span class=free>model_to_dimacs_model</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>vs</span></span></span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>model_to_dimacs_model</span> <span class=main><span class=bound><span class=entity>_</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_append><span class=command>lemma</span></span> model_to_dimacs_model_append<span class=main>:</span>
 <span class=quoted><span class=quoted>"set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>(</span><span class=free>vs</span> <span class=main>@</span> <span class=free>vs'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=free>vs</span><span class=main>)</span> <span class=main>∪</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=free>vs'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>vs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-upt_append_sing><span class=command>lemma</span></span> upt_append_sing<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>n_vars</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>=</span> <span class=free>n_vars</span><span class=main>-</span><span class=main>1</span> <span class=main>∧</span> <span class=free>n_vars</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"<span class=free>n_vars</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-upt_eqD><span class=command>lemma</span></span> upt_eqD<span class=main>:</span> <span class=quoted><span class=quoted>"upt <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> upt <span class=free>a</span> <span class=free>b'</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span> <span class=main>=</span> <span class=free>b'</span> <span class=main>∨</span> <span class=free>b'</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>∨</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> upt_append_sing <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-pos_in_model><span class=command>lemma</span></span> pos_in_model<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> int <span class=free>n</span> <span class=main>∈</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>1</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n_vars</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq model_to_dimacs_model_append <span class=main>)</span>

<span class=keyword1 id=Solve_SASP-neg_in_model><span class=command>lemma</span></span> neg_in_model<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>M</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> <span class=main>-</span> <span class=main>(</span>int <span class=free>n</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>1</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n_vars</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq model_to_dimacs_model_append<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-in_model><span class=command>lemma</span></span> in_model<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> int <span class=free>n</span> <span class=main>∈</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>1</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span> <span class=main>∨</span> <span class=main>-</span> <span class=main>(</span>int <span class=free>n</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>1</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> pos_in_model neg_in_model
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_all_vars><span class=command>lemma</span></span> model_to_dimacs_model_all_vars<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>&lt;</span> <span class=free>n_vars</span><span class=main>)</span> <span class=main>⟹</span> is_cnf <span class=free>f</span> <span class=main>⟹</span> <span class=free>M</span> <span class=main>⊨</span> <span class=free>f</span> <span class=main>⟹</span>
        <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n</span></span><span class=main>&lt;</span><span class=free>n_vars</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>n</span> <span class=main>⟶</span> <span class=main>(</span>int <span class=bound>n</span> <span class=main>∈</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>nat<span class=main>)</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span> <span class=main>∨</span>
                              <span class=main>-</span><span class=main>(</span>int <span class=bound>n</span><span class=main>)</span> <span class=main>∈</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>nat<span class=main>)</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> in_model neg_in_model pos_in_model  
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_less model_to_dimacs_model_append <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-cnf_And><span class=command>lemma</span></span> cnf_And<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>cnf_to_dimacs <span class=main>(</span><span class=free>f1</span> <span class=main><span class=hidden>❙</span><b>∧</b></span> <span class=free>f2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>cnf_to_dimacs <span class=free>f1</span><span class=main>)</span> <span class=main>∪</span> set <span class=main>(</span>cnf_to_dimacs <span class=free>f2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-one_always_in><span class=command>lemma</span></span> one_always_in<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> <span class=main>1</span> <span class=main>∈</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>(</span><span class=main>[</span><span class=main>1</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>∨</span> <span class=main>-</span> <span class=main>1</span> <span class=main>∈</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>(</span><span class=main>[</span><span class=main>1</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n_vars</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq model_to_dimacs_model_append<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>disj_to_dimacs <span class=main>(</span><span class=free>f1</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>f2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>disj_to_dimacs <span class=free>f1</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span>disj_to_dimacs <span class=free>f2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>atoms <span class=main>(</span><span class=free>f1</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>f2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> atoms <span class=free>f1</span> <span class=main>∪</span> atoms <span class=free>f2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-isdisj_disjD><span class=command>lemma</span></span> isdisj_disjD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>is_disj <span class=main>(</span><span class=free>f1</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>f2</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> is_disj <span class=free>f1</span> <span class=main>∧</span> is_disj <span class=free>f2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>f1</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Solve_SASP-disj_to_dimacs_sound><span class=command>lemma</span></span> disj_to_dimacs_sound<span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>&lt;</span> <span class=free>n_vars</span><span class=main>)</span> <span class=main>⟹</span> is_disj <span class=free>f</span> <span class=main>⟹</span> <span class=free>M</span> <span class=main>⊨</span> <span class=free>f</span>
     <span class=main>⟹</span> <span class=main>∃</span><span class=bound>l</span><span class=main>∈</span>set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>nat<span class=main>)</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span> <span class=main>∈</span> set <span class=main>(</span>disj_to_dimacs <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> neg_in_model pos_in_model one_always_in
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_lit_plus.elims <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> isdisj_disjD<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Solve_SASP-is_cnf_disj><span class=command>lemma</span></span> is_cnf_disj<span class=main>:</span> <span class=quoted><span class=quoted>"is_cnf <span class=main>(</span><span class=free>f1</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>f2</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>⋀</span><span class=bound>f</span><span class=main>.</span> <span class=free>f1</span> <span class=main><span class=hidden>❙</span><b>∨</b></span> <span class=free>f2</span> <span class=main>=</span> <span class=bound>f</span> <span class=main>⟹</span> is_disj <span class=bound>f</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-cnf_to_dimacs_disj><span class=command>lemma</span></span> cnf_to_dimacs_disj<span class=main>:</span> <span class=quoted><span class=quoted>"is_disj <span class=free>f</span> <span class=main>⟹</span> cnf_to_dimacs <span class=free>f</span> <span class=main>=</span> <span class=main>[</span>disj_to_dimacs <span class=free>f</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_all_clauses><span class=command>lemma</span></span> model_to_dimacs_model_all_clauses<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>&lt;</span> <span class=free>n_vars</span><span class=main>)</span> <span class=main>⟹</span> is_cnf <span class=free>f</span> <span class=main>⟹</span> <span class=free>M</span> <span class=main>⊨</span> <span class=free>f</span> <span class=main>⟹</span>
        <span class=free>c</span><span class=main>∈</span>set <span class=main>(</span>cnf_to_dimacs <span class=free>f</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>l</span><span class=main>∈</span>set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>nat<span class=main>)</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span> <span class=main>∈</span> set <span class=free>c</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Not <span class=skolem>f</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>using</span></span> in_model neg_in_model
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_lit_plus.elims<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Or <span class=skolem>f1</span> <span class=skolem>f2</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_to_dimacs_disj disj_to_dimacs_sound
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>elim</span> is_cnf_disj<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> in_model neg_in_model pos_in_model<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Solve_SASP-upt_eq_Cons_conv><span class=command>lemma</span></span> upt_eq_Cons_conv<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[</span><span class=free>i</span><span class=main>..&lt;</span><span class=free>j</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>∧</span> <span class=free>i</span> <span class=main>=</span> <span class=free>x</span> <span class=main>∧</span> <span class=main>[</span><span class=free>i</span><span class=main>+</span><span class=main>1</span><span class=main>..&lt;</span><span class=free>j</span><span class=main>]</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> upt_eq_Cons_conv
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id="Solve_SASP-model_to_dimacs_model_append'"><span class=command>lemma</span></span> model_to_dimacs_model_append'<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>(</span><span class=free>vs</span> <span class=main>@</span> <span class=free>vs'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=free>vs</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=free>vs'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>vs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_neg_nin><span class=command>lemma</span></span> model_to_dimacs_neg_nin<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=free>n_vars</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>⟹</span> int <span class=free>x</span> <span class=main>∉</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n_vars</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> model_to_dimacs_model_append'<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_pos_nin><span class=command>lemma</span></span> model_to_dimacs_pos_nin<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=free>n_vars</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>⟹</span> <span class=main>-</span> int <span class=free>x</span> <span class=main>∉</span> set <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n_vars</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> model_to_dimacs_model_append'<span class=main>)</span>

<span class=keyword1 id="Solve_SASP-int_cases2'"><span class=command>lemma</span></span> int_cases2'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>0</span> <span class=main>≠</span> <span class=main>(</span>int <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>z</span> <span class=main>=</span> int <span class=bound>n</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>0</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>(</span>int <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>z</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span>int <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>full_types<span class=main><span class=main>)</span></span> int_cases2<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_distinct><span class=command>lemma</span></span> model_to_dimacs_model_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> distinct <span class=main>(</span>map dimacs_lit_to_var <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>1</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n_vars</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> int_cases2'
                <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dimacs_lit_to_var_def model_to_dimacs_model_append'
                          model_to_dimacs_neg_nin model_to_dimacs_pos_nin<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_sound><span class=command>lemma</span></span> model_to_dimacs_model_sound<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>&lt;</span> <span class=free>n_vars</span><span class=main>)</span> <span class=main>⟹</span> is_cnf <span class=free>f</span> <span class=main>⟹</span> <span class=free>M</span> <span class=main>⊨</span> <span class=free>f</span> <span class=main>⟹</span>
        dimacs_model <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>nat<span class=main>)</span><span class=main>..&lt;</span><span class=free>n_vars</span><span class=main>]</span><span class=main>)</span> <span class=main>(</span>cnf_to_dimacs <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> dimacs_model_def
  <span class=keyword1><span class=command>using</span></span> model_to_dimacs_model_all_vars model_to_dimacs_model_all_clauses model_to_dimacs_model_distinct
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>  

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_sound_exists><span class=command>lemma</span></span> model_to_dimacs_model_sound_exists<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=free>n_vars</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>&lt;</span> <span class=free>n_vars</span><span class=main>)</span> <span class=main>⟹</span> is_cnf <span class=free>f</span> <span class=main>⟹</span> <span class=free>M</span> <span class=main>⊨</span> <span class=free>f</span> <span class=main>⟹</span>
        <span class=main>∃</span><span class=bound>M_dimacs</span><span class=main>.</span> dimacs_model <span class=bound>M_dimacs</span> <span class=main>(</span>cnf_to_dimacs <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> model_to_dimacs_model_sound
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>dimacs_to_atom</span> <span class=main>::</span><span class=quoted><span class=quoted>"int <span class=main>⇒</span> nat formula"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>dimacs_to_atom</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>≡</span> <span class=keyword1>if</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>)</span> <span class=keyword1>then</span> Not <span class=main>(</span>Atom <span class=main>(</span>nat <span class=main>(</span>abs <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> Atom <span class=main>(</span>nat <span class=main>(</span>abs <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>dimacs_to_disj</span><span class=main>::</span><span class=quoted><span class=quoted>"int list <span class=main>⇒</span> nat formula"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>dimacs_to_disj</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> <span class=main><span class=hidden>❙</span><b>⋁</b></span> <span class=main>(</span>map dimacs_to_atom <span class=free><span class=bound><span class=entity>f</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>dimacs_to_cnf</span><span class=main>::</span><span class=quoted><span class=quoted>"int list list <span class=main>⇒</span> nat formula"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>dimacs_to_cnf</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> <span class=main><span class=hidden>❙</span><b>⋀</b></span>map dimacs_to_disj <span class=free><span class=bound><span class=entity>f</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>dimacs_model_to_abs</span> <span class=free><span class=bound><span class=entity>dimacs_M</span></span></span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>≡</span> 
  fold <span class=main>(</span><span class=main>λ</span><span class=bound>l</span> <span class=bound>M</span><span class=main>.</span> <span class=keyword1>if</span> <span class=main>(</span><span class=bound>l</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>)</span> <span class=keyword1>then</span> <span class=bound>M</span><span class=main>(</span><span class=main>(</span>nat <span class=main>(</span>abs <span class=bound>l</span><span class=main>)</span><span class=main>)</span><span class=main>:=</span> True<span class=main>)</span> <span class=keyword1>else</span> <span class=bound>M</span><span class=main>(</span><span class=main>(</span>nat <span class=main>(</span>abs <span class=bound>l</span><span class=main>)</span><span class=main>)</span><span class=main>:=</span> False<span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>dimacs_M</span></span></span> <span class=free><span class=bound><span class=entity>M</span></span></span>"</span></span>

<span class=keyword1 id=Solve_SASP-dimacs_model_to_abs_atom><span class=command>lemma</span></span> dimacs_model_to_abs_atom<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>⟹</span> int <span class=free>x</span> <span class=main>∈</span> set <span class=free>dimacs_M</span> <span class=main>⟹</span> distinct <span class=main>(</span>map dimacs_lit_to_var  <span class=free>dimacs_M</span><span class=main>)</span> <span class=main>⟹</span> dimacs_model_to_abs <span class=free>dimacs_M</span> <span class=free>M</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>dimacs_M</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>M</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>a</span> <span class=skolem>dimacs_M</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dimacs_model_to_abs_def dimacs_lit_to_var_def image_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id="Solve_SASP-dimacs_model_to_abs_atom'"><span class=command>lemma</span></span> dimacs_model_to_abs_atom'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>⟹</span> <span class=main>-</span><span class=main>(</span>int <span class=free>x</span><span class=main>)</span> <span class=main>∈</span> set <span class=free>dimacs_M</span> <span class=main>⟹</span> distinct <span class=main>(</span>map dimacs_lit_to_var  <span class=free>dimacs_M</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>¬</span> dimacs_model_to_abs <span class=free>dimacs_M</span> <span class=free>M</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>dimacs_M</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>M</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>snoc <span class=skolem>a</span> <span class=skolem>dimacs_M</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dimacs_model_to_abs_def dimacs_lit_to_var_def image_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_complete_disj><span class=command>lemma</span></span> model_to_dimacs_model_complete_disj<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>&lt;</span> <span class=free>n_vars</span><span class=main>)</span> <span class=main>⟹</span> is_disj <span class=free>f</span> <span class=main>⟹</span> distinct <span class=main>(</span>map dimacs_lit_to_var <span class=free>dimacs_M</span><span class=main>)</span>
     <span class=main>⟹</span> dimacs_model <span class=free>dimacs_M</span> <span class=main>(</span>cnf_to_dimacs <span class=free>f</span><span class=main>)</span> <span class=main>⟹</span> dimacs_model_to_abs <span class=free>dimacs_M</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span> <span class=main>⊨</span> <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_lit_plus.elims <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> isdisj_disjD
                <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> cnf_to_dimacs_disj dimacs_model_def dimacs_model_to_abs_atom'
                      dimacs_model_to_abs_atom<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_complete><span class=command>lemma</span></span> model_to_dimacs_model_complete<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span> <span class=main>∧</span> <span class=bound>v</span> <span class=main>&lt;</span> <span class=free>n_vars</span><span class=main>)</span> <span class=main>⟹</span> is_cnf <span class=free>f</span> <span class=main>⟹</span> distinct <span class=main>(</span>map dimacs_lit_to_var <span class=free>dimacs_M</span><span class=main>)</span>
     <span class=main>⟹</span> dimacs_model <span class=free>dimacs_M</span> <span class=main>(</span>cnf_to_dimacs <span class=free>f</span><span class=main>)</span> <span class=main>⟹</span> dimacs_model_to_abs <span class=free>dimacs_M</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span> <span class=main>⊨</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Not <span class=skolem>f</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_lit_plus.elims <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dimacs_model_to_abs_atom' dimacs_model_def<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Or <span class=skolem>f1</span> <span class=skolem>f2</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cnf_to_dimacs_disj model_to_dimacs_model_complete_disj
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>elim</span> is_cnf_disj<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dimacs_model_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> dimacs_model_to_abs_atom<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dimacs_model_def<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_complete_max_var><span class=command>lemma</span></span> model_to_dimacs_model_complete_max_var<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span><span class=main>)</span> <span class=main>⟹</span> is_cnf <span class=free>f</span> <span class=main>⟹</span> 
   dimacs_model <span class=free>dimacs_M</span> <span class=main>(</span>cnf_to_dimacs <span class=free>f</span><span class=main>)</span> <span class=main>⟹</span>
     dimacs_model_to_abs <span class=free>dimacs_M</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span> <span class=main>⊨</span> <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> le_imp_less_Suc<span class=main>[</span><span class=operator>OF</span> max_var<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> model_to_dimacs_model_complete <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dimacs_model_def<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-model_to_dimacs_model_sound_max_var><span class=command>lemma</span></span> model_to_dimacs_model_sound_max_var<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>atoms <span class=free>f</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>v</span><span class=main>)</span> <span class=main>⟹</span> is_cnf <span class=free>f</span> <span class=main>⟹</span> <span class=free>M</span> <span class=main>⊨</span> <span class=free>f</span> <span class=main>⟹</span>
     dimacs_model <span class=main>(</span>model_to_dimacs_model <span class=free>M</span> <span class=main>[</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>nat<span class=main>)</span><span class=main>..&lt;</span><span class=main>(</span>find_max <span class=main>(</span>formula_vars <span class=free>f</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>
                  <span class=main>(</span>cnf_to_dimacs <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> le_imp_less_Suc<span class=main>[</span><span class=operator>unfolded</span> Suc_eq_plus1<span class=main>,</span> <span class=operator>OF</span> max_var<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> model_to_dimacs_model_sound<span class=main>)</span>

<span class=keyword1><span class=command>context</span></span> sat_solve_sasp
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"var_to_dimacs <span class=free>sv</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>sv</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-var_to_dimacs_pos><span class=command>lemma</span></span> var_to_dimacs_pos<span class=main>:</span> 
  <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> atoms <span class=main>(</span>map_formula var_to_dimacs <span class=free>f</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-map_is_disj><span class=command>lemma</span></span> map_is_disj<span class=main>:</span> <span class=quoted><span class=quoted>"is_disj <span class=free>f</span> <span class=main>⟹</span> is_disj <span class=main>(</span>map_formula <span class=free>F</span> <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_lit_plus.elims<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-map_is_cnf><span class=command>lemma</span></span> map_is_cnf<span class=main>:</span> <span class=quoted><span class=quoted>"is_cnf <span class=free>f</span> <span class=main>⟹</span> is_cnf <span class=main>(</span>map_formula <span class=free>F</span> <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>f</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_lit_plus.elims <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_is_disj<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-planning_dimacs_complete><span class=command>lemma</span></span> planning_dimacs_complete<span class=main>:</span>
  <span class=quoted><span class=quoted>"valid_plan <span class=free>πs</span> <span class=main>⟹</span> length <span class=free>πs</span> <span class=main>≤</span> <span class=free>h</span> <span class=main>⟹</span>
   <span class=keyword1>let</span> <span class=bound>cnf_formula</span> <span class=main>=</span> <span class=main>(</span>map_formula var_to_dimacs 
                                  <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>h</span><span class=main>)</span><span class=main>)</span>
   <span class=keyword1>in</span>
       <span class=main>∃</span><span class=bound>dimacs_M</span><span class=main>.</span> dimacs_model <span class=bound>dimacs_M</span> <span class=main>(</span>cnf_to_dimacs <span class=bound>cnf_formula</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> Let_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> var_to_dimacs_pos
                <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> planning_by_cnf_dimacs_complete
                <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> model_to_dimacs_model_sound_max_var map_is_cnf
                       is_cnf_encode_problem_with_operator_interference_exclusion
                       is_valid_problem_sas_plus_then_strips_transformation_too
                       noops_valid abs_prob_valid<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-planning_dimacs_sound><span class=command>lemma</span></span> planning_dimacs_sound<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>let</span> <span class=bound>cnf_formula</span> <span class=main>=</span>
     <span class=main>(</span>map_formula var_to_dimacs
                  <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=free>h</span><span class=main>)</span><span class=main>)</span>
   <span class=keyword1>in</span>
     dimacs_model <span class=free>dimacs_M</span> <span class=main>(</span>cnf_to_dimacs <span class=bound>cnf_formula</span><span class=main>)</span> <span class=main>⟹</span>
   valid_plan 
        <span class=main>(</span>decode_abs_plan
            <span class=main>(</span>rem_noops
              <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span> <span class=bound>op</span><span class=main>)</span>
                   <span class=main>(</span>concat
                    <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop abs_prob<span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>dimacs_model_to_abs <span class=free>dimacs_M</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span><span class=main>)</span> <span class=keyword1>o</span> var_to_dimacs<span class=main>)</span> <span class=free>h</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> var_to_dimacs_pos Let_def
               <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> planning_by_cnf_dimacs_sound model_to_dimacs_model_complete_max_var
                      map_is_cnf is_cnf_encode_problem_with_operator_interference_exclusion 
                      is_valid_problem_sas_plus_then_strips_transformation_too abs_prob_valid
                      noops_valid<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Code Generation›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹We now generate SML code equivalent to the functions that encode a problem as a CNF formula
      and that decode the model of the given encodings into a plan.›</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
   <span class=quoted><span class=quoted>"dimacs_model <span class=free>ls</span> <span class=free>cs</span> <span class=main>≡</span> <span class=main>(</span>list_all <span class=main>(</span><span class=main>λ</span><span class=bound>c</span><span class=main>.</span> list_ex <span class=main>(</span><span class=main>λ</span><span class=bound>l</span><span class=main>.</span> ListMem <span class=bound>l</span> <span class=bound>c</span> <span class=main>)</span> <span class=free>ls</span><span class=main>)</span> <span class=free>cs</span><span class=main>)</span> <span class=main>∧</span>
                               distinct <span class=main>(</span>map dimacs_lit_to_var <span class=free>ls</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> dimacs_model_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list.pred_set ListMem_iff list_ex_iff <span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> 
<span class=quoted><span class=quoted>"<span class=free>SASP_to_DIMACS</span> <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span> <span class=main>≡</span>
   cnf_to_dimacs
     <span class=main>(</span>map_formula 
       <span class=main>(</span>cnf_to_dimacs.var_to_dimacs <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>h</span></span></span><span class=main>)</span> <span class=main>(</span>Suc <span class=main>(</span>length <span class=main>(</span>ast_problem.astδ <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
         <span class=main>(</span><span class=keyword1>Φ<span class=hidden>⇩</span><sub>∀</sub></span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop <span class=main>(</span>ast_problem.abs_prob <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>h</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Solve_SASP-planning_dimacs_complete_code><span class=command>lemma</span></span> planning_dimacs_complete_code<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>ast_problem.well_formed <span class=free>prob</span><span class=main>;</span>
    <span class=main>∀</span><span class=bound>π</span><span class=main>∈</span>set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span><span class=main>.</span> is_standard_operator' <span class=bound>π</span><span class=main>;</span>
    ast_problem.valid_plan <span class=free>prob</span> <span class=free>πs</span><span class=main>;</span>
    length <span class=free>πs</span> <span class=main>≤</span> <span class=free>h</span><span class=main>⟧</span> <span class=main>⟹</span>
   <span class=keyword1>let</span> <span class=bound>cnf_formula</span> <span class=main>=</span> <span class=main>(</span>SASP_to_DIMACS <span class=free>h</span> <span class=free>prob</span><span class=main>)</span> <span class=keyword1>in</span>
       <span class=main>∃</span><span class=bound>dimacs_M</span><span class=main>.</span> dimacs_model <span class=bound>dimacs_M</span> <span class=bound>cnf_formula</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> SASP_to_DIMACS_def Let_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> sat_solve_sasp.planning_dimacs_complete<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> Let_def<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unfold_locales</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>SASP_to_DIMACS'</span> <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span> <span class=main>≡</span> SASP_to_DIMACS <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=main>(</span>rem_implicit_pres_ops <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id="Solve_SASP-planning_dimacs_complete_code'"><span class=command>lemma</span></span> planning_dimacs_complete_code'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>ast_problem.well_formed <span class=free>prob</span><span class=main>;</span>
    <span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span><span class=main>;</span>
    <span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> is_standard_operator <span class=bound>op</span><span class=main>)</span><span class=main>;</span>
    ast_problem.valid_plan <span class=free>prob</span> <span class=free>πs</span><span class=main>;</span>
    length <span class=free>πs</span> <span class=main>≤</span> <span class=free>h</span><span class=main>⟧</span> <span class=main>⟹</span>
   <span class=keyword1>let</span> <span class=bound>cnf_formula</span> <span class=main>=</span> <span class=main>(</span>SASP_to_DIMACS' <span class=free>h</span> <span class=free>prob</span><span class=main>)</span> <span class=keyword1>in</span>
       <span class=main>∃</span><span class=bound>dimacs_M</span><span class=main>.</span> dimacs_model <span class=bound>dimacs_M</span> <span class=bound>cnf_formula</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> Let_def SASP_to_DIMACS'_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_valid_plan<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> wf_ast_problem_def
           <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> rem_implicit_pres.simps
           <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rem_implicit_pres_is_standard_operator'
                   planning_dimacs_complete_code<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> Let_def<span class=main><span class=main>]</span></span>
                   rem_implicit_pres_ops_well_formed
           <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_inδD<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A function that does the checks required by the completeness theorem above, and returns
      appropriate error messages if any of the checks fail.›</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>"<span class=free>encode</span> <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span> <span class=main>≡</span>
     <span class=keyword1>if</span> ast_problem.well_formed <span class=free><span class=bound><span class=entity>prob</span></span></span> <span class=keyword1>then</span>
       <span class=keyword1>if</span> <span class=main>(</span><span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>.</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span> <span class=keyword1>then</span>
         <span class=keyword1>if</span> <span class=main>(</span><span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>.</span> is_standard_operator <span class=bound>op</span><span class=main>)</span> <span class=keyword1>then</span>
           Inl <span class=main>(</span>SASP_to_DIMACS' <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span>
         <span class=keyword1>else</span>
           Inr <span class=main>(</span><span class=keyword1>STR</span> <span class=inner_quoted>''Error: Conditional effects!''</span><span class=main>)</span>
       <span class=keyword1>else</span>
         Inr <span class=main>(</span><span class=keyword1>STR</span> <span class=inner_quoted>''Error: Preconditions inconsistent''</span><span class=main>)</span>
     <span class=keyword1>else</span>
       Inr <span class=main>(</span><span class=keyword1>STR</span> <span class=inner_quoted>''Error: Problem malformed!''</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Solve_SASP-encode_sound><span class=command>lemma</span></span> encode_sound<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>ast_problem.valid_plan <span class=free>prob</span> <span class=free>πs</span><span class=main>;</span> length <span class=free>πs</span> <span class=main>≤</span> <span class=free>h</span><span class=main>;</span>
        encode <span class=free>h</span> <span class=free>prob</span> <span class=main>=</span> Inl <span class=free>cnf_formula</span><span class=main>⟧</span> <span class=main>⟹</span> 
         <span class=main>(</span><span class=main>∃</span><span class=bound>dimacs_M</span><span class=main>.</span> dimacs_model <span class=bound>dimacs_M</span> <span class=free>cnf_formula</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list.pred_set
           <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> planning_dimacs_complete_code'<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> Let_def<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Solve_SASP-encode_complete><span class=command>lemma</span></span> encode_complete<span class=main>:</span>
  <span class=quoted><span class=quoted>"encode <span class=free>h</span> <span class=free>prob</span> <span class=main>=</span> Inr <span class=free>err</span> <span class=main>⟹</span> 
     <span class=main>¬</span><span class=main>(</span>ast_problem.well_formed <span class=free>prob</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span><span class=main>.</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span>
     <span class=main>(</span><span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span><span class=main>.</span> is_standard_operator <span class=bound>op</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> encode_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list.pred_set
           <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> planning_dimacs_complete_code'<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> Let_def<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>match_pre</span> <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>match_pre</span> <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>v</span><span class=main>)</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=bound>x</span> <span class=main>=</span> Some <span class=bound>v</span>"</span></span>
    
<span class=keyword1><span class=command>definition</span></span> <span class=entity>match_pres</span> <span class=keyword2><span class=keyword>where</span></span> 
    <span class=quoted><span class=quoted>"<span class=free>match_pres</span> <span class=free><span class=bound><span class=entity>pres</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>pre</span><span class=main>∈</span>set <span class=free><span class=bound><span class=entity>pres</span></span></span><span class=main>.</span> match_pre <span class=bound>pre</span> <span class=free><span class=bound><span class=entity>s</span></span></span>"</span></span>

<span class=keyword1 id=Solve_SASP-match_pres_distinct><span class=command>lemma</span></span> match_pres_distinct<span class=main>:</span> 
  <span class=quoted><span class=quoted>"distinct <span class=main>(</span>map fst <span class=free>pres</span><span class=main>)</span> <span class=main>⟹</span> match_pres <span class=free>pres</span> <span class=free>s</span> <span class=main>⟷</span> Map.map_of <span class=free>pres</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> match_pres_def match_pre_def 
  <span class=keyword1><span class=command>using</span></span> map_le_def map_of_SomeD
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>using</span></span> domI map_of_is_SomeI
  <span class=keyword1><span class=command>by</span></span> <span class=operator>smt</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>tree_map_of</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>tree_map_of</span> <span class=free><span class=bound><span class=entity>updatea</span></span></span> <span class=free><span class=bound><span class=entity>T</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>T</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>tree_map_of</span> <span class=free><span class=bound><span class=entity>updatea</span></span></span> <span class=free><span class=bound><span class=entity>T</span></span></span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>,</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>#</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>updatea</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>(</span><span class=free>tree_map_of</span> <span class=free><span class=bound><span class=entity>updatea</span></span></span> <span class=free><span class=bound><span class=entity>T</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>context</span></span> Map
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=quoted><span class=quoted>"<span class=free>tree_map_of'</span> <span class=main>≡</span> tree_map_of <span class=free>update</span>"</span></span>

<span class=keyword1 id=Solve_SASP-tree_map_of_invar><span class=command>lemma</span></span> tree_map_of_invar<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>invar</span> <span class=free>T</span> <span class=main>⟹</span> <span class=free>invar</span> <span class=main>(</span>tree_map_of' <span class=free>T</span> <span class=free>pres</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>pres</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> invar_update<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-tree_map_of_works><span class=command>lemma</span></span> tree_map_of_works<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>lookup</span> <span class=main>(</span>tree_map_of' <span class=free>empty</span> <span class=free>pres</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> map_of <span class=free>pres</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>pres</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_empty map_update<span class=main><span class=main>[</span></span><span class=operator>OF</span> tree_map_of_invar<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> invar_empty<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Solve_SASP-tree_map_of_dom><span class=command>lemma</span></span> tree_map_of_dom<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=free>lookup</span> <span class=main>(</span>tree_map_of' <span class=free>empty</span> <span class=free>pres</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> dom <span class=main>(</span>map_of <span class=free>pres</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>pres</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_empty map_update<span class=main><span class=main>[</span></span><span class=operator>OF</span> tree_map_of_invar<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> invar_empty<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span> tree_map_of_works<span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=Solve_SASP-distinct_if_sorted><span class=command>lemma</span></span> distinct_if_sorted<span class=main>:</span> <span class=quoted><span class=quoted>"sorted <span class=free>xs</span> <span class=main>⟹</span> distinct <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> induct_list012<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>context</span></span> Map_by_Ordered
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Solve_SASP-tree_map_of_distinct><span class=command>lemma</span></span> tree_map_of_distinct<span class=main>:</span> <span class=quoted><span class=quoted>"distinct <span class=main>(</span>map fst <span class=main>(</span><span class=free>inorder</span> <span class=main>(</span>tree_map_of' <span class=free>empty</span> <span class=free>pres</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>pres</span></span><span class=main>)</span> 
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_empty inorder_empty<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> distinct_if_sorted invar_def invar_empty invar_update tree_map_of_invar
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=Solve_SASP-set_tree_intorder><span class=command>lemma</span></span> set_tree_intorder<span class=main>:</span> <span class=quoted><span class=quoted>"set_tree <span class=free>t</span> <span class=main>=</span> set <span class=main>(</span>inorder <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>t</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-map_of_eq><span class=command>lemma</span></span> map_of_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"map_of <span class=free>xs</span> <span class=main>=</span> Map.map_of <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_of_simps <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.split<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-lookup_someD><span class=command>lemma</span></span> lookup_someD<span class=main>:</span> <span class=quoted><span class=quoted>"lookup <span class=free>T</span> <span class=free>x</span> <span class=main>=</span> Some <span class=free>y</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>p</span><span class=main>.</span> <span class=bound>p</span> <span class=main>∈</span> set <span class=main>(</span>inorder <span class=free>T</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>p</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>T</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-map_of_lookup><span class=command>lemma</span></span> map_of_lookup<span class=main>:</span> <span class=quoted><span class=quoted>"sorted1 <span class=main>(</span>inorder <span class=free>T</span><span class=main>)</span> <span class=main>⟹</span> Map.map_of <span class=main>(</span>inorder <span class=free>T</span><span class=main>)</span> <span class=main>=</span> lookup <span class=free>T</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>T</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.splits <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> map_le_antisym
      <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> lookup_map_of map_add_Some_iff map_of_None2 sorted_wrt_append<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> lookup_someD
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_of_eq map_add_def map_le_def
            <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.splits<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Solve_SASP-map_le_cong><span class=command>lemma</span></span> map_le_cong<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=free>m1</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>m2</span> <span class=bound>x</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>m1</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span> <span class=main>⟷</span> <span class=free>m2</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>

<span class=keyword1 id=Solve_SASP-match_pres_submap><span class=command>lemma</span></span> match_pres_submap<span class=main>:</span>
  <span class=quoted><span class=quoted>"match_pres <span class=main>(</span>inorder <span class=main>(</span>M.tree_map_of' empty <span class=free>pres</span><span class=main>)</span><span class=main>)</span> <span class=free>s</span> <span class=main>⟷</span> Map.map_of <span class=free>pres</span> <span class=keyword1>⊆<span class=hidden>⇩</span><sub>m</sub></span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> match_pres_distinct<span class=main>[</span><span class=operator>OF</span> M.tree_map_of_distinct<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> M.invar_def M.invar_empty M.tree_map_of_invar M.tree_map_of_works map_le_cong map_of_eq map_of_lookup<span class=main>)</span>  

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"SAS_Plus_Representation.is_operator_applicable_in <span class=free>s</span> <span class=free>op</span> <span class=main>⟷</span> 
      match_pres <span class=main>(</span>inorder <span class=main>(</span>M.tree_map_of' empty <span class=main>(</span>SAS_Plus_Representation.precondition_of <span class=free>op</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> match_pres_submap SAS_Plus_Representation.is_operator_applicable_in_def<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>decode_DIMACS_model</span> <span class=free><span class=bound><span class=entity>dimacs_M</span></span></span> <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span> <span class=main>≡</span> 
  <span class=main>(</span>ast_problem.decode_abs_plan <span class=free><span class=bound><span class=entity>prob</span></span></span>
      <span class=main>(</span>rem_noops
         <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>op</span><span class=main>.</span> <span class=keyword1>φ<span class=hidden>⇩</span><sub>O</sub>¯</span> <span class=main>(</span>prob_with_noop <span class=main>(</span>ast_problem.abs_prob <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>)</span> <span class=bound>op</span><span class=main>)</span>
           <span class=main>(</span>concat 
              <span class=main>(</span><span class=keyword1>Φ¯</span> <span class=main>(</span><span class=keyword1>φ</span> <span class=main>(</span>prob_with_noop <span class=main>(</span>ast_problem.abs_prob <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                   <span class=main>(</span><span class=main>(</span>dimacs_model_to_abs <span class=free><span class=bound><span class=entity>dimacs_M</span></span></span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span><span class=main>)</span> <span class=keyword1>o</span>
                     <span class=main>(</span>cnf_to_dimacs.var_to_dimacs <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>h</span></span></span><span class=main>)</span>
                        <span class=main>(</span>Suc <span class=main>(</span>length <span class=main>(</span>ast_problem.astδ <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                   <span class=free><span class=bound><span class=entity>h</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Solve_SASP-planning_dimacs_sound_code><span class=command>lemma</span></span> planning_dimacs_sound_code<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>ast_problem.well_formed <span class=free>prob</span><span class=main>;</span>
    <span class=main>∀</span><span class=bound>π</span><span class=main>∈</span>set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span><span class=main>.</span> is_standard_operator' <span class=bound>π</span><span class=main>⟧</span> <span class=main>⟹</span>
    <span class=keyword1>let</span>
      <span class=bound>cnf_formula</span> <span class=main>=</span> <span class=main>(</span>SASP_to_DIMACS <span class=free>h</span> <span class=free>prob</span><span class=main>)</span><span class=main>;</span>
      <span class=bound>decoded_plan</span> <span class=main>=</span> decode_DIMACS_model <span class=free>dimacs_M</span> <span class=free>h</span> <span class=free>prob</span>
    <span class=keyword1>in</span>
     <span class=main>(</span>dimacs_model <span class=free>dimacs_M</span> <span class=bound>cnf_formula</span> <span class=main>⟶</span> ast_problem.valid_plan <span class=free>prob</span> <span class=bound>decoded_plan</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> SASP_to_DIMACS_def decode_DIMACS_model_def Let_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> impI sat_solve_sasp.planning_dimacs_sound<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> Let_def<span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unfold_locales</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>"<span class=free>decode_DIMACS_model'</span> <span class=free><span class=bound><span class=entity>dimacs_M</span></span></span> <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span> <span class=main>≡</span> 
     decode_DIMACS_model <span class=free><span class=bound><span class=entity>dimacs_M</span></span></span> <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=main>(</span>rem_implicit_pres_ops <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id="Solve_SASP-planning_dimacs_sound_code'"><span class=command>lemma</span></span> planning_dimacs_sound_code'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>ast_problem.well_formed <span class=free>prob</span><span class=main>;</span>
   <span class=main>(</span><span class=main>⋀</span><span class=bound>op</span><span class=main>.</span> <span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span> <span class=main>⟹</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span><span class=main>;</span>
    <span class=main>∀</span><span class=bound>π</span><span class=main>∈</span>set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span><span class=main>.</span> is_standard_operator <span class=bound>π</span><span class=main>⟧</span> <span class=main>⟹</span>
    <span class=keyword1>let</span>
      <span class=bound>cnf_formula</span> <span class=main>=</span> <span class=main>(</span>SASP_to_DIMACS' <span class=free>h</span> <span class=free>prob</span><span class=main>)</span><span class=main>;</span>
      <span class=bound>decoded_plan</span> <span class=main>=</span> decode_DIMACS_model' <span class=free>dimacs_M</span> <span class=free>h</span> <span class=free>prob</span>
    <span class=keyword1>in</span>
     <span class=main>(</span>dimacs_model <span class=free>dimacs_M</span> <span class=bound>cnf_formula</span> <span class=main>⟶</span> ast_problem.valid_plan <span class=free>prob</span> <span class=bound>decoded_plan</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> SASP_to_DIMACS'_def decode_DIMACS_model'_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subst</span> rem_implicit_pres_ops_valid_plan<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_valid_plan wf_ast_problem_def
           <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rem_implicit_pres_is_standard_operator'
                   rem_implicit_pres_ops_well_formed
                   rev_iffD2<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ rem_implicit_pres_ops_valid_plan<span class=main><span class=main>]</span></span>
                   planning_dimacs_sound_code wf_ast_problem.intro
           <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rem_implicit_pres_ops_inδD<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Checking if the model satisfies the formula takes the longest time in the decoding function.
      We reimplement that part using red black trees, which makes it 10 times faster, on average!›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>list_to_rbt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int list <span class=main>⇒</span> int rbt"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>list_to_rbt</span> <span class=main>[]</span> <span class=main>=</span> Leaf"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>list_to_rbt</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>#</span><span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> insert_rbt <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span><span class=free>list_to_rbt</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Solve_SASP-inv_list_to_rbt><span class=command>lemma</span></span> inv_list_to_rbt<span class=main>:</span> <span class=quoted><span class=quoted>"invc <span class=main>(</span>list_to_rbt <span class=free>xs</span><span class=main>)</span> <span class=main>∧</span> invh <span class=main>(</span>list_to_rbt <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rbt_def RBT.inv_insert<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-Tree2_list_to_rbt><span class=command>lemma</span></span> Tree2_list_to_rbt<span class=main>:</span> <span class=quoted><span class=quoted>"Tree2.bst <span class=main>(</span>list_to_rbt <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> RBT.bst_insert<span class=main>)</span>

<span class=keyword1 id=Solve_SASP-set_list_to_rbt><span class=command>lemma</span></span> set_list_to_rbt<span class=main>:</span> <span class=quoted><span class=quoted>"Tree2.set_tree <span class=main>(</span>list_to_rbt <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> RBT.set_tree_insert Tree2_list_to_rbt<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The following ›</span></span>

<span class=keyword1 id=Solve_SASP-dimacs_model_code><span class=command>lemma</span></span> dimacs_model_code<span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"dimacs_model <span class=free>ls</span> <span class=free>cs</span> <span class=main>⟷</span> 
        <span class=main>(</span><span class=keyword1>let</span> <span class=bound>tls</span> <span class=main>=</span> list_to_rbt <span class=free>ls</span> <span class=keyword1>in</span>
          <span class=main>(</span><span class=main>∀</span><span class=bound>c</span><span class=main>∈</span>set <span class=free>cs</span><span class=main>.</span> size <span class=main>(</span>inter_rbt <span class=main>(</span><span class=bound>tls</span><span class=main>)</span> <span class=main>(</span>list_to_rbt <span class=bound>c</span><span class=main>)</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span> <span class=main>∧</span>
               distinct <span class=main>(</span>map dimacs_lit_to_var <span class=free>ls</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> RBT.set_tree_inter<span class=main>[</span><span class=operator>OF</span> Tree2_list_to_rbt Tree2_list_to_rbt<span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dimacs_model_def Let_def set_list_to_rbt inter_rbt_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> IntI RBT.set_empty empty_iff<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Tree2.eq_set_tree_empty disjoint_iff_not_equal<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>"<span class=free>decode</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span> <span class=main>≡</span>
     <span class=keyword1>if</span> ast_problem.well_formed <span class=free><span class=bound><span class=entity>prob</span></span></span> <span class=keyword1>then</span>
       <span class=keyword1>if</span> <span class=main>(</span><span class=main>∀</span><span class=bound>op</span><span class=main>∈</span>set <span class=main>(</span>ast_problem.astδ <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>.</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span> <span class=keyword1>then</span>
         <span class=keyword1>if</span> <span class=main>(</span><span class=main>∀</span><span class=bound>op</span><span class=main>∈</span>set <span class=main>(</span>ast_problem.astδ <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>.</span> is_standard_operator <span class=bound>op</span><span class=main>)</span> <span class=keyword1>then</span>
           <span class=keyword1>if</span> <span class=main>(</span>dimacs_model <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>(</span>SASP_to_DIMACS' <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span><span class=main>)</span> <span class=keyword1>then</span>
             Inl <span class=main>(</span>decode_DIMACS_model' <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>h</span></span></span> <span class=free><span class=bound><span class=entity>prob</span></span></span><span class=main>)</span>
           <span class=keyword1>else</span> Inr <span class=main>(</span><span class=keyword1>STR</span> <span class=inner_quoted>''Error: Model does not solve the problem!''</span><span class=main>)</span>
         <span class=keyword1>else</span>
           Inr <span class=main>(</span><span class=keyword1>STR</span> <span class=inner_quoted>''Error: Conditional effects!''</span><span class=main>)</span>
       <span class=keyword1>else</span>
         Inr <span class=main>(</span><span class=keyword1>STR</span> <span class=inner_quoted>''Error: Preconditions inconsistent''</span><span class=main>)</span>
     <span class=keyword1>else</span>
       Inr <span class=main>(</span><span class=keyword1>STR</span> <span class=inner_quoted>''Error: Problem malformed!''</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Solve_SASP-decode_sound><span class=command>lemma</span></span> decode_sound<span class=main>:</span>
  <span class=quoted><span class=quoted>"decode <span class=free>M</span> <span class=free>h</span> <span class=free>prob</span> <span class=main>=</span> Inl <span class=free>plan</span> <span class=main>⟹</span> 
         ast_problem.valid_plan <span class=free>prob</span> <span class=free>plan</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> decode_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list.pred_set<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> planning_dimacs_sound_code'
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Solve_SASP-decode_complete><span class=command>lemma</span></span> decode_complete<span class=main>:</span>
  <span class=quoted><span class=quoted>"decode <span class=free>M</span> <span class=free>h</span> <span class=free>prob</span> <span class=main>=</span> Inr <span class=free>err</span> <span class=main>⟹</span>
         <span class=main>¬</span> <span class=main>(</span>ast_problem.well_formed <span class=free>prob</span> <span class=main>∧</span> 
            <span class=main>(</span><span class=main>∀</span><span class=bound>op</span> <span class=main>∈</span> set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span><span class=main>.</span> consistent_pres_op <span class=bound>op</span><span class=main>)</span> <span class=main>∧</span>
            <span class=main>(</span><span class=main>∀</span><span class=bound>π</span><span class=main>∈</span>set <span class=main>(</span>ast_problem.astδ <span class=free>prob</span><span class=main>)</span><span class=main>.</span> is_standard_operator <span class=bound>π</span><span class=main>)</span> <span class=main>∧</span> 
            dimacs_model <span class=free>M</span> <span class=main>(</span>SASP_to_DIMACS' <span class=free>h</span> <span class=free>prob</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> decode_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list.pred_set<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"ListMem <span class=free>x'</span> <span class=main>[]</span><span class=main>=</span> False"</span></span>
  <span class=quoted><span class=quoted>"ListMem <span class=free>x'</span> <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x'</span> <span class=main>=</span> <span class=free>x</span> <span class=main>∨</span> ListMem <span class=free>x'</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ListMem_iff<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span> <span class=main>=</span> SASP_to_DIMACS_def ast_problem.abs_prob_def
                ast_problem.abs_ast_variable_section_def ast_problem.abs_ast_operator_section_def
                ast_problem.abs_ast_initial_state_def ast_problem.abs_range_map_def
                ast_problem.abs_ast_goal_def cnf_to_dimacs.var_to_dimacs.simps
                ast_problem.astδ_def ast_problem.astDom_def ast_problem.abs_ast_operator_def
                ast_problem.astI_def ast_problem.astG_def ast_problem.lookup_action_def
                ast_problem.I_def execute_operator_sas_plus_def ast_problem.decode_abs_plan_def

<span class=keyword1><span class=command>definition</span></span> <span class=entity>nat_opt_of_integer</span> <span class=main>::</span> <span class=quoted><span class=quoted>"integer <span class=main>⇒</span> nat option"</span></span> <span class=keyword2><span class=keyword>where</span></span>
       <span class=quoted><span class=quoted>"<span class=free>nat_opt_of_integer</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≥</span> <span class=main>0</span><span class=main>)</span> <span class=keyword1>then</span> Some <span class=main>(</span>nat_of_integer <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>max_var</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int list <span class=main>⇒</span> int"</span></span> <span class=keyword2><span class=keyword>where</span></span>
       <span class=quoted><span class=quoted>"<span class=free>max_var</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>≡</span> fold <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>::</span>int<span class=main>)</span> <span class=main>(</span><span class=bound>y</span><span class=main>::</span>int<span class=main>)</span><span class=main>.</span> <span class=keyword1>if</span> abs <span class=bound>x</span> <span class=main>≥</span> abs <span class=bound>y</span> <span class=keyword1>then</span> <span class=main>(</span>abs <span class=bound>x</span><span class=main>)</span> <span class=keyword1>else</span> <span class=bound>y</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>export_code</span></span> <span class=quoted><span class=quoted>encode</span></span> <span class=quoted><span class=quoted>nat_of_integer</span></span> <span class=quoted><span class=quoted>integer_of_nat</span></span> <span class=quoted><span class=quoted>nat_opt_of_integer</span></span> <span class=quoted><span class=quoted>Inl</span></span> <span class=quoted><span class=quoted>Inr</span></span> <span class=quoted><span class=quoted>String.explode</span></span>
    <span class=quoted><span class=quoted>String.implode</span></span> <span class=quoted><span class=quoted>max_var</span></span> <span class=quoted><span class=quoted>concat</span></span> <span class=quoted><span class=quoted>char_of_nat</span></span> <span class=quoted><span class=quoted>Int.nat</span></span> <span class=quoted><span class=quoted>integer_of_int</span></span> <span class=quoted><span class=quoted>length</span></span> <span class=quoted><span class=quoted>int_of_integer</span></span>
  <span class=keyword2><span class=keyword>in</span></span> SML <span class=keyword2><span class=keyword>module_name</span></span> exported <span class=keyword2><span class=keyword>file_prefix</span></span> SASP_to_DIMACS

<span class=keyword1><span class=command>export_code</span></span> <span class=quoted><span class=quoted>decode</span></span> <span class=quoted><span class=quoted>nat_of_integer</span></span> <span class=quoted><span class=quoted>integer_of_nat</span></span> <span class=quoted><span class=quoted>nat_opt_of_integer</span></span> <span class=quoted><span class=quoted>Inl</span></span> <span class=quoted><span class=quoted>Inr</span></span> <span class=quoted><span class=quoted>String.explode</span></span>
    <span class=quoted><span class=quoted>String.implode</span></span> <span class=quoted><span class=quoted>max_var</span></span> <span class=quoted><span class=quoted>concat</span></span> <span class=quoted><span class=quoted>char_of_nat</span></span> <span class=quoted><span class=quoted>Int.nat</span></span> <span class=quoted><span class=quoted>integer_of_int</span></span> <span class=quoted><span class=quoted>length</span></span> <span class=quoted><span class=quoted>int_of_integer</span></span>
  <span class=keyword2><span class=keyword>in</span></span> SML <span class=keyword2><span class=keyword>module_name</span></span> exported <span class=keyword2><span class=keyword>file_prefix</span></span> decode_DIMACS_model

<span class=keyword2><span class=keyword>end</span></span>
</pre></div></main></div></div></body></html>